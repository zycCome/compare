### **【数据模型】原型与JSON**

**核心职责**：为**单张**物理表进行一次性的、标准化的业务封装，完成**物理字段到逻辑概念（维度/指标/属性）的权威映射**，并支持通过表达式创建新的“计算字段”。

#### **原型 (Plaintext) - 数据模型**
```
+--------------------------------------------------------------------------------------------------+
|  <-- 返回  |  创建/编辑数据模型: 采购协议模型                                     [取消] [保存模型]  |
|==================================================================================================|
|                                                                                                  |
|  [ ① 基本信息与数据源关联 ]                                                                      |
|  ----------------------------------------------------------------------------------------------  |
|  * 模型编码: [ DM_AGREEMENT                         ]                                           |
|  * 模型名称: [       采购协议模型                   ]                                           |
|  * 模型描述: [ 采购协议模型，包含协议编号、产品编码、供应商编码、净价、税率、协议价(含税)、协议品牌号 ] 文本域|
|  * 数据源类型: [ Doris | v ]          <-- (选择Doris或者Mysql)                                     |
|  * 数据库名称: [ yyigou_dsrp | v ]          <-- (选择Doris或者Mysql连接下的数据库)                                     |
|  * 关联物理表: [ dwd_purchase_agreements | v ]  <-- (从数据仓库选择物理表)                      |
|                                                                                                  |
|==================================================================================================|
|                                                                                                  |
|  [ ② 字段定义与映射 (为每个字段指认业务身份，可添加计算字段) ]                                     |
|  ----------------------------------------------------------------------------------------------  |
|  [ + 添加计算字段 ]                                                                              |
|                                                                                                  |
| | 来源     | 字段名/表达式                      | 业务显示名   | 字段角色     | 映射目标/关联上下文          |
| |----------|------------------------------------|--------------|--------------|------------------------------|
| | 物理字段 | product_code                       | [产品编码]   | [维度外键 | v] | -> [产品(DIM_PRODUCT)]     |
| | 物理字段 | supplier_code                      | [供应商编码] | [维度外键 | v] | -> [供应商(DIM_SUPPLIER)]  |
| | 物理字段 | net_price                          | [净价]       | [(不使用) | v] |                              |
| | 物理字段 | tax_rate                           | [税率]       | [(不使用) | v] |                              |
| | 计算字段 | [net_price * (1 + tax_rate)      ] | [协议价(含税)] | [度量实现 | v] | -> [协议价(P001)]          |
| | 计算字段 | [agreement_code || '-' || brand_name] | [协议品牌号]   | [描述性属性 | v] | 关联到: [协议价(含税)]     |
|--------------------------------------------------------------------------------------------------|
|                                                                                                  |
+--------------------------------------------------------------------------------------------------+```

#### **配套JSON示例 (数据模型)**
```json
{
  "dataModelId": "dm_agreement",
  "dataModelCode": "DM_AGREEMENT",
  "dataModelName": "采购协议模型",
  "dataModelDesc": "采购协议模型，包含协议编号、产品编码、供应商编码、净价、税率、协议价(含税)、协议品牌号",
  "dataSourceType": "DORIS",
  "databaseName": "yyigou_dsrp",
  "sourceTableName": "dwd_purchase_agreements",
  
  // -- 对应原型第二部分 --
  "fields": [
    {
      "fieldId": "dmf_001",
      "sourceType": "PHYSICAL",
      "physicalName": "product_code",
      "expression": null,
      "businessName": "产品编码",
      "role": "DIMENSION_FK",
      "mappingTargetId": "DIM_PRODUCT", // 关联到维度库
      "contextFieldId": null
    },
    // ... 其他物理字段 ...
    {
      "fieldId": "dmf_005",
      "sourceType": "PHYSICAL",
      "physicalName": "net_price",
      "businessName": "净价",
      "role": "UNUSED", // 不直接参与分析，仅作为计算原料
      "mappingTargetId": null,
      "contextFieldId": null
    },
    // -- 计算字段的定义 --
    {
      "fieldId": "dmf_007",
      "sourceType": "CALCULATED",
      "physicalName": null, // 计算字段没有物理名
      "expression": "net_price * (1 + tax_rate)",
      "businessName": "协议价(含税)",
      "role": "MEASURE_IMPL",
      "mappingTargetId": "P001", // 将计算结果映射到指标库
      "contextFieldId": null
    },
    {
      "fieldId": "dmf_008",
      "sourceType": "CALCULATED",
      "physicalName": null,
      "expression": "agreement_code || '-' || brand_name",
      "businessName": "协议品牌号",
      "role": "DESCRIPTIVE",
      "mappingTargetId": null,
      "contextFieldId": "dmf_007" // 声明其修饰哪个字段(协议价(含税))
    }
  ],
  "status": "ACTIVE"
}
```