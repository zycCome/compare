### **最终版原型：新增/编辑比价模型界面 (基于交互式表格)**

**场景**：管理员在后台点击“新建模型”或“编辑模型”时，呈现此全屏配置页面。

**设计理念**：
*   **数据驱动**：以用户选择的“主数据集”为核心驱动，动态生成可配置的字段表格。
*   **角色化配置**：在一个统一的表格视图中，为每个字段清晰地指派其在当前模型中的一个或多个“角色”（分析指标、分析对象、分析维度）。
*   **透明与赋能**：将所有可用字段及其预定义类型完全透明地展示给模型创建者，赋予其最大的配置灵活性。

#### **原型 (Plaintext) - 最终交互版**

```
+--------------------------------------------------------------------------------------------------+
|  <-- 返回  |  创建比价模型                                                    [取消] [保存模型]  |
|==================================================================================================|
|                                                                                                  |
|  [ ① 基本信息 ]                                                                                  |
|  ----------------------------------------------------------------------------------------------  |
|  * 模型编码:    [ 系统自动生成... ]       * 模型名称:    [ 医疗器械核心耗材比价模型... ]            |
|   * 比价对象类型: (o)相同产品 ( )同类产品    |
|   模型描述:    [ 多行文本框，输入模型的用途和适用场景...                              ]           | 
|                                                                                                  |
|--------------------------------------------------------------------------------------------------|
|                                                                                                  |
|  [ ② 配置主数据集字段角色 ]                                                                      |
|  ----------------------------------------------------------------------------------------------  |
|  * 主数据集: [ DWD层-采购协议表 | v ] <-- (选择后，下方表格会自动加载并填充字段)                |
|                                                                                                  |
|  |--------------------------------------------------------------------------------------------| |
|  | | 字段名         | 类型(预定义) | 显示名         | 分析指标 | 分析对象 | 分析维度/属性 |    | |
|  | |                |              | (可修改别名)   | (比价指标) | (可筛选) | (可展示列)  |    | |
|  | |----------------|--------------|----------------|----------|----------|---------------|    | |
|  | | agreement_price| 度量         | [协议价(含税)] |   [√]    |   [ ]    |      [√]      |    | |
|  | | agreement_qty  | 度量         | [协议数量]     |   [√]    |   [ ]    |      [√]      |    | |
|  | | supplier_name  | 维度         | [供应商]       |   [ ]    |   [√]    |      [√]      |    | |
|  | | product_name   | 维度         | [产品]         |   [ ]    |   [√]    |      [√]      |    | |
|  | | org_name       | 维度         | [采购组织]     |   [ ]    |   [√]    |      [√]      |    | |
|  | | brand_name     | 属性         | [品牌]         |   [ ]    |   [ ]    |      [√]      |    | |
|  | | agreement_code | 普通字段     | [协议编号]     |   [ ]    |   [ ]    |      [√]      |    | |
|  | | ...            | ...          | ...            |   ...    |   ...    |      ...      |    | |
|  |--------------------------------------------------------------------------------------------| |
|                                                                                                  |
|--------------------------------------------------------------------------------------------------|
|                                                                                                  |
|  [ ③ 配置基准指标池 ]                                                                            |
|  ----------------------------------------------------------------------------------------------  |
|  可选的基准指标:                                                                                 |
|  [ (x) 历史订单均价 | (x) 集团指导价 | v ] <-- (从指标库多选，数据源等在方案中配置)         |
|                                                                                                  |
|  可选的计算指标:                                                                                 |
|  [ (x) 价格差异额 | (x) 价格差异率 | v ]                                                       |
|                                                                                                  |
+--------------------------------------------------------------------------------------------------+
```
**原型交互逻辑最终说明**：
1.  **加载与填充**：选择“主数据集”后，系统后端获取该数据集所有已映射字段的列表，并填充到②区的表格中。
2.  **类型 (预定义)**：此列由【数据集】模块的配置决定，在此处为只读，用于告知用户每个字段的“天赋”。
3.  **三列勾选框的角色**：
    *   **分析指标 (比价指标)**：只有“度量”类型的字段，此复选框才可用。勾选后，该字段将成为下游【比价方案】中“核心比价指标”的选项。
    *   **分析对象 (可筛选)**：只有“维度”类型的字段，此复选框才可用。勾选后，该字段将成为下游【比价方案】中“全局查询条件”的筛选项。
    *   **分析维度/属性 (可展示列)**：**所有字段**的此复选框都可用。勾选后，该字段将成为下游【比价方案】中“选择列示内容”里的可选列。

---

### **配套的、全量的界面配置JSON数据示例**

这份JSON代表了一个**完整的、已保存的“比价模型”**的数据库实体结构。其核心变化在于，我们将之前分散的配置项，全部统一到了一个结构化的`field_role_config`对象中，使其与新的交互式表格完全对应。

```json
{
  "modelId": "model_123",
  "modelName": "医疗器械核心耗材比价模型",
  "description": "基于交互式表格配置的、新一代高灵活性比价模型。",
  
  // -- 对应原型第一部分 --
  "comparisonObjectType": "SAME_PRODUCT",
  
  // -- 对应原型第二部分 --
  "primaryDatasetId": "ds_01",
  "fieldRoleConfig": {
    // key 是数据集中的物理字段名
    "agreement_price": {
      "displayName": "协议价(含税)", // 用户可修改的别名
      "isComparisonIndicator": true, // 对应“分析指标”列的勾选
      "isAnalysisObject": false,     // 对应“分析对象”列的勾选 (度量类型不可用)
      "isDisplayDimension": true   // 对应“分析维度/属性”列的勾选
    },
    "agreement_qty": {
      "displayName": "协议数量",
      "isComparisonIndicator": true,
      "isAnalysisObject": false,
      "isDisplayDimension": true
    },
    "supplier_name": {
      "displayName": "供应商",
      "isComparisonIndicator": false, // 维度类型不可用
      "isAnalysisObject": true,
      "isDisplayDimension": true
    },
    "product_name": {
      "displayName": "产品",
      "isComparisonIndicator": false,
      "isAnalysisObject": true,
      "isDisplayDimension": true
    },
    "org_name": {
      "displayName": "采购组织",
      "isComparisonIndicator": false,
      "isAnalysisObject": true,
      "isDisplayDimension": true
    },
    "brand_name": {
      "displayName": "品牌",
      "isComparisonIndicator": false, // 属性类型不可用
      "isAnalysisObject": false,     // 属性类型不可用
      "isDisplayDimension": true
    },
    "agreement_code": {
      "displayName": "协议编号",
      "isComparisonIndicator": false, // 普通字段类型不可用
      "isAnalysisObject": false,     // 普通字段类型不可用
      "isDisplayDimension": true
    }
  },

  // -- 对应原型第三部分 --
  "baselineConfig": {
    "optionalBaselineIndicatorIds": ["H001", "G001"],
    "optionalCalculatedIndicatorIds": ["DIFF_AMOUNT", "DIFF_PERCENT"]
  },

  "creatorId": "admin_01",
  "createdAt": "2025-08-06 18:00:00"
}
```