好，我帮你把**比价规则**原型按照我们之前的讨论重新整理，确保和你现在的“比价模型 → 比价规则 → 比价方案”闭环一致，尤其是解决你之前提到的 **规则如何提前选到计算指标** 的问题。

我会分成：

1. **Plaintext 原型**（字段与布局）
2. **UI 原型结构说明**（推荐交互与组件）
3. **配置 JSON 契约示例**（研发可直接落地）

---

## **一、Plaintext 原型**

```
[页面] 编辑比价规则

1) 基本信息
- 规则ID*         [rule_price_warning]
- 规则名称*       [价格预警规则]
- 规则描述        [当差异率或差异额超过设定值时进行预警或打分]
- 标签            [预警] [评分] [+]

2) 模型引用
- 选择比价模型*   [供应商价格对比模型 ▼]
  （绑定模型后，可获取模型的原子指标、基准指标、计算指标）

3) 规则类型*
- 控制型（预警/过滤）
- 评分型（打分/加权）

4) 规则条件配置（控制型）
- 条件列表（支持多条 AND/OR 组合）
    - 指标选择：从引用的模型中选择（支持计算指标，如差异率、差异额）
    - 条件符号： >  <  =  !=  BETWEEN  IN
    - 阈值： 数值输入框（支持百分比/货币自动格式）
    - 提示信息：文本
    - 严重程度：高/中/低
- 示例：差异率 > 0.1 → 提示 "价格偏高"

5) 评分因子配置（评分型）
- 从引用的模型中选择可评分的指标
- 为每个指标设置：
    - 权重（百分比）
    - 分值计算方式（区间打分 / 公式打分）
    - 区间打分配置（如 0%-5% = 100分，5%-10% = 80分）
    - 公式打分（如 100 - (差异率*1000)）

6) 应用范围（可选）
- 应用组织：多选组织
- 数据集过滤条件：SQL WHERE 条件（可视化条件构建器）

7) 元数据
- 创建人 / 创建时间
- 启用开关

[取消] [保存]
```

---

## **二、UI 原型结构说明**

### **整体布局**

* 顶部：规则基本信息卡片（ID/名称/描述/标签/类型/启用状态）
* Tabs 分区：

  1. 模型引用
  2. 控制型条件配置
  3. 评分型因子配置
  4. 应用范围
  5. 元数据

### **交互细节**

* **模型引用**

  * 使用 `Select` 选择模型，加载后显示模型可用指标（原子 + 基准 + 计算）
* **条件配置（控制型）**

  * 使用 `Table` 展示条件列表，每行有：

    * 指标下拉（分组：原子指标/计算指标）
    * 条件符号下拉
    * 阈值输入（根据指标类型自动格式化）
    * 提示文本输入
    * 严重程度 `Select`
  * 支持添加行（AND/OR逻辑选择器）
* **评分配置（评分型）**

  * 使用 `Table` 或 `List`，每行显示：

    * 指标选择器
    * 权重滑条（`Slider`）
    * 打分模式单选（区间 / 公式）
    * 配置区（区间表格 / 公式编辑器）
* **应用范围**

  * 组织选择器（TreeSelect）
  * 数据集过滤条件构建器（类似 Tableau 的 Filter UI）
* **实时预览**

  * 右侧浮动面板：当前规则条件的 SQL/公式预览

---

## **三、配置 JSON 契约示例**

```json
{
  "ruleId": "rule_price_warning",
  "name": "价格预警规则",
  "description": "当差异率或差异额超过设定值时进行预警或打分",
  "tags": ["预警", "评分"],
  "modelRef": "mdl_vendor_price_compare",
  "ruleType": "control",  // control | score
  "conditions": [
    {
      "indicatorId": "ind_diff_rate",
      "operator": ">",
      "value": 0.1,
      "unit": "percent",
      "message": "价格偏高",
      "severity": "high"
    },
    {
      "indicatorId": "ind_diff_amount",
      "operator": "<",
      "value": -100,
      "unit": "CNY",
      "message": "价格低于基准",
      "severity": "low"
    }
  ],
  "scoringFactors": [],
  "applyScope": {
    "orgs": ["org001", "org002"],
    "datasetFilter": {
      "field": "purchase_mode",
      "operator": "=",
      "value": "集中采购"
    }
  },
  "enable": true,
  "createdBy": "user001",
  "createdAt": "2025-08-12T09:30:00Z"
}
```

---

✅ **这样设计的好处**

* 规则只引用模型，不直接依赖方案
* 模型里已经有了计算指标（差异率、差异额），规则配置时可以直接选择
* 规则可以配置成预警型（控制型）或评分型（打分型）
* 方案引用规则时，能直接套用规则逻辑并执行

---
