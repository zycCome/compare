# A. 比价规则（Rule Set）

## 1) Plaintext 原型

```
页头
────────────────────────────────
比价规则 · 新建/编辑
状态：草稿 | 保存 | 发布 | 返回
────────────────────────────────

(1) 基本
- 规则集名称*      [__________________]
- 规则集编码*      [rule_vendor_compare_default]
- 标签            [控制型] [评分型] [+]
- 描述            [____________________________________________]
- 启用            (✓)

(2) 变量来源（只读）
- 可用指标/字段    来自方案执行时传入的数据列（如 ind_diff_rate、vendor_id 等）

(3) 规则明细（可多条；顺序可调整）
- [ + 新增规则 ]

  ① 控制型（阈值/布尔命中 → 触发动作）
   · 名称*          [高于历史最低10%预警]
   · 条件表达式*    [ ind_diff_rate > 0.10 ]
   · 动作*          [ warn ▼ ]   （warn|error|exclude|mark）
   · 附加配置       [ 消息模板ID ▼ ]  [ 审批流程ID ▼ ]  [ 颜色标记：红色 ]

  ② 评分型（多因子加权）
   · 名称*          [价格因子得分]
   · 因子*          [ ind_diff_rate ]
   · 权重*          [ 0.6 ]
   · 得分表达式*    [ MAX(0, 100 - ind_diff_rate*100) ]   //0~100

  ③ 评分型（辅因子）
   · 名称*          [供应商评级因子]
   · 因子*          [ vendor_score ]     // 可由附加数据集带入
   · 权重*          [ 0.4 ]
   · 得分表达式*    [ vendor_score ]     //假设0~100

(4) 评分聚合
- 总分计算         [ SUM(weighted_factors) ] | [ 自定义表达式… ]

(5) 预览
- 使用样例数据试跑，查看命中与得分
```

## 2) UI 原型（草图）

```
┌───────────────────────────────────────────────┐
│ ① 基本信息 | ② 规则明细 | ③ 评分聚合 | ④ 预览                       │
├───────────────────────────────────────────────┤
│ 规则明细列表： [ 控制型-10%预警 ] [ 评分-价格 ] [ 评分-评级 ] [+新增] │
│ 右侧编辑面板： 类型单选(控制/评分) → 字段/表达式 → 动作/权重 → 保存 │
└───────────────────────────────────────────────┘
```

## 3) 界面配置 JSON（示例）

```json
{
  "ruleSetName": "默认供应商比价规则集",
  "ruleSetCode": "rule_vendor_compare_default",
  "tags": ["控制型", "评分型"],
  "enabled": true,
  "description": "价格差异预警+多因子评分",
  "rules": [
    {
      "id": "r1",
      "type": "control",
      "name": "高于历史最低10%预警",
      "expr": "ind_diff_rate > 0.10",
      "action": "warn",
      "style": {"color": "red"},
      "notify": {"messageTemplateId": "msg_tpl_over_10", "flowId": null}
    },
    {
      "id": "r2",
      "type": "score",
      "name": "价格因子得分",
      "factor": "ind_diff_rate",
      "weight": 0.6,
      "scoreExpr": "MAX(0, 100 - ind_diff_rate * 100)"
    },
    {
      "id": "r3",
      "type": "score",
      "name": "供应商评级因子",
      "factor": "vendor_score",
      "weight": 0.4,
      "scoreExpr": "vendor_score"
    }
  ],
  "scoreAggregate": "SUM(weights * factorScores)"
}
```

---