### **最终版原型：新增/编辑比价方案 (全量四步向导，含动态报P表样式)**

#### **第一步：基本信息**
*   **目的**：为即将创建的方案赋予“身份”，包括名称、编码和业务描述。

```
+--------------------------------------------------------------------------+
|  创建/编辑比价方案                                               [ X ]   |
|--------------------------------------------------------------------------|
|  (1. 基本信息) -> (2. 分析规则与范围) -> (3. 基准配置) -> (4. 报表呈现)   |
|  ^-- (当前步骤高亮)                                                      |
|--------------------------------------------------------------------------|
|                                                                          |
|  * 方案名称:                                                             |
|    [ 医疗器械-核心耗材采购价分析... ]                                    |
|                                                                          |
|  * 方案编码:                                                             |
|    [ PLAN_20250806_MED001 ]  <-- (系统自动生成，可编辑)                  |
|                                                                          |
|    方案描述:                                                             |
|    [ 多行文本框，对公司主要采购的医疗耗材进行综合对标分析... ]           |
|                                                                          |
|--------------------------------------------------------------------------|
|                                                  [ 取消 ] [ 下一步 > ]   |
+--------------------------------------------------------------------------+
```

#### **第二步：选择分析规则与范围**
*   **目的**：定义本次分析的**“主视角”**——用什么规则（模型）、具体比哪个数字（分析指标）、看哪些主体之间（查询条件）的对比。

```
+--------------------------------------------------------------------------+
|  创建/编辑比价方案                                               [ X ]   |
|--------------------------------------------------------------------------|
|  (1) -> (2. 分析规则与范围) -> (3) -> (4)                                 |
|         ^-- (当前步骤高亮)                                               |
|--------------------------------------------------------------------------|
|                                                                          |
|  * 选择比价模型: [ 医疗器械核心耗材比价模型 | v ]                        |
|    (说明：选择后，下方所有可选的指标和查询条件都将由此模型决定)          |
|                                                                          |
|  * 选择分析指标: [ 协议价(含税) | v ]  <-- (选项来自模型授权的比价指标)    |
|                                                                          |
|  ----------------------------------------------------------------------  |
|  [ 全局查询条件 (筛选本次分析的主体范围) ]                               |
|                                                                          |
|  * 比价对象 (产品):                                                      |
|    [ 进口输液器(J101) × | 医用口罩(M205) × | v ] <-- (多选Select)     |
|                                                                          |
|  * 分析对象 (供应商):                                                    |
|    [ 强生医疗 × | 飞利浦医疗 × | v ] <-- (多选Select)                   |
|                                                                          |
|--------------------------------------------------------------------------|
|                                     [ < 上一步 ] [ 下一步 > ]              |
+--------------------------------------------------------------------------+
```

#### **第三步：配置基准指标**
*   **目的**：定义本次分析的**“对比视角”**——要拿主视角去和谁比，并且可以为每一个“谁”定义其独立的数据来源和筛选条件。

```
+--------------------------------------------------------------------------+
|  创建/编辑比价方案                                               [ X ]   |
|--------------------------------------------------------------------------|
|  (1) -> (2) -> (3. 基准配置) -> (4)                                       |
|                 ^-- (当前步骤高亮)                                       |
|--------------------------------------------------------------------------|
|                                                                          |
|  * 报表默认基准: [ 与历史价比对 | v ] <-- (选择一个，用于报表初次加载)     |
|    (说明：此列表来源于模型中定义的“可选基准指标”)                        |
|                                                                          |
|  ----------------------------------------------------------------------  |
|  [ 请为模型中所有可选的基准指标，按需配置其参数 ]                        |
|  ----------------------------------------------------------------------  |
|                                                                          |
|  +--[配置“历史订单均价”]--(上下文分组)-------------------------------+    |
|  | * 数据来源: [ 订单历史数据集(主) | v ] <-- (用户在此为指标选择数据源) |    |
|  |   局部查询条件: 订单类型: [ 普通订单 × | v ]                      |    |
|  +--------------------------------------------------------------------+    |
|                                                                          |
|  +--[配置“集团指导价”]--(上下文分组)---------------------------------+    |
|  | * 数据来源: [ 集团指导价表 ] <-- (只读，因其只有一个可用数据源)    |    |
|  +--------------------------------------------------------------------+    |
|                                                                          |
|--------------------------------------------------------------------------|
|                                      [ < 上一步 ] [ 下一步 > ]             |
+--------------------------------------------------------------------------+
```

#### **第四步：配置报表呈现**
*   **目的**：让用户最终决定报表“长什么样”，包括选择组件样式、拖拽配置布局，并实时预览效果。

```
+--------------------------------------------------------------------------+
|  创建/编辑比价方案                                               [ X ]   |
|--------------------------------------------------------------------------|
|  (1) -> (2) -> (3) -> (4. 报表呈现)                                       |
|                         ^-- (当前步骤高亮)                               |
|--------------------------------------------------------------------------|
|  [ A. 选择报表组件样式 ]                                                 |
|  +---------------------+   +---------------------+   +---------------------+
|  |       [图标]        |   |       [图标]        |   |       [图标]        |
|  |     多维交叉表      |   |     分组柱状图      |   |       折线图        |
|  +---------------------+   +---------------------+   +---------------------+
|  ^-- (当前选中“多维交叉表”)                                              |
|  ----------------------------------------------------------------------  |
|  [ B. 配置布局与列示内容 (根据A的选择动态变化) ]                           |
|  +--[当前为“多维交叉表”的配置界面]-------------------------------------+    |
|  |                                                                      |    |
|  |  左侧可用字段(树状)  |   右侧配置区                                 |    |
|  |  +- 维度: 产品...      |   行: [ 供应商 × ]                         |    |
|  |  +- 指标: 协议价...    |   列: [ 产品分类 × ]                       |    |
|  |                      |   值: [ 协议价 × | 价格差异率 × ]           |    |
|  |                      |   附加列: [ 品牌 × | 协议编号 × ]         |    |
|  +--------------------------------------------------------------------+    |
|  ----------------------------------------------------------------------  |
|  [ C. 实时预览区 ]                                                       |
|  +--------------------------------------------------------------------+    |
|  |  <-- 此处嵌入S2组件，根据B的配置实时渲染预览 -->                     |    |
|  +--------------------------------------------------------------------+    |
|--------------------------------------------------------------------------|
|                              [ < 上一步 ] [ 完成并执行分析 ] [ 保存方案 ]  |
+--------------------------------------------------------------------------+
```

---

### **配套的、全量的比价方案JSON数据示例**

这份JSON结构与最终的四步流程完全匹配，清晰地记录了用户在每一步的决策。

```json
{
  // -- 对应步骤一: 基本信息 --
  "planId": "plan_p_98765",
  "planCode": "PLAN_20250806_MED001",
  "planName": "医疗器械-核心耗材采购价分析",
  "description": "对公司主要采购的医疗耗材进行综合对标分析",
  "ownerId": "user_101",
  
  // -- -------------------------------------- --
  // -- 对应步骤二: 分析规则与范围 --
  // -- -------------------------------------- --
  "modelId": "model_med_001",
  "analysisConfig": {
    "comparisonIndicatorId": "P005", // 用户选择的核心比价指标
    "globalFilters": { // 用户设置的全局查询条件
      "DIM_PRODUCT": ["J101", "M205"],
      "DIM_SUPPLIER": ["STRONG_MEDICAL", "PHILIPS_MEDICAL"]
    }
  },

  // -- -------------------------------------- --
  // -- 对应步骤三: 基准配置 --
  // -- -------------------------------------- --
  "baselineConfig": {
    "defaultBaselineIndicatorId": "H001", // 报表打开时默认和哪个基准比
    "configurations": [ // 对模型中每个可选基准指标的具体配置
      {
        "indicatorId": "H001", // 历史订单均价
        "sourceDatasetId": "ds_order_hist", // 用户为H001选择的数据源
        "localFilters": { // 局部查询条件
          "DIM_ORDER_BATCH_TYPE": ["NORMAL"]
        }
      },
      {
        "indicatorId": "G001", // 集团指导价
        "sourceDatasetId": "ds_group_price",
        "localFilters": {} // 用户未设置局部条件
      }
    ]
  },

  // -- -------------------------------------- --
  // -- 对应步骤四: 报表呈现 --
  // -- -------------------------------------- --
  "reportConfig": {
    // [A] 用户选择的组件样式
    "componentType": "S2_PIVOT_TABLE", 
    
    // [B] 用户为该组件配置的布局
    "layoutConfig": {
      "rows": ["DIM_SUPPLIER"],
      "columns": ["DIM_PRODUCT_CATEGORY"],
      "values": ["P005", "CALC_DIFF_PERCENT"], // P005是核心比价指标, CALC_DIFF_PERCENT是计算指标
      "extraDisplayFields": ["ATTR_BRAND", "ATTR_AGREEMENT_CODE"] // 附加的展示列
    },
    
    // 之前讨论的“列示内容”选择，实际上被 layoutConfig 更精确地定义了
    // 这里可以保留一个完整的可选字段列表，以备用户在报表页动态调整
    "availableDisplayFields": {
      "calculated": ["CALC_DIFF_AMOUNT", "CALC_DIFF_PERCENT"],
      "attributes": {
        "DIM_PRODUCT": ["ATTR_BRAND"],
        "P005": ["ATTR_AGREEMENT_CODE"],
        "H001": ["ATTR_ORIGINAL_ORDER_ID"]
      }
    }
  },

  "isTemplate": false,
  "status": "active"
}
```