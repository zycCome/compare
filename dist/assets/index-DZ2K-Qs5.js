var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,d=e=>{throw TypeError(e)},r=Math.pow,o=(t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s,c=(e,t)=>{for(var i in t||(t={}))n.call(t,i)&&o(e,i,t[i]);if(l)for(var i of l(t))a.call(t,i)&&o(e,i,t[i]);return e},m=(e,s)=>t(e,i(s)),p=(e,t,i)=>t.has(e)||d("Cannot "+i),x=(e,t,i)=>(p(e,t,"read from private field"),i?i.call(e):t.get(e)),h=(e,t,i)=>t.has(e)?d("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),u=(e,t,i,s)=>(p(e,t,"write to private field"),s?s.call(e,i):t.set(e,i),i),f=(e,t,i)=>(p(e,t,"access private method"),i),g=(e,t,i,s)=>({set _(s){u(e,t,s,i)},get _(){return x(e,t,s)}}),y=(e,t,i)=>new Promise((s,l)=>{var n=e=>{try{d(i.next(e))}catch(t){l(t)}},a=e=>{try{d(i.throw(e))}catch(t){l(t)}},d=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,a);d((i=i.apply(e,t)).next())});import{r as j,c as v,g as b,u as C,f as N,L as I,B as w,h as S,i as k}from"./react-vendor-C_X1RIjH.js";import{o as T,I as _,_ as A,T as R,B as z,a as E,A as M,C as D,b as O,R as L,c as P,d as B,e as F,f as $,D as V,S as H,g as q,h as U,F as W,i as K,j as Y,M as G,k as Q,l as J,m as X,P as Z,n as ee,s as te,U as ie,p as se,q as le,r as ne,t as ae,u as de,v as re,w as oe,x as ce,y as me,z as pe,E as xe,G as he,H as ue,J as fe,K as ge,L as ye,N as je,O as ve,Q as be,V as Ce,W as Ne,X as Ie,Y as we,Z as Se,$ as ke,a0 as Te,a1 as _e,a2 as Ae,a3 as Re,a4 as ze,a5 as Ee,a6 as Me,a7 as De,a8 as Oe}from"./ui-vendor-xE1ddF3f.js";import{T as Le,a as Pe,D as Be,U as Fe,P as $e,C as Ve,b as He,c as qe,d as Ue,S as We,e as Ke,E as Ye,f as Ge,g as Qe,h as Je,F as Xe,i as Ze,I as et,K as tt,L as it,j as st,k as lt,l as nt,m as at,n as dt,R as rt,A as ot,o as ct,p as mt,G as pt,q as xt,r as ht,s as ut}from"./utils-vendor-GeVnzjuH.js";var ft,gt,yt=(ft={"assets/index-DZ2K-Qs5.js"(e){var t,i,s,l,n,a,d,o,p,ft,gt,yt,jt,vt,bt,Ct,Nt,It,wt,St,kt,Tt,_t,At,Rt,zt,Et,Mt,Dt,Ot,Lt,Pt,Bt,Ft,$t,Vt,Ht,qt,Ut,Wt,Kt,Yt,Gt,Qt,Jt;!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Xt={exports:{}},Zt={},ei=j,ti=Symbol.for("react.element"),ii=Symbol.for("react.fragment"),si=Object.prototype.hasOwnProperty,li=ei.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ni={key:!0,ref:!0,__self:!0,__source:!0};function ai(e,t,i){var s,l={},n=null,a=null;for(s in void 0!==i&&(n=""+i),void 0!==t.key&&(n=""+t.key),void 0!==t.ref&&(a=t.ref),t)si.call(t,s)&&!ni.hasOwnProperty(s)&&(l[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===l[s]&&(l[s]=t[s]);return{$$typeof:ti,type:e,key:n,ref:a,props:l,_owner:li.current}}Zt.Fragment=ii,Zt.jsx=ai,Zt.jsxs=ai,Xt.exports=Zt;var di=Xt.exports,ri={},oi=v;ri.createRoot=oi.createRoot,ri.hydrateRoot=oi.hydrateRoot;var ci=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},mi={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},pi=new(s=class{constructor(){h(this,t,mi),h(this,i,!1)}setTimeoutProvider(e){u(this,t,e)}setTimeout(e,i){return x(this,t).setTimeout(e,i)}clearTimeout(e){x(this,t).clearTimeout(e)}setInterval(e,i){return x(this,t).setInterval(e,i)}clearInterval(e){x(this,t).clearInterval(e)}},t=new WeakMap,i=new WeakMap,s),xi="undefined"==typeof window||"Deno"in globalThis;function hi(){}function ui(e,t){return"function"==typeof e?e(t):e}function fi(e,t){const{type:i="all",exact:s,fetchStatus:l,predicate:n,queryKey:a,stale:d}=e;if(a)if(s){if(t.queryHash!==yi(a,t.options))return!1}else if(!vi(t.queryKey,a))return!1;if("all"!==i){const e=t.isActive();if("active"===i&&!e)return!1;if("inactive"===i&&e)return!1}return!("boolean"==typeof d&&t.isStale()!==d||l&&l!==t.state.fetchStatus||n&&!n(t))}function gi(e,t){const{exact:i,status:s,predicate:l,mutationKey:n}=e;if(n){if(!t.options.mutationKey)return!1;if(i){if(ji(t.options.mutationKey)!==ji(n))return!1}else if(!vi(t.options.mutationKey,n))return!1}return!(s&&t.state.status!==s||l&&!l(t))}function yi(e,t){return((null==t?void 0:t.queryKeyHashFn)||ji)(e)}function ji(e){return JSON.stringify(e,(e,t)=>Ii(t)?Object.keys(t).sort().reduce((e,i)=>(e[i]=t[i],e),{}):t)}function vi(e,t){return e===t||typeof e==typeof t&&!(!e||!t||"object"!=typeof e||"object"!=typeof t)&&Object.keys(t).every(i=>vi(e[i],t[i]))}var bi=Object.prototype.hasOwnProperty;function Ci(e,t){if(e===t)return e;const i=Ni(e)&&Ni(t);if(!(i||Ii(e)&&Ii(t)))return t;const s=(i?e:Object.keys(e)).length,l=i?t:Object.keys(t),n=l.length,a=i?new Array(n):{};let d=0;for(let r=0;r<n;r++){const n=i?r:l[r],o=e[n],c=t[n];if(o===c){a[n]=o,(i?r<s:bi.call(e,n))&&d++;continue}if(null===o||null===c||"object"!=typeof o||"object"!=typeof c){a[n]=c;continue}const m=Ci(o,c);a[n]=m,m===o&&d++}return s===n&&d===s?e:a}function Ni(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function Ii(e){if(!wi(e))return!1;const t=e.constructor;if(void 0===t)return!0;const i=t.prototype;return!!wi(i)&&!!i.hasOwnProperty("isPrototypeOf")&&Object.getPrototypeOf(e)===Object.prototype}function wi(e){return"[object Object]"===Object.prototype.toString.call(e)}function Si(e,t,i){return"function"==typeof i.structuralSharing?i.structuralSharing(e,t):!1!==i.structuralSharing?Ci(e,t):t}function ki(e,t,i=0){const s=[...e,t];return i&&s.length>i?s.slice(1):s}function Ti(e,t,i=0){const s=[t,...e];return i&&s.length>i?s.slice(0,-1):s}var _i=Symbol();function Ai(e,t){return!e.queryFn&&(null==t?void 0:t.initialPromise)?()=>t.initialPromise:e.queryFn&&e.queryFn!==_i?e.queryFn:()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`))}var Ri=new(d=class extends ci{constructor(){super(),h(this,l),h(this,n),h(this,a),u(this,a,e=>{if(!xi&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){x(this,n)||this.setEventListener(x(this,a))}onUnsubscribe(){var e;this.hasListeners()||(null==(e=x(this,n))||e.call(this),u(this,n,void 0))}setEventListener(e){var t;u(this,a,e),null==(t=x(this,n))||t.call(this),u(this,n,e(e=>{"boolean"==typeof e?this.setFocused(e):this.onFocus()}))}setFocused(e){x(this,l)!==e&&(u(this,l,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return"boolean"==typeof x(this,l)?x(this,l):"hidden"!==(null==(e=globalThis.document)?void 0:e.visibilityState)}},l=new WeakMap,n=new WeakMap,a=new WeakMap,d),zi=function(e){setTimeout(e,0)},Ei=function(){let e=[],t=0,i=e=>{e()},s=e=>{e()},l=zi;const n=s=>{t?e.push(s):l(()=>{i(s)})};return{batch:n=>{let a;t++;try{a=n()}finally{t--,t||(()=>{const t=e;e=[],t.length&&l(()=>{s(()=>{t.forEach(e=>{i(e)})})})})()}return a},batchCalls:e=>(...t)=>{n(()=>{e(...t)})},schedule:n,setNotifyFunction:e=>{i=e},setBatchNotifyFunction:e=>{s=e},setScheduler:e=>{l=e}}}(),Mi=new(gt=class extends ci{constructor(){super(),h(this,o,!0),h(this,p),h(this,ft),u(this,ft,e=>{if(!xi&&window.addEventListener){const t=()=>e(!0),i=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",i,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",i)}}})}onSubscribe(){x(this,p)||this.setEventListener(x(this,ft))}onUnsubscribe(){var e;this.hasListeners()||(null==(e=x(this,p))||e.call(this),u(this,p,void 0))}setEventListener(e){var t;u(this,ft,e),null==(t=x(this,p))||t.call(this),u(this,p,e(this.setOnline.bind(this)))}setOnline(e){x(this,o)!==e&&(u(this,o,e),this.listeners.forEach(t=>{t(e)}))}isOnline(){return x(this,o)}},o=new WeakMap,p=new WeakMap,ft=new WeakMap,gt);function Di(e){return Math.min(1e3*r(2,e),3e4)}function Oi(e){return"online"!==(null!=e?e:"online")||Mi.isOnline()}var Li=class extends Error{constructor(e){super("CancelledError"),this.revert=null==e?void 0:e.revert,this.silent=null==e?void 0:e.silent}};function Pi(e){let t,i=!1,s=0;const l=function(){let e,t;const i=new Promise((i,s)=>{e=i,t=s});function s(e){Object.assign(i,e),delete i.resolve,delete i.reject}return i.status="pending",i.catch(()=>{}),i.resolve=t=>{s({status:"fulfilled",value:t}),e(t)},i.reject=e=>{s({status:"rejected",reason:e}),t(e)},i}(),n=()=>"pending"!==l.status,a=()=>Ri.isFocused()&&("always"===e.networkMode||Mi.isOnline())&&e.canRun(),d=()=>Oi(e.networkMode)&&e.canRun(),r=e=>{n()||(null==t||t(),l.resolve(e))},o=e=>{n()||(null==t||t(),l.reject(e))},c=()=>new Promise(i=>{var s;t=e=>{(n()||a())&&i(e)},null==(s=e.onPause)||s.call(e)}).then(()=>{var i;t=void 0,n()||null==(i=e.onContinue)||i.call(e)}),m=()=>{if(n())return;let t;const l=0===s?e.initialPromise:void 0;try{t=null!=l?l:e.fn()}catch(d){t=Promise.reject(d)}Promise.resolve(t).then(r).catch(t=>{var l,d,r;if(n())return;const p=null!=(l=e.retry)?l:xi?0:3,x=null!=(d=e.retryDelay)?d:Di,h="function"==typeof x?x(s,t):x,u=!0===p||"number"==typeof p&&s<p||"function"==typeof p&&p(s,t);var f;!i&&u?(s++,null==(r=e.onFail)||r.call(e,s,t),(f=h,new Promise(e=>{pi.setTimeout(e,f)})).then(()=>a()?void 0:c()).then(()=>{i?o(t):m()})):o(t)})};return{promise:l,status:()=>l.status,cancel:t=>{var i;if(!n()){const s=new Li(t);o(s),null==(i=e.onCancel)||i.call(e,s)}},continue:()=>(null==t||t(),l),cancelRetry:()=>{i=!0},continueRetry:()=>{i=!1},canStart:d,start:()=>(d()?m():c().then(m),l)}}var Bi=(jt=class{constructor(){h(this,yt)}destroy(){this.clearGcTimeout()}scheduleGc(){var e;this.clearGcTimeout(),"number"==typeof(e=this.gcTime)&&e>=0&&e!==1/0&&u(this,yt,pi.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,null!=e?e:xi?1/0:3e5)}clearGcTimeout(){x(this,yt)&&(pi.clearTimeout(x(this,yt)),u(this,yt,void 0))}},yt=new WeakMap,jt),Fi=(_t=class extends Bi{constructor(e){var t;super(),h(this,kt),h(this,vt),h(this,bt),h(this,Ct),h(this,Nt),h(this,It),h(this,wt),h(this,St),u(this,St,!1),u(this,wt,e.defaultOptions),this.setOptions(e.options),this.observers=[],u(this,Nt,e.client),u(this,Ct,x(this,Nt).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,u(this,vt,$i(this.options)),this.state=null!=(t=e.state)?t:x(this,vt),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return null==(e=x(this,It))?void 0:e.promise}setOptions(e){if(this.options=c(c({},x(this,wt)),e),this.updateGcTime(this.options.gcTime),this.state&&void 0===this.state.data){const e=$i(this.options);void 0!==e.data&&(this.setData(e.data,{updatedAt:e.dataUpdatedAt,manual:!0}),u(this,vt,e))}}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||x(this,Ct).remove(this)}setData(e,t){const i=Si(this.state.data,e,this.options);return f(this,kt,Tt).call(this,{data:i,type:"success",dataUpdatedAt:null==t?void 0:t.updatedAt,manual:null==t?void 0:t.manual}),i}setState(e,t){f(this,kt,Tt).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var t,i;const s=null==(t=x(this,It))?void 0:t.promise;return null==(i=x(this,It))||i.cancel(e),s?s.then(hi).catch(hi):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(x(this,vt))}isActive(){return this.observers.some(e=>{return!1!==(t=e.options.enabled,i=this,"function"==typeof t?t(i):t);var t,i})}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===_i||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0&&this.observers.some(e=>"static"===ui(e.options.staleTime,this))}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):void 0===this.state.data||this.state.isInvalidated}isStaleByTime(e=0){return void 0===this.state.data||"static"!==e&&(!!this.state.isInvalidated||!function(e,t){return Math.max(e+(t||0)-Date.now(),0)}(this.state.dataUpdatedAt,e))}onFocus(){var e;const t=this.observers.find(e=>e.shouldFetchOnWindowFocus());null==t||t.refetch({cancelRefetch:!1}),null==(e=x(this,It))||e.continue()}onOnline(){var e;const t=this.observers.find(e=>e.shouldFetchOnReconnect());null==t||t.refetch({cancelRefetch:!1}),null==(e=x(this,It))||e.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),x(this,Ct).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(x(this,It)&&(x(this,St)?x(this,It).cancel({revert:!0}):x(this,It).cancelRetry()),this.scheduleGc()),x(this,Ct).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||f(this,kt,Tt).call(this,{type:"invalidate"})}fetch(e,t){return y(this,null,function*(){var i,s,l,n,a,d,r,o,p,h,g,y;if("idle"!==this.state.fetchStatus&&"rejected"!==(null==(i=x(this,It))?void 0:i.status()))if(void 0!==this.state.data&&(null==t?void 0:t.cancelRefetch))this.cancel({silent:!0});else if(x(this,It))return x(this,It).continueRetry(),x(this,It).promise;if(e&&this.setOptions(e),!this.options.queryFn){const e=this.observers.find(e=>e.options.queryFn);e&&this.setOptions(e.options)}const j=new AbortController,v=e=>{Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(u(this,St,!0),j.signal)})},b=()=>{const e=Ai(this.options,t),i=(()=>{const e={client:x(this,Nt),queryKey:this.queryKey,meta:this.meta};return v(e),e})();return u(this,St,!1),this.options.persister?this.options.persister(e,i,this):e(i)},C=(()=>{const e={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:x(this,Nt),state:this.state,fetchFn:b};return v(e),e})();null==(s=this.options.behavior)||s.onFetch(C,this),u(this,bt,this.state),"idle"!==this.state.fetchStatus&&this.state.fetchMeta===(null==(l=C.fetchOptions)?void 0:l.meta)||f(this,kt,Tt).call(this,{type:"fetch",meta:null==(n=C.fetchOptions)?void 0:n.meta}),u(this,It,Pi({initialPromise:null==t?void 0:t.initialPromise,fn:C.fetchFn,onCancel:e=>{e instanceof Li&&e.revert&&this.setState(m(c({},x(this,bt)),{fetchStatus:"idle"})),j.abort()},onFail:(e,t)=>{f(this,kt,Tt).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{f(this,kt,Tt).call(this,{type:"pause"})},onContinue:()=>{f(this,kt,Tt).call(this,{type:"continue"})},retry:C.options.retry,retryDelay:C.options.retryDelay,networkMode:C.options.networkMode,canRun:()=>!0}));try{const e=yield x(this,It).start();if(void 0===e)throw new Error(`${this.queryHash} data is undefined`);return this.setData(e),null==(d=(a=x(this,Ct).config).onSuccess)||d.call(a,e,this),null==(o=(r=x(this,Ct).config).onSettled)||o.call(r,e,this.state.error,this),e}catch(N){if(N instanceof Li){if(N.silent)return x(this,It).promise;if(N.revert){if(void 0===this.state.data)throw N;return this.state.data}}throw f(this,kt,Tt).call(this,{type:"error",error:N}),null==(h=(p=x(this,Ct).config).onError)||h.call(p,N,this),null==(y=(g=x(this,Ct).config).onSettled)||y.call(g,this.state.data,N,this),N}finally{this.scheduleGc()}})}},vt=new WeakMap,bt=new WeakMap,Ct=new WeakMap,Nt=new WeakMap,It=new WeakMap,wt=new WeakMap,St=new WeakMap,kt=new WeakSet,Tt=function(e){this.state=(t=>{var i,s,l,n;switch(e.type){case"failed":return m(c({},t),{fetchFailureCount:e.failureCount,fetchFailureReason:e.error});case"pause":return m(c({},t),{fetchStatus:"paused"});case"continue":return m(c({},t),{fetchStatus:"fetching"});case"fetch":return m(c(c({},t),(l=t.data,n=this.options,c({fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Oi(n.networkMode)?"fetching":"paused"},void 0===l&&{error:null,status:"pending"}))),{fetchMeta:null!=(i=e.meta)?i:null});case"success":const a=c(m(c({},t),{data:e.data,dataUpdateCount:t.dataUpdateCount+1,dataUpdatedAt:null!=(s=e.dataUpdatedAt)?s:Date.now(),error:null,isInvalidated:!1,status:"success"}),!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null});return u(this,bt,e.manual?a:void 0),a;case"error":const d=e.error;return m(c({},t),{error:d,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:d,fetchStatus:"idle",status:"error"});case"invalidate":return m(c({},t),{isInvalidated:!0});case"setState":return c(c({},t),e.state)}})(this.state),Ei.batch(()=>{this.observers.forEach(e=>{e.onQueryUpdate()}),x(this,Ct).notify({query:this,type:"updated",action:e})})},_t);function $i(e){const t="function"==typeof e.initialData?e.initialData():e.initialData,i=void 0!==t,s=i?"function"==typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:i?null!=s?s:Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:i?"success":"pending",fetchStatus:"idle"}}function Vi(e){return{onFetch:(t,i)=>{var s,l,n,a,d;const r=t.options,o=null==(n=null==(l=null==(s=t.fetchOptions)?void 0:s.meta)?void 0:l.fetchMore)?void 0:n.direction,c=(null==(a=t.state.data)?void 0:a.pages)||[],m=(null==(d=t.state.data)?void 0:d.pageParams)||[];let p={pages:[],pageParams:[]},x=0;const h=()=>y(this,null,function*(){var i;let s=!1;const l=Ai(t.options,t.fetchOptions),n=(e,i,n)=>y(this,null,function*(){if(s)return Promise.reject();if(null==i&&e.pages.length)return Promise.resolve(e);const a=(()=>{const e={client:t.client,queryKey:t.queryKey,pageParam:i,direction:n?"backward":"forward",meta:t.options.meta};var l;return l=e,Object.defineProperty(l,"signal",{enumerable:!0,get:()=>(t.signal.aborted?s=!0:t.signal.addEventListener("abort",()=>{s=!0}),t.signal)}),e})(),d=yield l(a),{maxPages:r}=t.options,o=n?Ti:ki;return{pages:o(e.pages,d,r),pageParams:o(e.pageParams,i,r)}});if(o&&c.length){const e="backward"===o,t={pages:c,pageParams:m},i=(e?qi:Hi)(r,t);p=yield n(t,i,e)}else{const t=null!=e?e:c.length;do{const e=0===x?null!=(i=m[0])?i:r.initialPageParam:Hi(r,p);if(x>0&&null==e)break;p=yield n(p,e),x++}while(x<t)}return p});t.options.persister?t.fetchFn=()=>{var e,s;return null==(s=(e=t.options).persister)?void 0:s.call(e,h,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},i)}:t.fetchFn=h}}}function Hi(e,{pages:t,pageParams:i}){const s=t.length-1;return t.length>0?e.getNextPageParam(t[s],t,i[s],i):void 0}function qi(e,{pages:t,pageParams:i}){var s;return t.length>0?null==(s=e.getPreviousPageParam)?void 0:s.call(e,t[0],t,i[0],i):void 0}var Ui=(Ot=class extends Bi{constructor(e){super(),h(this,Mt),h(this,At),h(this,Rt),h(this,zt),h(this,Et),u(this,At,e.client),this.mutationId=e.mutationId,u(this,zt,e.mutationCache),u(this,Rt,[]),this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0},this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){x(this,Rt).includes(e)||(x(this,Rt).push(e),this.clearGcTimeout(),x(this,zt).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){u(this,Rt,x(this,Rt).filter(t=>t!==e)),this.scheduleGc(),x(this,zt).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){x(this,Rt).length||("pending"===this.state.status?this.scheduleGc():x(this,zt).remove(this))}continue(){var e,t;return null!=(t=null==(e=x(this,Et))?void 0:e.continue())?t:this.execute(this.state.variables)}execute(e){return y(this,null,function*(){var t,i,s,l,n,a,d,r,o,c,m,p,h,g,y,j,v,b,C,N,I;const w=()=>{f(this,Mt,Dt).call(this,{type:"continue"})},S={client:x(this,At),meta:this.options.meta,mutationKey:this.options.mutationKey};u(this,Et,Pi({fn:()=>this.options.mutationFn?this.options.mutationFn(e,S):Promise.reject(new Error("No mutationFn found")),onFail:(e,t)=>{f(this,Mt,Dt).call(this,{type:"failed",failureCount:e,error:t})},onPause:()=>{f(this,Mt,Dt).call(this,{type:"pause"})},onContinue:w,retry:null!=(t=this.options.retry)?t:0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>x(this,zt).canRun(this)}));const k="pending"===this.state.status,T=!x(this,Et).canStart();try{if(k)w();else{f(this,Mt,Dt).call(this,{type:"pending",variables:e,isPaused:T}),yield null==(s=(i=x(this,zt).config).onMutate)?void 0:s.call(i,e,this,S);const t=yield null==(n=(l=this.options).onMutate)?void 0:n.call(l,e,S);t!==this.state.context&&f(this,Mt,Dt).call(this,{type:"pending",context:t,variables:e,isPaused:T})}const t=yield x(this,Et).start();return yield null==(d=(a=x(this,zt).config).onSuccess)?void 0:d.call(a,t,e,this.state.context,this,S),yield null==(o=(r=this.options).onSuccess)?void 0:o.call(r,t,e,this.state.context,S),yield null==(m=(c=x(this,zt).config).onSettled)?void 0:m.call(c,t,null,this.state.variables,this.state.context,this,S),yield null==(h=(p=this.options).onSettled)?void 0:h.call(p,t,null,e,this.state.context,S),f(this,Mt,Dt).call(this,{type:"success",data:t}),t}catch(_){try{throw yield null==(y=(g=x(this,zt).config).onError)?void 0:y.call(g,_,e,this.state.context,this,S),yield null==(v=(j=this.options).onError)?void 0:v.call(j,_,e,this.state.context,S),yield null==(C=(b=x(this,zt).config).onSettled)?void 0:C.call(b,void 0,_,this.state.variables,this.state.context,this,S),yield null==(I=(N=this.options).onSettled)?void 0:I.call(N,void 0,_,e,this.state.context,S),_}finally{f(this,Mt,Dt).call(this,{type:"error",error:_})}}finally{x(this,zt).runNext(this)}})}},At=new WeakMap,Rt=new WeakMap,zt=new WeakMap,Et=new WeakMap,Mt=new WeakSet,Dt=function(e){this.state=(t=>{switch(e.type){case"failed":return m(c({},t),{failureCount:e.failureCount,failureReason:e.error});case"pause":return m(c({},t),{isPaused:!0});case"continue":return m(c({},t),{isPaused:!1});case"pending":return m(c({},t),{context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()});case"success":return m(c({},t),{data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1});case"error":return m(c({},t),{data:void 0,error:e.error,failureCount:t.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"})}})(this.state),Ei.batch(()=>{x(this,Rt).forEach(t=>{t.onMutationUpdate(e)}),x(this,zt).notify({mutation:this,type:"updated",action:e})})},Ot),Wi=(Ft=class extends ci{constructor(e={}){super(),h(this,Lt),h(this,Pt),h(this,Bt),this.config=e,u(this,Lt,new Set),u(this,Pt,new Map),u(this,Bt,0)}build(e,t,i){const s=new Ui({client:e,mutationCache:this,mutationId:++g(this,Bt)._,options:e.defaultMutationOptions(t),state:i});return this.add(s),s}add(e){x(this,Lt).add(e);const t=Ki(e);if("string"==typeof t){const i=x(this,Pt).get(t);i?i.push(e):x(this,Pt).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(x(this,Lt).delete(e)){const t=Ki(e);if("string"==typeof t){const i=x(this,Pt).get(t);if(i)if(i.length>1){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}else i[0]===e&&x(this,Pt).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=Ki(e);if("string"==typeof t){const i=x(this,Pt).get(t),s=null==i?void 0:i.find(e=>"pending"===e.state.status);return!s||s===e}return!0}runNext(e){var t,i;const s=Ki(e);if("string"==typeof s){const l=null==(t=x(this,Pt).get(s))?void 0:t.find(t=>t!==e&&t.state.isPaused);return null!=(i=null==l?void 0:l.continue())?i:Promise.resolve()}return Promise.resolve()}clear(){Ei.batch(()=>{x(this,Lt).forEach(e=>{this.notify({type:"removed",mutation:e})}),x(this,Lt).clear(),x(this,Pt).clear()})}getAll(){return Array.from(x(this,Lt))}find(e){const t=c({exact:!0},e);return this.getAll().find(e=>gi(t,e))}findAll(e={}){return this.getAll().filter(t=>gi(e,t))}notify(e){Ei.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(e=>e.state.isPaused);return Ei.batch(()=>Promise.all(e.map(e=>e.continue().catch(hi))))}},Lt=new WeakMap,Pt=new WeakMap,Bt=new WeakMap,Ft);function Ki(e){var t;return null==(t=e.options.scope)?void 0:t.id}var Yi,Gi=(Vt=class extends ci{constructor(e={}){super(),h(this,$t),this.config=e,u(this,$t,new Map)}build(e,t,i){var s;const l=t.queryKey,n=null!=(s=t.queryHash)?s:yi(l,t);let a=this.get(n);return a||(a=new Fi({client:e,queryKey:l,queryHash:n,options:e.defaultQueryOptions(t),state:i,defaultOptions:e.getQueryDefaults(l)}),this.add(a)),a}add(e){x(this,$t).has(e.queryHash)||(x(this,$t).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=x(this,$t).get(e.queryHash);t&&(e.destroy(),t===e&&x(this,$t).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Ei.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return x(this,$t).get(e)}getAll(){return[...x(this,$t).values()]}find(e){const t=c({exact:!0},e);return this.getAll().find(e=>fi(t,e))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(t=>fi(e,t)):t}notify(e){Ei.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Ei.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Ei.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},$t=new WeakMap,Vt),Qi=(Jt=class{constructor(e={}){h(this,Ht),h(this,qt),h(this,Ut),h(this,Wt),h(this,Kt),h(this,Yt),h(this,Gt),h(this,Qt),u(this,Ht,e.queryCache||new Gi),u(this,qt,e.mutationCache||new Wi),u(this,Ut,e.defaultOptions||{}),u(this,Wt,new Map),u(this,Kt,new Map),u(this,Yt,0)}mount(){g(this,Yt)._++,1===x(this,Yt)&&(u(this,Gt,Ri.subscribe(e=>y(this,null,function*(){e&&(yield this.resumePausedMutations(),x(this,Ht).onFocus())}))),u(this,Qt,Mi.subscribe(e=>y(this,null,function*(){e&&(yield this.resumePausedMutations(),x(this,Ht).onOnline())}))))}unmount(){var e,t;g(this,Yt)._--,0===x(this,Yt)&&(null==(e=x(this,Gt))||e.call(this),u(this,Gt,void 0),null==(t=x(this,Qt))||t.call(this),u(this,Qt,void 0))}isFetching(e){return x(this,Ht).findAll(m(c({},e),{fetchStatus:"fetching"})).length}isMutating(e){return x(this,qt).findAll(m(c({},e),{status:"pending"})).length}getQueryData(e){var t;const i=this.defaultQueryOptions({queryKey:e});return null==(t=x(this,Ht).get(i.queryHash))?void 0:t.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),i=x(this,Ht).build(this,t),s=i.state.data;return void 0===s?this.fetchQuery(e):(e.revalidateIfStale&&i.isStaleByTime(ui(t.staleTime,i))&&this.prefetchQuery(t),Promise.resolve(s))}getQueriesData(e){return x(this,Ht).findAll(e).map(({queryKey:e,state:t})=>[e,t.data])}setQueryData(e,t,i){const s=this.defaultQueryOptions({queryKey:e}),l=x(this,Ht).get(s.queryHash),n=function(e,t){return"function"==typeof e?e(t):e}(t,null==l?void 0:l.state.data);if(void 0!==n)return x(this,Ht).build(this,s).setData(n,m(c({},i),{manual:!0}))}setQueriesData(e,t,i){return Ei.batch(()=>x(this,Ht).findAll(e).map(({queryKey:e})=>[e,this.setQueryData(e,t,i)]))}getQueryState(e){var t;const i=this.defaultQueryOptions({queryKey:e});return null==(t=x(this,Ht).get(i.queryHash))?void 0:t.state}removeQueries(e){const t=x(this,Ht);Ei.batch(()=>{t.findAll(e).forEach(e=>{t.remove(e)})})}resetQueries(e,t){const i=x(this,Ht);return Ei.batch(()=>(i.findAll(e).forEach(e=>{e.reset()}),this.refetchQueries(c({type:"active"},e),t)))}cancelQueries(e,t={}){const i=c({revert:!0},t),s=Ei.batch(()=>x(this,Ht).findAll(e).map(e=>e.cancel(i)));return Promise.all(s).then(hi).catch(hi)}invalidateQueries(e,t={}){return Ei.batch(()=>{var i,s;return x(this,Ht).findAll(e).forEach(e=>{e.invalidate()}),"none"===(null==e?void 0:e.refetchType)?Promise.resolve():this.refetchQueries(m(c({},e),{type:null!=(s=null!=(i=null==e?void 0:e.refetchType)?i:null==e?void 0:e.type)?s:"active"}),t)})}refetchQueries(e,t={}){var i;const s=m(c({},t),{cancelRefetch:null==(i=t.cancelRefetch)||i}),l=Ei.batch(()=>x(this,Ht).findAll(e).filter(e=>!e.isDisabled()&&!e.isStatic()).map(e=>{let t=e.fetch(void 0,s);return s.throwOnError||(t=t.catch(hi)),"paused"===e.state.fetchStatus?Promise.resolve():t}));return Promise.all(l).then(hi)}fetchQuery(e){const t=this.defaultQueryOptions(e);void 0===t.retry&&(t.retry=!1);const i=x(this,Ht).build(this,t);return i.isStaleByTime(ui(t.staleTime,i))?i.fetch(t):Promise.resolve(i.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(hi).catch(hi)}fetchInfiniteQuery(e){return e.behavior=Vi(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(hi).catch(hi)}ensureInfiniteQueryData(e){return e.behavior=Vi(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Mi.isOnline()?x(this,qt).resumePausedMutations():Promise.resolve()}getQueryCache(){return x(this,Ht)}getMutationCache(){return x(this,qt)}getDefaultOptions(){return x(this,Ut)}setDefaultOptions(e){u(this,Ut,e)}setQueryDefaults(e,t){x(this,Wt).set(ji(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...x(this,Wt).values()],i={};return t.forEach(t=>{vi(e,t.queryKey)&&Object.assign(i,t.defaultOptions)}),i}setMutationDefaults(e,t){x(this,Kt).set(ji(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...x(this,Kt).values()],i={};return t.forEach(t=>{vi(e,t.mutationKey)&&Object.assign(i,t.defaultOptions)}),i}defaultQueryOptions(e){if(e._defaulted)return e;const t=m(c(c(c({},x(this,Ut).queries),this.getQueryDefaults(e.queryKey)),e),{_defaulted:!0});return t.queryHash||(t.queryHash=yi(t.queryKey,t)),void 0===t.refetchOnReconnect&&(t.refetchOnReconnect="always"!==t.networkMode),void 0===t.throwOnError&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===_i&&(t.enabled=!1),t}defaultMutationOptions(e){return(null==e?void 0:e._defaulted)?e:m(c(c(c({},x(this,Ut).mutations),(null==e?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey)),e),{_defaulted:!0})}clear(){x(this,Ht).clear(),x(this,qt).clear()}},Ht=new WeakMap,qt=new WeakMap,Ut=new WeakMap,Wt=new WeakMap,Kt=new WeakMap,Yt=new WeakMap,Gt=new WeakMap,Qt=new WeakMap,Jt),Ji=j.createContext(void 0),Xi=({client:e,children:t})=>(j.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),di.jsx(Ji.Provider,{value:e,children:t})),Zi={},es={exports:{}};(Yi=es).exports=function(e){return e&&e.__esModule?e:{default:e}},Yi.exports.__esModule=!0,Yi.exports.default=Yi.exports;var ts=es.exports,is={};Object.defineProperty(is,"__esModule",{value:!0}),is.default=void 0,is.default={items_per_page:"条/页",jump_to:"跳至",jump_to_confirm:"确定",page:"页",prev_page:"上一页",next_page:"下一页",prev_5:"向前 5 页",next_5:"向后 5 页",prev_3:"向前 3 页",next_3:"向后 3 页",page_size:"页码"};var ss={},ls={},ns={},as={};Object.defineProperty(as,"__esModule",{value:!0}),as.commonLocale=void 0,as.commonLocale={yearFormat:"YYYY",dayFormat:"D",cellMeridiemFormat:"A",monthBeforeYear:!0};var ds=ts.default;Object.defineProperty(ns,"__esModule",{value:!0}),ns.default=void 0;var rs=ds(T),os=as,cs=(0,rs.default)((0,rs.default)({},os.commonLocale),{},{locale:"zh_CN",today:"今天",now:"此刻",backToToday:"返回今天",ok:"确定",timeSelect:"选择时间",dateSelect:"选择日期",weekSelect:"选择周",clear:"清除",week:"周",month:"月",year:"年",previousMonth:"上个月 (翻页上键)",nextMonth:"下个月 (翻页下键)",monthSelect:"选择月份",yearSelect:"选择年份",decadeSelect:"选择年代",previousYear:"上一年 (Control键加左方向键)",nextYear:"下一年 (Control键加右方向键)",previousDecade:"上一年代",nextDecade:"下一年代",previousCentury:"上一世纪",nextCentury:"下一世纪",yearFormat:"YYYY年",cellDateFormat:"D",monthBeforeYear:!1});ns.default=cs;var ms={};Object.defineProperty(ms,"__esModule",{value:!0}),ms.default=void 0,ms.default={placeholder:"请选择时间",rangePlaceholder:["开始时间","结束时间"]};var ps=ts.default;Object.defineProperty(ls,"__esModule",{value:!0}),ls.default=void 0;var xs=ps(ns),hs=ps(ms);const us={lang:Object.assign({placeholder:"请选择日期",yearPlaceholder:"请选择年份",quarterPlaceholder:"请选择季度",monthPlaceholder:"请选择月份",weekPlaceholder:"请选择周",rangePlaceholder:["开始日期","结束日期"],rangeYearPlaceholder:["开始年份","结束年份"],rangeMonthPlaceholder:["开始月份","结束月份"],rangeQuarterPlaceholder:["开始季度","结束季度"],rangeWeekPlaceholder:["开始周","结束周"]},xs.default),timePickerLocale:Object.assign({},hs.default)};us.lang.ok="确定",ls.default=us;var fs=ts.default;Object.defineProperty(ss,"__esModule",{value:!0}),ss.default=void 0;var gs=fs(ls);ss.default=gs.default;var ys=ts.default;Object.defineProperty(Zi,"__esModule",{value:!0}),Zi.default=void 0;var js=ys(is),vs=ys(ss),bs=ys(ls),Cs=ys(ms);const Ns="${label}不是一个有效的${type}",Is={locale:"zh-cn",Pagination:js.default,DatePicker:bs.default,TimePicker:Cs.default,Calendar:vs.default,global:{placeholder:"请选择",close:"关闭"},Table:{filterTitle:"筛选",filterConfirm:"确定",filterReset:"重置",filterEmptyText:"无筛选项",filterCheckAll:"全选",filterSearchPlaceholder:"在筛选项中搜索",emptyText:"暂无数据",selectAll:"全选当页",selectInvert:"反选当页",selectNone:"清空所有",selectionAll:"全选所有",sortTitle:"排序",expand:"展开行",collapse:"关闭行",triggerDesc:"点击降序",triggerAsc:"点击升序",cancelSort:"取消排序"},Modal:{okText:"确定",cancelText:"取消",justOkText:"知道了"},Tour:{Next:"下一步",Previous:"上一步",Finish:"结束导览"},Popconfirm:{cancelText:"取消",okText:"确定"},Transfer:{titles:["",""],searchPlaceholder:"请输入搜索内容",itemUnit:"项",itemsUnit:"项",remove:"删除",selectCurrent:"全选当页",removeCurrent:"删除当页",selectAll:"全选所有",deselectAll:"取消全选",removeAll:"删除全部",selectInvert:"反选当页"},Upload:{uploading:"文件上传中",removeFile:"删除文件",uploadError:"上传错误",previewFile:"预览文件",downloadFile:"下载文件"},Empty:{description:"暂无数据"},Icon:{icon:"图标"},Text:{edit:"编辑",copy:"复制",copied:"复制成功",expand:"展开",collapse:"收起"},Form:{optional:"（可选）",defaultValidateMessages:{default:"字段验证错误${label}",required:"请输入${label}",enum:"${label}必须是其中一个[${enum}]",whitespace:"${label}不能为空字符",date:{format:"${label}日期格式无效",parse:"${label}不能转换为日期",invalid:"${label}是一个无效日期"},types:{string:Ns,method:Ns,array:Ns,object:Ns,number:Ns,date:Ns,boolean:Ns,integer:Ns,float:Ns,regexp:Ns,email:Ns,url:Ns,hex:Ns},string:{len:"${label}须为${len}个字符",min:"${label}最少${min}个字符",max:"${label}最多${max}个字符",range:"${label}须在${min}-${max}字符之间"},number:{len:"${label}必须等于${len}",min:"${label}最小值为${min}",max:"${label}最大值为${max}",range:"${label}须在${min}-${max}之间"},array:{len:"须为${len}个${label}",min:"最少${min}个${label}",max:"最多${max}个${label}",range:"${label}数量须在${min}-${max}之间"},pattern:{mismatch:"${label}与模式不匹配${pattern}"}}},Image:{preview:"预览"},QRCode:{expired:"二维码过期",refresh:"点击刷新",scanned:"已扫描"},ColorPicker:{presetEmpty:"暂无",transparent:"无色",singleColor:"单色",gradientColor:"渐变色"}};Zi.default=Is;const ws=b(Zi);var Ss={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M894 462c30.9 0 43.8-39.7 18.7-58L530.8 126.2a31.81 31.81 0 00-37.6 0L111.3 404c-25.1 18.2-12.2 58 18.8 58H192v374h-72c-4.4 0-8 3.6-8 8v52c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-52c0-4.4-3.6-8-8-8h-72V462h62zM512 196.7l271.1 197.2H240.9L512 196.7zM264 462h117v374H264V462zm189 0h117v374H453V462zm307 374H642V462h118v374z"}}]},name:"bank",theme:"outlined"},ks=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:Ss}))},Ts=j.forwardRef(ks),_s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M816 768h-24V428c0-141.1-104.3-257.7-240-277.1V112c0-22.1-17.9-40-40-40s-40 17.9-40 40v38.9c-135.7 19.4-240 136-240 277.1v340h-24c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h216c0 61.8 50.2 112 112 112s112-50.2 112-112h216c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM512 888c-26.5 0-48-21.5-48-48h96c0 26.5-21.5 48-48 48zM304 768V428c0-55.6 21.6-107.8 60.9-147.1S456.4 220 512 220c55.6 0 107.8 21.6 147.1 60.9S720 372.4 720 428v340H304z"}}]},name:"bell",theme:"outlined"},As=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:_s}))},Rs=j.forwardRef(As),zs={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M715.8 493.5L335 165.1c-14.2-12.2-35-1.2-35 18.5v656.8c0 19.7 20.8 30.7 35 18.5l380.8-328.4c10.9-9.4 10.9-27.6 0-37z"}}]},name:"caret-right",theme:"outlined"},Es=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:zs}))},Ms=j.forwardRef(Es),Ds={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-600 72h560v208H232V136zm560 480H232V408h560v208zm0 272H232V680h560v208zM304 240a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"database",theme:"outlined"},Os=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:Ds}))},Ls=j.forwardRef(Os),Ps={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.3 506.3L781.7 405.6a7.23 7.23 0 00-11.7 5.7V476H548V254h64.8c6 0 9.4-7 5.7-11.7L517.7 114.7a7.14 7.14 0 00-11.3 0L405.6 242.3a7.23 7.23 0 005.7 11.7H476v222H254v-64.8c0-6-7-9.4-11.7-5.7L114.7 506.3a7.14 7.14 0 000 11.3l127.5 100.8c4.7 3.7 11.7.4 11.7-5.7V548h222v222h-64.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7.4-11.7-5.7-11.7H548V548h222v64.8c0 6 7 9.4 11.7 5.7l127.5-100.8a7.3 7.3 0 00.1-11.4z"}}]},name:"drag",theme:"outlined"},Bs=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:Ps}))},Fs=j.forwardRef(Bs),$s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M925.9 804l-24-199.2c-.8-6.6-8.9-9.4-13.6-4.7L829 659.5 557.7 388.3c-6.3-6.2-16.4-6.2-22.6 0L433.3 490 156.6 213.3a8.03 8.03 0 00-11.3 0l-45 45.2a8.03 8.03 0 000 11.3L422 591.7c6.2 6.3 16.4 6.3 22.6 0L546.4 490l226.1 226-59.3 59.3a8.01 8.01 0 004.7 13.6l199.2 24c5.1.7 9.5-3.7 8.8-8.9z"}}]},name:"fall",theme:"outlined"},Vs=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:$s}))},Hs=j.forwardRef(Vs),qs={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"},Us=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:qs}))},Ws=j.forwardRef(Us),Ks={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M841 370c3-3.3 2.7-8.3-.6-11.3a8.24 8.24 0 00-5.3-2.1h-72.6c-2.4 0-4.6 1-6.1 2.8L633.5 504.6a7.96 7.96 0 01-13.4-1.9l-63.5-141.3a7.9 7.9 0 00-7.3-4.7H380.7l.9-4.7 8-42.3c10.5-55.4 38-81.4 85.8-81.4 18.6 0 35.5 1.7 48.8 4.7l14.1-66.8c-22.6-4.7-35.2-6.1-54.9-6.1-103.3 0-156.4 44.3-175.9 147.3l-9.4 49.4h-97.6c-3.8 0-7.1 2.7-7.8 6.4L181.9 415a8.07 8.07 0 007.8 9.7H284l-89 429.9a8.07 8.07 0 007.8 9.7H269c3.8 0 7.1-2.7 7.8-6.4l89.7-433.1h135.8l68.2 139.1c1.4 2.9 1 6.4-1.2 8.8l-180.6 203c-2.9 3.3-2.6 8.4.7 11.3 1.5 1.3 3.4 2 5.3 2h72.7c2.4 0 4.6-1 6.1-2.8l123.7-146.7c2.8-3.4 7.9-3.8 11.3-1 .9.8 1.6 1.7 2.1 2.8L676.4 784c1.3 2.8 4.1 4.7 7.3 4.7h64.6a8.02 8.02 0 007.2-11.5l-95.2-198.9c-1.4-2.9-.9-6.4 1.3-8.8L841 370z"}}]},name:"function",theme:"outlined"},Ys=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:Ks}))},Gs=j.forwardRef(Ys),Qs={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M536.1 273H488c-4.4 0-8 3.6-8 8v275.3c0 2.6 1.2 5 3.3 6.5l165.3 120.7c3.6 2.6 8.6 1.9 11.2-1.7l28.6-39c2.7-3.7 1.9-8.7-1.7-11.2L544.1 528.5V281c0-4.4-3.6-8-8-8zm219.8 75.2l156.8 38.3c5 1.2 9.9-2.6 9.9-7.7l.8-161.5c0-6.7-7.7-10.5-12.9-6.3L752.9 334.1a8 8 0 003 14.1zm167.7 301.1l-56.7-19.5a8 8 0 00-10.1 4.8c-1.9 5.1-3.9 10.1-6 15.1-17.8 42.1-43.3 80-75.9 112.5a353 353 0 01-112.5 75.9 352.18 352.18 0 01-137.7 27.8c-47.8 0-94.1-9.3-137.7-27.8a353 353 0 01-112.5-75.9c-32.5-32.5-58-70.4-75.9-112.5A353.44 353.44 0 01171 512c0-47.8 9.3-94.2 27.8-137.8 17.8-42.1 43.3-80 75.9-112.5a353 353 0 01112.5-75.9C430.6 167.3 477 158 524.8 158s94.1 9.3 137.7 27.8A353 353 0 01775 261.7c10.2 10.3 19.8 21 28.6 32.3l59.8-46.8C784.7 146.6 662.2 81.9 524.6 82 285 82.1 92.6 276.7 95 516.4 97.4 751.9 288.9 942 524.8 942c185.5 0 343.5-117.6 403.7-282.3 1.5-4.2-.7-8.9-4.9-10.4z"}}]},name:"history",theme:"outlined"},Js=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:Qs}))},Xs=j.forwardRef(Js),Zs={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},el=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:Zs}))},tl=j.forwardRef(el),il={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"}}]},name:"info-circle",theme:"outlined"},sl=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:il}))},ll=j.forwardRef(sl),nl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 000 13.8z"}}]},name:"menu-fold",theme:"outlined"},al=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:nl}))},dl=j.forwardRef(al),rl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM142.4 642.1L298.7 519a8.84 8.84 0 000-13.9L142.4 381.9c-5.8-4.6-14.4-.5-14.4 6.9v246.3a8.9 8.9 0 0014.4 7z"}}]},name:"menu-unfold",theme:"outlined"},ol=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:rl}))},cl=j.forwardRef(ol),ml={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},pl=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:ml}))},xl=j.forwardRef(pl),hl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 394c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8H708V152c0-4.4-3.6-8-8-8h-64c-4.4 0-8 3.6-8 8v166H400V152c0-4.4-3.6-8-8-8h-64c-4.4 0-8 3.6-8 8v166H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h168v236H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h168v166c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V706h228v166c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V706h164c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8H708V394h164zM628 630H400V394h228v236z"}}]},name:"number",theme:"outlined"},ul=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:hl}))},fl=j.forwardRef(ul),gl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M719.4 499.1l-296.1-215A15.9 15.9 0 00398 297v430c0 13.1 14.8 20.5 25.3 12.9l296.1-215a15.9 15.9 0 000-25.8zm-257.6 134V390.9L628.5 512 461.8 633.1z"}}]},name:"play-circle",theme:"outlined"},yl=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:gl}))},jl=j.forwardRef(yl),vl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M917 211.1l-199.2 24c-6.6.8-9.4 8.9-4.7 13.6l59.3 59.3-226 226-101.8-101.7c-6.3-6.3-16.4-6.2-22.6 0L100.3 754.1a8.03 8.03 0 000 11.3l45 45.2c3.1 3.1 8.2 3.1 11.3 0L433.3 534 535 635.7c6.3 6.2 16.4 6.2 22.6 0L829 364.5l59.3 59.3a8.01 8.01 0 0013.6-4.7l24-199.2c.7-5.1-3.7-9.5-8.9-8.8z"}}]},name:"rise",theme:"outlined"},bl=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:vl}))},Cl=j.forwardRef(bl),Nl={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64L128 192v384c0 212.1 171.9 384 384 384s384-171.9 384-384V192L512 64zm312 512c0 172.3-139.7 312-312 312S200 748.3 200 576V246l312-110 312 110v330z"}},{tag:"path",attrs:{d:"M378.4 475.1a35.91 35.91 0 00-50.9 0 35.91 35.91 0 000 50.9l129.4 129.4 2.1 2.1a33.98 33.98 0 0048.1 0L730.6 434a33.98 33.98 0 000-48.1l-2.8-2.8a33.98 33.98 0 00-48.1 0L483 579.7 378.4 475.1z"}}]},name:"safety",theme:"outlined"},Il=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:Nl}))},wl=j.forwardRef(Il),Sl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"},kl=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:Sl}))},Tl=j.forwardRef(kl),_l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h360c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H184V184h656v320c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V144c0-17.7-14.3-32-32-32zM653.3 599.4l52.2-52.2a8.01 8.01 0 00-4.7-13.6l-179.4-21c-5.1-.6-9.5 3.7-8.9 8.9l21 179.4c.8 6.6 8.9 9.4 13.6 4.7l52.4-52.4 256.2 256.2c3.1 3.1 8.2 3.1 11.3 0l42.4-42.4c3.1-3.1 3.1-8.2 0-11.3L653.3 599.4z"}}]},name:"select",theme:"outlined"},Al=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:_l}))},Rl=j.forwardRef(Al),zl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2a15.99 15.99 0 00-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-.9 3.7-.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 .7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-.8 4.2-2.6 5-5 1.4-4.2-.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z"}}]},name:"send",theme:"outlined"},El=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:zl}))},Ml=j.forwardRef(El),Dl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"},Ol=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:Dl}))},Ll=j.forwardRef(Ol),Pl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M752 664c-28.5 0-54.8 10-75.4 26.7L469.4 540.8a160.68 160.68 0 000-57.6l207.2-149.9C697.2 350 723.5 360 752 360c66.2 0 120-53.8 120-120s-53.8-120-120-120-120 53.8-120 120c0 11.6 1.6 22.7 4.7 33.3L439.9 415.8C410.7 377.1 364.3 352 312 352c-88.4 0-160 71.6-160 160s71.6 160 160 160c52.3 0 98.7-25.1 127.9-63.8l196.8 142.5c-3.1 10.6-4.7 21.8-4.7 33.3 0 66.2 53.8 120 120 120s120-53.8 120-120-53.8-120-120-120zm0-476c28.7 0 52 23.3 52 52s-23.3 52-52 52-52-23.3-52-52 23.3-52 52-52zM312 600c-48.5 0-88-39.5-88-88s39.5-88 88-88 88 39.5 88 88-39.5 88-88 88zm440 236c-28.7 0-52-23.3-52-52s23.3-52 52-52 52 23.3 52 52-23.3 52-52 52z"}}]},name:"share-alt",theme:"outlined"},Bl=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:Pl}))},Fl=j.forwardRef(Bl),$l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"},Vl=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:$l}))},Hl=j.forwardRef(Vl),ql={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M824.2 699.9a301.55 301.55 0 00-86.4-60.4C783.1 602.8 812 546.8 812 484c0-110.8-92.4-201.7-203.2-200-109.1 1.7-197 90.6-197 200 0 62.8 29 118.8 74.2 155.5a300.95 300.95 0 00-86.4 60.4C345 754.6 314 826.8 312 903.8a8 8 0 008 8.2h56c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5A226.62 226.62 0 01612 684c60.9 0 118.2 23.7 161.3 66.8C814.5 792 838 846.3 840 904.3c.1 4.3 3.7 7.7 8 7.7h56a8 8 0 008-8.2c-2-77-33-149.2-87.8-203.9zM612 612c-34.2 0-66.4-13.3-90.5-37.5a126.86 126.86 0 01-37.5-91.8c.3-32.8 13.4-64.5 36.3-88 24-24.6 56.1-38.3 90.4-38.7 33.9-.3 66.8 12.9 91 36.6 24.8 24.3 38.4 56.8 38.4 91.4 0 34.2-13.3 66.3-37.5 90.5A127.3 127.3 0 01612 612zM361.5 510.4c-.9-8.7-1.4-17.5-1.4-26.4 0-15.9 1.5-31.4 4.3-46.5.7-3.6-1.2-7.3-4.5-8.8-13.6-6.1-26.1-14.5-36.9-25.1a127.54 127.54 0 01-38.7-95.4c.9-32.1 13.8-62.6 36.3-85.6 24.7-25.3 57.9-39.1 93.2-38.7 31.9.3 62.7 12.6 86 34.4 7.9 7.4 14.7 15.6 20.4 24.4 2 3.1 5.9 4.4 9.3 3.2 17.6-6.1 36.2-10.4 55.3-12.4 5.6-.6 8.8-6.6 6.3-11.6-32.5-64.3-98.9-108.7-175.7-109.9-110.9-1.7-203.3 89.2-203.3 199.9 0 62.8 28.9 118.8 74.2 155.5-31.8 14.7-61.1 35-86.5 60.4-54.8 54.7-85.8 126.9-87.8 204a8 8 0 008 8.2h56.1c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5 29.4-29.4 65.4-49.8 104.7-59.7 3.9-1 6.5-4.7 6-8.7z"}}]},name:"team",theme:"outlined"},Ul=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:ql}))},Wl=j.forwardRef(Ul),Kl={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 160h-92v-40c0-4.4-3.6-8-8-8H256c-4.4 0-8 3.6-8 8v40h-92a44 44 0 00-44 44v148c0 81.7 60 149.6 138.2 162C265.7 630.2 359 721.7 476 734.5v105.2H280c-17.7 0-32 14.3-32 32V904c0 4.4 3.6 8 8 8h512c4.4 0 8-3.6 8-8v-32.3c0-17.7-14.3-32-32-32H548V734.5C665 721.7 758.3 630.2 773.8 514 852 501.6 912 433.7 912 352V204a44 44 0 00-44-44zM184 352V232h64v207.6a91.99 91.99 0 01-64-87.6zm520 128c0 49.1-19.1 95.4-53.9 130.1-34.8 34.8-81 53.9-130.1 53.9h-16c-49.1 0-95.4-19.1-130.1-53.9-34.8-34.8-53.9-81-53.9-130.1V184h384v296zm136-128c0 41-26.9 75.8-64 87.6V232h64v120z"}}]},name:"trophy",theme:"outlined"},Yl=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:Kl}))},Gl=j.forwardRef(Yl),Ql={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},Jl=function(e,t){return j.createElement(_,A({},e,{ref:t,icon:Ql}))},Xl=j.forwardRef(Jl);const{Title:Zl,Text:en,Paragraph:tn}=R,{Option:sn}=q,{TextArea:ln}=U,nn=[{id:"dm_001",dataModelCode:"DM_AGREEMENT",dataModelName:"采购协议模型",dataModelDesc:"采购协议模型，包含协议编号、产品编码、供应商编码、净价、税率、协议价(含税)、协议品牌号",dataSourceType:"DORIS",databaseName:"yyigou_dsrp",sourceTableName:"dwd_purchase_agreements",fields:[{fieldId:"dmf_001",sourceType:"PHYSICAL",physicalName:"product_code",businessName:"产品编码",role:"DIMENSION_FK",relatedDimensionId:"DIM_PRODUCT"},{fieldId:"dmf_002",sourceType:"PHYSICAL",physicalName:"supplier_code",businessName:"供应商编码",role:"DIMENSION_FK",relatedDimensionId:"DIM_SUPPLIER"},{fieldId:"dmf_003",sourceType:"CALCULATED",expression:"net_price * (1 + tax_rate)",businessName:"协议价(含税)",role:"MEASURE_IMPL",relatedMetricId:"P001"}],status:"ACTIVE",createdBy:"张三",createdAt:"2025-01-20",updatedAt:"2025-01-20"},{id:"dm_002",dataModelCode:"DM_ORDER_HIST",dataModelName:"采购订单历史模型",dataModelDesc:"采购订单历史数据模型，用于分析历史订单价格趋势",dataSourceType:"DORIS",databaseName:"yyigou_dsrp",sourceTableName:"dwd_purchase_orders",fields:[{fieldId:"dmf_101",sourceType:"PHYSICAL",physicalName:"order_code",businessName:"订单编号",role:"DESCRIPTIVE"},{fieldId:"dmf_102",sourceType:"PHYSICAL",physicalName:"order_price",businessName:"订单价格",role:"MEASURE_IMPL",relatedMetricId:"P001"}],status:"ACTIVE",createdBy:"李四",createdAt:"2025-01-18",updatedAt:"2025-01-19"}],an=({visible:e,onCancel:t,onSelect:i})=>{const[s,l]=j.useState(""),[n,a]=j.useState(""),d=[{id:"M001",code:"PRICE_WITH_TAX",name:"含税价格"},{id:"M002",code:"NET_PRICE",name:"净价"},{id:"M003",code:"TAX_AMOUNT",name:"税额"},{id:"M004",code:"DISCOUNT_RATE",name:"折扣率"},{id:"M005",code:"TOTAL_AMOUNT",name:"总金额"}].filter(e=>!s||e.name.toLowerCase().includes(s.toLowerCase())||e.code.toLowerCase().includes(s.toLowerCase()));return di.jsx(G,{title:"选择关联指标",open:e,onOk:()=>{n&&i(n)},onCancel:()=>{a(""),l(""),t()},okText:"确定",cancelText:"取消",width:600,okButtonProps:{disabled:!n},children:di.jsxs("div",{className:"space-y-4",children:[di.jsx(U.Search,{placeholder:"根据指标编号/名称搜索",value:s,onChange:e=>l(e.target.value),allowClear:!0}),di.jsx("div",{className:"max-h-96 overflow-y-auto border rounded",children:d.map(e=>di.jsx("div",{className:"p-3 border-b cursor-pointer hover:bg-gray-50 "+(n===e.id?"bg-blue-50 border-blue-200":""),onClick:()=>a(e.id),children:di.jsxs("div",{className:"flex justify-between items-center",children:[di.jsxs("div",{children:[di.jsx("div",{className:"font-medium",children:e.name}),di.jsx("div",{className:"text-sm text-gray-500 font-mono",children:e.code})]}),n===e.id&&di.jsx("div",{className:"text-blue-600",children:"✓"})]})},e.id))})]})})},dn=({visible:e,onCancel:t,onSelect:i})=>{const[s,l]=j.useState(""),[n,a]=j.useState(""),d=[{id:"DIM_PRODUCT",code:"DIM_PRODUCT",name:"产品维度"},{id:"DIM_SUPPLIER",code:"DIM_SUPPLIER",name:"供应商维度"},{id:"DIM_TIME",code:"DIM_TIME",name:"时间维度"},{id:"DIM_REGION",code:"DIM_REGION",name:"地区维度"}].filter(e=>!s||e.name.toLowerCase().includes(s.toLowerCase())||e.code.toLowerCase().includes(s.toLowerCase()));return di.jsx(G,{title:"选择关联维度",open:e,onOk:()=>{n&&i(n)},onCancel:()=>{a(""),l(""),t()},okText:"确定",cancelText:"取消",width:600,okButtonProps:{disabled:!n},children:di.jsxs("div",{className:"space-y-4",children:[di.jsx(U.Search,{placeholder:"根据维度编号/名称搜索",value:s,onChange:e=>l(e.target.value),allowClear:!0}),di.jsx("div",{className:"max-h-96 overflow-y-auto border rounded",children:d.map(e=>di.jsx("div",{className:"p-3 border-b cursor-pointer hover:bg-gray-50 "+(n===e.id?"bg-blue-50 border-blue-200":""),onClick:()=>a(e.id),children:di.jsxs("div",{className:"flex justify-between items-center",children:[di.jsxs("div",{children:[di.jsx("div",{className:"font-medium",children:e.name}),di.jsx("div",{className:"text-sm text-gray-500 font-mono",children:e.code})]}),n===e.id&&di.jsx("div",{className:"text-blue-600",children:"✓"})]})},e.id))})]})})},rn=({visible:e,onCancel:t,onAddFields:i,availableFields:s})=>{const[l,n]=j.useState([]),a=[{title:"字段名称",dataIndex:"fieldComment",key:"fieldComment",render:(e,t)=>e||t.fieldName},{title:"字段编码",dataIndex:"fieldName",key:"fieldName",render:e=>di.jsx("span",{className:"font-mono text-sm",children:e})},{title:"数据类型",dataIndex:"fieldType",key:"fieldType",render:e=>di.jsx("span",{className:"text-sm",children:e})}],d={selectedRowKeys:l,onChange:e=>{n(e)}};return di.jsx(G,{title:"新增数据模型字段",open:e,onOk:()=>{const e=s.filter(e=>l.includes(e.fieldName)).map((e,t)=>{var i,s,l;return{fieldId:`dmf_${Date.now()}_${t}`,sourceType:"PHYSICAL",physicalName:e.fieldName,businessName:e.fieldComment||e.fieldName,role:"DESCRIPTIVE",dataType:e.fieldType.includes("VARCHAR")?"字符串":e.fieldType.includes("DECIMAL")?"小数":e.fieldType.includes("INT")?"整数":"字符串",fieldLength:e.fieldType.includes("VARCHAR")?parseInt((null==(i=e.fieldType.match(/\((\d+)\)/))?void 0:i[1])||"50"):void 0,numericPrecision:e.fieldType.includes("DECIMAL")?parseInt((null==(s=e.fieldType.match(/\((\d+),\d+\)/))?void 0:s[1])||"10"):void 0,numericScale:e.fieldType.includes("DECIMAL")?parseInt((null==(l=e.fieldType.match(/\(\d+,(\d+)\)/))?void 0:l[1])||"2"):void 0,isPrimaryKey:!1,isForeignKey:!1,componentType:"文本框"}});i(e),n([])},onCancel:()=>{n([]),t()},okText:"确定添加",cancelText:"取消",width:800,okButtonProps:{disabled:0===l.length},children:di.jsxs("div",{className:"space-y-4",children:[di.jsxs("div",{className:"text-sm text-gray-600",children:["从物理表中选择要添加的字段（已选择 ",l.length," 个字段）："]}),s.length>0?di.jsx(Y,{rowSelection:d,columns:a,dataSource:s,rowKey:"fieldName",pagination:!1,scroll:{y:400},size:"small"}):di.jsx("div",{className:"text-center text-gray-500 py-8",children:"没有可添加的字段"})]})})},{TextArea:on}=U,{Option:cn}=q,mn=({open:t,mode:i,subject:s,onClose:l,onSave:n})=>{const[a]=W.useForm(),[d,r]=j.useState(!1);return j.useEffect(()=>{t&&("edit"===i&&s?a.setFieldsValue(s):a.resetFields())},[t,i,s,a]),di.jsx(G,{title:(()=>{switch(i){case"add":return"新建分析主题";case"edit":return"编辑分析主题";case"view":return"查看分析主题";default:return"分析主题"}})(),open:t,onOk:()=>y(e,null,function*(){if("view"!==i)try{r(!0);const e=yield a.validateFields();n(e),te.success("add"===i?"创建成功":"更新成功"),l()}catch(e){}finally{r(!1)}else l()}),onCancel:l,confirmLoading:d,okText:"view"===i?"关闭":"确定",cancelText:"取消",width:600,children:di.jsxs(W,{form:a,layout:"vertical",disabled:"view"===i,children:[di.jsx(W.Item,{name:"subjectName",label:"主题名称",rules:[{required:!0,message:"请输入主题名称"},{max:50,message:"主题名称不能超过50个字符"}],children:di.jsx(U,{placeholder:"请输入主题名称"})}),di.jsx(W.Item,{name:"description",label:"主题描述",rules:[{required:!0,message:"请输入主题描述"},{max:200,message:"主题描述不能超过200个字符"}],children:di.jsx(on,{rows:4,placeholder:"请输入主题描述"})}),di.jsx(W.Item,{name:"status",label:"状态",rules:[{required:!0,message:"请选择状态"}],initialValue:1,children:di.jsxs(q,{placeholder:"请选择状态",children:[di.jsx(cn,{value:1,children:"启用"}),di.jsx(cn,{value:0,children:"停用"})]})})]})})},{TextArea:pn}=U,{Option:xn}=q,hn=({open:t,mode:i,dataset:s,onClose:l,onSave:n,preSelectedSubject:a})=>{const[d]=W.useForm(),[r,o]=j.useState(!1),[c,m]=j.useState("");return j.useEffect(()=>{t&&("edit"===i&&s?(d.setFieldsValue(s),m(s.type||"")):(d.resetFields(),m(""),a&&d.setFieldsValue({analysisSubject:a.subjectName})))},[t,i,s,d,a]),di.jsx(G,{title:(()=>{switch(i){case"add":return"新建数据集";case"edit":return"编辑数据集";case"view":return"查看数据集";default:return"数据集"}})(),open:t,onOk:()=>y(e,null,function*(){if("view"!==i)try{o(!0);const e=yield d.validateFields();n(e),te.success("add"===i?"创建成功":"更新成功"),l()}catch(e){}finally{o(!1)}else l()}),onCancel:l,confirmLoading:r,okText:"view"===i?"关闭":"确定",cancelText:"取消",width:700,children:di.jsxs(W,{form:d,layout:"vertical",disabled:"view"===i,children:[di.jsx(W.Item,{name:"datasetName",label:"数据集名称",rules:[{required:!0,message:"请输入数据集名称"},{max:50,message:"数据集名称不能超过50个字符"}],children:di.jsx(U,{placeholder:"请输入数据集名称"})}),di.jsx(W.Item,{name:"description",label:"数据集描述",rules:[{required:!0,message:"请输入数据集描述"},{max:200,message:"数据集描述不能超过200个字符"}],children:di.jsx(pn,{rows:3,placeholder:"请输入数据集描述"})}),di.jsx(W.Item,{name:"analysisSubject",label:"分析主题",rules:[{required:!0,message:"请选择分析主题"}],children:di.jsxs(q,{placeholder:"请选择分析主题",disabled:!!a||"view"===i,children:[di.jsx(xn,{value:"销售分析主题",children:"销售分析主题"}),di.jsx(xn,{value:"库存分析主题",children:"库存分析主题"}),di.jsx(xn,{value:"财务分析主题",children:"财务分析主题"}),di.jsx(xn,{value:"价格比对分析主题",children:"价格比对分析主题"})]})}),di.jsx(W.Item,{name:"type",label:"数据来源类型",rules:[{required:!0,message:"请选择数据来源类型"}],children:di.jsxs(q,{placeholder:"请选择数据来源类型",onChange:e=>m(e),children:[di.jsx(xn,{value:"数据模型",children:"数据模型"}),di.jsx(xn,{value:"SQL",children:"SQL"}),di.jsx(xn,{value:"Excel",children:"Excel"}),di.jsx(xn,{value:"API接口",children:"API接口"})]})}),di.jsx(W.Item,{name:"status",label:"状态",rules:[{required:!0,message:"请选择状态"}],initialValue:1,children:di.jsxs(q,{placeholder:"请选择状态",children:[di.jsx(xn,{value:1,children:"启用"}),di.jsx(xn,{value:0,children:"停用"})]})}),"add"===i&&"Excel"===c&&di.jsx(W.Item,{name:"file",label:"数据文件",rules:[{required:!0,message:"请上传数据文件"}],children:di.jsx(ie,{beforeUpload:()=>!1,maxCount:1,accept:".xlsx,.xls",children:di.jsx(E,{icon:di.jsx(Xl,{}),children:"选择文件"})})}),"add"===i&&"SQL"===c&&di.jsxs(di.Fragment,{children:[di.jsx(W.Item,{name:"sqlQuery",label:"SQL查询语句",rules:[{required:!0,message:"请输入SQL查询语句"}],children:di.jsx(pn,{rows:6,placeholder:"请输入SQL查询语句，例如：SELECT * FROM table_name WHERE condition"})}),di.jsx(W.Item,{name:"dataSource",label:"数据源",rules:[{required:!0,message:"请选择数据源"}],children:di.jsxs(q,{placeholder:"请选择数据源",children:[di.jsx(xn,{value:"mysql_prod",children:"MySQL生产库"}),di.jsx(xn,{value:"postgresql_dev",children:"PostgreSQL开发库"}),di.jsx(xn,{value:"oracle_warehouse",children:"Oracle数据仓库"})]})})]}),"add"===i&&"API接口"===c&&di.jsxs(di.Fragment,{children:[di.jsx(W.Item,{name:"apiUrl",label:"API地址",rules:[{required:!0,message:"请输入API地址"}],children:di.jsx(U,{placeholder:"请输入API地址，例如：https://api.example.com/data"})}),di.jsx(W.Item,{name:"requestMethod",label:"请求方式",rules:[{required:!0,message:"请选择请求方式"}],initialValue:"GET",children:di.jsxs(q,{placeholder:"请选择请求方式",children:[di.jsx(xn,{value:"GET",children:"GET"}),di.jsx(xn,{value:"POST",children:"POST"})]})}),di.jsx(W.Item,{name:"authType",label:"认证方式",rules:[{required:!0,message:"请选择认证方式"}],initialValue:"none",children:di.jsxs(q,{placeholder:"请选择认证方式",children:[di.jsx(xn,{value:"none",children:"无认证"}),di.jsx(xn,{value:"apikey",children:"API Key"}),di.jsx(xn,{value:"bearer",children:"Bearer Token"})]})}),di.jsx(W.Item,{name:"requestHeaders",label:"请求头",children:di.jsx(pn,{rows:3,placeholder:'请输入请求头信息（JSON格式），例如：{"Content-Type": "application/json"}'})})]})]})})},{Title:un,Text:fn}=R,{Search:gn}=U,{Meta:yn}=D,jn=[{id:"1",name:"销售分析主题",description:"包含销售订单、客户、产品等维度的综合分析主题",datasets:[{id:"1-1",name:"销售订单数据集",subjectId:"1",description:"包含所有销售订单的详细信息，用于销售业绩分析",dataSource:"MySQL - 销售库",lastUpdatedBy:"张三（zhangsan）",lastUpdatedTime:"2025-01-15 14:30",rowCount:12e3,fieldCount:15,relatedModelsCount:5,enabled:!0,fields:[{id:"f1",name:"订单号",type:"VARCHAR(50)",role:"dimension",description:"唯一订单标识符"},{id:"f2",name:"客户名称",type:"VARCHAR(100)",role:"dimension",description:"购买客户的公司名称"},{id:"f3",name:"订单金额",type:"DECIMAL(10,2)",role:"measure",description:"订单总金额，单位：元"},{id:"f4",name:"订单日期",type:"DATE",role:"dimension",description:"客户下单的日期"},{id:"f5",name:"产品类别",type:"VARCHAR(50)",role:"dimension",description:"产品所属的分类"},{id:"f6",name:"销售员",type:"VARCHAR(50)",role:"dimension",description:"负责该订单的销售人员"},{id:"f7",name:"订单数量",type:"INT",role:"measure",description:"订单中产品的总数量"},{id:"f8",name:"折扣率",type:"DECIMAL(5,2)",role:"measure",description:"订单享受的折扣比例"}]},{id:"1-2",name:"客户信息数据集",subjectId:"1",description:"客户基础信息和属性数据，用于客户画像分析",dataSource:"MySQL - 客户库",lastUpdatedBy:"李四（lisi）",lastUpdatedTime:"2025-01-14 16:20",rowCount:3500,fieldCount:12,relatedModelsCount:3,enabled:!0,fields:[{id:"f9",name:"客户ID",type:"VARCHAR(20)",role:"dimension",description:"客户唯一标识符"},{id:"f10",name:"客户名称",type:"VARCHAR(100)",role:"dimension",description:"客户公司名称"},{id:"f11",name:"客户等级",type:"VARCHAR(20)",role:"dimension",description:"客户重要程度等级"},{id:"f12",name:"年度消费额",type:"DECIMAL(12,2)",role:"measure",description:"客户年度总消费金额"},{id:"f13",name:"注册时间",type:"DATETIME",role:"dimension",description:"客户注册平台的时间"},{id:"f14",name:"所在城市",type:"VARCHAR(50)",role:"dimension",description:"客户公司所在城市"}]},{id:"1-3",name:"产品信息数据集",subjectId:"1",description:"产品基础信息和属性",dataSource:"MySQL - 产品库",lastUpdatedBy:"王五（wangwu）",lastUpdatedTime:"2025-01-13 10:15",rowCount:850,fieldCount:8,relatedModelsCount:2,enabled:!1,fields:[{id:"f15",name:"产品ID",type:"VARCHAR(20)",role:"dimension",description:"产品唯一标识符"},{id:"f16",name:"产品名称",type:"VARCHAR(100)",role:"dimension",description:"产品完整名称"},{id:"f17",name:"产品价格",type:"DECIMAL(8,2)",role:"measure",description:"产品单价"},{id:"f18",name:"产品类别",type:"VARCHAR(50)",role:"dimension",description:"产品分类"}]}]},{id:"2",name:"库存分析主题",description:"库存管理和分析相关的数据主题",datasets:[{id:"2-1",name:"库存明细数据集",subjectId:"2",description:"各产品的库存详细信息和库存变动记录",dataSource:"MySQL - 库存库",lastUpdatedBy:"赵六（zhaoliu）",lastUpdatedTime:"2025-01-15 09:15",rowCount:8500,fieldCount:10,relatedModelsCount:4,enabled:!0,fields:[{id:"f19",name:"产品编码",type:"VARCHAR(30)",role:"dimension",description:"产品唯一编码"},{id:"f20",name:"产品名称",type:"VARCHAR(100)",role:"dimension",description:"产品名称"},{id:"f21",name:"当前库存",type:"INT",role:"measure",description:"当前库存数量"},{id:"f22",name:"安全库存",type:"INT",role:"measure",description:"安全库存阈值"},{id:"f23",name:"仓库位置",type:"VARCHAR(50)",role:"dimension",description:"存储仓库位置"},{id:"f24",name:"库存成本",type:"DECIMAL(10,2)",role:"measure",description:"库存总成本"}]},{id:"2-2",name:"库存周转数据集",subjectId:"2",description:"库存周转率和周转天数分析",dataSource:"MySQL - 库存库",lastUpdatedBy:"孙七（sunqi）",lastUpdatedTime:"2025-01-12 15:45",rowCount:2200,fieldCount:7,relatedModelsCount:1,enabled:!0,fields:[{id:"f25",name:"产品类别",type:"VARCHAR(50)",role:"dimension",description:"产品分类"},{id:"f26",name:"周转率",type:"DECIMAL(6,2)",role:"measure",description:"库存周转率"},{id:"f27",name:"周转天数",type:"INT",role:"measure",description:"平均库存周转天数"}]}]},{id:"3",name:"财务分析主题",description:"财务数据分析和报表相关主题",datasets:[{id:"3-1",name:"收入明细数据集",subjectId:"3",description:"各业务线收入明细数据",dataSource:"Oracle - 财务库",lastUpdatedBy:"周八（zhouba）",lastUpdatedTime:"2025-01-14 18:30",rowCount:15600,fieldCount:12,relatedModelsCount:6,enabled:!0,fields:[{id:"f28",name:"业务线",type:"VARCHAR(50)",role:"dimension",description:"业务线名称"},{id:"f29",name:"收入金额",type:"DECIMAL(12,2)",role:"measure",description:"收入金额"},{id:"f30",name:"收入日期",type:"DATE",role:"dimension",description:"收入确认日期"}]}]}],{Option:vn}=q,bn=({availableModels:e,selectedPrimaryModel:t,relations:i,existingFields:s,onAddFields:l,onCancel:n})=>{const[a,d]=j.useState([]),r=(()=>{let l=[];const n=e.find(e=>e.id===t);return n&&n.fields.forEach(e=>{"UNUSED"!==e.role&&l.push(m(c({},e),{sourceModel:n.dataModelName,sourceModelId:n.id,identity:"DIMENSION_FK"===e.role?`维度: ${e.mappingTargetId}`:"MEASURE_IMPL"===e.role?`指标: ${e.mappingTargetId}`:"描述性属性"}))}),i.forEach(t=>{const i=e.find(e=>e.id===t.relatedDataModelId);i&&i.fields.forEach(e=>{"UNUSED"!==e.role&&l.push(m(c({},e),{sourceModel:i.dataModelName,sourceModelId:i.id,identity:"DIMENSION_FK"===e.role?`维度: ${e.mappingTargetId}`:"MEASURE_IMPL"===e.role?`指标: ${e.mappingTargetId}`:"描述性属性"}))})}),l.filter(e=>!s.some(t=>t.fieldId===e.fieldId))})(),o=[{title:"字段名称",dataIndex:"businessName",key:"businessName"},{title:"字段编码",dataIndex:"fieldId",key:"fieldId",render:e=>di.jsx("span",{className:"font-mono text-sm",children:e})},{title:"来源模型",dataIndex:"sourceModel",key:"sourceModel",render:e=>di.jsx("span",{className:"text-sm",children:e})},{title:"字段类型",dataIndex:"identity",key:"identity",render:e=>{let t="default";return e.includes("维度")?t="blue":e.includes("指标")&&(t="green"),di.jsx(B,{color:t,children:e})}}],p={selectedRowKeys:a,onChange:e=>{d(e)}};return di.jsxs("div",{className:"space-y-4",children:[di.jsxs("div",{className:"text-sm text-gray-600",children:["从数据模型中选择要添加的字段（已选择 ",a.length," 个字段）："]}),r.length>0?di.jsx(Y,{rowSelection:p,columns:o,dataSource:r,rowKey:"fieldId",pagination:!1,scroll:{y:400},size:"small"}):di.jsx("div",{className:"text-center text-gray-500 py-8",children:"没有可添加的字段"}),di.jsxs("div",{className:"flex justify-end space-x-2",children:[di.jsx(E,{onClick:()=>{d([]),n()},children:"取消"}),di.jsx(E,{type:"primary",onClick:()=>{const e=r.filter(e=>a.includes(e.fieldId));l(e),d([])},disabled:0===a.length,children:"确定添加"})]})]})},{Option:Cn}=q,{TextArea:Nn}=U,{Option:In}=q,{TextArea:wn}=U,{Title:Sn,Text:kn}=R,{Title:Tn}=R,{Option:_n}=q,{Option:An}=q,Rn=({open:t,reportId:i,reportName:s,onClose:l,onSave:n})=>{const[a]=W.useForm(),[d,r]=j.useState(!1),[o,p]=j.useState([]),[x,h]=j.useState(!1),[u,f]=j.useState(""),g=[{id:"org1",name:"销售部",memberCount:15,level:1},{id:"org2",name:"财务部",memberCount:8,level:1},{id:"org3",name:"采购部",memberCount:12,level:1},{id:"org4",name:"人事部",memberCount:6,level:1},{id:"org5",name:"技术部",memberCount:20,level:1},{id:"org6",name:"质检部",memberCount:10,level:1}],v=[{id:"perm1",organizationId:"org1",organizationName:"销售部",memberCount:15,permissionLevel:"edit"},{id:"perm2",organizationId:"org2",organizationName:"财务部",memberCount:8,permissionLevel:"view"},{id:"perm3",organizationId:"org3",organizationName:"采购部",memberCount:12,permissionLevel:"add_delete"}],b=[{value:"view",label:"👁️ 可查看",color:"#1890ff",description:"可查看报表内容和数据"},{value:"edit",label:"✏️ 可编辑",color:"#52c41a",description:"可修改报表配置、筛选条件等"},{value:"add_delete",label:"➕🗑️ 可新增/删除",color:"#fa8c16",description:"可对报表数据进行增删操作"},{value:"manage",label:"⚙️ 可管理",color:"#722ed1",description:"可管理该报表的权限设置"}];j.useEffect(()=>{t&&(p(v),a.resetFields(),h(!1),f(""))},[t,a]);const C=(e,t)=>{"remove"!==t?(p(i=>i.map(i=>i.organizationId===e?m(c({},i),{permissionLevel:t}):i)),te.success("权限修改成功")):(e=>{p(t=>t.filter(t=>t.organizationId!==e)),te.success("移除权限成功")})(e)},N=o.filter(e=>e.organizationName.toLowerCase().includes(u.toLowerCase()));return di.jsx(G,{title:di.jsxs("div",{className:"flex items-center",children:[di.jsx(Wl,{className:"mr-2"}),"权限管理"]}),open:t,onCancel:l,width:800,footer:[di.jsx(E,{onClick:l,children:"取消"},"cancel"),di.jsx(E,{type:"primary",onClick:()=>{n(o),te.success("权限配置保存成功"),l()},children:"保存权限配置"},"save")],children:di.jsxs("div",{className:"space-y-4",children:[di.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[di.jsxs("div",{className:"flex items-center justify-between mb-3",children:[di.jsxs("div",{className:"flex items-center",children:[di.jsx(Ts,{className:"mr-2 text-gray-600"}),di.jsx("span",{className:"font-medium",children:"添加组织权限"})]}),!x&&di.jsx(E,{type:"dashed",size:"small",icon:di.jsx(K,{}),onClick:()=>{h(!0)},children:"添加组织"})]}),x&&di.jsxs(W,{form:a,layout:"inline",className:"space-y-3",children:[di.jsx(W.Item,{name:"organizationId",rules:[{required:!0,message:"请选择组织"}],className:"flex-1 mb-0",children:di.jsx(q,{placeholder:"选择组织",style:{width:"100%"},showSearch:!0,filterOption:(e,t)=>{var i;return null==(i=null==t?void 0:t.children)?void 0:i.toLowerCase().includes(e.toLowerCase())},children:g.map(e=>di.jsx(An,{value:e.id,disabled:o.some(t=>t.organizationId===e.id),children:di.jsxs("div",{children:[di.jsx("div",{children:e.name}),di.jsxs("div",{className:"text-xs text-gray-500",children:["共 ",e.memberCount," 个成员"]})]})},e.id))})}),di.jsx(W.Item,{name:"permissionLevel",rules:[{required:!0,message:"请选择权限级别"}],className:"mb-0",children:di.jsx(q,{placeholder:"选择权限级别",style:{width:160},children:b.map(e=>di.jsx(An,{value:e.value,children:e.label},e.value))})}),di.jsxs("div",{className:"flex space-x-2",children:[di.jsx(E,{type:"primary",size:"small",onClick:()=>y(e,null,function*(){try{const e=yield a.validateFields(),t=g.find(t=>t.id===e.organizationId);if(!t)return void te.error("请选择组织");if(o.some(e=>e.organizationId===t.id))return void te.error("该组织已存在权限配置");const i={id:`perm_${Date.now()}`,organizationId:t.id,organizationName:t.name,memberCount:t.memberCount,permissionLevel:e.permissionLevel||"view"};p(e=>[...e,i]),a.resetFields(),h(!1),te.success("添加组织权限成功")}catch(e){}}),children:"确定"}),di.jsx(E,{size:"small",onClick:()=>{a.resetFields(),h(!1)},children:"取消"})]})]})]}),di.jsx(V,{className:"my-4"}),di.jsxs("div",{children:[di.jsxs("div",{className:"flex items-center justify-between mb-3",children:[di.jsxs("div",{className:"flex items-center",children:[di.jsx(Wl,{className:"mr-2 text-gray-600"}),di.jsx("span",{className:"font-medium",children:"已授权组织"}),di.jsxs(B,{className:"ml-2",children:[o.length," 个组织"]})]}),di.jsx(U,{placeholder:"搜索组织",prefix:di.jsx(le,{}),value:u,onChange:e=>f(e.target.value),style:{width:200},allowClear:!0})]}),N.length>0?di.jsx("div",{className:"space-y-3",children:N.map(e=>{var t;return t=e.permissionLevel,b.find(e=>e.value===t),di.jsx(D,{size:"small",className:"permission-card",children:di.jsxs("div",{className:"flex items-center justify-between",children:[di.jsxs("div",{className:"flex items-center flex-1",children:[di.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3",children:di.jsx(Ts,{className:"text-blue-600 text-lg"})}),di.jsx("div",{children:di.jsx("div",{className:"font-medium text-gray-900",children:e.organizationName})})]}),di.jsx("div",{className:"flex items-center space-x-3",children:di.jsx(q,{value:e.permissionLevel,onChange:t=>C(e.organizationId,t),style:{width:160},dropdownRender:t=>di.jsxs("div",{children:[b.map(t=>di.jsxs("div",{onClick:()=>C(e.organizationId,t.value),style:{padding:"8px 12px",cursor:"pointer",display:"flex",alignItems:"center",color:t.color},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f5f5f5"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[di.jsx("span",{style:{marginRight:"8px"},children:t.label.split(" ")[0]}),di.jsx("span",{children:t.label.split(" ")[1]})]},t.value)),di.jsx("div",{style:{margin:"4px 0",borderTop:"1px solid #f0f0f0"}}),di.jsxs("div",{onClick:()=>C(e.organizationId,"remove"),style:{padding:"8px 12px",cursor:"pointer",display:"flex",alignItems:"center",color:"#ff4d4f"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#fff2f0"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[di.jsx("span",{style:{marginRight:"8px"},children:"🗑️"}),di.jsx("span",{children:"移除权限"})]})]}),children:b.map(e=>di.jsx(An,{value:e.value,children:di.jsx("span",{style:{color:e.color},children:e.label})},e.value))})})]})},e.id)})}):di.jsx(xe,{image:xe.PRESENTED_IMAGE_SIMPLE,description:u?"未找到匹配的组织":"暂无授权组织",className:"py-8"})]})]})})},{RangePicker:zn}=he,{Option:En}=q,{TextArea:Mn}=U,Dn=({condition:e,value:t,onChange:i,disabled:s=!1,editing:l=!0,inline:n=!1})=>{const[a,d]=j.useState(!1),[r,o]=j.useState([]),p=()=>di.jsx(U,{placeholder:n?"输入":e.placeholder||`请输入${e.fieldName}`,value:t||"",onChange:e=>i(e.target.value),disabled:s||!l,size:"small",style:n?{width:80,minWidth:60}:{width:"100%"}}),x=()=>{var a;return di.jsx(q,{placeholder:n?"选择":e.placeholder||`请选择${e.fieldName}`,value:t,onChange:i,disabled:s||!l,size:"small",style:n?{width:80,minWidth:60}:{width:"100%"},allowClear:!0,children:null==(a=e.options)?void 0:a.map(e=>di.jsx(En,{value:e,children:e},e))})},h=()=>{var a;return n&&t&&t.length>0?di.jsx("div",{className:"flex items-center gap-1 h-5",children:di.jsx("span",{className:"text-xs text-gray-600",children:1===t.length?t[0].substring(0,4)+(t[0].length>4?"...":""):`${t.length}项`})}):di.jsx(q,{mode:"multiple",placeholder:n?"多选":e.placeholder||`请选择${e.fieldName}`,value:t||[],onChange:i,disabled:s||!l,size:"small",style:n?{width:80,minWidth:60}:{width:"100%"},maxTagCount:n?0:void 0,maxTagPlaceholder:e=>`+${e.length}`,dropdownStyle:n?{fontSize:"12px"}:{},children:null==(a=e.options)?void 0:a.map(e=>di.jsx(En,{value:e,children:e},e))})},u=()=>di.jsx(he,{placeholder:n?"日期":e.placeholder||`请选择${e.fieldName}`,value:t,onChange:e=>i(e),disabled:s||!l,size:"small",style:n?{width:100,minWidth:80}:{width:"100%"}}),f=()=>di.jsx(zn,{placeholder:n?["开始","结束"]:["开始日期","结束日期"],value:t,onChange:e=>i(e),disabled:s||!l,size:"small",style:n?{width:150,minWidth:120}:{width:"100%"}}),g=()=>{const e=void 0!==(null==t?void 0:t.min)?t.min:null,a=void 0!==(null==t?void 0:t.max)?t.max:null;return n?di.jsxs(U.Group,{compact:!0,style:{display:"flex",alignItems:"center"},children:[di.jsx(ge,{placeholder:"最小",value:e,onChange:e=>i(m(c({},t),{min:e})),disabled:s||!l,size:"small",style:{width:60},min:0}),di.jsx("span",{className:"px-1 text-gray-400",children:"~"}),di.jsx(ge,{placeholder:"最大",value:a,onChange:e=>i(m(c({},t),{max:e})),disabled:s||!l,size:"small",style:{width:60},min:0})]}):di.jsxs(U.Group,{compact:!0,children:[di.jsx(ge,{placeholder:"最小值",value:e,onChange:e=>i(m(c({},t),{min:e})),disabled:s||!l,size:"small",style:{width:"45%"},min:0}),di.jsx("span",{className:"text-center",style:{width:"10%",display:"inline-block",lineHeight:"24px"},children:"~"}),di.jsx(ge,{placeholder:"最大值",value:a,onChange:e=>i(m(c({},t),{max:e})),disabled:s||!l,size:"small",style:{width:"45%"},min:0})]})},y=()=>di.jsxs("div",{children:[di.jsxs("div",{className:"flex items-center gap-2",children:[di.jsx(E,{icon:di.jsx(le,{}),onClick:()=>d(!0),disabled:s||!l,size:"small",style:n?{padding:"0 8px",fontSize:"12px"}:{},children:n?"选择":`选择${e.fieldName}`}),t&&t.length>0&&di.jsx("div",{className:n?"":"flex-1",children:di.jsxs(J,{wrap:!0,children:[t.slice(0,n?1:3).map(e=>di.jsx(B,{size:"small",closable:!s,onClose:()=>{const s=t.filter(t=>t!==e);i(s)},children:e},e)),t.length>(n?1:3)&&di.jsxs(B,{size:"small",color:"blue",children:["+",t.length-(n?1:3)," 项"]})]})})]}),di.jsxs(G,{title:`选择${e.fieldName}`,open:a,onOk:()=>{i(r),d(!1)},onCancel:()=>{o(t||[]),d(!1)},width:600,okText:"确定",cancelText:"取消",children:[di.jsx("div",{className:"mb-4",children:di.jsxs(R.Text,{type:"secondary",children:["请选择",e.fieldName,"，支持多选"]})}),di.jsx(ne,{checkable:!0,checkedKeys:r,onCheck:e=>o(e),treeData:[{title:"组织机构",key:"org",children:[{title:"集团总部",key:"org1"},{title:"华北分公司",key:"org2"},{title:"华东分公司",key:"org3"}]},{title:"产品类别",key:"category",children:[{title:"生化试剂",key:"cat1"},{title:"免疫试剂",key:"cat2"},{title:"分子诊断",key:"cat3"}]}],defaultExpandAll:!0})]})]});return di.jsx("div",{className:"dynamic-condition-renderer",children:di.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{switch(e.componentType){case"datePicker":case"dateRangePicker":return di.jsx(fe,{className:"text-gray-400"});case"numberRange":return di.jsx(fl,{className:"text-gray-400"});case"modalSelector":return di.jsx(ue,{className:"text-gray-400"});default:return di.jsx(le,{className:"text-gray-400"})}})(),di.jsx("div",{className:"flex-1",children:(()=>{if("metric"===e.fieldType)return g();switch(e.componentType){case"input":default:return p();case"select":return x();case"multiSelect":return h();case"datePicker":return u();case"dateRangePicker":return f();case"numberRange":return g();case"modalSelector":return y()}})()})]})})},{Search:On}=U,Ln=({visible:e,fields:t,title:i,onFieldSelect:s,onCancel:l})=>{const[n,a]=j.useState(""),d=j.useMemo(()=>{let e=t;return n&&(e=e.filter(e=>e.name.toLowerCase().includes(n.toLowerCase())||e.id.toLowerCase().includes(n.toLowerCase()))),e},[t,n]),r=e=>({input:"文本输入",select:"下拉选择",multiSelect:"多选",datePicker:"日期选择",dateRangePicker:"日期区间",numberRange:"数值区间",modalSelector:"弹窗选择"}[e]||"未知类型");return di.jsxs(G,{title:i,open:e,onCancel:l,footer:null,width:600,destroyOnClose:!0,children:[di.jsxs("div",{className:"mb-4",children:[di.jsx(On,{placeholder:"搜索字段名称",allowClear:!0,value:n,onChange:e=>a(e.target.value),style:{marginBottom:12}}),n&&di.jsxs(R.Text,{type:"secondary",className:"text-sm",children:["找到 ",d.length," 个匹配字段"]})]}),di.jsx("div",{style:{maxHeight:400,overflowY:"auto"},children:d.length>0?di.jsx("div",{children:d.map(e=>{return di.jsx(D,{size:"small",hoverable:!0,className:"cursor-pointer mb-2",onClick:()=>{s(e)},bodyStyle:{padding:"12px 16px"},children:di.jsxs("div",{className:"flex items-center justify-between",children:[di.jsx("span",{className:"text-sm font-medium text-gray-800",children:e.name}),di.jsx(B,{color:(t=e.componentType,{input:"blue",select:"green",multiSelect:"cyan",datePicker:"orange",dateRangePicker:"orange",numberRange:"purple",modalSelector:"geekblue"}[t]||"default"),size:"small",children:r(e.componentType)})]})},e.id);var t})}):di.jsx(xe,{description:"暂无匹配的字段",image:xe.PRESENTED_IMAGE_SIMPLE,children:n&&di.jsx(E,{size:"small",onClick:()=>a(""),children:"清除搜索条件"})})})]})},Pn=({type:e,conditions:t,availableFields:i,onUpdateCondition:s,onRemoveCondition:l,onAddCondition:n})=>{const[a,d]=j.useState(!1),[r,o]=j.useState(null),c=t.filter(e=>e.isPredefined),m=t.filter(e=>!e.isPredefined);return di.jsxs("div",{className:"query-condition-group",children:[di.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[[...c,...m].map(e=>di.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-1 border rounded mr-2 mb-2 transition-all h-8 leading-6 "+(e.isPredefined?"border-gray-200 bg-gray-100 opacity-75":"border-blue-200 bg-white hover:border-blue-300"),style:{minHeight:"32px",maxHeight:"32px"},children:[di.jsx("span",{className:"text-xs font-medium whitespace-nowrap "+(e.isPredefined?"text-gray-600":"text-gray-800"),children:e.fieldName}),di.jsx("span",{className:"text-gray-400 text-xs flex-shrink-0",children:":"}),di.jsx("div",{className:"min-w-0 flex-1 flex items-center",children:di.jsx(Dn,{condition:e,value:e.value,onChange:t=>s(e.id,t),disabled:e.isPredefined,editing:!e.isPredefined,inline:!0})}),!e.isPredefined&&di.jsx(E,{type:"text",size:"small",icon:di.jsx(ee,{}),onClick:()=>l(e.id),className:"text-gray-400 hover:text-red-500 p-0 h-4 w-4 min-w-0 ml-1 flex-shrink-0",title:"删除条件"})]},e.id)),di.jsx(E,{type:"dashed",icon:di.jsx(K,{}),onClick:()=>d(!0),disabled:0===i.length,size:"small",className:"h-6 px-2 text-xs border-gray-300 hover:border-blue-400 hover:text-blue-600",children:i.length>0?"添加":"无可用"})]}),di.jsx(Ln,{visible:a,fields:i,title:`选择${"metric"===e?"指标":"维度"}字段`,onFieldSelect:e=>{n(e),d(!1)},onCancel:()=>d(!1)})]})},{Title:Bn}=R,{Panel:Fn}=ce,$n=({visible:e=!0,conditions:t,onConditionsChange:i,availableFields:s,predefinedConditions:l=[],loading:n=!1})=>{const[a,d]=j.useState(["comparison","groupPrice","historyPrice","metric"]),[r,o]=j.useState(null),p=j.useCallback(()=>{const e={comparison:[],groupPrice:[],historyPrice:[],metric:[]};return t.forEach(t=>{e[t.groupType].push(t)}),l.forEach(t=>{if("baseline"===t.groupType){const i="历史价"===t.baselineName?"historyPrice":"groupPrice";e[i].some(e=>e.isPredefined&&e.fieldId===t.fieldId)||e[i].push(m(c({},t),{groupType:i}))}else e[t.groupType].push(t)}),e},[t,l]),x=j.useCallback(()=>t.filter(e=>!e.isPredefined).map(e=>e.fieldId),[t]),h=j.useCallback((e,s)=>{if(x().includes(s.id))return void te.warning("该字段已添加过查询条件");const l={id:`${s.id}_${Date.now()}`,fieldId:s.id,fieldName:s.name,fieldType:s.type,groupType:e,value:null,isPredefined:!1,componentType:s.componentType,options:s.options,placeholder:s.placeholder};i([...t,l]),te.success(`已添加${s.name}查询条件`)},[t,x,i]),u=j.useCallback((e,s)=>{const l=t.map(t=>t.id===e?m(c({},t),{value:s}):t);i(l)},[t,i]),f=j.useCallback(e=>{const s=t.find(t=>t.id===e);(null==s?void 0:s.isPredefined)?te.warning("预置条件不能删除"):i(t.filter(t=>t.id!==e))},[t,i]),g=j.useCallback(()=>{const e=t.filter(e=>e.isPredefined);i(e),te.success("已清空自定义查询条件")},[t,i]),y=p(),v=x(),b=[{key:"comparison",title:"比对对象",description:"设置比对对象的查询条件",icon:di.jsx(Ws,{className:"text-blue-600"}),color:"blue"},{key:"groupPrice",title:"集团价",description:"设置集团采购价格基准条件",icon:di.jsx(Ll,{className:"text-green-600"}),color:"green"},{key:"historyPrice",title:"历史价",description:"设置历史采购价格基准条件",icon:di.jsx(Ll,{className:"text-purple-600"}),color:"purple"},{key:"metric",title:"指标",description:"设置指标的数值区间条件",icon:di.jsx(Ws,{className:"text-orange-600"}),color:"orange"}];return e?di.jsxs(D,{className:"mb-4",size:"small",title:di.jsxs("div",{className:"flex items-center justify-between",children:[di.jsxs("div",{className:"flex items-center",children:[di.jsx(Ws,{className:"mr-2 text-blue-600"}),di.jsx(Bn,{level:5,className:"mb-0",children:"查询条件"})]}),di.jsx(J,{children:di.jsx(E,{size:"small",onClick:g,disabled:0===t.filter(e=>!e.isPredefined).length,children:"清空条件"})})]}),children:[di.jsx(ce,{activeKey:a,onChange:d,size:"small",ghost:!0,children:b.map(e=>{const t=y[e.key];return di.jsx(Fn,{header:di.jsx("div",{className:"flex items-center justify-between w-full",children:di.jsxs("div",{className:"flex items-center",children:[e.icon,di.jsx("span",{className:"ml-2 font-medium",children:e.title}),di.jsx(R.Text,{type:"secondary",className:"ml-2 text-xs",children:e.description})]})}),children:di.jsx(Pn,{type:e.key,conditions:t,availableFields:s.filter(t=>"metric"===e.key?"metric"===t.type&&!v.includes(t.id):"dimension"===t.type&&!v.includes(t.id)),onUpdateCondition:u,onRemoveCondition:f,onAddCondition:t=>h(e.key,t)})},e.key)})}),0===t.length&&0===l.length&&di.jsx(xe,{image:xe.PRESENTED_IMAGE_SIMPLE,description:"暂无查询条件",className:"py-4",children:di.jsx(E,{type:"primary",icon:di.jsx(K,{}),onClick:()=>o("comparison"),children:"添加查询条件"})})]}):null},{Title:Vn,Text:Hn}=R,{Content:qn}=ye,{TextArea:Un}=U,{Title:Wn,Text:Kn}=R,{TextArea:Yn}=U,{Option:Gn}=q,{Title:Qn,Text:Jn}=R,{TextArea:Xn}=U,{TabPane:Zn}=O,{Option:ea}=q,{Step:ta}=Q,{Panel:ia}=ce,{Option:sa}=q,{TextArea:la}=U,{Title:na,Text:aa}=R,{RangePicker:da}=he,{Step:ra}=Q,{Option:oa}=q,{TextArea:ca}=U,{Title:ma}=R,pa=({visible:e,onCancel:t,onOk:i,title:s="新增自定义指标"})=>{const[l]=W.useForm(),[n,a]=j.useState(0),[d,r]=j.useState(!1),[o,p]=j.useState(""),[x,h]=j.useState({string:!0,number:!0,date:!0}),u=()=>{l.resetFields(),a(0),p("")};j.useEffect(()=>{e&&u()},[e]);const f=()=>{u(),t()};return di.jsxs(di.Fragment,{children:[di.jsx(G,{title:s,open:e,onCancel:f,footer:[di.jsx(E,{onClick:f,children:"取消"},"cancel"),di.jsx(E,{type:"primary",onClick:()=>{l.validateFields().then(e=>{if(e.bizSpec&&e.bizSpec.length>500)return void te.error("指标描述不能超过500字");const t=m(c({id:Date.now().toString()},e),{expression:o});i(t),te.success("自定义指标创建成功")})},children:"保存"},"save")],width:800,destroyOnClose:!0,children:di.jsxs(W,{form:l,layout:"vertical",children:[di.jsxs("div",{children:[di.jsx(ma,{level:4,children:"基本信息"}),di.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[di.jsx(W.Item,{name:"metricName",label:di.jsxs("span",{children:["指标名称 ",di.jsx("span",{style:{color:"red"},children:"*"})]}),rules:[{required:!0,message:"请输入指标名称"}],children:di.jsx(U,{placeholder:"协议价 / 最低价 / 差异率"})}),di.jsx(W.Item,{name:"metricCode",label:di.jsxs("span",{children:["指标编码 ",di.jsx("span",{style:{color:"red"},children:"*"})]}),rules:[{required:!0,message:"请输入指标编码"}],children:di.jsx(U,{placeholder:"ind_agreement_price"})})]}),di.jsxs(W.Item,{name:"bizSpec",label:"指标描述",children:[di.jsx(ca,{placeholder:"请描述指标的业务含义和计算逻辑",rows:3,onChange:e=>a(e.target.value.length)}),di.jsxs("div",{style:{textAlign:"right",color:"#999",fontSize:"12px",marginTop:"4px"},children:[n,"/500"]})]}),di.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[di.jsx(W.Item,{name:"unit",label:"单位",children:di.jsx(U,{placeholder:"万元、个、%"})}),di.jsx(W.Item,{name:"scale",label:"精度",children:di.jsx(U,{placeholder:"2",type:"number",min:0,max:10,style:{width:"100%"}})})]})]}),di.jsx(V,{}),di.jsxs("div",{children:[di.jsx(ma,{level:4,children:"指标公式"}),di.jsx("div",{className:"grid grid-cols-1 gap-4",children:di.jsx(W.Item,{name:"expression",label:"指标公式",children:di.jsx(U,{placeholder:"点击编辑指标公式",readOnly:!0,value:o,style:{cursor:"pointer"},onClick:()=>{r(!0)},suffix:di.jsx(Gs,{})})})})]})]})}),di.jsx(G,{title:"指标公式编辑器",open:d,onCancel:()=>r(!1),onOk:()=>{l.setFieldsValue({expression:o}),r(!1)},width:1200,style:{top:20},children:di.jsxs("div",{style:{display:"flex",gap:"16px",height:"600px"},children:[di.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"16px"},children:[di.jsx(D,{size:"small",title:di.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#722ed1",display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{display:"inline-block",width:"4px",height:"14px",backgroundColor:"#722ed1",borderRadius:"2px"}}),"🔢 聚合函数"]}),style:{border:"1px solid #d3adf7",borderRadius:"8px",background:"linear-gradient(135deg, #f9f0ff 0%, #ffffff 100%)"},children:di.jsx(J,{wrap:!0,children:["SUM","AVG","COUNT","MAX","MIN","COUNT(DISTINCT)"].map(e=>di.jsx(E,{size:"small",onClick:()=>{p(t=>t?`${t} ${e}()`:`${e}()`)},style:{fontFamily:"monospace",fontWeight:"bold"},children:e},e))})}),di.jsx(D,{size:"small",title:di.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#1890ff",display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{display:"inline-block",width:"4px",height:"14px",backgroundColor:"#1890ff",borderRadius:"2px"}}),"🔢 数值函数"]}),style:{border:"1px solid #91d5ff",borderRadius:"8px",background:"linear-gradient(135deg, #e6f7ff 0%, #ffffff 100%)"},children:di.jsx(J,{wrap:!0,children:["ROUND","CEIL","FLOOR","ABS","POWER","SQRT"].map(e=>di.jsx(E,{size:"small",onClick:()=>{p(t=>t?`${t} ${e}()`:`${e}()`)},style:{fontFamily:"monospace",fontWeight:"bold"},children:e},e))})})]}),di.jsxs("div",{style:{flex:1.5,display:"flex",flexDirection:"column",gap:"16px"},children:[di.jsx(D,{size:"small",title:di.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#1890ff",display:"flex",alignItems:"center",gap:"12px",padding:"8px 0"},children:[di.jsx("span",{style:{display:"inline-block",width:"6px",height:"20px",backgroundColor:"#1890ff",borderRadius:"3px"}}),"🎯 指标公式编辑器"]}),style:{border:"2px solid #1890ff",borderRadius:"12px",flex:1},children:di.jsx(ca,{value:o,onChange:e=>p(e.target.value),placeholder:"🚀 在此输入指标公式，或点击右侧元素快速构建...",autoSize:{minRows:16,maxRows:20},style:{fontFamily:'Monaco, Menlo, "Ubuntu Mono", monospace',fontSize:"14px",lineHeight:"1.6"}})}),di.jsx(D,{size:"small",title:"⚡ 常用操作符",style:{border:"1px solid #b7eb8f",borderRadius:"8px"},children:di.jsx(J,{wrap:!0,children:["+","-","*","/","(",")","=","<",">","<=",">=","<>","AND","OR","NOT"].map(e=>di.jsx(E,{size:"small",onClick:()=>{p(t=>t?`${t} ${e}`:e)},style:{fontFamily:"monospace",fontWeight:"bold"},children:e},e))})})]})]})})]})},{Option:xa}=q,{TextArea:ha}=U,{Title:ua,Text:fa}=R,{RangePicker:ga}=he,{Panel:ya}=ce,{Option:ja}=q,va=({visible:t,field:i,onCancel:s,onOk:l,initialConfig:n})=>{const[a]=W.useForm();return j.useEffect(()=>{var e;if(t&&i){const t={fieldId:i.id,fieldCode:i.fieldCode,fieldName:i.fieldName,fieldType:i.fieldType,displayName:i.displayName,queryComponent:{type:"input"}},s=c(c({},t),n);a.setFieldsValue({queryComponentType:(null==(e=s.queryComponent)?void 0:e.type)||"input"})}},[t,i,n,a]),di.jsx(G,{title:`配置字段: ${(null==i?void 0:i.displayName)||(null==i?void 0:i.fieldName)}`,open:t,onOk:()=>y(e,null,function*(){try{const e=yield a.validateFields();if(!i)return;const t={fieldId:i.id,fieldCode:i.fieldCode,fieldName:i.fieldName,fieldType:i.fieldType,displayName:i.displayName,queryComponent:{type:e.queryComponentType}};l(t)}catch(e){}}),onCancel:s,width:500,destroyOnClose:!0,children:di.jsx(W,{form:a,layout:"vertical",preserve:!1,children:di.jsx(D,{title:"查询组件设置",size:"small",children:di.jsx(W.Item,{label:"组件类型",name:"queryComponentType",rules:[{required:!0,message:"请选择查询组件类型"}],children:di.jsxs(q,{placeholder:"请选择查询组件类型",children:[di.jsx(ja,{value:"input",children:"输入框"}),di.jsx(ja,{value:"select",children:"下拉选择"}),di.jsx(ja,{value:"multiSelect",children:"多选下拉"}),di.jsx(ja,{value:"datePicker",children:"日期选择"}),di.jsx(ja,{value:"dateRangePicker",children:"日期范围"}),di.jsx(ja,{value:"numberRange",children:"数值范围"}),di.jsx(ja,{value:"modalSelector",children:"弹窗选择"})]})})})})})},{Option:ba}=q,{TextArea:Ca}=U,{Title:Na,Text:Ia}=R,{Option:wa}=q,{TextArea:Sa}=U,{Title:ka,Text:Ta}=R,{Title:_a,Text:Aa}=R,{Search:Ra}=U,za=[{title:"工作台",to:"/",icon:di.jsx(mt,{className:"h-4 w-4"}),component:()=>{const[e,t]=j.useState("templates"),i=[{id:"1",name:"同产品与历史价格对比",description:"分析同一产品在不同时间段的价格变化趋势",category:"价格趋势",isStarred:!0,usageCount:156},{id:"2",name:"跨组织价格差异分析",description:"对比不同组织间同类产品的价格差异",category:"价格对比",isStarred:!1,usageCount:89},{id:"3",name:"协议价执行情况分析",description:"监控协议价格的执行情况和偏差",category:"协议监控",isStarred:!0,usageCount:234},{id:"4",name:"同类产品比价分析",description:"对同类产品进行全面的价格比较分析",category:"产品比价",isStarred:!1,usageCount:178}],s=[{id:"1",type:"warning",title:"价格异动预警",description:"物料 [CPU-i9-14900K] 的最新采购价(150元)较上月均价上涨超过15%",time:"10分钟前",actionText:"查看详情"},{id:"2",type:"info",title:"协议到期提醒",description:"供应商 [供应商C] 的协议价将于 [2025-08-30] 到期，请及时处理",time:"1小时前",actionText:"去处理"}],l={value:1258e4,change:8.5},n={value:125e4,change:15.2},a={value:156,change:-2.1},d={value:94.5,change:3.2};return di.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[di.jsx("div",{className:"mb-6",children:di.jsxs("div",{className:"flex justify-between items-center",children:[di.jsxs("div",{children:[di.jsx(Zl,{level:2,className:"mb-2",children:"智能比价分析平台"}),di.jsx(en,{type:"secondary",children:"欢迎您，李经理"})]}),di.jsxs("div",{className:"flex items-center space-x-4",children:[di.jsx(z,{count:3,children:di.jsx(E,{icon:di.jsx(Rs,{}),shape:"circle"})}),di.jsx(M,{size:"large",children:"李"})]})]})}),di.jsx(D,{className:"mb-6",title:di.jsxs("div",{className:"flex items-center space-x-2",children:[di.jsx(Le,{className:"h-5 w-5 text-green-500"}),di.jsx("span",{children:"我的工作区"})]}),children:di.jsx(O,{activeKey:e,onChange:t,items:[{key:"templates",label:"常用报表模板",children:di.jsx(L,{gutter:[16,16],children:i.map(e=>di.jsx(P,{xs:24,sm:12,lg:6,children:di.jsx(D,{size:"small",hoverable:!0,actions:[di.jsx(E,{type:"primary",size:"small",onClick:()=>{e.id},children:"开始分析"}),di.jsx(E,{type:"text",size:"small",icon:e.isStarred?di.jsx(F,{style:{color:"#faad14"}}):di.jsx(Hl,{}),onClick:()=>{e.id},children:e.isStarred?"已收藏":"收藏"})],children:di.jsx(D.Meta,{title:di.jsxs("div",{className:"flex items-center justify-between",children:[di.jsx("span",{className:"text-sm font-medium",children:e.name}),e.isStarred&&di.jsx(F,{style:{color:"#faad14",fontSize:"12px"}})]}),description:di.jsxs("div",{className:"space-y-2",children:[di.jsx(tn,{ellipsis:{rows:2},className:"text-xs text-gray-600 mb-2",children:e.description}),di.jsxs("div",{className:"flex justify-between items-center",children:[di.jsx(B,{color:"blue",children:e.category}),di.jsxs(en,{type:"secondary",className:"text-xs",children:["使用 ",e.usageCount," 次"]})]})]})})})},e.id))})},{key:"schemes",label:"我的方案",children:di.jsx("div",{className:"text-center py-8",children:di.jsx(en,{type:"secondary",children:"暂无个人方案"})})},{key:"favorites",label:"我的收藏",children:di.jsx(L,{gutter:[16,16],children:i.filter(e=>e.isStarred).map(e=>di.jsx(P,{xs:24,sm:12,lg:6,children:di.jsx(D,{size:"small",hoverable:!0,actions:[di.jsx(E,{type:"primary",size:"small",onClick:()=>{e.id},children:"开始分析"})],children:di.jsx(D.Meta,{title:di.jsx("span",{className:"text-sm font-medium",children:e.name}),description:di.jsxs("div",{className:"space-y-2",children:[di.jsx(tn,{ellipsis:{rows:2},className:"text-xs text-gray-600 mb-2",children:e.description}),di.jsx(B,{color:"blue",children:e.category})]})})})},e.id))})}]})}),di.jsxs(L,{gutter:[16,16],children:[di.jsx(P,{xs:24,lg:12,children:di.jsx(D,{title:di.jsxs("div",{className:"flex items-center space-x-2",children:[di.jsx(Pe,{className:"h-5 w-5 text-orange-500"}),di.jsx("span",{children:"智能洞察与预警"})]}),className:"h-full",children:di.jsxs("div",{className:"space-y-4",children:[di.jsxs("div",{children:[di.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[di.jsx(Rs,{className:"text-red-500"}),di.jsxs(en,{strong:!0,children:["价格异动预警 (",s.length,"条)"]})]}),di.jsx("div",{className:"space-y-2",children:s.map(e=>{return di.jsx($,{type:e.type,showIcon:!0,icon:(t=e.type,{warning:di.jsx(Pe,{className:"h-4 w-4",style:{color:"#faad14"}}),info:di.jsx(ll,{style:{color:"#1890ff"}}),success:di.jsx(qe,{className:"h-4 w-4",style:{color:"#52c41a"}})}[t]),message:di.jsxs("div",{className:"flex justify-between items-center",children:[di.jsxs("div",{children:[di.jsx("div",{className:"font-medium",children:e.title}),di.jsx("div",{className:"text-sm text-gray-600 mt-1",children:e.description}),di.jsx(en,{type:"secondary",className:"text-xs",children:e.time})]}),di.jsx(E,{type:"link",size:"small",children:e.actionText})]})},e.id);var t})})]}),di.jsx(V,{}),di.jsxs("div",{children:[di.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[di.jsx(ll,{className:"text-blue-500"}),di.jsx(en,{strong:!0,children:"洞察推荐"})]}),di.jsx("div",{className:"space-y-3",children:[{id:"1",title:"降本机会发现",description:"您常分析的 [内存条] 品类，发现 [供应商D] 的价格在过去一季度中持续最低",actionText:"生成对比报表",time:"2小时前"},{id:"2",title:"供应商表现分析",description:"供应商 [供应商A] 在 [显卡] 品类的价格稳定性表现优异，建议加强合作",actionText:"查看详细分析",time:"1天前"}].map(e=>di.jsx("div",{className:"p-3 bg-blue-50 rounded-lg",children:di.jsxs("div",{className:"flex justify-between items-start",children:[di.jsxs("div",{className:"flex-1",children:[di.jsx("div",{className:"font-medium text-blue-900 mb-1",children:e.title}),di.jsx("div",{className:"text-sm text-blue-700 mb-2",children:e.description}),di.jsx(en,{type:"secondary",className:"text-xs",children:e.time})]}),di.jsx(E,{type:"primary",size:"small",ghost:!0,children:e.actionText})]})},e.id))})]})]})})}),di.jsx(P,{xs:24,lg:12,children:di.jsxs(D,{title:di.jsxs("div",{className:"flex items-center space-x-2",children:[di.jsx(Ve,{className:"h-5 w-5 text-purple-500"}),di.jsx("span",{children:"关键指标概览"})]}),className:"h-full",children:[di.jsxs(L,{gutter:[16,16],children:[di.jsx(P,{span:12,children:di.jsx(D,{size:"small",className:"text-center",children:di.jsx(H,{title:"采购总额(月度)",value:l.value,precision:0,valueStyle:{color:"#3f8600"},prefix:di.jsx(Be,{className:"h-4 w-4"}),suffix:di.jsxs("div",{className:"text-xs",children:[di.jsx(Cl,{style:{color:"#3f8600"}}),Math.abs(l.change),"%"]})})})}),di.jsx(P,{span:12,children:di.jsx(D,{size:"small",className:"text-center",children:di.jsx(H,{title:"降本金额",value:n.value,precision:0,valueStyle:{color:"#3f8600"},prefix:di.jsx(Gl,{}),suffix:di.jsxs("div",{className:"text-xs",children:[di.jsx(Cl,{style:{color:"#3f8600"}}),n.change,"%"]})})})}),di.jsx(P,{span:12,children:di.jsx(D,{size:"small",className:"text-center",children:di.jsx(H,{title:"活跃供应商",value:a.value,valueStyle:{color:"#cf1322"},prefix:di.jsx(Fe,{className:"h-4 w-4"}),suffix:di.jsxs("div",{className:"text-xs",children:[di.jsx(Hs,{style:{color:"#cf1322"}}),Math.abs(a.change),"%"]})})})}),di.jsx(P,{span:12,children:di.jsx(D,{size:"small",className:"text-center",children:di.jsx(H,{title:"协议执行率",value:d.value,precision:1,valueStyle:{color:"#3f8600"},prefix:di.jsx($e,{className:"h-4 w-4"}),suffix:di.jsxs("div",{className:"text-xs",children:[di.jsx(Cl,{style:{color:"#3f8600"}}),d.change,"%"]})})})})]}),di.jsx("div",{className:"mt-4",children:di.jsxs(L,{gutter:[16,16],children:[di.jsx(P,{span:12,children:di.jsx(D,{size:"small",title:"采购总额趋势",children:di.jsx("div",{className:"h-32 flex items-center justify-center bg-gray-50 rounded",children:di.jsxs("div",{className:"text-center",children:[di.jsx(Ve,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),di.jsx(en,{type:"secondary",className:"text-xs",children:"柱状图/折线图"})]})})})}),di.jsx(P,{span:12,children:di.jsx(D,{size:"small",title:"品类成本占比",children:di.jsx("div",{className:"h-32 flex items-center justify-center bg-gray-50 rounded",children:di.jsxs("div",{className:"text-center",children:[di.jsx(He,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),di.jsx(en,{type:"secondary",className:"text-xs",children:"饼图/环形图"})]})})})})]})})]})})]})]})},group:"一期"},{title:"数据模型",to:"/data-model",icon:di.jsx(it,{className:"h-4 w-4"}),component:()=>{const[t,i]=j.useState(nn),[s,l]=j.useState(!1),[n,a]=j.useState(null),[d]=W.useForm(),[r]=j.useState(!1),[o,p]=j.useState(0),[x,h]=j.useState(""),[u,f]=j.useState(""),[g,v]=j.useState([]),[b,C]=j.useState([]),[N,I]=j.useState(!1),[w,S]=j.useState(!1),[k,T]=j.useState(!1),[_,A]=j.useState(""),R={yyigou_dsrp:[{tableName:"dwd_purchase_agreements",tableComment:"采购协议明细表",fields:[{fieldName:"agreement_code",fieldType:"VARCHAR(50)",fieldComment:"协议编号"},{fieldName:"product_code",fieldType:"VARCHAR(50)",fieldComment:"产品编码"},{fieldName:"supplier_code",fieldType:"VARCHAR(50)",fieldComment:"供应商编码"},{fieldName:"net_price",fieldType:"DECIMAL(10,2)",fieldComment:"净价"},{fieldName:"tax_rate",fieldType:"DECIMAL(5,4)",fieldComment:"税率"},{fieldName:"brand_name",fieldType:"VARCHAR(100)",fieldComment:"品牌名称"}]},{tableName:"dwd_purchase_orders",tableComment:"采购订单明细表",fields:[{fieldName:"order_code",fieldType:"VARCHAR(50)",fieldComment:"订单编号"},{fieldName:"product_code",fieldType:"VARCHAR(50)",fieldComment:"产品编码"},{fieldName:"supplier_code",fieldType:"VARCHAR(50)",fieldComment:"供应商编码"},{fieldName:"order_price",fieldType:"DECIMAL(10,2)",fieldComment:"订单价格"},{fieldName:"order_quantity",fieldType:"INT",fieldComment:"订单数量"}]}]};j.useEffect(()=>{},[]);const z=[{title:"模型编码",dataIndex:"dataModelCode",key:"dataModelCode",width:150,fixed:"left"},{title:"模型名称",dataIndex:"dataModelName",key:"dataModelName",width:200,fixed:"left",render:(e,t)=>di.jsx(E,{type:"link",onClick:()=>D(),style:{padding:0},children:e})},{title:"数据源类型",dataIndex:"dataSourceType",key:"dataSourceType",width:120,render:e=>di.jsx(B,{icon:di.jsx(Ls,{}),color:"DORIS"===e?"blue":"green",children:e})},{title:"数据库",dataIndex:"databaseName",key:"databaseName",width:150},{title:"源表",dataIndex:"sourceTableName",key:"sourceTableName",width:200},{title:"状态",dataIndex:"status",key:"status",width:80,align:"center",render:e=>di.jsx(B,{color:"ACTIVE"===e?"green":"red",children:"ACTIVE"===e?"启用":"禁用"})},{title:"创建人",dataIndex:"createdBy",key:"createdBy",width:100,align:"center"},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt",width:120,align:"center"},{title:"操作",key:"action",width:180,fixed:"right",render:(e,t)=>di.jsxs(J,{size:"small",children:[di.jsx(E,{type:"link",icon:di.jsx(X,{}),onClick:()=>M(t),size:"small",children:"编辑"}),di.jsx(E,{type:"link",onClick:()=>O(t),size:"small",children:"ACTIVE"===t.status?"禁用":"启用"}),di.jsx(Z,{title:"确定要删除这个数据模型吗？",onConfirm:()=>L(t.id),okText:"确定",cancelText:"取消",children:di.jsx(E,{type:"link",danger:!0,icon:di.jsx(ee,{}),size:"small",children:"删除"})})]})}],M=e=>{a(e),p(0),h(e.databaseName),f(e.sourceTableName),C(e.fields),d.setFieldsValue({dataModelCode:e.dataModelCode,dataModelName:e.dataModelName,dataModelDesc:e.dataModelDesc,dataSourceType:e.dataSourceType,databaseName:e.databaseName,sourceTableName:e.sourceTableName}),l(!0)},D=e=>{},O=e=>{const t="ACTIVE"===e.status?"INACTIVE":"ACTIVE";i(i=>i.map(i=>i.id===e.id?m(c({},i),{status:t}):i)),te.success("数据模型已"+("ACTIVE"===t?"启用":"禁用"))},L=e=>{i(t=>t.filter(t=>t.id!==e)),te.success("数据模型删除成功")},P=(e,t)=>{C(i=>i.map(i=>i.fieldId===e?c(c({},i),t):i))},F=[{title:"基本信息",description:"填写数据模型基本信息"},{title:"数据源配置",description:"选择数据源和物理表"}];return di.jsxs("div",{className:"p-6",children:[di.jsxs("div",{className:"flex justify-between items-center mb-6",children:[di.jsxs("div",{children:[di.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"数据模型管理"}),di.jsx("p",{className:"text-gray-600 mt-1",children:"管理和配置数据模型，定义业务字段映射关系"})]}),di.jsx("div",{children:di.jsx(E,{type:"primary",icon:di.jsx(K,{}),onClick:()=>{a(null),p(0),h(""),f(""),v([]),C([]),d.resetFields(),l(!0)},children:"新建数据模型"})})]}),di.jsx(Y,{columns:z,dataSource:t,rowKey:"id",loading:r,scroll:{x:1400},pagination:{total:t.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}}),di.jsxs(G,{title:n?"编辑数据模型":"新建数据模型",open:s,onCancel:()=>l(!1),width:1200,footer:di.jsxs("div",{className:"flex justify-end space-x-2",children:[di.jsx(E,{onClick:()=>l(!1),children:"取消"}),o>0&&di.jsx(E,{onClick:()=>{p(o-1)},children:"上一步"}),o<F.length-1?di.jsx(E,{type:"primary",onClick:()=>y(e,null,function*(){if(0===o)try{yield d.validateFields(["dataModelCode","dataModelName","dataModelDesc"]),p(1)}catch(e){e instanceof Error&&te.error("请填写完整的基本信息")}}),children:"下一步"}):di.jsx(E,{type:"primary",onClick:()=>y(e,null,function*(){try{const e=yield d.validateFields(),t=m(c({id:(null==n?void 0:n.id)||`dm_${Date.now()}`},e),{fields:b,status:(null==n?void 0:n.status)||"ACTIVE",createdBy:(null==n?void 0:n.createdBy)||"当前用户",createdAt:(null==n?void 0:n.createdAt)||(new Date).toISOString().split("T")[0],updatedAt:(new Date).toISOString().split("T")[0]});n?(i(e=>e.map(e=>e.id===n.id?t:e)),te.success("数据模型更新成功")):(i(e=>[...e,t]),te.success("数据模型创建成功")),l(!1)}catch(e){te.error("保存失败，请检查表单信息")}}),children:"保存"})]}),children:[di.jsx("div",{className:"mb-6",children:di.jsx(Q,{current:o,items:F})}),di.jsxs(W,{form:d,layout:"vertical",className:"data-model-form",children:[0===o&&di.jsxs("div",{children:[di.jsx(W.Item,{label:"模型编码",name:"dataModelCode",rules:[{required:!0,message:"请输入模型编码"}],children:di.jsx(U,{placeholder:"请输入模型编码，如：DM_AGREEMENT"})}),di.jsx(W.Item,{label:"模型名称",name:"dataModelName",rules:[{required:!0,message:"请输入模型名称"}],children:di.jsx(U,{placeholder:"请输入模型名称"})}),di.jsx(W.Item,{label:"模型描述",name:"dataModelDesc",rules:[{required:!0,message:"请输入模型描述"}],children:di.jsx(ln,{rows:3,placeholder:"请输入模型描述"})})]}),1===o&&di.jsxs("div",{children:[di.jsx(W.Item,{label:"数据源类型",name:"dataSourceType",rules:[{required:!0,message:"请选择数据源类型"}],children:di.jsxs(q,{placeholder:"请选择数据源类型",children:[di.jsx(sn,{value:"DORIS",children:"DORIS"}),di.jsx(sn,{value:"MYSQL",children:"MYSQL"})]})}),di.jsx(W.Item,{label:"数据库名称",name:"databaseName",rules:[{required:!0,message:"请选择数据库"}],children:di.jsx(q,{placeholder:"请选择数据库",onChange:e=>{h(e),f(""),v([]),C([])},value:x,children:Object.keys(R).map(e=>di.jsx(sn,{value:e,children:e},e))})}),di.jsx(W.Item,{label:"关联物理表",name:"sourceTableName",rules:[{required:!0,message:"请选择物理表"}],children:di.jsx(q,{placeholder:"请选择物理表",onChange:e=>{f(e);const t=(R[x]||[]).find(t=>t.tableName===e);if(t){v(t.fields);const e=t.fields.map((e,t)=>{var i,s,l;return{fieldId:`dmf_${Date.now()}_${t}`,sourceType:"PHYSICAL",physicalName:e.fieldName,businessName:e.fieldComment||e.fieldName,role:"DESCRIPTIVE",dataType:e.fieldType.includes("VARCHAR")?"字符串":e.fieldType.includes("DECIMAL")?"小数":e.fieldType.includes("INT")?"整数":"字符串",fieldLength:e.fieldType.includes("VARCHAR")?parseInt((null==(i=e.fieldType.match(/\((\d+)\)/))?void 0:i[1])||"50"):void 0,numericPrecision:e.fieldType.includes("DECIMAL")?parseInt((null==(s=e.fieldType.match(/\((\d+),\d+\)/))?void 0:s[1])||"10"):void 0,numericScale:e.fieldType.includes("DECIMAL")?parseInt((null==(l=e.fieldType.match(/\(\d+,(\d+)\)/))?void 0:l[1])||"2"):void 0,isPrimaryKey:!1,isForeignKey:!1,componentType:"文本框"}});C(e)}},value:u,disabled:!x,children:(R[x]||[]).map(e=>di.jsxs(sn,{value:e.tableName,children:[e.tableName," (",e.tableComment,")"]},e.tableName))})}),u&&g.length>0&&di.jsxs("div",{className:"mt-6",children:[di.jsxs("div",{className:"flex justify-between items-center mb-4",children:[di.jsx("h3",{className:"text-lg font-medium",children:"模型字段属性管理"}),di.jsx(E,{type:"primary",onClick:()=>T(!0),children:"添加字段"})]}),di.jsx("div",{className:"border rounded-lg overflow-hidden",children:di.jsx("div",{className:"overflow-x-auto",children:di.jsxs("div",{className:"min-w-[1320px]",children:[di.jsx("div",{className:"bg-gray-50 px-4 py-2 border-b",children:di.jsxs("div",{className:"grid gap-4 items-center",style:{gridTemplateColumns:"120px 150px 100px 140px 80px 80px 90px 80px 80px 120px 80px"},children:[di.jsx("div",{children:di.jsx("strong",{children:"字段编码"})}),di.jsx("div",{children:di.jsx("strong",{children:"字段名"})}),di.jsx("div",{children:di.jsx("strong",{children:"数据类型"})}),di.jsx("div",{children:di.jsx("strong",{children:"日期格式"})}),di.jsx("div",{children:di.jsx("strong",{children:"字段长度"})}),di.jsx("div",{children:di.jsx("strong",{children:"数值精度"})}),di.jsx("div",{children:di.jsx("strong",{children:"数值小数位"})}),di.jsx("div",{children:di.jsx("strong",{children:"是否主键"})}),di.jsx("div",{children:di.jsx("strong",{children:"是否外键"})}),di.jsx("div",{children:di.jsx("strong",{children:"组件类型"})}),di.jsx("div",{children:di.jsx("strong",{children:"操作"})})]})}),di.jsx("div",{className:"max-h-96 overflow-y-auto",children:b.map(e=>di.jsx("div",{className:"px-4 py-3 border-b hover:bg-gray-50",children:di.jsxs("div",{className:"grid gap-4 items-center",style:{gridTemplateColumns:"120px 150px 100px 140px 80px 80px 90px 80px 80px 120px 80px"},children:[di.jsx("div",{children:di.jsx("span",{className:"font-mono text-sm truncate block",children:e.physicalName||e.fieldId})}),di.jsx("div",{children:di.jsx(U,{value:e.businessName,onChange:t=>P(e.fieldId,{businessName:t.target.value}),placeholder:"字段名",size:"small"})}),di.jsx("div",{children:di.jsxs(q,{value:e.dataType||"字符串",onChange:t=>P(e.fieldId,{dataType:t}),size:"small",style:{width:"100%"},children:[di.jsx(sn,{value:"整数",children:"整数"}),di.jsx(sn,{value:"小数",children:"小数"}),di.jsx(sn,{value:"字符串",children:"字符串"}),di.jsx(sn,{value:"日期",children:"日期"}),di.jsx(sn,{value:"时间",children:"时间"}),di.jsx(sn,{value:"布尔",children:"布尔"})]})}),di.jsx("div",{children:di.jsx("span",{className:"text-sm text-gray-600",children:"日期"===e.dataType||"时间"===e.dataType?e.dateFormat||"yyyy-MM-dd":"-"})}),di.jsx("div",{children:di.jsx("span",{className:"text-sm text-gray-600",children:e.fieldLength||"-"})}),di.jsx("div",{children:di.jsx("span",{className:"text-sm text-gray-600",children:"小数"===e.dataType&&e.numericPrecision||"-"})}),di.jsx("div",{children:di.jsx("span",{className:"text-sm text-gray-600",children:"小数"===e.dataType&&e.numericScale||"-"})}),di.jsx("div",{children:di.jsx("span",{className:"text-sm text-gray-600",children:e.isPrimaryKey?"是":"否"})}),di.jsx("div",{children:di.jsx("span",{className:"text-sm text-gray-600",children:e.isForeignKey?"是":"否"})}),di.jsx("div",{children:di.jsxs(q,{value:e.componentType||"文本框",onChange:t=>P(e.fieldId,{componentType:t}),size:"small",style:{width:"100%"},children:[di.jsx(sn,{value:"文本框",children:"文本框"}),di.jsx(sn,{value:"下拉框",children:"下拉框"}),di.jsx(sn,{value:"弹框单选",children:"弹框单选"}),di.jsx(sn,{value:"弹框多选",children:"弹框多选"}),di.jsx(sn,{value:"日期选择器",children:"日期选择器"}),di.jsx(sn,{value:"时间选择器",children:"时间选择器"}),di.jsx(sn,{value:"日期时间选择器",children:"日期时间选择器"}),di.jsx(sn,{value:"数字选择器",children:"数字选择器"}),di.jsx(sn,{value:"文件上传",children:"文件上传"})]})}),di.jsx("div",{children:di.jsx(E,{type:"link",danger:!0,size:"small",onClick:()=>{return t=e.fieldId,void C(e=>e.filter(e=>e.fieldId!==t));var t},children:"删除"})})]})},e.fieldId))})]})})})]})]})]})]}),di.jsx(an,{visible:N,onCancel:()=>{I(!1),A("")},onSelect:e=>{_&&P(_,{relatedMetricId:e,role:"MEASURE_IMPL"}),I(!1),A("")}}),di.jsx(dn,{visible:w,onCancel:()=>{S(!1),A("")},onSelect:e=>{_&&P(_,{relatedDimensionId:e,role:"DIMENSION_FK"}),S(!1),A("")}}),di.jsx(rn,{visible:k,onCancel:()=>T(!1),onAddFields:e=>{C(t=>[...t,...e]),T(!1)},availableFields:g.filter(e=>!b.some(t=>t.physicalName===e.fieldName))})]})},group:"一期"},{title:"分析主题",to:"/analysis-subject",icon:di.jsx(Ve,{className:"h-4 w-4"}),component:()=>{const[e,t]=j.useState([{id:1,subjectName:"销售分析主题",description:"包含销售订单、客户、产品等维度的综合分析",status:1,createName:"张三",createTime:"2024-01-15 10:30:00"},{id:2,subjectName:"库存分析主题",description:"库存周转、库存预警、库存结构分析",status:1,createName:"李四",createTime:"2024-01-16 14:20:00"}]),[i,s]=j.useState(!1),[l,n]=j.useState("add"),[a,d]=j.useState(null),[r,o]=j.useState(!1),[p,x]=j.useState("add"),[h,u]=j.useState(null),f=[{title:"主题名称",dataIndex:"subjectName",key:"subjectName",render:(e,t)=>di.jsxs("div",{children:[di.jsx("div",{style:{fontWeight:500,marginBottom:4},children:e}),di.jsx(fn,{type:"secondary",style:{fontSize:12},children:t.description})]})},{title:"状态",dataIndex:"status",key:"status",render:e=>di.jsx(B,{color:1===e?"green":"default",children:1===e?"启用":"停用"})},{title:"创建信息",key:"createInfo",render:e=>di.jsxs("div",{children:[di.jsxs(fn,{style:{fontSize:12},children:["创建人: ",e.createName]}),di.jsx("br",{}),di.jsxs(fn,{type:"secondary",style:{fontSize:12},children:["创建时间: ",e.createTime]})]})},{title:"操作",key:"actions",render:i=>di.jsxs(J,{children:[di.jsx(se,{title:"新建数据集",children:di.jsx(E,{type:"text",size:"small",icon:di.jsx(Ke,{className:"w-4 h-4"}),onClick:()=>{return e=i,x("add"),u(e),void o(!0);var e}})}),di.jsx(se,{title:"查看详情",children:di.jsx(E,{type:"text",size:"small",icon:di.jsx(Ye,{className:"w-4 h-4"}),onClick:()=>{return e=i,n("view"),d(e),void s(!0);var e}})}),di.jsx(se,{title:"编辑",children:di.jsx(E,{type:"text",size:"small",icon:di.jsx(Ge,{className:"w-4 h-4"}),onClick:()=>{return e=i,n("edit"),d(e),void s(!0);var e}})}),di.jsx(se,{title:"删除",children:di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(Qe,{className:"w-4 h-4"}),onClick:()=>{return s=i.id,void(window.confirm("确定要删除这个分析主题吗？")&&t(e.filter(e=>e.id!==s)));var s}})})]})}];return di.jsxs("div",{style:{padding:24},children:[di.jsxs("div",{style:{marginBottom:24,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[di.jsxs("div",{children:[di.jsx(un,{level:2,style:{margin:0},children:"分析主题管理"}),di.jsx(fn,{type:"secondary",children:"管理和组织您的数据分析主题"})]}),di.jsx(E,{type:"primary",icon:di.jsx(Ue,{className:"w-4 h-4"}),onClick:()=>{n("add"),d(null),s(!0)},children:"新建主题"})]}),di.jsxs(D,{children:[di.jsx("div",{style:{marginBottom:16},children:di.jsx(U,{placeholder:"搜索主题名称或描述...",prefix:di.jsx(We,{className:"w-4 h-4"}),style:{width:300}})}),di.jsx(Y,{columns:f,dataSource:e,rowKey:"id",pagination:!1})]}),di.jsx(mn,{open:i,mode:l,subject:a,onClose:()=>s(!1),onSave:i=>{if("add"===l){const s=m(c({},i),{id:Math.max(...e.map(e=>e.id))+1,createName:"当前用户",createTime:(new Date).toLocaleString("zh-CN")});t([...e,s])}else t(e.map(e=>e.id===(null==a?void 0:a.id)?m(c(c({},e),i),{updateTime:(new Date).toLocaleString("zh-CN")}):e))}}),di.jsx(hn,{open:r,mode:p,dataset:null,onClose:()=>o(!1),onSave:e=>{o(!1)},preSelectedSubject:h})]})},group:"一期"},{title:"数据集管理",to:"/analysis-subject-v2",icon:di.jsx(Ve,{className:"h-4 w-4"}),component:()=>{var e;const[t,i]=j.useState(jn),[s,l]=j.useState(""),[n,a]=j.useState("subject"),[d,r]=j.useState(""),[o,p]=j.useState(""),[x,h]=j.useState([]),[u,f]=j.useState(!1),[g,y]=j.useState(!1),[v,b]=j.useState(!1),[C,N]=j.useState(!1),[I,w]=j.useState(!1),[S,k]=j.useState(null),[T,_]=j.useState(null),[A,R]=j.useState(!1),[z]=W.useForm(),[M]=W.useForm(),[O]=W.useForm(),L=j.useMemo(()=>t.find(e=>e.id===s),[t,s]),P=j.useMemo(()=>{if("dataset"!==n)return null;for(const e of t){const t=e.datasets.find(e=>e.id===s);if(t)return t}return null},[t,s,n]),F=j.useMemo(()=>L?L.datasets.filter(e=>e.name.toLowerCase().includes(d.toLowerCase())):[],[L,d]),$=(e,t)=>{l(e),a(t),r(""),R(!1)},V=j.useCallback((e,t)=>{const{node:i}=t;if(i.isLeaf){const e=i.datasetData;e&&$(e.id,"dataset")}else $(i.key,"subject"),h(e=>[...e.filter(e=>e!==i.key),i.key])},[t]),H=e=>{_(e),M.setFieldsValue({name:e.name,description:e.description}),b(!0)};return di.jsxs("div",{className:"h-screen flex flex-col bg-gray-100",children:[di.jsx("div",{className:"bg-white shadow-sm p-4 border-b",children:di.jsxs("div",{children:[di.jsx("h2",{className:"text-xl font-semibold mb-0",children:"数据集管理"}),di.jsx("p",{className:"text-sm text-gray-600",children:"管理分析主题和数据集，构建完整的数据分析体系"})]})}),di.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[di.jsxs("div",{className:"w-80 bg-white border-r overflow-hidden flex flex-col",children:[di.jsx("div",{className:"p-4 border-b",children:di.jsx(gn,{placeholder:"搜索分析主题或数据集...",value:o,onChange:e=>p(e.target.value),prefix:di.jsx(le,{}),allowClear:!0})}),di.jsx("div",{className:"border-b",children:di.jsxs("div",{className:"px-4 py-3 flex justify-between items-center",children:[di.jsx("span",{className:"font-medium text-gray-700",children:"分析主题"}),di.jsx(E,{type:"primary",size:"small",icon:di.jsx(K,{}),onClick:()=>y(!0),children:"新建主题"})]})}),di.jsxs("div",{className:"flex-1 overflow-auto p-4",children:[di.jsx("style",{jsx:!0,children:"\n            .custom-tree .ant-tree-node-content-wrapper {\n              display: flex;\n              align-items: center;\n              min-height: 32px;\n            }\n            .custom-tree .ant-tree-title {\n              flex: 1;\n              display: flex;\n              align-items: center;\n            }\n            .custom-tree .ant-tree-switcher {\n              display: flex;\n              align-items: center;\n            }\n            .custom-tree .ant-tree-node-content-wrapper:hover {\n              background-color: transparent;\n            }\n            .custom-tree .ant-tree-node-content-wrapper.ant-tree-node-selected {\n              background-color: transparent;\n            }\n          "}),di.jsx(ne,{showIcon:!0,treeData:(o?t.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.datasets.some(e=>e.name.toLowerCase().includes(o.toLowerCase()))):t).map(e=>{const t=o?e.datasets.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())):e.datasets;return{title:di.jsxs("div",{className:"flex justify-between items-center pr-2 group rounded px-2 py-1 "+(s===e.id&&"subject"===n?"bg-blue-50":"hover:bg-gray-50"),children:[di.jsx("span",{className:"flex-1 truncate",children:e.name}),di.jsx(oe,{menu:{items:[{key:"edit",label:"编辑主题",icon:di.jsx(X,{}),onClick:()=>H(e)}]},trigger:["click"],placement:"bottomRight",children:di.jsx(E,{type:"text",size:"small",icon:di.jsx(xl,{}),className:"opacity-60 group-hover:opacity-100 ml-2 transition-opacity "+(s===e.id&&"subject"===n?"text-blue-600":""),onClick:e=>e.stopPropagation()})})]}),key:e.id,icon:di.jsx(re,{className:s===e.id&&"subject"===n?"text-blue-600":""}),children:t.map(e=>({title:e.name,key:e.id,icon:di.jsx(de,{}),isLeaf:!0,datasetData:e}))}}),onSelect:V,expandedKeys:x,onExpand:h,blockNode:!0,className:"custom-tree"})]})]}),di.jsx("div",{className:"flex-1 overflow-auto",children:di.jsxs("div",{className:"p-6 h-full bg-white",children:[(()=>{const e=[{title:"首页"},{title:"分析主题"}];if("subject"===n&&L)e.push({title:L.name});else if("dataset"===n&&P){const i=t.find(e=>e.id===P.subjectId);i&&(e.push({title:i.name}),e.push({title:P.name}))}return di.jsx(ae,{className:"mb-6",items:e,style:{fontSize:"12px",lineHeight:"20px",color:"#666666"}})})(),"subject"===n&&L&&di.jsxs("div",{children:[di.jsxs("div",{className:"flex justify-between items-center mb-6",children:[di.jsx("h3",{className:"text-lg font-semibold text-[#333333]",children:"数据集列表"}),di.jsxs("div",{className:"flex items-center gap-3",children:[di.jsx(gn,{placeholder:"搜索数据集名称",style:{width:240},value:d,onChange:e=>r(e.target.value),allowClear:!0}),di.jsx(E,{type:"primary",icon:di.jsx(Ue,{className:"w-4 h-4"}),onClick:()=>f(!0),children:"新增数据集"})]})]}),F.length>0?di.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:F.map(e=>di.jsx(D,{hoverable:!0,className:"cursor-pointer transition-all hover:shadow-lg hover:border-blue-200 border-2",onClick:()=>$(e.id,"dataset"),bodyStyle:{padding:"20px"},children:di.jsxs("div",{className:"flex flex-col h-full",children:[di.jsx("div",{className:"mb-4",children:di.jsx("div",{className:"font-semibold text-gray-900 text-sm truncate",children:e.name})}),di.jsx("div",{className:"flex-1 mb-4",children:di.jsx("div",{className:"text-xs text-gray-600 leading-relaxed line-clamp-3",children:e.description||"暂无描述"})}),di.jsxs("div",{className:"space-y-2 mb-4",children:[di.jsxs("div",{className:"text-xs text-gray-500",children:["数据连接：",e.dataSource]}),di.jsxs("div",{className:"text-xs text-gray-500",children:["关联模型数：",e.relatedModelsCount]}),di.jsx("div",{className:"flex items-center",children:di.jsx("span",{className:"text-xs px-2 py-1 rounded-full "+(e.enabled?"bg-green-100 text-green-600":"bg-red-100 text-red-600"),children:e.enabled?"启用":"禁用"})})]}),di.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[di.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[di.jsx("span",{children:e.lastUpdatedBy}),di.jsx("span",{className:"mx-2",children:"·"}),di.jsx("span",{children:e.lastUpdatedTime})]}),di.jsxs("div",{className:"flex space-x-1",children:[di.jsx(E,{type:"text",size:"small",icon:di.jsx(Ye,{className:"w-3 h-3"}),className:"text-gray-400 hover:text-blue-500 p-1",onClick:t=>{t.stopPropagation(),$(e.id,"dataset")},title:"查看详情"}),di.jsx(E,{type:"text",size:"small",icon:di.jsx(Je,{className:"w-3 h-3"}),className:"text-gray-400 hover:text-red-500 p-1",onClick:t=>{t.stopPropagation(),e.id,N(!0)},title:"删除"})]})]})]})},e.id))}):di.jsxs(D,{className:"text-center py-12",children:[di.jsx(Xe,{className:"w-16 h-16 text-[#D9D9D9] mx-auto mb-4"}),di.jsx("h4",{className:"text-lg font-medium text-[#999999] mb-2",children:"暂无数据集"}),di.jsx("p",{className:"text-sm text-[#999999] mb-6",children:d?"没有找到匹配的数据集":"当前主题下暂无数据集，点击右上角按钮创建"}),!d&&di.jsx(E,{type:"primary",icon:di.jsx(Ue,{className:"w-4 h-4"}),onClick:()=>f(!0),children:"创建数据集"})]})]}),"dataset"===n&&P&&di.jsxs("div",{children:[di.jsxs("div",{className:"flex justify-between items-center mb-6",children:[di.jsxs("div",{children:[di.jsx("h2",{className:"text-xl font-semibold text-[#333333]",children:P.name}),di.jsx("p",{className:"text-sm text-[#666666] mt-1",children:P.description||"暂无描述"})]}),di.jsx(E,{type:A?"default":"primary",icon:di.jsx(Ge,{className:"w-4 h-4"}),onClick:()=>R(!A),children:A?"保存":"编辑"})]}),di.jsxs("div",{className:"space-y-6",children:[di.jsx(D,{title:"基础信息",className:"shadow-sm",children:di.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[di.jsxs("div",{children:[di.jsx("label",{className:"block text-sm font-medium text-[#666666] mb-2",children:"所属主题"}),di.jsxs("div",{className:"flex items-center",children:[di.jsx(Ze,{className:"w-4 h-4 text-[#1890FF] mr-2"}),di.jsx("span",{className:"text-sm text-[#333333]",children:null==(e=t.find(e=>e.id===P.subjectId))?void 0:e.name})]})]}),di.jsxs("div",{children:[di.jsx("label",{className:"block text-sm font-medium text-[#666666] mb-2",children:"数据来源"}),di.jsxs("div",{className:"flex items-center",children:[di.jsx(Ke,{className:"w-4 h-4 text-[#52C41A] mr-2"}),di.jsx("span",{className:"text-sm text-[#333333]",children:P.dataSource})]})]}),di.jsxs("div",{children:[di.jsx("label",{className:"block text-sm font-medium text-[#666666] mb-2",children:"数据规模"}),di.jsx("span",{className:"text-sm text-[#333333]",children:(q=P.rowCount,Q=P.fieldCount,`${J=q,J>=1e4?`${(J/1e4).toFixed(1)}万`:J.toString()}行 / ${Q}字段`)})]}),di.jsxs("div",{children:[di.jsx("label",{className:"block text-sm font-medium text-[#666666] mb-2",children:"最后更新"}),di.jsxs("div",{children:[di.jsx("div",{className:"text-sm text-[#333333]",children:P.lastUpdatedTime}),di.jsx("div",{className:"text-xs text-[#999999]",children:P.lastUpdatedBy})]})]})]})}),di.jsx(D,{title:di.jsxs("div",{className:"flex items-center justify-between",children:[di.jsx("span",{children:"字段结构"}),di.jsxs("div",{className:"text-xs text-[#999999] space-y-1",children:[di.jsxs("div",{className:"flex items-center",children:[di.jsx(B,{color:"blue",children:"维度"}),di.jsx("span",{className:"ml-2",children:"用于分组 / 筛选"})]}),di.jsxs("div",{className:"flex items-center",children:[di.jsx(B,{color:"green",children:"度量"}),di.jsx("span",{className:"ml-2",children:"用于计算 / 统计"})]})]})]}),className:"shadow-sm",children:di.jsx(Y,{dataSource:P.fields,rowKey:"id",pagination:!1,size:"small",className:"custom-table",columns:[{title:"字段名称",dataIndex:"name",width:"25%",render:e=>di.jsx("span",{className:"font-medium text-[#333333]",children:e})},{title:"数据类型",dataIndex:"type",width:"20%",render:e=>di.jsx(B,{color:"default",className:"font-mono text-xs",children:e})},{title:"字段角色",dataIndex:"role",width:"15%",render:e=>di.jsx(B,{color:"dimension"===e?"blue":"green",children:"dimension"===e?"维度":"度量"})},{title:"字段描述",dataIndex:"description",width:"30%",render:e=>di.jsx("span",{className:"text-sm text-[#666666]",children:e||di.jsx("span",{className:"text-[#D9D9D9]",children:"暂无描述"})})},{title:"操作",width:"10%",render:(e,t)=>di.jsx(E,{type:"link",size:"small",onClick:()=>{return k(e=t),O.setFieldsValue({description:e.description||""}),void w(!0);var e},className:"p-0",children:"编辑备注"})}]})})]})]}),!s&&di.jsxs("div",{className:"flex flex-col items-center justify-center h-96",children:[di.jsx(et,{className:"w-16 h-16 text-[#D9D9D9] mb-4"}),di.jsx("h3",{className:"text-lg font-medium text-[#999999] mb-2",children:"欢迎使用分析主题管理"}),di.jsx("p",{className:"text-sm text-[#999999] text-center max-w-md",children:"请从左侧菜单选择分析主题或数据集来查看详细信息。您可以管理数据集、配置字段结构，构建完整的数据分析体系。"})]})]})})]}),di.jsx(G,{title:"新建数据集",open:u,onOk:()=>{z.validateFields().then(e=>{te.success("数据集创建成功"),f(!1),z.resetFields()})},onCancel:()=>{f(!1),z.resetFields()},width:500,maskClosable:!1,children:di.jsxs(W,{form:z,layout:"vertical",children:[di.jsx(W.Item,{name:"name",label:"数据集名称",rules:[{required:!0,message:"请输入数据集名称"},{max:50,message:"数据集名称不能超过50个字符"}],children:di.jsx(U,{placeholder:"请输入数据集名称"})}),di.jsx(W.Item,{name:"description",label:"数据集描述",children:di.jsx(U.TextArea,{placeholder:"请输入数据集描述（可选）",rows:3,maxLength:200,showCount:!0})})]})}),di.jsx(G,{title:"新建分析主题",open:g,onOk:()=>{M.validateFields().then(e=>{const s={id:Date.now().toString(),name:e.name,description:e.description,datasets:[]};i([...t,s]),te.success("分析主题创建成功"),y(!1),M.resetFields()})},onCancel:()=>{y(!1),M.resetFields()},width:500,maskClosable:!1,children:di.jsxs(W,{form:M,layout:"vertical",children:[di.jsx(W.Item,{name:"name",label:"主题名称",rules:[{required:!0,message:"请输入主题名称"},{max:50,message:"主题名称不能超过50个字符"}],children:di.jsx(U,{placeholder:"请输入主题名称"})}),di.jsx(W.Item,{name:"description",label:"主题描述",children:di.jsx(U.TextArea,{placeholder:"请输入主题描述（可选）",rows:3,maxLength:200,showCount:!0})})]})}),di.jsx(G,{title:"编辑分析主题",open:v,onOk:()=>{M.validateFields().then(e=>{if(T){const s=t.map(t=>t.id===T.id?m(c({},t),{name:e.name,description:e.description}):t);i(s),te.success("分析主题更新成功"),b(!1),M.resetFields(),_(null)}})},onCancel:()=>{b(!1),M.resetFields(),_(null)},width:500,maskClosable:!1,children:di.jsxs(W,{form:M,layout:"vertical",children:[di.jsx(W.Item,{name:"name",label:"主题名称",rules:[{required:!0,message:"请输入主题名称"},{max:50,message:"主题名称不能超过50个字符"}],children:di.jsx(U,{placeholder:"请输入主题名称"})}),di.jsx(W.Item,{name:"description",label:"主题描述",children:di.jsx(U.TextArea,{placeholder:"请输入主题描述（可选）",rows:3,maxLength:200,showCount:!0})})]})}),di.jsx(G,{title:"确认删除",open:C,onOk:()=>{te.success("数据集删除成功"),N(!1)},onCancel:()=>N(!1),okText:"确认删除",cancelText:"取消",okButtonProps:{danger:!0},children:di.jsxs("div",{className:"flex items-start",children:[di.jsx(et,{className:"w-5 h-5 text-[#FF4D4F] mr-3 mt-0.5 flex-shrink-0"}),di.jsxs("div",{children:[di.jsx("p",{className:"text-[#333333] mb-2",children:"确定要删除这个数据集吗？"}),di.jsx("p",{className:"text-sm text-[#999999]",children:"删除后将无法恢复，请谨慎操作。"})]})]})}),di.jsx(G,{title:`编辑字段备注 - ${null==S?void 0:S.name}`,open:I,onOk:()=>{O.validateFields().then(e=>{te.success("字段备注更新成功"),w(!1),O.resetFields(),k(null)})},onCancel:()=>{w(!1),O.resetFields(),k(null)},width:500,children:di.jsx(W,{form:O,layout:"vertical",children:di.jsx(W.Item,{name:"description",label:"字段描述",children:di.jsx(U.TextArea,{placeholder:"请输入字段描述信息",rows:4,maxLength:200,showCount:!0})})})})]});var q,Q,J},group:"二期"},{title:"数据集管理",to:"/dataset-management",icon:di.jsx(Ke,{className:"h-4 w-4"}),component:()=>{const[t,i]=j.useState([]),[s,l]=j.useState(!1),[n,a]=j.useState(null),[d]=W.useForm(),[r,o]=j.useState(!1),[p,x]=j.useState("card"),[h,u]=j.useState([]),[f,g]=j.useState(""),[v,b]=j.useState([]),[C,N]=j.useState([]),[I,w]=j.useState([]),[S,k]=j.useState([]),[T,_]=j.useState([]),[A,R]=j.useState(""),[z,M]=j.useState(0),[O,F]=j.useState(!1),$=[{id:"dm_001",dataModelCode:"DM_AGREEMENT",dataModelName:"采购协议模型",dataModelDesc:"采购协议模型，包含协议编号、产品编码、供应商编码、净价、税率、协议价(含税)、协议品牌号",dataSourceType:"DORIS",databaseName:"yyigou_dsrp",sourceTableName:"dwd_purchase_agreements",fields:[{fieldId:"dmf_001",sourceType:"PHYSICAL",physicalName:"product_code",businessName:"产品编码",role:"DIMENSION_FK",mappingTargetId:"DIM_PRODUCT"},{fieldId:"dmf_002",sourceType:"PHYSICAL",physicalName:"supplier_code",businessName:"供应商编码",role:"DIMENSION_FK",mappingTargetId:"DIM_SUPPLIER"},{fieldId:"dmf_003",sourceType:"CALCULATED",expression:"net_price * (1 + tax_rate)",businessName:"协议价(含税)",role:"MEASURE_IMPL",mappingTargetId:"P001"}],status:"ACTIVE",createdBy:"张三",createdAt:"2025-01-20",updatedAt:"2025-01-20"},{id:"dm_002",dataModelCode:"DM_ORDER_HIST",dataModelName:"采购订单历史模型",dataModelDesc:"采购订单历史数据模型，用于分析历史订单价格趋势",dataSourceType:"DORIS",databaseName:"yyigou_dsrp",sourceTableName:"dwd_purchase_orders",fields:[{fieldId:"dmf_101",sourceType:"PHYSICAL",physicalName:"product_code",businessName:"产品编码",role:"DIMENSION_FK",mappingTargetId:"DIM_PRODUCT"},{fieldId:"dmf_102",sourceType:"PHYSICAL",physicalName:"order_price",businessName:"订单价格",role:"MEASURE_IMPL",mappingTargetId:"P001"}],status:"ACTIVE",createdBy:"李四",createdAt:"2025-01-18",updatedAt:"2025-01-19"}],V=[{id:"ds_001",datasetCode:"DS_PURCHASE_FULL_LINK",datasetName:"采购全链路融合分析数据集",analysisTheme:"采购分析",sourceConfig:{type:"DATA_MODEL",primaryDataModelId:"dm_001",relations:[{relatedDataModelId:"dm_002",joinType:"LEFT_JOIN",joinCondition:"主模型.产品编码 = 关联模型.产品编码"}]},fieldSelections:{selections:[{sourceFieldId:"dmf_003",alias:"协议-协议价",selected:!0},{sourceFieldId:"dmf_102",alias:"订单-协议价",selected:!0},{sourceFieldId:"dmf_002",alias:"供应商名称",selected:!0}],conflictResolutions:[{conceptId:"P001",dominantAlias:"协议-协议价"}]},status:"ACTIVE",createdBy:"张三",createdAt:"2025-01-20",updatedAt:"2025-01-20"},{id:"ds_002",datasetCode:"DS_SUPPLIER_ANALYSIS",datasetName:"供应商综合分析",analysisTheme:"供应商分析",sourceConfig:{type:"RAW_SQL",customSql:"SELECT * FROM supplier_analysis_view"},fieldSelections:{selections:[],conflictResolutions:[]},status:"ACTIVE",createdBy:"李四",createdAt:"2025-01-19",updatedAt:"2025-01-19"}];j.useEffect(()=>{i(V),u($.filter(e=>"ACTIVE"===e.status))},[]);const H=[{title:"数据集编码",dataIndex:"datasetCode",key:"datasetCode",width:180,render:e=>di.jsx("span",{className:"font-mono text-sm",children:e})},{title:"数据集名称",dataIndex:"datasetName",key:"datasetName",width:200,render:(e,t)=>di.jsx(E,{type:"link",className:"p-0 h-auto font-medium text-left",onClick:()=>le(t),children:e})},{title:"分析主题",dataIndex:"analysisTheme",key:"analysisTheme",width:120,render:e=>e||"-"},{title:"数据源类型",dataIndex:["sourceConfig","type"],key:"buildType",width:120,render:e=>{const t={DATA_MODEL:{text:"数据模型",color:"blue"},EXCEL:{text:"Excel",color:"green"},RAW_SQL:{text:"原始SQL",color:"orange"},API:{text:"API接口",color:"purple"}}[e]||{text:e,color:"default"};return di.jsx(B,{color:t.color,children:t.text})}},{title:"主数据模型",dataIndex:["sourceConfig","primaryDataModelId"],key:"primaryModel",width:160,render:e=>{const t=h.find(t=>t.id===e);return t?t.dataModelName:"-"}},{title:"关联模型数",dataIndex:["sourceConfig","relations"],key:"relationCount",width:110,align:"center",render:e=>(null==e?void 0:e.length)||0},{title:"状态",dataIndex:"status",key:"status",width:80,align:"center",render:e=>di.jsx(B,{color:"ACTIVE"===e?"green":"red",children:"ACTIVE"===e?"启用":"禁用"})},{title:"创建人",dataIndex:"createdBy",key:"createdBy",width:100,align:"center"},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt",width:120,align:"center"},{title:"操作",key:"action",width:180,render:(e,t)=>di.jsxs(J,{size:"small",children:[di.jsx(E,{type:"link",icon:di.jsx(X,{}),onClick:()=>se(t),size:"small",children:"编辑"}),di.jsx(E,{type:"link",onClick:()=>ne(t),size:"small",children:"ACTIVE"===t.status?"禁用":"启用"}),di.jsx(Z,{title:"确定要删除这个数据集吗？",onConfirm:()=>ae(t.id),okText:"确定",cancelText:"取消",children:di.jsx(E,{type:"link",danger:!0,icon:di.jsx(ee,{}),size:"small",children:"删除"})})]})}],se=e=>{var t,i,s,n;a(e),d.setFieldsValue({datasetCode:e.datasetCode,datasetName:e.datasetName,analysisTheme:e.analysisTheme,buildType:e.sourceConfig.type,primaryDataModelId:e.sourceConfig.primaryDataModelId,customSql:e.sourceConfig.customSql,apiEndpoint:null==(t=e.sourceConfig.apiConfig)?void 0:t.endpoint,apiMethod:null==(i=e.sourceConfig.apiConfig)?void 0:i.method,excelFileName:null==(s=e.sourceConfig.excelConfig)?void 0:s.fileName,excelSheetName:null==(n=e.sourceConfig.excelConfig)?void 0:n.sheetName}),R(e.sourceConfig.type),g(e.sourceConfig.primaryDataModelId||""),b(e.sourceConfig.relations||[]),w(e.fieldSelections.selections),_(e.fieldSelections.conflictResolutions),l(!0)},le=e=>{te.info(`查看数据集: ${e.datasetName}`)},ne=e=>{const t="ACTIVE"===e.status?"INACTIVE":"ACTIVE";i(i=>i.map(i=>i.id===e.id?m(c({},i),{status:t}):i)),te.success(`${e.datasetName} 已${"ACTIVE"===t?"启用":"禁用"}`)},ae=e=>{i(t=>t.filter(t=>t.id!==e)),te.success("数据集删除成功")},de=()=>{const e={relatedDataModelId:"",joinType:"LEFT_JOIN",joinCondition:""};b(t=>[...t,e])},re=(e,t)=>{b(i=>i.map((i,s)=>s===e?c(c({},i),t):i))},oe=()=>y(e,null,function*(){try{const t=yield d.validateFields();o(!0);let s={type:t.buildType};switch(t.buildType){case"DATA_MODEL":s=m(c({},s),{primaryDataModelId:f,relations:v});break;case"EXCEL":s=m(c({},s),{excelConfig:{fileName:t.excelFileName,sheetName:t.excelSheetName}});break;case"RAW_SQL":s=m(c({},s),{customSql:t.customSql});break;case"API":let i={};if(t.apiHeaders)try{i=JSON.parse(t.apiHeaders)}catch(e){return void te.error("请求头格式不正确，请输入有效的JSON格式")}s=m(c({},s),{apiConfig:{endpoint:t.apiEndpoint,method:t.apiMethod,headers:i}})}const a={id:(null==n?void 0:n.id)||`ds_${Date.now()}`,datasetCode:t.datasetCode,datasetName:t.datasetName,analysisTheme:t.analysisTheme,sourceConfig:s,fieldSelections:{selections:I,conflictResolutions:T},status:"ACTIVE",createdBy:(null==n?void 0:n.createdBy)||"当前用户",createdAt:(null==n?void 0:n.createdAt)||(new Date).toISOString().split("T")[0],updatedAt:(new Date).toISOString().split("T")[0]};n?(i(e=>e.map(e=>e.id===n.id?a:e)),te.success("数据集更新成功")):(i(e=>[...e,a]),te.success("数据集创建成功")),l(!1)}catch(t){}finally{o(!1)}}),ce=()=>{l(!1),M(0),d.resetFields(),R(""),g(""),b([]),N([]),w([]),k([]),_([])},me=[{title:"基本信息",content:"basic-info"},{title:"关联模型",content:"data-source"},{title:"字段选择",content:"field-selection"}],pe=()=>di.jsxs("div",{children:[di.jsx(W.Item,{label:"数据集编码",name:"datasetCode",rules:[{required:!0,message:"请输入数据集编码"}],children:di.jsx(U,{placeholder:"如: DS_PURCHASE_FULL_LINK"})}),di.jsx(W.Item,{label:"数据集名称",name:"datasetName",rules:[{required:!0,message:"请输入数据集名称"}],children:di.jsx(U,{placeholder:"如: 采购全链路融合分析"})}),di.jsx(W.Item,{label:"分析主题",name:"analysisTheme",rules:[{required:!0,message:"请选择分析主题"}],children:di.jsxs(q,{placeholder:"请选择分析主题",children:[di.jsx(vn,{value:"采购分析",children:"采购分析"}),di.jsx(vn,{value:"供应商分析",children:"供应商分析"}),di.jsx(vn,{value:"销售分析",children:"销售分析"}),di.jsx(vn,{value:"财务分析",children:"财务分析"}),di.jsx(vn,{value:"库存分析",children:"库存分析"}),di.jsx(vn,{value:"客户分析",children:"客户分析"}),di.jsx(vn,{value:"运营分析",children:"运营分析"}),di.jsx(vn,{value:"风险分析",children:"风险分析"})]})}),di.jsx(W.Item,{label:"数据集描述",name:"datasetDesc",rules:[{required:!0,message:"请输入数据集描述"}],children:di.jsx(U.TextArea,{placeholder:"包含超音数访问统计相关的指标和维度等",rows:4})})]}),xe=()=>di.jsxs("div",{children:[di.jsx(W.Item,{label:"数据源类型",name:"buildType",rules:[{required:!0,message:"请选择数据源类型"}],children:di.jsxs(q,{placeholder:"请选择数据源类型",onChange:e=>R(e),children:[di.jsx(vn,{value:"DATA_MODEL",children:"数据模型"}),di.jsx(vn,{value:"EXCEL",children:"Excel"}),di.jsx(vn,{value:"RAW_SQL",children:"原始SQL"}),di.jsx(vn,{value:"API",children:"API接口"})]})}),"EXCEL"===A&&di.jsxs("div",{className:"mb-4",children:[di.jsx("h4",{className:"text-md font-medium mb-2",children:"Excel文件配置"}),di.jsx(W.Item,{label:"上传Excel文件",name:"excelFile",rules:[{required:!0,message:"请上传Excel文件"}],children:di.jsx(ie,{accept:".xlsx,.xls",maxCount:1,beforeUpload:()=>!1,onChange:e=>{e.file&&d.setFieldsValue({excelFileName:e.file.name})},children:di.jsx(E,{children:"选择Excel文件"})})}),di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:12,children:di.jsx(W.Item,{label:"文件名",name:"excelFileName",children:di.jsx(U,{placeholder:"文件名将自动填充",disabled:!0})})}),di.jsx(P,{span:12,children:di.jsx(W.Item,{label:"工作表名称",name:"excelSheetName",rules:[{required:!0,message:"请输入工作表名称"}],children:di.jsx(U,{placeholder:"如: Sheet1"})})})]})]}),"RAW_SQL"===A&&di.jsxs("div",{className:"mb-4",children:[di.jsx("h4",{className:"text-md font-medium mb-2",children:"SQL配置"}),di.jsx(W.Item,{label:"自定义SQL",name:"customSql",rules:[{required:!0,message:"请输入SQL语句"}],children:di.jsx(U.TextArea,{rows:6,placeholder:"请输入SQL查询语句，如：SELECT * FROM table_name WHERE condition"})})]}),"API"===A&&di.jsxs("div",{className:"mb-4",children:[di.jsx("h4",{className:"text-md font-medium mb-2",children:"API接口配置"}),di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:16,children:di.jsx(W.Item,{label:"API地址",name:"apiEndpoint",rules:[{required:!0,message:"请输入API地址"}],children:di.jsx(U,{placeholder:"如: https://api.example.com/data"})})}),di.jsx(P,{span:8,children:di.jsx(W.Item,{label:"请求方法",name:"apiMethod",rules:[{required:!0,message:"请选择请求方法"}],children:di.jsxs(q,{placeholder:"请求方法",children:[di.jsx(vn,{value:"GET",children:"GET"}),di.jsx(vn,{value:"POST",children:"POST"}),di.jsx(vn,{value:"PUT",children:"PUT"}),di.jsx(vn,{value:"DELETE",children:"DELETE"})]})})})]}),di.jsx(W.Item,{label:"请求头",name:"apiHeaders",children:di.jsx(U.TextArea,{rows:3,placeholder:'请输入JSON格式的请求头，如：{"Content-Type": "application/json", "Authorization": "Bearer token"}'})})]}),"DATA_MODEL"===A&&di.jsxs("div",{children:[di.jsx("h4",{className:"text-md font-medium mb-4",children:"数据模型组合与关联"}),di.jsx(W.Item,{label:"主数据模型",name:"primaryDataModelId",rules:[{required:"DATA_MODEL"===A,message:"请选择主数据模型"}],children:di.jsx(q,{placeholder:"选择主数据模型",value:f,onChange:g,children:h.map(e=>di.jsx(vn,{value:e.id,children:e.dataModelName},e.id))})}),di.jsxs("div",{className:"mb-4",children:[di.jsxs("div",{className:"flex justify-between items-center mb-2",children:[di.jsx("span",{className:"font-medium",children:"关联数据模型"}),di.jsx(E,{type:"dashed",onClick:de,children:"+ 添加关联数据模型"})]}),v.map((e,t)=>di.jsx(D,{size:"small",className:"mb-2",children:di.jsxs(L,{gutter:16,align:"middle",children:[di.jsx(P,{span:6,children:di.jsx(q,{placeholder:"选择关联模型",value:e.relatedDataModelId,onChange:e=>re(t,{relatedDataModelId:e}),style:{width:"100%"},children:h.filter(e=>e.id!==f).map(e=>di.jsx(vn,{value:e.id,children:e.dataModelName},e.id))})}),di.jsx(P,{span:4,children:di.jsxs(q,{value:e.joinType,onChange:e=>re(t,{joinType:e}),style:{width:"100%"},children:[di.jsx(vn,{value:"LEFT_JOIN",children:"LEFT JOIN"}),di.jsx(vn,{value:"RIGHT_JOIN",children:"RIGHT JOIN"}),di.jsx(vn,{value:"INNER_JOIN",children:"INNER JOIN"}),di.jsx(vn,{value:"FULL_JOIN",children:"FULL JOIN"})]})}),di.jsx(P,{span:12,children:di.jsx(U,{placeholder:"关联条件，如: 主模型.产品编码 = 关联模型.产品编码",value:e.joinCondition,onChange:e=>re(t,{joinCondition:e.target.value})})}),di.jsx(P,{span:2,children:di.jsx(E,{type:"link",danger:!0,onClick:()=>(e=>{b(t=>t.filter((t,i)=>i!==e))})(t),children:"删除"})})]})},t))]})]})]}),he=()=>di.jsxs("div",{children:[di.jsxs("div",{className:"mb-4 flex justify-between items-center",children:[di.jsx("h4",{className:"text-md font-medium",children:"字段选择与配置"}),di.jsx(E,{type:"primary",icon:di.jsx(K,{}),onClick:()=>F(!0),children:"添加字段"})]}),C.length>0&&di.jsx("div",{className:"mb-6",children:di.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[di.jsx("div",{className:"bg-gray-50 px-4 py-2 border-b",children:di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:4,children:di.jsx("strong",{children:"字段编码"})}),di.jsx(P,{span:4,children:di.jsx("strong",{children:"字段名"})}),di.jsx(P,{span:4,children:di.jsx("strong",{children:"所属模型"})}),di.jsx(P,{span:4,children:di.jsx("strong",{children:"显示名称"})}),di.jsx(P,{span:4,children:di.jsx("strong",{children:"字段类型"})}),di.jsx(P,{span:4,children:di.jsx("strong",{children:"操作"})})]})}),di.jsx("div",{className:"max-h-96 overflow-y-auto",children:C.map(e=>{const t=I.find(t=>t.sourceFieldId===e.fieldId);return di.jsx("div",{className:"px-4 py-3 border-b hover:bg-gray-50",children:di.jsxs(L,{gutter:16,align:"middle",children:[di.jsx(P,{span:4,children:di.jsx("span",{className:"text-sm",children:e.fieldId})}),di.jsx(P,{span:4,children:di.jsx("span",{className:"text-sm font-medium",children:e.businessName})}),di.jsx(P,{span:4,children:di.jsx("span",{className:"text-sm",children:e.sourceModel})}),di.jsx(P,{span:4,children:di.jsx(U,{size:"small",value:(null==t?void 0:t.alias)||e.businessName,onChange:t=>{return i=e.fieldId,s=t.target.value,void w(e=>e.map(e=>e.sourceFieldId===i?m(c({},e),{alias:s}):e));var i,s}})}),di.jsx(P,{span:4,children:di.jsx("span",{className:"text-sm text-gray-600",children:e.identity})}),di.jsx(P,{span:4,children:di.jsx(E,{type:"link",danger:!0,size:"small",onClick:()=>{return t=e.fieldId,N(e=>e.filter(e=>e.fieldId!==t)),w(e=>e.filter(e=>e.sourceFieldId!==t)),void te.success("字段已删除");var t},children:"删除"})})]})},e.fieldId)})})]})})]}),ue=()=>{if(z<me.length-1){if(1===z){if(!f)return void te.warning("请先选择主数据模型");(()=>{const e=h.find(e=>e.id===f);if(!e)return;let t=[];e.fields.forEach(i=>{"UNUSED"!==i.role&&t.push(m(c({},i),{sourceModel:e.dataModelName,sourceModelId:e.id,identity:"DIMENSION_FK"===i.role?`维度: ${i.mappingTargetId}`:"MEASURE_IMPL"===i.role?`指标: ${i.mappingTargetId}`:"描述性属性"}))}),v.forEach(e=>{const i=h.find(t=>t.id===e.relatedDataModelId);i&&i.fields.forEach(e=>{"UNUSED"!==e.role&&t.push(m(c({},e),{sourceModel:i.dataModelName,sourceModelId:i.id,identity:"DIMENSION_FK"===e.role?`维度: ${e.mappingTargetId}`:"MEASURE_IMPL"===e.role?`指标: ${e.mappingTargetId}`:"描述性属性"}))})}),N(t);const i=t.map(e=>({sourceFieldId:e.fieldId,alias:e.businessName,selected:!0}));w(i);const s={};t.forEach(e=>{e.mappingTargetId&&(s[e.mappingTargetId]||(s[e.mappingTargetId]=[]),s[e.mappingTargetId].push(e))});const l=Object.entries(s).filter(([e,t])=>t.length>1).map(([e,t])=>({conceptId:e,fields:t}));k(l);const n=l.map(e=>{var t;return{conceptId:e.conceptId,dominantAlias:(null==(t=e.fields.find(e=>e.sourceModelId===f))?void 0:t.businessName)||e.fields[0].businessName}});_(n)})()}M(z+1)}},fe=()=>{z>0&&M(z-1)};return di.jsxs("div",{className:"p-6",children:[di.jsxs(D,{children:[di.jsxs("div",{className:"flex justify-between items-center mb-4",children:[di.jsxs("div",{children:[di.jsx("h2",{className:"text-xl font-semibold",children:"数据集管理"}),di.jsx("p",{className:"text-gray-500 mt-1",children:"组合多个已封装好的数据模型，通过选用、别名、最终形成可供分析的一站式数据集"})]}),di.jsx(E,{type:"primary",icon:di.jsx(K,{}),onClick:()=>{a(null),d.resetFields(),g(""),b([]),N([]),w([]),k([]),_([]),R(""),l(!0)},children:"新增数据集"})]}),di.jsx(Y,{columns:H,dataSource:t,rowKey:"id",size:"small",scroll:{x:1200},pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}}),0===t.length&&di.jsx("div",{className:"text-center py-8 text-gray-500",children:"暂无数据集，点击上方按钮创建第一个数据集"})]}),di.jsxs(G,{title:n?"编辑数据集":"创建数据集",open:s,onCancel:ce,width:1200,footer:null,children:[di.jsx(Q,{current:z,className:"mb-6",children:me.map(e=>di.jsx(Q.Step,{title:e.title},e.title))}),di.jsxs(W,{form:d,layout:"vertical",children:[(()=>{switch(z){case 0:default:return pe();case 1:return xe();case 2:return he()}})(),di.jsx("div",{className:"flex justify-end mt-6",children:di.jsxs(J,{children:[di.jsx(E,{onClick:ce,children:"取消"}),z>0&&di.jsx(E,{onClick:fe,children:"上一步"}),z<me.length-1?di.jsx(E,{type:"primary",onClick:ue,children:"下一步"}):di.jsx(E,{type:"primary",onClick:oe,loading:r,children:"保存数据集"})]})})]})]}),di.jsx(G,{title:"新增数据集字段",open:O,onCancel:()=>F(!1),width:800,footer:null,children:di.jsx(bn,{availableModels:h,selectedPrimaryModel:f,relations:v,existingFields:C,onAddFields:e=>{const t=e.filter(e=>!C.some(t=>t.fieldId===e.fieldId));if(t.length>0){N(e=>[...e,...t]);const e=t.map(e=>({sourceFieldId:e.fieldId,alias:e.businessName,selected:!0}));w(t=>[...t,...e]),te.success(`已添加 ${t.length} 个字段`)}F(!1)},onCancel:()=>F(!1)})})]})},group:"一期"},{title:"维度管理",to:"/dimension-management",icon:di.jsx(pt,{className:"h-4 w-4"}),component:()=>{const[t,i]=j.useState([]),[s,l]=j.useState([]),[n,a]=j.useState(!1),[d,r]=j.useState(!1),[o,p]=j.useState(null),[x,h]=j.useState(null),[u,f]=j.useState(""),[g,v]=j.useState([]),[b,C]=j.useState({}),[N,I]=j.useState(""),[w,S]=j.useState(0),[k]=W.useForm(),[T]=W.useForm(),[_,A]=j.useState([]),R=[{title:"基本信息",description:"填写维度基本信息"},{title:"关联数据模型",description:"选择数据模型和定义字段角色"}];j.useEffect(()=>{i([{id:"dim_001",dimensionCode:"DIM_PRODUCT",dimensionName:"产品",tableName:"dim_products",status:"ACTIVE",createdAt:"2025-01-15",updatedAt:"2025-01-20",fields:[{physicalName:"product_code",businessName:"产品编码",role:"PRIMARY_KEY"},{physicalName:"product_name",businessName:"产品名称",role:"DISPLAY_NAME"},{physicalName:"category_name",businessName:"产品分类",role:"GROUPABLE"},{physicalName:"brand_name",businessName:"品牌",role:"GROUPABLE"}]},{id:"dim_002",dimensionCode:"DIM_BRAND",dimensionName:"品牌",tableName:"dim_brands",parentDimensionId:"dim_001",parentDimensionName:"产品",status:"ACTIVE",createdAt:"2025-01-15",updatedAt:"2025-01-20",fields:[{physicalName:"brand_code",businessName:"品牌编码",role:"PRIMARY_KEY"},{physicalName:"brand_name",businessName:"品牌名称",role:"DISPLAY_NAME"}]},{id:"dim_003",dimensionCode:"DIM_SUPPLIER",dimensionName:"供应商",tableName:"dim_suppliers",status:"ACTIVE",createdAt:"2025-01-15",updatedAt:"2025-01-20",fields:[{physicalName:"supplier_code",businessName:"供应商编码",role:"PRIMARY_KEY"},{physicalName:"supplier_name",businessName:"供应商名称",role:"DISPLAY_NAME"}]}]),l([{tableName:"dim_products",tableComment:"产品维度表",fields:[{fieldName:"product_code",fieldType:"VARCHAR(50)",fieldComment:"产品编码"},{fieldName:"product_name",fieldType:"VARCHAR(200)",fieldComment:"产品名称"},{fieldName:"category_name",fieldType:"VARCHAR(100)",fieldComment:"产品分类"},{fieldName:"brand_name",fieldType:"VARCHAR(100)",fieldComment:"品牌名称"},{fieldName:"manufacturer",fieldType:"VARCHAR(200)",fieldComment:"生产企业"},{fieldName:"registration_no",fieldType:"VARCHAR(100)",fieldComment:"注册证号"},{fieldName:"create_date",fieldType:"DATETIME",fieldComment:"创建日期"}]},{tableName:"dim_suppliers",tableComment:"供应商维度表",fields:[{fieldName:"supplier_code",fieldType:"VARCHAR(50)",fieldComment:"供应商编码"},{fieldName:"supplier_name",fieldType:"VARCHAR(200)",fieldComment:"供应商名称"},{fieldName:"supplier_type",fieldType:"VARCHAR(50)",fieldComment:"供应商类型"},{fieldName:"contact_person",fieldType:"VARCHAR(100)",fieldComment:"联系人"}]}])},[]);const z=[{title:"维度编码",dataIndex:"dimensionCode",key:"dimensionCode",width:150},{title:"维度名称",dataIndex:"dimensionName",key:"dimensionName",width:150,render:(e,t)=>di.jsx(E,{type:"link",onClick:()=>L(),style:{padding:0,height:"auto"},children:e})},{title:"关联的维度表",dataIndex:"tableName",key:"tableName",width:180,render:(e,t)=>e&&""!==e?e:di.jsx(E,{type:"link",size:"small",onClick:()=>P(t),children:"关联维度表"})},{title:"上级维度",dataIndex:"parentDimensionName",key:"parentDimensionName",width:120,render:e=>e||"-"},{title:"状态",dataIndex:"status",key:"status",width:100,render:e=>{const t="ACTIVE"===e?{text:"启用",color:"#52c41a"}:{text:"禁用",color:"#f5222d"};return di.jsx("span",{style:{color:t.color},children:t.text})}},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:120},{title:"操作",key:"action",width:200,render:(e,t)=>di.jsxs(J,{size:"small",children:[di.jsx(E,{type:"link",size:"small",icon:di.jsx(X,{}),onClick:()=>O(t),children:"编辑"}),di.jsx(E,{type:"link",size:"small",onClick:()=>P(t),children:"关联数据模型"}),di.jsx(E,{type:"link",size:"small",onClick:()=>F(t),children:"ACTIVE"===t.status?"禁用":"启用"}),di.jsx(Z,{title:"确定要删除这个维度吗？",onConfirm:()=>$(t.id),okText:"确定",cancelText:"取消",children:di.jsx(E,{type:"link",size:"small",danger:!0,icon:di.jsx(ee,{}),children:"删除"})})]})}],M=[{value:"PRIMARY_KEY",label:"主键 (Primary Key)",icon:di.jsx(tt,{className:"h-4 w-4"})},{value:"DISPLAY_NAME",label:"主显示名 (Display Name)",icon:di.jsx(B,{className:"h-4 w-4"})},{value:"GROUPABLE",label:"可分组属性 (Groupable)",icon:di.jsx(it,{className:"h-4 w-4"})},{value:"DESCRIPTIVE",label:"描述性属性 (Descriptive)",icon:di.jsx(st,{className:"h-4 w-4"})},{value:"UNUSED",label:"(不使用)",icon:null}],O=e=>{p(e),f(e.tableName),S(0);const t=s.find(t=>t.tableName===e.tableName);if(t){v(t.fields);const i={};e.fields.forEach(e=>{i[e.physicalName]=e.role}),C(i)}k.setFieldsValue({dimensionName:e.dimensionName,dimensionCode:e.dimensionCode,tableName:e.tableName,parentDimensionId:e.parentDimensionId}),a(!0)},L=e=>{te.info("查看维度详情功能")},P=e=>{h(e),I(""),f(""),v([]),C({}),A([]),T.resetFields(),r(!0)},F=e=>{const s="ACTIVE"===e.status?"INACTIVE":"ACTIVE";i(t.map(t=>t.id===e.id?m(c({},t),{status:s}):t)),te.success("维度已"+("ACTIVE"===s?"启用":"禁用"))},$=e=>{i(t.filter(t=>t.id!==e)),te.success("删除成功")},V=[{title:"物理字段名",dataIndex:"fieldName",key:"fieldName",width:150},{title:"业务显示名",dataIndex:"fieldComment",key:"fieldComment",width:150},{title:"数据类型",dataIndex:"fieldType",key:"fieldType",width:120},{title:"字段角色",key:"role",width:200,render:(e,t)=>di.jsx(q,{value:b[t.fieldName]||"UNUSED",onChange:e=>{return i=t.fieldName,s=e,void C(e=>m(c({},e),{[i]:s}));var i,s},style:{width:"100%"},children:M.map(e=>di.jsx(Cn,{value:e.value,children:di.jsxs(J,{children:[e.icon,e.label]})},e.value))})},{title:"备注",key:"note",render:(e,t)=>{const i=b[t.fieldName];return"PRIMARY_KEY"===i?"* 必须指定一个主键":"DISPLAY_NAME"===i?"* 用于报表默认显示":"GROUPABLE"===i?"* 可拖拽到行列头":"DESCRIPTIVE"===i?"* 仅用于展示":"UNUSED"===i?"* 此字段不参与分析":""}}];return di.jsxs("div",{className:"p-6",children:[di.jsxs(D,{children:[di.jsxs("div",{className:"flex justify-between items-center mb-4",children:[di.jsx("h2",{className:"text-xl font-semibold",children:"维度库管理"}),di.jsx(E,{type:"primary",icon:di.jsx(K,{}),onClick:()=>{p(null),f(""),v([]),C({}),S(0),k.resetFields(),a(!0)},children:"新增维度"})]}),di.jsx(Y,{columns:z,dataSource:t,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})]}),di.jsxs(G,{title:o?"编辑维度":"新增维度",open:n,onCancel:()=>a(!1),footer:[di.jsx(E,{onClick:()=>a(!1),children:"取消"},"cancel"),w>0&&di.jsx(E,{onClick:()=>{S(w-1)},children:"上一步"},"prev"),w<R.length-1?di.jsx(E,{type:"primary",onClick:()=>y(e,null,function*(){if(0===w)try{yield k.validateFields(["dimensionCode","dimensionName"]),S(1)}catch(e){te.error("请填写完整的基本信息")}}),children:"下一步"},"next"):di.jsx(E,{type:"primary",onClick:()=>{k.validateFields().then(e=>{var s;if(1!==Object.values(b).filter(e=>"PRIMARY_KEY"===e).length)return void te.error("必须指定一个且仅一个主键字段");const l=g.map(e=>({physicalName:e.fieldName,businessName:e.fieldComment||e.fieldName,role:b[e.fieldName]||"UNUSED"})).filter(e=>"UNUSED"!==e.role),n=m(c({id:(null==o?void 0:o.id)||Date.now().toString()},e),{parentDimensionName:e.parentDimensionId?null==(s=t.find(t=>t.id===e.parentDimensionId))?void 0:s.dimensionName:void 0,status:"ACTIVE",createdAt:(null==o?void 0:o.createdAt)||(new Date).toISOString().split("T")[0],updatedAt:(new Date).toISOString().split("T")[0],fields:l});o?(i(t.map(e=>e.id===o.id?n:e)),te.success("更新成功")):(i([...t,n]),te.success("创建成功")),a(!1),S(0)})},children:"保存维度"},"save")].filter(Boolean),width:1e3,children:[di.jsx("div",{className:"mb-6",children:di.jsx(Q,{current:w,items:R})}),di.jsxs("div",{className:"mt-6",children:[0===w&&di.jsxs("div",{children:[di.jsx("h3",{className:"text-lg font-medium mb-4",children:"基本信息"}),di.jsxs(W,{form:k,layout:"vertical",children:[di.jsx(W.Item,{name:"dimensionCode",label:"维度编码",rules:[{required:!0,message:"请输入维度编码"}],children:di.jsx(U,{placeholder:"请输入维度编码",disabled:!!o})}),di.jsx(W.Item,{name:"dimensionName",label:"维度名称",rules:[{required:!0,message:"请输入维度名称"}],children:di.jsx(U,{placeholder:"请输入维度名称"})}),di.jsx(W.Item,{name:"dimensionDesc",label:"维度描述",children:di.jsx(Nn,{rows:3,placeholder:"请输入维度描述（可选）"})})]})]}),1===w&&di.jsxs("div",{children:[di.jsx("h3",{className:"text-lg font-medium mb-4",children:"关联数据模型"}),di.jsx(W,{form:k,layout:"vertical",children:di.jsx(W.Item,{name:"tableName",label:"选择数据表",rules:[{required:!0,message:"请选择数据表"}],children:di.jsx(q,{placeholder:"请选择数据表",value:u,onChange:e=>{f(e);const t=s.find(t=>t.tableName===e);t&&(v(t.fields),C({}))},children:s.map(e=>di.jsxs(Cn,{value:e.tableName,children:[e.tableName," (",e.tableComment,")"]},e.tableName))})})}),g.length>0&&di.jsxs("div",{children:[di.jsx("h4",{className:"text-md font-medium mb-3",children:"字段角色定义"}),di.jsx(Y,{columns:V,dataSource:g,rowKey:"fieldName",pagination:!1,size:"small",scroll:{y:300}})]})]})]})]}),di.jsx(G,{title:"关联维度表",open:d,onCancel:()=>{r(!1),h(null),I(""),A([]),T.resetFields()},onOk:()=>y(e,null,function*(){try{const e=yield T.validateFields(),s=t.map(t=>t.id===(null==x?void 0:x.id)?m(c({},t),{tableName:e.tableName,dataSource:e.dataSource,database:e.database}):t);i(s),r(!1),te.success("关联维度表成功！")}catch(e){}}),width:800,okText:"确定",cancelText:"取消",children:di.jsxs("div",{className:"space-y-6",children:[di.jsx(W,{form:T,layout:"vertical",children:di.jsx(W.Item,{name:"modelName",label:"选择数据模型",rules:[{required:!0,message:"请选择数据模型"}],children:di.jsxs(q,{placeholder:"请选择数据模型",value:N,onChange:e=>{I(e),A({dim_products:[{fieldName:"product_code",fieldType:"VARCHAR(50)",fieldComment:"产品编码"},{fieldName:"product_name",fieldType:"VARCHAR(200)",fieldComment:"产品名称"},{fieldName:"category_id",fieldType:"INT",fieldComment:"分类ID"},{fieldName:"brand_id",fieldType:"INT",fieldComment:"品牌ID"},{fieldName:"status",fieldType:"VARCHAR(20)",fieldComment:"状态"}],dim_suppliers:[{fieldName:"supplier_code",fieldType:"VARCHAR(50)",fieldComment:"供应商编码"},{fieldName:"supplier_name",fieldType:"VARCHAR(200)",fieldComment:"供应商名称"},{fieldName:"contact_person",fieldType:"VARCHAR(100)",fieldComment:"联系人"},{fieldName:"phone",fieldType:"VARCHAR(20)",fieldComment:"电话"}],dim_customers:[{fieldName:"customer_code",fieldType:"VARCHAR(50)",fieldComment:"客户编码"},{fieldName:"customer_name",fieldType:"VARCHAR(200)",fieldComment:"客户名称"},{fieldName:"customer_type",fieldType:"VARCHAR(50)",fieldComment:"客户类型"}],dim_brands:[{fieldName:"brand_code",fieldType:"VARCHAR(50)",fieldComment:"品牌编码"},{fieldName:"brand_name",fieldType:"VARCHAR(200)",fieldComment:"品牌名称"},{fieldName:"brand_desc",fieldType:"TEXT",fieldComment:"品牌描述"}]}[e]||[])},children:[di.jsx(Cn,{value:"dim_products",children:"产品维度模型"}),di.jsx(Cn,{value:"dim_suppliers",children:"供应商维度模型"}),di.jsx(Cn,{value:"dim_customers",children:"客户维度模型"}),di.jsx(Cn,{value:"dim_brands",children:"品牌维度模型"})]})})}),_.length>0&&di.jsxs("div",{children:[di.jsx("h4",{className:"text-md font-medium mb-3",children:"字段角色定义"}),di.jsx(Y,{columns:V,dataSource:_,rowKey:"fieldName",pagination:!1,size:"small",scroll:{y:300}})]})]})})]})},group:"一期"},{title:"指标管理",to:"/metric-management",icon:di.jsx(Le,{className:"h-4 w-4"}),component:()=>{const[t,i]=j.useState([]),[s,l]=j.useState([]),[n,a]=j.useState(!1),[d,r]=j.useState(null),[o]=W.useForm(),[p,x]=j.useState(""),[h,u]=j.useState(""),[f,g]=j.useState(""),[v,b]=j.useState("all"),[C,N]=j.useState(!1),[I,w]=j.useState(null),[S]=W.useForm(),[k,T]=j.useState([]),[_,A]=j.useState([]),[R,z]=j.useState(!1),[M]=W.useForm(),[O,L]=j.useState(""),[P,F]=j.useState(0),[$,H]=j.useState(!1),[Q,ie]=j.useState(""),[se,le]=j.useState({string:!0,number:!0,date:!0});j.useEffect(()=>{l([{id:"sales",name:"销售指标",description:"销售相关的业务指标",icon:"💰"},{id:"finance",name:"财务指标",description:"财务分析相关指标",icon:"📊"},{id:"inventory",name:"库存指标",description:"库存管理相关指标",icon:"📦"},{id:"customer",name:"客户指标",description:"客户分析相关指标",icon:"👥"},{id:"operational",name:"运营指标",description:"运营效率相关指标",icon:"⚙️"}]),T([{id:"ds_agreement_price",name:"集团采购协议数据集",fields:[{code:"agreement_id",name:"协议ID",type:"STRING"},{code:"supplier_id",name:"供应商ID",type:"STRING"},{code:"supplier_name",name:"供应商名称",type:"STRING"},{code:"product_category",name:"产品类别",type:"STRING"},{code:"product_name",name:"产品名称",type:"STRING"},{code:"agreement_price",name:"协议价格",type:"DECIMAL"},{code:"quantity",name:"数量",type:"INTEGER"},{code:"discount_rate",name:"折扣率",type:"DECIMAL"},{code:"effective_date",name:"生效日期",type:"DATE"},{code:"expire_date",name:"失效日期",type:"DATE"},{code:"contract_amount",name:"合同金额",type:"DECIMAL"},{code:"payment_terms",name:"付款条件",type:"STRING"}]},{id:"ds_vendor_offer",name:"供应商报价数据集",fields:[{code:"quote_id",name:"报价ID",type:"STRING"},{code:"supplier_id",name:"供应商ID",type:"STRING"},{code:"supplier_name",name:"供应商名称",type:"STRING"},{code:"product_id",name:"产品ID",type:"STRING"},{code:"product_name",name:"产品名称",type:"STRING"},{code:"product_spec",name:"产品规格",type:"STRING"},{code:"offer_price",name:"报价",type:"DECIMAL"},{code:"quote_quantity",name:"报价数量",type:"INTEGER"},{code:"unit_price",name:"单价",type:"DECIMAL"},{code:"delivery_time",name:"交货时间",type:"INTEGER"},{code:"quote_date",name:"报价日期",type:"DATE"},{code:"valid_until",name:"报价有效期",type:"DATE"},{code:"currency",name:"币种",type:"STRING"},{code:"tax_rate",name:"税率",type:"DECIMAL"}]},{id:"ds_orders",name:"订单事实表",fields:[{code:"order_id",name:"订单ID",type:"STRING"},{code:"supplier_id",name:"供应商ID",type:"STRING"},{code:"supplier_name",name:"供应商名称",type:"STRING"},{code:"product_id",name:"产品ID",type:"STRING"},{code:"product_name",name:"产品名称",type:"STRING"},{code:"product_category",name:"产品类别",type:"STRING"},{code:"order_amount",name:"订单金额",type:"DECIMAL"},{code:"order_quantity",name:"订单数量",type:"INTEGER"},{code:"unit_price",name:"单价",type:"DECIMAL"},{code:"order_date",name:"订单日期",type:"DATE"},{code:"delivery_date",name:"交货日期",type:"DATE"},{code:"order_status",name:"订单状态",type:"STRING"},{code:"payment_amount",name:"付款金额",type:"DECIMAL"},{code:"discount_amount",name:"折扣金额",type:"DECIMAL"}]},{id:"ds_product_master",name:"产品主数据",fields:[{code:"product_id",name:"产品ID",type:"STRING"},{code:"product_name",name:"产品名称",type:"STRING"},{code:"product_code",name:"产品编码",type:"STRING"},{code:"category_id",name:"类别ID",type:"STRING"},{code:"category_name",name:"类别名称",type:"STRING"},{code:"brand",name:"品牌",type:"STRING"},{code:"model",name:"型号",type:"STRING"},{code:"specification",name:"规格",type:"STRING"},{code:"unit",name:"单位",type:"STRING"},{code:"standard_price",name:"标准价格",type:"DECIMAL"}]},{id:"ds_supplier_master",name:"供应商主数据",fields:[{code:"supplier_id",name:"供应商ID",type:"STRING"},{code:"supplier_name",name:"供应商名称",type:"STRING"},{code:"supplier_code",name:"供应商编码",type:"STRING"},{code:"supplier_type",name:"供应商类型",type:"STRING"},{code:"contact_person",name:"联系人",type:"STRING"},{code:"contact_phone",name:"联系电话",type:"STRING"},{code:"address",name:"地址",type:"STRING"},{code:"credit_rating",name:"信用等级",type:"STRING"},{code:"cooperation_years",name:"合作年限",type:"INTEGER"},{code:"payment_terms",name:"付款条件",type:"STRING"}]}]),i([{id:"metric_001",metricCode:"TOTAL_SALES",metricName:"总销售额",type:"atomic",bizSpec:"统计所有销售订单的总金额",unit:"元",scale:2,displayFormat:"currency",formula:"SUM(order_amount)",mappings:[{datasetId:"ds_orders",datasetName:"订单事实表",fieldCode:"order_amount",fieldName:"订单金额",defaultAgg:"SUM"}],isBaselineEligible:!0,tags:["销售","金额"],category:"sales",status:"ACTIVE",createdBy:"张三",createdAt:"2024-01-15",updatedAt:"2024-01-20",usageCount:156},{id:"metric_002",metricCode:"SQL_ORDER_VALUE",metricName:"SQL订单价值",type:"derived",bizSpec:"基于SQL查询计算的订单价值指标",unit:"元",scale:2,displayFormat:"currency",formula:"SUM(order_amount * discount_rate)",dependencies:["TOTAL_SALES"],mappings:[{datasetId:"ds_orders",datasetName:"订单事实表",fieldCode:"order_amount",fieldName:"订单金额",defaultAgg:"SUM"}],isBaselineEligible:!1,tags:["销售","计算"],category:"sales",status:"ACTIVE",createdBy:"李四",createdAt:"2024-01-10",updatedAt:"2024-01-18",usageCount:89},{id:"metric_003",metricCode:"CUSTOMER_COUNT",metricName:"客户数量统计",type:"atomic",bizSpec:"统计活跃客户的总数量",unit:"个",scale:0,displayFormat:"number",formula:"COUNT(DISTINCT customer_id)",mappings:[{datasetId:"ds_customers",datasetName:"客户维度表",fieldCode:"customer_id",fieldName:"客户ID",defaultAgg:"NONE"}],isBaselineEligible:!0,tags:["客户","统计"],category:"customer",status:"ACTIVE",createdBy:"王五",createdAt:"2024-01-12",updatedAt:"2024-01-19",usageCount:234},{id:"metric_004",metricCode:"INVENTORY_CLOUD",metricName:"库存云指标",type:"derived",bizSpec:"基于云端数据计算的库存相关指标",unit:"%",scale:2,displayFormat:"percent",formula:"(stock_in - stock_out) / total_capacity * 100",dependencies:[],mappings:[{datasetId:"ds_inventory",datasetName:"库存事实表",fieldCode:"stock_in",fieldName:"入库量",defaultAgg:"SUM"}],isBaselineEligible:!1,tags:["库存","比率"],category:"inventory",status:"ACTIVE",createdBy:"赵六",createdAt:"2024-01-08",updatedAt:"2024-01-16",usageCount:67},{id:"metric_005",metricCode:"PROFIT_MARGIN",metricName:"利润率分析",type:"derived",bizSpec:"计算销售利润占销售收入的比例",unit:"%",scale:4,displayFormat:"percent",formula:"((revenue - cost) / revenue) * 100",dependencies:[],mappings:[{datasetId:"ds_finance",datasetName:"财务事实表",fieldCode:"revenue",fieldName:"收入",defaultAgg:"SUM"}],isBaselineEligible:!1,tags:["财务","比率"],category:"finance",status:"ACTIVE",createdBy:"孙七",createdAt:"2024-01-05",updatedAt:"2024-01-14",usageCount:123}])},[]);const ne="all"===v?t:t.filter(e=>e.category===v),ae=[{title:"指标编码",dataIndex:"metricCode",key:"metricCode",width:120,render:e=>di.jsx("span",{className:"font-mono text-sm",children:e})},{title:"指标名称",dataIndex:"metricName",key:"metricName",width:150,render:(e,t)=>di.jsx(E,{type:"link",className:"p-0 h-auto font-medium text-left",onClick:()=>re(),children:e})},{title:"指标分类",dataIndex:"category",key:"category",width:120,render:e=>{const t=s.find(t=>t.id===e);return t?t.name:e}},{title:"单位",dataIndex:"unit",key:"unit",width:80},{title:"状态",dataIndex:"status",key:"status",width:80,render:e=>di.jsx(B,{color:"ACTIVE"===e?"green":"red",children:"ACTIVE"===e?"启用":"禁用"})},{title:"创建人",dataIndex:"createdBy",key:"createdBy",width:100},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt",width:120},{title:"操作",key:"action",width:200,render:(e,t)=>di.jsxs(J,{children:[di.jsx(E,{type:"link",icon:di.jsx(Gs,{}),size:"small",onClick:()=>oe(t),children:"关联数据集"}),di.jsx(E,{type:"link",icon:di.jsx(X,{}),size:"small",onClick:()=>de(t),children:"编辑"}),di.jsx(Z,{title:"确定要删除这个指标吗？",onConfirm:()=>me(t.id),okText:"确定",cancelText:"取消",children:di.jsx(E,{type:"link",icon:di.jsx(ee,{}),size:"small",danger:!0,children:"删除"})})]})}],de=e=>{r(e),o.setFieldsValue({metricName:e.metricName,metricCode:e.metricCode,type:e.type,bizSpec:e.bizSpec,unit:e.unit,scale:e.scale,displayFormat:e.displayFormat,formula:e.formula,category:e.category,isBaselineEligible:e.isBaselineEligible,tags:e.tags}),a(!0)},re=e=>{te.info("查看指标详情功能")},oe=e=>{w(e),x(""),u(""),g(""),S.resetFields(),N(!0)},me=e=>{i(t.filter(t=>t.id!==e)),te.success("删除成功")};return di.jsxs("div",{className:"p-6",children:[di.jsxs(D,{children:[di.jsxs("div",{className:"flex justify-between items-center mb-4",children:[di.jsxs("div",{children:[di.jsx("h2",{className:"text-xl font-semibold",children:"指标库管理"}),di.jsx("p",{className:"text-gray-500 mt-1",children:"管理系统中的所有业务指标，定义计算规则和分类"})]}),di.jsx(E,{type:"primary",icon:di.jsx(K,{}),onClick:()=>{r(null),o.resetFields(),a(!0)},children:"新增指标"})]}),di.jsx("div",{className:"mb-4",children:di.jsxs(J,{children:[di.jsx("span",{children:"指标分类："}),di.jsxs(q,{value:v,onChange:b,style:{width:200},children:[di.jsx(In,{value:"all",children:"全部分类"}),s.map(e=>di.jsx(In,{value:e.id,children:di.jsxs(J,{children:[di.jsx("span",{children:e.icon}),e.name]})},e.id))]})]})}),di.jsx(Y,{columns:ae,dataSource:ne,rowKey:"id",scroll:{x:1200},pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})]}),di.jsx(G,{title:"新建指标",open:n,onCancel:()=>a(!1),footer:[di.jsx(E,{onClick:()=>a(!1),children:"关闭"},"cancel"),di.jsx(E,{type:"primary",onClick:()=>{o.validateFields().then(e=>{if(e.bizSpec&&e.bizSpec.length>500)return void te.error("指标描述不能超过500字");const s=m(c({id:(null==d?void 0:d.id)||Date.now().toString()},e),{status:"ACTIVE",createdBy:(null==d?void 0:d.createdBy)||"当前用户",createdAt:(null==d?void 0:d.createdAt)||(new Date).toISOString().split("T")[0],updatedAt:(new Date).toISOString().split("T")[0],usageCount:(null==d?void 0:d.usageCount)||0});d?(i(t.map(e=>e.id===d.id?s:e)),te.success("更新成功")):(i([...t,s]),te.success("创建成功")),a(!1),o.resetFields(),F(0)})},children:"保存"},"save")],width:800,children:di.jsxs(W,{form:o,layout:"vertical",children:[di.jsxs("div",{children:[di.jsx(Sn,{level:4,children:"基本信息"}),di.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[di.jsx(W.Item,{name:"metricName",label:di.jsxs("span",{children:["指标名称 ",di.jsx("span",{style:{color:"red"},children:"*"})]}),rules:[{required:!0,message:"请输入指标名称"}],children:di.jsx(U,{placeholder:"协议价 / 最低价 / 差异率"})}),di.jsx(W.Item,{name:"metricCode",label:di.jsxs("span",{children:["指标编码 ",di.jsx("span",{style:{color:"red"},children:"*"})]}),rules:[{required:!0,message:"请输入指标编码"}],children:di.jsx(U,{placeholder:"ind_agreement_price",disabled:!!d})})]}),di.jsxs(W.Item,{name:"bizSpec",label:"指标描述",children:[di.jsx(wn,{placeholder:"请描述指标的业务含义和计算逻辑",rows:3,onChange:e=>F(e.target.value.length)}),di.jsxs("div",{style:{textAlign:"right",color:"#999",fontSize:"12px",marginTop:"4px"},children:[P,"/500"]})]}),di.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[di.jsx(W.Item,{name:"unit",label:"单位",children:di.jsx(U,{placeholder:"万元、个、%"})}),di.jsx(W.Item,{name:"scale",label:"精度",children:di.jsx(U,{placeholder:"2",type:"number",min:0,max:10,style:{width:"100%"}})})]})]}),di.jsx(V,{}),di.jsxs("div",{children:[di.jsx(Sn,{level:4,children:"数据集字段绑定"}),di.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[di.jsx(W.Item,{name:"datasetId",label:di.jsxs("span",{children:["数据集 ",di.jsx("span",{style:{color:"red"},children:"*"})]}),rules:[{required:!0,message:"请选择数据集"}],children:di.jsx(q,{placeholder:"请选择",children:k.map(e=>di.jsx(In,{value:e.id,children:e.name},e.id))})}),di.jsx(W.Item,{name:"expression",label:"表达式",children:di.jsx(U,{placeholder:"点击编辑表达式",readOnly:!0,style:{cursor:"pointer"},onClick:()=>{H(!0),ie(o.getFieldValue("expression")||"")}})})]})]})]})}),di.jsx(G,{title:"关联数据模型",open:C,onCancel:()=>N(!1),onOk:()=>y(e,null,function*(){try{yield S.validateFields(),te.success("关联数据集成功"),N(!1)}catch(e){}}),width:600,children:di.jsxs(W,{form:S,layout:"vertical",children:[di.jsx(W.Item,{name:"modelName",label:"选择数据模型",rules:[{required:!0,message:"请选择数据模型"}],children:di.jsxs(q,{placeholder:"请选择数据模型",value:p,onChange:x,children:[di.jsx(In,{value:"procurement_agreement_detail",children:"采购协议明细表"}),di.jsx(In,{value:"procurement_order_detail",children:"采购订单明细表"}),di.jsx(In,{value:"historical_procurement_inbound",children:"历史采购入库明细"}),di.jsx(In,{value:"supplier_quotation_detail",children:"供应商报价明细表"}),di.jsx(In,{value:"procurement_contract_detail",children:"采购合同明细表"})]})}),di.jsx(W.Item,{name:"fieldName",label:"选择字段",rules:[{required:!0,message:"请选择字段"}],children:di.jsxs(q,{placeholder:"请选择字段",value:h,onChange:u,children:[di.jsx(In,{value:"sales_amount",children:"销售金额"}),di.jsx(In,{value:"order_amount",children:"订单金额"}),di.jsx(In,{value:"customer_id",children:"客户ID"}),di.jsx(In,{value:"product_id",children:"产品ID"}),di.jsx(In,{value:"quantity",children:"数量"})]})}),di.jsx(W.Item,{name:"aggregationType",label:"聚合类型",rules:[{required:!0,message:"请选择聚合类型"}],children:di.jsxs(q,{placeholder:"请选择聚合类型",value:f,onChange:g,children:[di.jsx(In,{value:"COUNT",children:"计数 (COUNT)"}),di.jsx(In,{value:"SUM",children:"求和 (SUM)"}),di.jsx(In,{value:"AVG",children:"平均值 (AVG)"}),di.jsx(In,{value:"MAX",children:"最大值 (MAX)"}),di.jsx(In,{value:"MIN",children:"最小值 (MIN)"}),di.jsx(In,{value:"RATIO",children:"比率 (RATIO)"}),di.jsx(In,{value:"CUSTOM",children:"自定义 (CUSTOM)"})]})})]})}),di.jsx(G,{title:"添加数据集字段映射",open:R,onOk:()=>{M.validateFields().then(e=>{const t=k.find(t=>t.id===e.datasetId),i=null==t?void 0:t.fields.find(t=>t.name===e.fieldName),s={datasetId:e.datasetId,datasetName:(null==t?void 0:t.name)||"",fieldName:e.fieldName,fieldCode:(null==i?void 0:i.code)||e.fieldName,fieldType:(null==i?void 0:i.type)||"",defaultAgg:e.defaultAgg};A([..._,s]),z(!1),M.resetFields()})},onCancel:()=>{z(!1),L(""),M.resetFields()},okText:"添加",cancelText:"取消",children:di.jsxs(W,{form:M,layout:"vertical",children:[di.jsx(W.Item,{name:"datasetId",label:"选择数据集",rules:[{required:!0,message:"请选择数据集"}],children:di.jsx(q,{placeholder:"请选择数据集",onChange:e=>{L(e),M.setFieldsValue({fieldName:void 0})},children:k.map(e=>di.jsx(In,{value:e.id,children:e.name},e.id))})}),di.jsx(W.Item,{name:"fieldName",label:"选择字段",rules:[{required:!0,message:"请选择字段"}],children:di.jsx(q,{placeholder:"请选择字段",children:(()=>{const e=k.find(e=>e.id===O);return(null==e?void 0:e.fields.map(e=>di.jsxs(In,{value:e.name,children:[e.name," (",e.type,")"]},e.name)))||[]})()})}),di.jsx(W.Item,{name:"defaultAgg",label:"默认聚合方式",rules:[{required:!0,message:"请选择聚合方式"}],children:di.jsxs(q,{placeholder:"请选择聚合方式",children:[di.jsx(In,{value:"SUM",children:"求和 (SUM)"}),di.jsx(In,{value:"COUNT",children:"计数 (COUNT)"}),di.jsx(In,{value:"AVG",children:"平均值 (AVG)"}),di.jsx(In,{value:"MAX",children:"最大值 (MAX)"}),di.jsx(In,{value:"MIN",children:"最小值 (MIN)"}),di.jsx(In,{value:"DISTINCT_COUNT",children:"去重计数"})]})})]})}),di.jsx(G,{title:"表达式编辑器",open:$,onCancel:()=>{H(!1),ie("")},onOk:()=>{o.setFieldsValue({expression:Q}),H(!1),te.success("表达式已保存")},width:1600,style:{top:20},children:di.jsx("div",{style:{display:"flex",gap:"16px",height:"700px"},children:di.jsxs("div",{style:{width:"480px",display:"flex",flexDirection:"column",gap:"16px"},children:[di.jsx("div",{style:{flex:1},children:di.jsxs(D,{size:"small",style:{height:"100%",borderRadius:"12px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",background:"linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)",overflow:"hidden"},title:di.jsx("div",{style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",margin:"-12px -16px 12px -16px",padding:"12px 16px",color:"white",fontSize:"14px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px",textShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"},children:"📊 数据集字段"}),children:[di.jsx("div",{style:{fontSize:"12px",color:"#64748b",marginBottom:"16px",padding:"8px 12px",background:"rgba(99, 102, 241, 0.05)",borderRadius:"8px",border:"1px solid rgba(99, 102, 241, 0.1)"},children:"💡 按类型分组，点击字段添加到表达式"}),di.jsx(ce,{size:"small",ghost:!0,activeKey:Object.keys(se).filter(e=>se[e]),onChange:e=>{const t={};Object.keys(se).forEach(i=>{t[i]=e.includes(i)}),le(t)},style:{background:"transparent"},items:[{key:"string",label:di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#059669",fontWeight:"500",fontSize:"13px"},children:["📝 文本类型",di.jsxs("span",{style:{fontSize:"11px",color:"#6b7280",background:"rgba(5, 150, 105, 0.1)",padding:"2px 6px",borderRadius:"10px"},children:["(",k.flatMap(e=>e.fields.filter(e=>"STRING"===e.type)).length,")"]})]}),children:di.jsx("div",{style:{maxHeight:"150px",overflowY:"auto",padding:"8px 0"},children:k.flatMap(e=>e.fields.filter(e=>"STRING"===e.type).map(t=>di.jsxs(E,{type:"text",size:"small",style:{textAlign:"left",height:"auto",padding:"8px 12px",whiteSpace:"normal",fontSize:"11px",display:"block",width:"100%",marginBottom:"4px",borderRadius:"8px",background:"linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%)",border:"1px solid #a7f3d0",transition:"all 0.2s ease",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},onClick:()=>{ie(e=>e?`${e} + ${t.code}`:t.code)},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.1)",e.currentTarget.style.background="linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 1px 2px rgba(0, 0, 0, 0.05)",e.currentTarget.style.background="linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%)"},children:[di.jsx("div",{style:{fontFamily:"monospace",color:"#065f46",fontWeight:"500"},children:t.code}),di.jsx("div",{style:{fontSize:"10px",color:"#047857"},children:t.name}),di.jsx("div",{style:{fontSize:"9px",color:"#6b7280"},children:e.name})]},`${e.id}-${t.code}`)))})},{key:"number",label:di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#dc2626",fontWeight:"500",fontSize:"13px"},children:["🔢 数值类型",di.jsxs("span",{style:{fontSize:"11px",color:"#999"},children:["(",k.flatMap(e=>e.fields.filter(e=>["INTEGER","DECIMAL","FLOAT","DOUBLE"].includes(e.type))).length,")"]})]}),children:di.jsx("div",{style:{maxHeight:"150px",overflowY:"auto",padding:"8px 0"},children:k.flatMap(e=>e.fields.filter(e=>["INTEGER","DECIMAL","FLOAT","DOUBLE"].includes(e.type)).map(t=>di.jsxs(E,{type:"text",size:"small",style:{textAlign:"left",height:"auto",padding:"8px 12px",whiteSpace:"normal",fontSize:"11px",display:"block",width:"100%",marginBottom:"4px",borderRadius:"8px",background:"linear-gradient(135deg, #fef2f2 0%, #fecaca 100%)",border:"1px solid #fca5a5",transition:"all 0.2s ease",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},onClick:()=>{ie(e=>e?`${e} + ${t.code}`:t.code)},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.1)",e.currentTarget.style.background="linear-gradient(135deg, #fecaca 0%, #f87171 100%)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 1px 2px rgba(0, 0, 0, 0.05)",e.currentTarget.style.background="linear-gradient(135deg, #fef2f2 0%, #fecaca 100%)"},children:[di.jsx("div",{style:{fontFamily:"monospace",color:"#991b1b",fontWeight:"500"},children:t.code}),di.jsx("div",{style:{fontSize:"10px",color:"#dc2626"},children:t.name}),di.jsx("div",{style:{fontSize:"9px",color:"#6b7280"},children:e.name})]},`${e.id}-${t.code}`)))})},{key:"date",label:di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"#7c3aed",fontWeight:"500",fontSize:"13px"},children:["📅 日期类型",di.jsxs("span",{style:{fontSize:"11px",color:"#6b7280",background:"rgba(124, 58, 237, 0.1)",padding:"2px 6px",borderRadius:"10px"},children:["(",k.flatMap(e=>e.fields.filter(e=>["DATE","DATETIME","TIMESTAMP"].includes(e.type))).length,")"]})]}),children:di.jsx("div",{style:{maxHeight:"150px",overflowY:"auto",padding:"8px 0"},children:k.flatMap(e=>e.fields.filter(e=>["DATE","DATETIME","TIMESTAMP"].includes(e.type)).map(t=>di.jsxs(E,{type:"text",size:"small",style:{textAlign:"left",height:"auto",padding:"8px 12px",whiteSpace:"normal",fontSize:"11px",display:"block",width:"100%",marginBottom:"4px",borderRadius:"8px",background:"linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%)",border:"1px solid #d1d5db",transition:"all 0.2s ease",boxShadow:"0 1px 2px rgba(0, 0, 0, 0.05)"},onClick:()=>{ie(e=>e?`${e} + ${t.code}`:t.code)},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.1)",e.currentTarget.style.background="linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 1px 2px rgba(0, 0, 0, 0.05)",e.currentTarget.style.background="linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%)"},children:[di.jsx("div",{style:{fontFamily:"monospace",color:"#374151",fontWeight:"500"},children:t.code}),di.jsx("div",{style:{fontSize:"10px",color:"#4b5563"},children:t.name}),di.jsx("div",{style:{fontSize:"9px",color:"#6b7280"},children:e.name})]},`${e.id}-${t.code}`)))})}]})]})}),di.jsx("div",{style:{flex:1},children:di.jsxs(D,{size:"small",title:di.jsx("div",{style:{background:"linear-gradient(135deg, #059669 0%, #10b981 100%)",margin:"-12px -16px 12px -16px",padding:"12px 16px",color:"white",fontSize:"14px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"8px",textShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"},children:"⚙️ 数据库函数"}),style:{height:"100%",borderRadius:"12px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",background:"linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)",overflow:"hidden"},children:[di.jsx("div",{style:{fontSize:"12px",color:"#64748b",marginBottom:"12px",padding:"8px 12px",background:"rgba(5, 150, 105, 0.05)",borderRadius:"8px",border:"1px solid rgba(5, 150, 105, 0.1)"},children:"💡 点击函数添加到表达式"}),di.jsxs("div",{style:{height:"620px",overflowY:"auto"},children:[di.jsxs("div",{style:{marginBottom:"20px"},children:[di.jsx("div",{style:{fontSize:"12px",fontWeight:"bold",marginBottom:"8px",color:"#333",borderBottom:"1px solid #f0f0f0",paddingBottom:"4px"},children:"聚合函数"}),di.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"4px"},children:[{func:"SUM",desc:"求和",example:"SUM(column_name)"},{func:"COUNT",desc:"计数",example:"COUNT(column_name)"},{func:"AVG",desc:"平均值",example:"AVG(column_name)"},{func:"MAX",desc:"最大值",example:"MAX(column_name)"},{func:"MIN",desc:"最小值",example:"MIN(column_name)"},{func:"COUNT_DISTINCT",desc:"去重计数",example:"COUNT(DISTINCT column_name)"},{func:"SUM_DISTINCT",desc:"去重求和",example:"SUM(DISTINCT column_name)"},{func:"AVG_DISTINCT",desc:"去重平均",example:"AVG(DISTINCT column_name)"}].map(e=>di.jsxs(E,{type:"link",size:"small",style:{textAlign:"left",height:"auto",padding:"8px",whiteSpace:"normal",fontSize:"11px",border:"1px solid #f0f0f0",borderRadius:"4px",marginBottom:"4px",width:"100%"},onClick:()=>{ie(t=>t?`${t} + ${e.func}()`:`${e.func}()`)},children:[di.jsx("div",{style:{fontWeight:"bold",fontSize:"13px",color:"#1890ff"},children:e.func}),di.jsx("div",{style:{fontSize:"10px",color:"#666",marginTop:"2px"},children:e.desc}),di.jsx("div",{style:{fontSize:"9px",color:"#999",fontFamily:"monospace",marginTop:"2px"},children:e.example})]},e.func))})]}),di.jsxs("div",{style:{marginBottom:"20px"},children:[di.jsx("div",{style:{fontSize:"12px",fontWeight:"bold",marginBottom:"8px",color:"#333",borderBottom:"1px solid #f0f0f0",paddingBottom:"4px"},children:"数值函数"}),di.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"4px"},children:[{func:"ABS",desc:"绝对值",example:"ABS(column_name)"},{func:"ROUND",desc:"四舍五入",example:"ROUND(column_name, 2)"},{func:"CEIL",desc:"向上取整",example:"CEIL(column_name)"},{func:"FLOOR",desc:"向下取整",example:"FLOOR(column_name)"},{func:"POWER",desc:"幂运算",example:"POWER(column_name, 2)"},{func:"SQRT",desc:"平方根",example:"SQRT(column_name)"},{func:"EXP",desc:"指数",example:"EXP(column_name)"},{func:"LOG",desc:"自然对数",example:"LOG(column_name)"},{func:"LOG10",desc:"常用对数",example:"LOG10(column_name)"}].map(e=>di.jsxs(E,{type:"link",size:"small",style:{textAlign:"left",height:"auto",padding:"8px",whiteSpace:"normal",fontSize:"11px",border:"1px solid #f0f0f0",borderRadius:"4px",marginBottom:"4px",width:"100%"},onClick:()=>{ie(t=>t?`${t} + ${e.func}()`:`${e.func}()`)},children:[di.jsx("div",{style:{fontWeight:"bold",fontSize:"13px",color:"#1890ff"},children:e.func}),di.jsx("div",{style:{fontSize:"10px",color:"#666",marginTop:"2px"},children:e.desc}),di.jsx("div",{style:{fontSize:"9px",color:"#999",fontFamily:"monospace",marginTop:"2px"},children:e.example})]},e.func))})]}),di.jsxs("div",{style:{marginBottom:"20px"},children:[di.jsx("div",{style:{fontSize:"12px",fontWeight:"bold",marginBottom:"8px",color:"#333",borderBottom:"1px solid #f0f0f0",paddingBottom:"4px"},children:"字符串函数"}),di.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"4px"},children:[{func:"CONCAT",desc:"连接字符串",example:"CONCAT(str1, str2)"},{func:"LENGTH",desc:"字符串长度",example:"LENGTH(column_name)"},{func:"UPPER",desc:"转大写",example:"UPPER(column_name)"},{func:"LOWER",desc:"转小写",example:"LOWER(column_name)"},{func:"TRIM",desc:"去除空格",example:"TRIM(column_name)"},{func:"SUBSTRING",desc:"子字符串",example:"SUBSTRING(column_name, 1, 5)"},{func:"REPLACE",desc:"替换字符串",example:'REPLACE(column_name, "old", "new")'}].map(e=>di.jsxs(E,{type:"link",size:"small",style:{textAlign:"left",height:"auto",padding:"8px",whiteSpace:"normal",fontSize:"11px",border:"1px solid #f0f0f0",borderRadius:"4px",marginBottom:"4px",width:"100%"},onClick:()=>{ie(t=>t?`${t} + ${e.func}()`:`${e.func}()`)},children:[di.jsx("div",{style:{fontWeight:"bold",fontSize:"13px",color:"#1890ff"},children:e.func}),di.jsx("div",{style:{fontSize:"10px",color:"#666",marginTop:"2px"},children:e.desc}),di.jsx("div",{style:{fontSize:"9px",color:"#999",fontFamily:"monospace",marginTop:"2px"},children:e.example})]},e.func))})]}),di.jsxs("div",{style:{marginBottom:"20px"},children:[di.jsx("div",{style:{fontSize:"12px",fontWeight:"bold",marginBottom:"8px",color:"#333",borderBottom:"1px solid #f0f0f0",paddingBottom:"4px"},children:"日期时间函数"}),di.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"4px"},children:[{func:"NOW",desc:"当前时间",example:"NOW()"},{func:"CURDATE",desc:"当前日期",example:"CURDATE()"},{func:"YEAR",desc:"年份",example:"YEAR(column_name)"},{func:"MONTH",desc:"月份",example:"MONTH(column_name)"},{func:"DAY",desc:"日期",example:"DAY(column_name)"},{func:"DATE_FORMAT",desc:"日期格式化",example:'DATE_FORMAT(column_name, "%Y-%m-%d")'},{func:"DATEDIFF",desc:"日期差",example:"DATEDIFF(date1, date2)"}].map(e=>di.jsxs(E,{type:"link",size:"small",style:{textAlign:"left",height:"auto",padding:"8px",whiteSpace:"normal",fontSize:"11px",border:"1px solid #f0f0f0",borderRadius:"4px",marginBottom:"4px",width:"100%"},onClick:()=>{ie(t=>t?`${t} + ${e.func}()`:`${e.func}()`)},children:[di.jsx("div",{style:{fontWeight:"bold",fontSize:"13px",color:"#1890ff"},children:e.func}),di.jsx("div",{style:{fontSize:"10px",color:"#666",marginTop:"2px"},children:e.desc}),di.jsx("div",{style:{fontSize:"9px",color:"#999",fontFamily:"monospace",marginTop:"2px"},children:e.example})]},e.func))})]}),di.jsxs("div",{children:[di.jsx("div",{style:{fontSize:"12px",fontWeight:"bold",marginBottom:"8px",color:"#333",borderBottom:"1px solid #f0f0f0",paddingBottom:"4px"},children:"条件函数"}),di.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:"4px"},children:[{func:"CASE",desc:"条件判断",example:"CASE WHEN condition THEN result ELSE default END"},{func:"IF",desc:"如果语句",example:"IF(condition, true_value, false_value)"},{func:"COALESCE",desc:"返回第一个非NULL值",example:"COALESCE(col1, col2, default_value)"},{func:"NULLIF",desc:"如果相等则返回NULL",example:"NULLIF(expr1, expr2)"}].map(e=>di.jsxs(E,{type:"link",size:"small",style:{textAlign:"left",height:"auto",padding:"8px",whiteSpace:"normal",fontSize:"11px",border:"1px solid #f0f0f0",borderRadius:"4px",marginBottom:"4px",width:"100%"},onClick:()=>{ie(t=>t?`${t} + ${e.func}`:e.func)},children:[di.jsx("div",{style:{fontWeight:"bold",fontSize:"13px",color:"#1890ff"},children:e.func}),di.jsx("div",{style:{fontSize:"10px",color:"#666",marginTop:"2px"},children:e.desc}),di.jsx("div",{style:{fontSize:"9px",color:"#999",fontFamily:"monospace",marginTop:"2px"},children:e.example})]},e.func))})]})]})]})}),di.jsx("div",{style:{flex:1.5,display:"flex",flexDirection:"column",gap:"16px"}}),di.jsx(D,{size:"small",title:di.jsxs("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#1890ff",display:"flex",alignItems:"center",gap:"12px",padding:"8px 0",background:"linear-gradient(90deg, #e6f7ff 0%, #bae7ff 100%)",margin:"-12px -16px 16px -16px",paddingLeft:"20px",borderBottom:"1px solid #91d5ff"},children:[di.jsx("span",{style:{display:"inline-block",width:"6px",height:"20px",backgroundColor:"#1890ff",borderRadius:"3px",boxShadow:"0 2px 4px rgba(24, 144, 255, 0.3)"}}),di.jsx("span",{style:{textShadow:"0 1px 2px rgba(24, 144, 255, 0.1)"},children:"🎯 表达式编辑器"})]}),style:{border:"2px solid #1890ff",borderRadius:"12px",boxShadow:"0 6px 16px rgba(24, 144, 255, 0.2)",background:"linear-gradient(135deg, #f6f9ff 0%, #ffffff 100%)",overflow:"hidden"},children:di.jsx(wn,{value:Q,onChange:e=>ie(e.target.value),placeholder:"🚀 在此输入表达式，或点击右侧元素快速构建...",autoSize:{minRows:16,maxRows:20},style:{fontFamily:'Monaco, Menlo, "Ubuntu Mono", monospace',fontSize:"14px",lineHeight:"1.6",backgroundColor:"#f8fbff",border:"1px solid #d9ecff",borderRadius:"8px",padding:"16px",boxShadow:"inset 0 2px 4px rgba(24, 144, 255, 0.05)",transition:"all 0.3s ease"}})}),di.jsx(D,{size:"small",title:di.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#52c41a",display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{display:"inline-block",width:"4px",height:"14px",backgroundColor:"#52c41a",borderRadius:"2px"}}),"⚡ 常用操作符"]}),style:{border:"1px solid #b7eb8f",borderRadius:"8px",background:"linear-gradient(135deg, #f6ffed 0%, #ffffff 100%)"},children:di.jsx(J,{wrap:!0,children:["+","-","*","/","(",")","=","<",">","<=",">=","<>","AND","OR","NOT","LIKE","IN","IS NULL","IS NOT NULL"].map(e=>di.jsx(E,{size:"small",onClick:()=>{ie(t=>t?`${t} ${e}`:e)},style:{fontFamily:"monospace",fontWeight:"bold"},children:e},e))})}),di.jsx(D,{size:"small",title:di.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#fa8c16",display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{display:"inline-block",width:"4px",height:"14px",backgroundColor:"#fa8c16",borderRadius:"2px"}}),"💡 常用示例"]}),style:{border:"1px solid #ffd591",borderRadius:"8px",background:"linear-gradient(135deg, #fff7e6 0%, #ffffff 100%)"},children:di.jsx("div",{style:{maxHeight:"120px",overflowY:"auto"},children:di.jsx(J,{direction:"vertical",size:"small",style:{width:"100%"},children:[{expr:"SUM(agreement_price)",desc:"求和：协议价格总和"},{expr:"AVG(unit_price)",desc:"平均值：单价平均值"},{expr:"COUNT(DISTINCT supplier_id)",desc:"去重计数：不同供应商数量"},{expr:"ROUND(amount * 0.1, 2)",desc:"计算：金额的10%并保留两位小数"}].map((e,t)=>di.jsxs(E,{type:"link",size:"small",style:{textAlign:"left",height:"auto",padding:"4px 8px",whiteSpace:"normal",width:"100%"},onClick:()=>ie(e.expr),children:[di.jsx("div",{style:{fontFamily:"monospace",fontSize:"11px",color:"#1890ff"},children:e.expr}),di.jsx("div",{style:{fontSize:"11px",color:"#666"},children:e.desc})]},t))})})})]})})})]})},group:"一期"},{title:"比价模型",to:"/price-model",icon:di.jsx(xt,{className:"h-4 w-4"}),component:()=>{var t;const[i,s]=j.useState([{id:"1",modelName:"供应商比价模型",modelCode:"mdl_vendor_compare",tags:["同品多商","历史对比"],description:"基于协议价与历史采购价格的供应商比价分析模型",enabled:!0,primaryDataset:{id:"ds_agreement_price",alias:"a",name:"协议价数据集"},attachedDatasets:[{id:"ds_po_hist",alias:"h",name:"历史采购数据集"},{id:"ds_market",alias:"m",name:"市场行情数据集"}],joins:[],fieldMapping:[],conditionInheritance:[],compareKey:["item_id","vendor_id"],analysisTarget:"vendor",analysisDimensions:["purchase_org","brand"],analysisIndicators:[],baselineCandidates:[],calculationIndicators:[],displayAttributes:[]},{id:"2",modelName:"市场行情比价模型",modelCode:"mdl_market_compare",tags:["市场对比"],description:"基于市场行情数据的价格比较分析模型",enabled:!1,primaryDataset:{id:"ds_market",alias:"m",name:"市场行情数据集"},attachedDatasets:[{id:"ds_agreement_price",alias:"a",name:"协议价数据集"}],joins:[],fieldMapping:[],conditionInheritance:[],compareKey:["item_id"],analysisTarget:"market",analysisDimensions:["brand","spec"],analysisIndicators:[],baselineCandidates:[],calculationIndicators:[],displayAttributes:[]}]),[l]=W.useForm(),[n,a]=j.useState(null),[d,r]=j.useState(!1),[o,p]=j.useState(0),[x,h]=j.useState([]),[u,f]=j.useState([]),[g,v]=j.useState([]),[b,C]=j.useState([]),[N,I]=j.useState(null),[w,S]=j.useState([]),[k,T]=j.useState([]),[_,A]=j.useState([]),[R,z]=j.useState([]),[M,O]=j.useState([]),[F,H]=j.useState(!1),[Z,te]=j.useState(!1),[ie,se]=j.useState(!1),[le,ne]=j.useState(null),[ae,de]=j.useState("all"),[re,oe]=j.useState("( ${COMPARE} - ${BASELINE} ) / NULLIF(${BASELINE},0)"),[ce,pe]=j.useState("visual"),[xe,he]=j.useState(!1),[ue,fe]=j.useState("primary"),[ge,ye]=j.useState(null),[je,ve]=j.useState([]),[be,Te]=j.useState(!1),[_e,Ae]=j.useState(!1),[Re,ze]=j.useState(!1),[Ee,Me]=j.useState(!1),[De,Oe]=j.useState(!1),[Le,Pe]=j.useState([]),[Be,Fe]=j.useState([]),[$e,Ve]=j.useState([]),[He,qe]=j.useState([]),[Ue,We]=j.useState(!1),[Ke,Ye]=j.useState([]),[Ge,Qe]=j.useState([]),[Je,Xe]=j.useState(!1),[Ze,et]=j.useState([]),[tt,it]=j.useState([]),[st,lt]=j.useState(""),nt=[{id:"ds_agreement_price",alias:"a",name:"协议价数据集"},{id:"ds_po_hist",alias:"h",name:"历史采购数据集"},{id:"ds_market",alias:"m",name:"市场行情数据集"},{id:"ds_bid",alias:"b",name:"招采中标数据集"}],at=[{value:"sku_code",label:"物料编码"},{value:"supplier_code",label:"供应商编码"},{value:"spec",label:"规格"},{value:"brand_no",label:"品牌"},{value:"purchase_org",label:"采购组织"},{value:"trade_date",label:"交易日期"},{value:"price",label:"含税单价"}],dt=[{libId:"lib.agr_price",name:"协议价",datasetAlias:"a",unit:"CNY",aggregation:"NONE"},{libId:"lib.tax_incl_price",name:"含税价",datasetAlias:"a",unit:"CNY",aggregation:"NONE"},{libId:"lib.hist_min",name:"历史最低价",datasetAlias:"h",unit:"CNY",aggregation:"MIN"},{libId:"lib.market_ref",name:"市场参考价",datasetAlias:"m",unit:"CNY",aggregation:"AVG"},{libId:"lib.bid_min",name:"中标最低价",datasetAlias:"b",unit:"CNY",aggregation:"MIN"}],rt=[{id:"attr_1",fieldCode:"sku_code",name:"物料编码",fieldType:"VARCHAR",datasetAlias:"a",field:"sku_code",displayName:"物料编码",bindField:"sku_code",attachTo:["协议价"],dedupe:{type:"保留最新",orderBy:"trade_date DESC"}},{id:"attr_2",fieldCode:"supplier_name",name:"供应商名称",fieldType:"VARCHAR",datasetAlias:"a",field:"supplier_name",displayName:"供应商名称",bindField:"supplier_name",attachTo:["协议价","含税价"],dedupe:{type:"保留最新"}},{id:"attr_3",fieldCode:"brand_no",name:"品牌",fieldType:"VARCHAR",datasetAlias:"a",field:"brand_no",displayName:"品牌",bindField:"brand_no",attachTo:["协议价"],dedupe:{type:"保留最新"}},{id:"attr_4",fieldCode:"purchase_org",name:"采购组织",fieldType:"VARCHAR",datasetAlias:"a",field:"purchase_org",displayName:"采购组织",bindField:"purchase_org",attachTo:["协议价","含税价"],dedupe:{type:"保留最新"}},{id:"attr_5",fieldCode:"trade_date",name:"交易日期",fieldType:"DATE",datasetAlias:"h",field:"trade_date",displayName:"交易日期",bindField:"trade_date",attachTo:["历史最低价"],dedupe:{type:"保留最新",orderBy:"trade_date DESC"}}],ot=[{id:"qc_1",fieldCode:"sku_code",fieldName:"物料编码",componentType:"弹框多选"},{id:"qc_2",fieldCode:"supplier_code",fieldName:"供应商编码",componentType:"弹框单选"},{id:"qc_3",fieldCode:"purchase_org",fieldName:"采购组织",componentType:"下拉单选"},{id:"qc_4",fieldCode:"trade_date",fieldName:"交易日期",componentType:"日期"},{id:"qc_5",fieldCode:"create_time",fieldName:"创建时间",componentType:"时间"}],ct=[{title:"基本信息",description:"模型名称、编码等基础信息"},{title:"选择数据集",description:"选择主数据集、基准数据集"},{title:"设置比价对象",description:"比价对象、比价指标、比价维度、属性显示"},{title:"设置基准对象",description:"基准指标"},{title:"设置计算指标",description:"衍生指标库，配置计算指标"},{title:"预览与校验",description:"SQL预览和配置校验"}],mt=e=>{r(!0),a(e),p(0),l.setFieldsValue(e);const t=(e.attachedDatasets||[]).map(e=>({id:Date.now().toString()+Math.random(),datasetId:e.id,datasetName:e.name,alias:e.alias,joinType:"LEFT",joinConditions:[],joinPreview:""}));h(t),f(e.joins||[]),v(e.fieldMapping||[]),C(e.conditionInheritance||[]),S(e.analysisIndicators||[]),T(e.baselineCandidates||[]),z(e.calculationIndicators||[]),A(e.displayAttributes||[])},pt=()=>y(e,null,function*(){try{const e=yield l.validateFields(),t=m(c({},e),{id:(null==n?void 0:n.id)||Date.now().toString(),attachedDatasets:x,joins:u,fieldMapping:g,conditionInheritance:b,analysisIndicators:w,baselineCandidates:k,calculationIndicators:R,displayAttributes:_});s(n?i.map(e=>e.id===n.id?t:e):[...i,t]),r(!1),a(null)}catch(e){}}),xt=()=>{o<ct.length-1&&p(o+1)},ht=()=>{o>0&&p(o-1)},ut=()=>{r(!1),a(null),p(0),l.resetFields()},ft=e=>{"primary"===ue?e&&l.setFieldsValue({primaryDataset:{id:e.id,name:e.name,alias:e.alias}}):je.forEach(e=>{gt(e)}),H(!1),ye(null),ve([])},gt=e=>{if(!x.find(t=>t.datasetId===e.id)){const t={id:Date.now().toString()+Math.random(),datasetId:e.id,datasetName:e.name,alias:e.alias,joinType:"LEFT",joinConditions:[],joinPreview:""};h([...x,t])}H(!1)},yt=()=>{var e;switch(o){case 0:return di.jsxs(D,{title:"基本信息",children:[di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:12,children:di.jsx(W.Item,{label:"模型名称",name:"modelName",rules:[{required:!0,message:"请输入模型名称"}],children:di.jsx(U,{placeholder:"请输入模型名称"})})}),di.jsx(P,{span:12,children:di.jsx(W.Item,{label:"模型编码",name:"modelCode",rules:[{required:!0,message:"请输入模型编码"}],children:di.jsx(U,{placeholder:"mdl_vendor_compare"})})})]}),di.jsx(W.Item,{label:"标签",name:"tags",children:di.jsxs(q,{mode:"tags",placeholder:"添加标签",children:[di.jsx(Gn,{value:"同品多商",children:"同品多商"}),di.jsx(Gn,{value:"历史对比",children:"历史对比"})]})}),di.jsx(W.Item,{label:"描述",name:"description",children:di.jsx(Yn,{rows:3,placeholder:"请输入模型描述"})}),di.jsx(W.Item,{label:"启用",name:"enabled",valuePropName:"checked",initialValue:!0,children:di.jsx(ke,{})}),di.jsx($,{message:"提示：模型定义结构与标准，计算公式与基准选择将在比价方案里配置。",type:"info",showIcon:!0,style:{marginTop:16}})]});case 1:return di.jsxs(D,{title:"选择数据集",children:[di.jsx(D,{size:"small",title:di.jsx(Kn,{strong:!0,children:"比价数据集"}),style:{marginBottom:16},bodyStyle:{padding:"16px"},children:di.jsxs(L,{gutter:16,align:"middle",children:[di.jsx(P,{span:3,children:di.jsx(Kn,{children:"选择比价数据集"})}),di.jsx(P,{span:9,children:di.jsx(W.Item,{name:["primaryDataset","id"],rules:[{required:!0,message:"请选择比价数据集"}],style:{margin:0},children:di.jsx(E,{style:{width:"100%",textAlign:"left"},onClick:()=>{H(!0),fe("primary")},children:l.getFieldValue(["primaryDataset","id"])?null==(e=nt.find(e=>e.id===l.getFieldValue(["primaryDataset","id"])))?void 0:e.name:"选择比价数据集"})})}),di.jsx(P,{span:2,children:di.jsx(Kn,{children:"别名"})}),di.jsx(P,{span:10,children:di.jsx(W.Item,{name:["primaryDataset","alias"],rules:[{required:!0,message:"请输入别名"},{pattern:/^[a-zA-Z][a-zA-Z0-9_]*$/,message:"别名必须以字母开头，只能包含字母、数字和下划线"}],style:{margin:0},children:di.jsx(U,{placeholder:"输入别名",onChange:e=>{const t=e.target.value,i=l.getFieldValue(["primaryDataset","id"]);i&&I({datasetId:i,alias:t})}})})})]})}),di.jsxs("div",{style:{marginTop:16,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[di.jsx(Kn,{strong:!0,children:"基准数据集"}),di.jsx(E,{type:"dashed",icon:di.jsx(K,{}),onClick:()=>{H(!0),fe("attached")},children:"选择基准数据集"})]}),x.length>0&&di.jsx("div",{style:{marginTop:16},children:di.jsx(Y,{dataSource:x,rowKey:"id",pagination:!1,size:"small",style:{marginTop:8},columns:[{title:"基准数据集名称",dataIndex:"datasetName",key:"datasetName",width:200},{title:"数据集别名",key:"alias",width:150,render:(e,t)=>di.jsx(U,{value:t.alias,placeholder:"输入别名",onChange:e=>{const i=x.map(i=>i.id===t.id?m(c({},i),{alias:e.target.value}):i);h(i)}})},{title:"连接类型",key:"joinType",width:120,render:(e,t)=>di.jsxs(q,{value:t.joinType,style:{width:"100%"},onChange:e=>{const i=x.map(i=>i.id===t.id?m(c({},i),{joinType:e}):i);h(i)},children:[di.jsx(Gn,{value:"INNER",children:"INNER JOIN"}),di.jsx(Gn,{value:"LEFT",children:"LEFT JOIN"}),di.jsx(Gn,{value:"RIGHT",children:"RIGHT JOIN"})]})},{title:"关联条件",key:"joinConditions",width:200,render:(e,t)=>di.jsx(q,{mode:"multiple",value:t.joinConditions,placeholder:"选择关联字段",style:{width:"100%"},onChange:e=>{const i=e.map(e=>`a.${e} = ${t.alias}.${e}`).join(" AND "),s=x.map(s=>s.id===t.id?m(c({},s),{joinConditions:e,joinPreview:i}):s);h(s)},children:at.map(e=>di.jsxs(Gn,{value:e.value,children:[e.label," (",e.value,")"]},e.value))})},{title:"关联条件预览",key:"joinPreview",width:250,render:(e,t)=>di.jsx(Kn,{code:!0,style:{fontSize:"12px"},children:t.joinPreview||"请选择关联条件"})},{title:"操作",key:"action",width:120,render:(e,t)=>di.jsxs(J,{size:"small",children:[di.jsx(E,{type:"link",size:"small",children:"校验"}),di.jsx(E,{type:"link",size:"small",danger:!0,onClick:()=>(e=>{const t=x.find(t=>t.id===e);h(x.filter(t=>t.id!==e)),t&&f(u.filter(e=>e.targetAlias!==t.alias))})(t.id),children:"删除"})]})}]})})]});case 2:return di.jsxs(D,{title:"比价对象设置",children:[di.jsx(W.Item,{label:"请选择比价对象",name:"compareKey",rules:[{required:!0,message:"请选择比价对象字段"}],style:{marginBottom:24},children:di.jsx(q,{mode:"multiple",placeholder:"选择比价对象字段（相同产品或者同类产品，比一个或者多个字段）",children:at.map(e=>di.jsxs(Gn,{value:e.value,children:[e.value," | ",e.label]},e.value))})}),di.jsx(V,{}),di.jsxs("div",{style:{marginBottom:24},children:[di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[di.jsx(Kn,{strong:!0,children:"比价指标（来自指标库，数据范围为映射了主数据集的指标）"}),di.jsx(E,{type:"dashed",icon:di.jsx(K,{}),onClick:()=>Ae(!0),children:"选择比价指标"})]}),w.length>0&&di.jsx(Y,{size:"small",dataSource:w,pagination:!1,rowKey:"libId",columns:[{title:"指标编码",dataIndex:"libId",key:"libId",width:150},{title:"指标名称",dataIndex:"name",key:"name",width:120},{title:"关联数据集",dataIndex:"datasetAlias",key:"datasetAlias",width:100,render:e=>{const t=nt.find(t=>t.alias===e);return t?`${t.name}(${e})`:e}},{title:"关联字段",key:"field",width:100,render:()=>"price"},{title:"聚合类型",dataIndex:"aggregation",key:"aggregation",width:100},{title:"指标单位",dataIndex:"unit",key:"unit",width:80},{title:"操作",key:"action",width:80,render:(e,t)=>di.jsx(E,{type:"link",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{S(e=>e.filter(e=>e.libId!==t.libId))},children:"删除"})}]})]}),di.jsx(V,{}),di.jsxs("div",{style:{marginBottom:24},children:[di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[di.jsx(Kn,{strong:!0,children:"比价维度（横向对比的主维度）"}),di.jsx(E,{type:"dashed",icon:di.jsx(K,{}),onClick:()=>he(!0),children:"选择比价维度"})]}),M.length>0&&di.jsx("div",{style:{marginTop:8},children:M.map((e,t)=>di.jsx(B,{closable:!0,onClose:()=>{O(e=>e.filter((e,i)=>i!==t))},style:{marginBottom:4,marginRight:4},children:e},t))}),0===M.length&&di.jsx("div",{style:{color:"#999",fontSize:"12px",marginTop:4},children:"请选择比价维度字段"})]}),di.jsx(V,{}),di.jsxs("div",{children:[di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[di.jsx(Kn,{strong:!0,children:"显示属性（用于报表展示的附加字段，不参与聚合）"}),di.jsx(E,{type:"dashed",icon:di.jsx(K,{}),onClick:()=>Oe(!0),children:"新增显示属性"})]}),_.length>0&&di.jsx(Y,{dataSource:_,rowKey:"id",pagination:!1,size:"small",style:{marginBottom:16},columns:[{title:"字段编码",dataIndex:"field",key:"field",width:120},{title:"字段名称",dataIndex:"name",key:"name",width:150},{title:"显示名称",dataIndex:"displayName",key:"displayName",width:150,render:(e,t,i)=>di.jsx(U,{value:e,onChange:e=>{const t=[..._];t[i].displayName=e.target.value,A(t)},size:"small"})},{title:"绑定字段",dataIndex:"bindField",key:"bindField",width:150,render:(e,t,i)=>di.jsxs(q,{value:e,onChange:e=>{const t=[..._];t[i].bindField=e,A(t)},size:"small",style:{width:"100%"},placeholder:"选择绑定字段",children:[di.jsx(Gn,{value:"price",children:"price"}),di.jsx(Gn,{value:"name",children:"name"}),di.jsx(Gn,{value:"category",children:"category"}),di.jsx(Gn,{value:"brand",children:"brand"})]})},{title:"操作",key:"action",width:80,render:(e,t,i)=>di.jsx(E,{type:"link",danger:!0,size:"small",onClick:()=>{const e=_.filter((e,t)=>t!==i);A(e)},children:"删除"})}]}),di.jsx($,{message:"说明：属性显示只做附加列，不参与聚合与计算，不改变汇总粒度。",type:"info",showIcon:!0,style:{marginTop:8}})]}),di.jsx(V,{}),di.jsxs("div",{children:[di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[di.jsx(Kn,{strong:!0,children:"查询条件配置"}),di.jsx(E,{type:"dashed",icon:di.jsx(K,{}),onClick:()=>We(!0),children:"添加查询条件"})]}),Ge.length>0&&di.jsx(Y,{dataSource:Ge,rowKey:"id",pagination:!1,size:"small",style:{marginBottom:16},columns:[{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:120},{title:"字段名称",dataIndex:"fieldName",key:"fieldName",width:150},{title:"组件类型",dataIndex:"componentType",key:"componentType",width:150,render:(e,t,i)=>di.jsxs(q,{value:e,onChange:e=>{const t=[...Ge];t[i].componentType=e,Qe(t)},size:"small",style:{width:"100%"},children:[di.jsx(Gn,{value:"弹框单选",children:"弹框单选"}),di.jsx(Gn,{value:"弹框多选",children:"弹框多选"}),di.jsx(Gn,{value:"下拉单选",children:"下拉单选"}),di.jsx(Gn,{value:"日期",children:"日期"}),di.jsx(Gn,{value:"时间",children:"时间"})]})},{title:"操作",key:"action",width:80,render:(e,t,i)=>di.jsx(E,{type:"link",danger:!0,size:"small",onClick:()=>{const e=Ge.filter((e,t)=>t!==i);Qe(e)},children:"删除"})}]}),di.jsx($,{message:"说明：查询条件配置用于生成前端查询界面的筛选条件组件。",type:"info",showIcon:!0,style:{marginTop:8}})]})]});case 3:return di.jsxs(D,{title:"选择基准对象",children:[di.jsxs("div",{children:[di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[di.jsx(Kn,{strong:!0,children:"基准指标（从关联基准数据集的指标库中选择）"}),di.jsx(E,{type:"dashed",icon:di.jsx(K,{}),onClick:()=>Me(!0),children:"选择基准指标"})]}),k.length>0&&di.jsx(Y,{size:"small",dataSource:k,pagination:!1,rowKey:"libId",columns:[{title:"指标编码",dataIndex:"libId",key:"libId",width:150},{title:"指标名称",dataIndex:"name",key:"name",width:120},{title:"关联数据集",dataIndex:"datasetAlias",key:"datasetAlias",width:100,render:e=>{const t=nt.find(t=>t.alias===e);return t?`${t.name}(${e})`:e}},{title:"关联字段",key:"field",width:100,render:()=>"price"},{title:"聚合类型",dataIndex:"aggregation",key:"aggregation",width:100},{title:"指标单位",dataIndex:"unit",key:"unit",width:80},{title:"操作",key:"action",width:80,render:(e,t)=>di.jsx(E,{type:"link",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{T(e=>e.filter(e=>e.libId!==t.libId))},children:"删除"})}]})]}),di.jsx($,{message:"说明：基准候选支持多选和全选，指标来自指标库，数据范围为映射了辅助数据集的指标。",type:"info",showIcon:!0,style:{marginTop:16}}),di.jsx(V,{}),di.jsxs("div",{children:[di.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:di.jsx(Kn,{strong:!0,children:"基准查询条件配置"})}),0===k.length?di.jsx($,{message:"请先选择基准指标，然后为每个基准指标配置查询条件",type:"warning",showIcon:!0,style:{marginBottom:16}}):di.jsx("div",{children:k.map((e,t)=>{const i=tt.filter(t=>t.baselineIndicatorId===e.libId);return di.jsx(D,{size:"small",style:{marginBottom:16},title:di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[di.jsxs("span",{children:[e.name," (",e.libId,")"]}),di.jsx(E,{type:"dashed",size:"small",icon:di.jsx(K,{}),onClick:()=>{lt(e.libId),Xe(!0)},children:"添加查询条件"})]}),children:i.length>0?di.jsx(Y,{dataSource:i,rowKey:"id",pagination:!1,size:"small",columns:[{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:120},{title:"字段名称",dataIndex:"fieldName",key:"fieldName",width:150},{title:"组件类型",dataIndex:"componentType",key:"componentType",width:150,render:(e,t,i)=>{const s=tt.findIndex(e=>e.id===t.id);return di.jsxs(q,{value:e,onChange:e=>{const t=[...tt];t[s].componentType=e,it(t)},size:"small",style:{width:"100%"},children:[di.jsx(Gn,{value:"弹框单选",children:"弹框单选"}),di.jsx(Gn,{value:"弹框多选",children:"弹框多选"}),di.jsx(Gn,{value:"下拉单选",children:"下拉单选"}),di.jsx(Gn,{value:"日期",children:"日期"}),di.jsx(Gn,{value:"时间",children:"时间"})]})}},{title:"操作",key:"action",width:80,render:(e,t)=>di.jsx(E,{type:"link",danger:!0,size:"small",onClick:()=>{const e=tt.filter(e=>e.id!==t.id);it(e)},children:"删除"})}]}):di.jsx("div",{style:{textAlign:"center",color:"#999",padding:"20px 0"},children:"暂无查询条件，点击上方按钮添加"})},e.libId)})}),di.jsx($,{message:"说明：为每个基准指标配置查询条件，用于在查询时筛选对应的基准数据。",type:"info",showIcon:!0,style:{marginTop:8}})]})]});case 4:return di.jsx(D,{title:"设置计算指标",children:di.jsxs("div",{style:{marginBottom:16},children:[di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[di.jsx(Kn,{strong:!0,children:"计算指标列表（衍生指标库）"}),di.jsxs(J,{children:[di.jsx(E,{type:"primary",icon:di.jsx(K,{}),onClick:()=>{ne(null),se(!0)},children:"新增计算指标"}),di.jsx(E,{icon:di.jsx(Se,{}),children:"复制"}),di.jsx(E,{children:"导入/导出"})]})]}),R.length>0?di.jsx(Y,{dataSource:R,rowKey:"id",pagination:!1,size:"small",columns:[{title:"指标ID",dataIndex:"indicatorId",key:"indicatorId",width:120},{title:"名称",dataIndex:"name",key:"name",width:120},{title:"绑定基准",dataIndex:"bindBaseline",key:"bindBaseline",width:100,render:(e,t)=>"all"===e?"全部":"specific"===e&&t.specificBaselines?t.specificBaselines.join(", "):"-"},{title:"数据类型",dataIndex:"dataType",key:"dataType",width:80},{title:"单位",dataIndex:"unit",key:"unit",width:60},{title:"小数位",dataIndex:"decimalPlaces",key:"decimalPlaces",width:60},{title:"启用",dataIndex:"enabled",key:"enabled",width:60,render:(e,t)=>di.jsx(ke,{checked:e,size:"small",onChange:e=>{const i=R.map(i=>i.id===t.id?m(c({},i),{enabled:e}):i);z(i)}})},{title:"操作",key:"action",width:120,render:(e,t)=>di.jsxs(J,{size:"small",children:[di.jsx(E,{type:"link",size:"small",icon:di.jsx(X,{}),onClick:()=>{ne(t),se(!0)},children:"编辑"}),di.jsx(E,{type:"link",size:"small",icon:di.jsx(Se,{}),children:"复制"}),di.jsx(E,{type:"link",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{const e=R.filter(e=>e.id!==t.id);z(e)},children:"删除"})]})}]}):di.jsx("div",{style:{textAlign:"center",padding:"40px 0",color:"#999"},children:'暂无计算指标，点击上方"新增计算指标"按钮开始配置'}),di.jsx($,{message:"说明：计算指标是基于参与侧指标和基准侧指标的衍生指标，支持自定义公式计算。配置后的指标将成为模型的标准字段。",type:"info",showIcon:!0,style:{marginTop:16}})]})});case 5:return di.jsxs(D,{title:"预览与校验",children:[di.jsxs("div",{style:{marginBottom:24},children:[di.jsx(Kn,{strong:!0,children:"校验结果："}),di.jsxs("div",{style:{marginTop:8},children:[di.jsxs("div",{style:{marginBottom:8},children:[di.jsx(we,{style:{color:"#52c41a",marginRight:8}}),di.jsx(Kn,{children:"分析指标均来自主数据集"})]}),di.jsxs("div",{style:{marginBottom:8},children:[di.jsx(we,{style:{color:"#52c41a",marginRight:8}}),di.jsx(Kn,{children:"基准候选均绑定基准数据集"})]}),di.jsxs("div",{style:{marginBottom:8},children:[di.jsx(we,{style:{color:"#52c41a",marginRight:8}}),di.jsx(Kn,{children:"比价对象键可解析"})]}),di.jsxs("div",{style:{marginBottom:8},children:[di.jsx(we,{style:{color:"#52c41a",marginRight:8}}),di.jsx(Kn,{children:"显示属性正确挂载到对象粒度"})]})]})]}),di.jsxs("div",{children:[di.jsx(Kn,{strong:!0,children:"SQL预览："}),di.jsx("div",{style:{marginTop:8,padding:16,backgroundColor:"#f5f5f5",borderRadius:4},children:di.jsx("pre",{style:{margin:0,fontSize:12},children:"SELECT \n  a.item_id,\n  a.spec,\n  a.brand,\n  a.vendor_id,\n  a.price as agreement_price,\n  h.min_price as hist_min_price,\n  m.ref_price as market_ref_price\nFROM ds_agreement_price a\nLEFT JOIN ds_po_hist h ON a.item_id = h.item_id AND a.spec = h.spec AND a.brand = h.brand\nLEFT JOIN ds_market m ON a.item_id = m.item_id AND a.brand = m.brand\nWHERE a.trade_date >= '2024-01-01'\nGROUP BY a.item_id, a.spec, a.brand, a.vendor_id"})})]})]});default:return null}};return d?di.jsxs("div",{style:{padding:"24px"},children:[di.jsxs("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[di.jsx(E,{icon:di.jsx(Ce,{}),onClick:ut,children:"返回"}),di.jsxs(Wn,{level:2,style:{margin:0},children:["比价模型2 · ",n?"编辑":"新建"]}),di.jsx(B,{color:"orange",children:"草稿"})]}),di.jsxs(J,{children:[di.jsx(E,{type:"primary",icon:di.jsx(Tl,{}),onClick:pt,children:"保存"}),di.jsx(E,{icon:di.jsx(Ml,{}),children:"发布"})]})]}),di.jsx(Q,{current:o,items:ct,style:{marginBottom:24}}),di.jsxs(W,{form:l,layout:"vertical",style:{maxWidth:"1200px"},children:[yt(),di.jsx("div",{style:{textAlign:"right",marginTop:24},children:di.jsxs(J,{children:[o>0&&di.jsx(E,{icon:di.jsx(Ce,{}),onClick:ht,children:"上一步"}),o<ct.length-1&&di.jsx(E,{type:"primary",icon:di.jsx(Ne,{}),onClick:xt,children:"下一步"}),o===ct.length-1&&di.jsx(E,{type:"primary",icon:di.jsx(Tl,{}),onClick:pt,children:"保存模型"})]})})]}),di.jsxs(G,{title:"primary"===ue?"选择比价数据集":"选择基准数据集",open:F,onCancel:()=>{H(!1),ye(null),ve([])},onOk:()=>{"primary"===ue?ge&&ft(ge):je.length>0&&ft()},okText:"确认添加",cancelText:"取消",width:800,children:[di.jsxs("div",{style:{marginBottom:16},children:["从数据模型中选择要添加的数据集（已选择 ","primary"===ue?ge?1:0:je.length," 个数据集）："]}),di.jsx(Y,{dataSource:"primary"===ue?nt:nt.filter(e=>!x.find(t=>t.datasetId===e.id)),rowKey:"id",pagination:!1,size:"small",rowSelection:{type:"primary"===ue?"radio":"checkbox",selectedRowKeys:"primary"===ue?ge?[ge.id]:[]:je.map(e=>e.id),onSelect:(e,t)=>{"primary"===ue?ye(t?e:null):ve(t?t=>[...t,e]:t=>t.filter(t=>t.id!==e.id))},onSelectAll:"attached"===ue?(e,t,i)=>{if(e)ve(e=>{const t=e.map(e=>e.id),s=i.filter(e=>!t.includes(e.id));return[...e,...s]});else{const e=i.map(e=>e.id);ve(t=>t.filter(t=>!e.includes(t.id)))}}:void 0},columns:[{title:"数据集名称",dataIndex:"name",key:"name",width:200},{title:"数据集编码",dataIndex:"id",key:"id",width:150},{title:"来源模型",key:"sourceModel",width:150,render:()=>"DWD层数据模型"},{title:"分析主题",key:"analysis",width:120,render:(e,t)=>di.jsx(B,{color:"green",children:{ds_agreement_price:"采购比价分析",ds_po_hist:"供应商绩效分析",ds_market:"历史价格趋势分析",ds_bid:"历史价格趋势分析"}[t.id]||"供应商价格分析"})}]})]}),di.jsx(G,{title:"新增对齐",open:be,onCancel:()=>Te(!1),onOk:()=>{const e={id:Date.now().toString(),targetAlias:"h",type:"LEFT",on:"a.item_id = h.item_id",uniqueCheck:!0};f([...u,e]),Te(!1)},width:600,children:di.jsxs(W,{layout:"vertical",children:[di.jsx(W.Item,{label:"目标数据集",required:!0,children:di.jsx(q,{placeholder:"选择目标数据集",children:x.map(e=>di.jsxs(Gn,{value:e.alias,children:[e.datasetName," (",e.alias,")"]},e.id))})}),di.jsx(W.Item,{label:"连接类型",required:!0,children:di.jsxs(Ie.Group,{defaultValue:"LEFT",children:[di.jsx(Ie,{value:"LEFT",children:"LEFT JOIN"}),di.jsx(Ie,{value:"RIGHT",children:"RIGHT JOIN"}),di.jsx(Ie,{value:"INNER",children:"INNER JOIN"})]})}),di.jsx(W.Item,{label:"ON条件",required:!0,children:di.jsx(U.TextArea,{placeholder:"例如: a.item_id = h.item_id AND a.vendor_id = h.vendor_id",rows:3})}),di.jsx(W.Item,{children:di.jsx(me,{defaultChecked:!0,children:"校验唯一性"})})]})}),di.jsx(G,{title:"选择比价指标",open:_e,onCancel:()=>{Ae(!1),Pe([])},onOk:()=>{const e=dt.filter(e=>Le.includes(e.libId)).map(e=>({libId:e.libId,name:e.name,datasetAlias:e.datasetAlias,unit:e.unit,aggregation:e.aggregation}));S([...w,...e]),Ae(!1),Pe([])},width:800,children:di.jsx(Y,{dataSource:dt,rowKey:"libId",pagination:!1,size:"small",rowSelection:{type:"checkbox",selectedRowKeys:Le,onChange:e=>{Pe(e)}},columns:[{title:"指标名称",dataIndex:"name",key:"name",width:200},{title:"指标ID",dataIndex:"libId",key:"libId",width:150},{title:"数据集",dataIndex:"datasetAlias",key:"datasetAlias",width:100},{title:"单位",dataIndex:"unit",key:"unit",width:80},{title:"聚合方式",dataIndex:"aggregation",key:"aggregation",width:100}]})}),di.jsx(G,{title:"选择基准指标",open:Ee,onCancel:()=>{Me(!1),Fe([])},onOk:()=>{const e=dt.filter(e=>Be.includes(e.libId)).filter(e=>x.some(t=>t.alias===e.datasetAlias)).map(e=>({libId:e.libId,name:e.name,datasetAlias:e.datasetAlias,unit:e.unit,aggregation:e.aggregation}));T([...k,...e]),Me(!1),Fe([])},width:800,children:di.jsx(Y,{dataSource:dt.filter(e=>x.some(t=>t.alias===e.datasetAlias)),rowKey:"libId",pagination:!1,size:"small",rowSelection:{type:"checkbox",selectedRowKeys:Be,onChange:e=>{Fe(e)}},columns:[{title:"指标名称",dataIndex:"name",key:"name",width:200},{title:"指标ID",dataIndex:"libId",key:"libId",width:150},{title:"数据集",dataIndex:"datasetAlias",key:"datasetAlias",width:100},{title:"单位",dataIndex:"unit",key:"unit",width:80},{title:"聚合方式",dataIndex:"aggregation",key:"aggregation",width:100}]})}),di.jsx(G,{title:"新增显示属性",open:De,onCancel:()=>{Oe(!1),Ve([])},onOk:()=>{const e=rt.filter(e=>$e.includes(e.id)).map(e=>({id:e.id,name:e.name,datasetAlias:e.datasetAlias,field:e.field,displayName:e.displayName,bindField:e.bindField,attachTo:e.attachTo,dedupe:e.dedupe}));A([..._,...e]),Oe(!1),Ve([])},width:800,children:di.jsx(Y,{dataSource:rt,rowKey:"id",pagination:!1,size:"small",rowSelection:{type:"checkbox",selectedRowKeys:$e,onChange:e=>{Ve(e)},onSelectAll:(e,t,i)=>{Ve(e?rt.map(e=>e.id):[])}},columns:[{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:150},{title:"字段名称",dataIndex:"name",key:"name",width:150},{title:"字段类型",dataIndex:"fieldType",key:"fieldType",width:120}]})}),di.jsx(G,{title:"添加查询条件",open:Ue,onCancel:()=>{We(!1),Ye([])},onOk:()=>{const e=ot.filter(e=>Ke.includes(e.id)).map(e=>({id:e.id,fieldCode:e.fieldCode,fieldName:e.fieldName,componentType:e.componentType}));Qe([...Ge,...e]),We(!1),Ye([])},width:800,children:di.jsx(Y,{dataSource:ot,rowKey:"id",pagination:!1,size:"small",rowSelection:{type:"checkbox",selectedRowKeys:Ke,onChange:e=>{Ye(e)},onSelectAll:(e,t,i)=>{Ye(e?ot.map(e=>e.id):[])}},columns:[{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:150},{title:"字段名称",dataIndex:"fieldName",key:"fieldName",width:150},{title:"组件类型",dataIndex:"componentType",key:"componentType",width:120}]})}),di.jsx(G,{title:`为基准指标配置查询条件 - ${(null==(t=k.find(e=>e.libId===st))?void 0:t.name)||""}`,open:Je,onCancel:()=>{Xe(!1),et([])},onOk:()=>{const e=ot.filter(e=>Ze.includes(e.id)).map(e=>({id:(Date.now()+Math.random()).toString(),baselineIndicatorId:st,fieldCode:e.fieldCode,fieldName:e.fieldName,componentType:e.componentType}));it([...tt,...e]),Xe(!1),et([])},width:800,children:di.jsx(Y,{dataSource:ot,rowKey:"id",pagination:!1,size:"small",rowSelection:{type:"checkbox",selectedRowKeys:Ze,onChange:e=>{et(e)},onSelectAll:(e,t,i)=>{et(e?ot.map(e=>e.id):[])}},columns:[{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:150},{title:"字段名称",dataIndex:"fieldName",key:"fieldName",width:150},{title:"组件类型",dataIndex:"componentType",key:"componentType",width:120}]})}),di.jsxs(G,{title:"选择比价维度",open:xe,onOk:()=>{const e=He.filter(e=>!M.includes(e));O(t=>[...t,...e]),he(!1),qe([])},onCancel:()=>{he(!1),qe([])},width:800,children:[di.jsx("div",{style:{marginBottom:16},children:di.jsx(me,{indeterminate:He.length>0&&He.length<at.length,checked:He.length===at.length,onChange:e=>{e.target.checked?qe(at.map(e=>e.value)):qe([])},children:"全选"})}),di.jsx(Y,{dataSource:at,rowKey:"value",pagination:!1,size:"small",rowSelection:{type:"checkbox",selectedRowKeys:He,onChange:e=>{qe(e)}},columns:[{title:"字段名称",dataIndex:"value",key:"value",width:150},{title:"字段描述",dataIndex:"label",key:"label",width:200},{title:"数据类型",key:"type",width:100,render:()=>"VARCHAR"}]})]}),di.jsx(G,{title:le?"编辑计算指标":"新增计算指标",open:ie,onCancel:()=>{se(!1),ne(null),de("all"),oe("( ${COMPARE} - ${BASELINE} ) / NULLIF(${BASELINE},0)"),pe("visual")},onOk:()=>{const e={id:(null==le?void 0:le.id)||Date.now().toString(),indicatorId:(null==le?void 0:le.indicatorId)||"ind_diff_rate",name:(null==le?void 0:le.name)||"差异率",description:(null==le?void 0:le.description)||"协议价相对基准价的差异比例",tags:(null==le?void 0:le.tags)||["价格对比"],bindBaseline:(null==le?void 0:le.bindBaseline)||"all",specificBaselines:null==le?void 0:le.specificBaselines,participantIndicator:(null==le?void 0:le.participantIndicator)||"ind_agreement_price",baselineIndicator:(null==le?void 0:le.baselineIndicator)||"ind_hist_min",formula:(null==le?void 0:le.formula)||"( ${COMPARE} - ${BASELINE} ) / NULLIF(${BASELINE},0)",dataType:(null==le?void 0:le.dataType)||"number",unit:(null==le?void 0:le.unit)||"%",decimalPlaces:(null==le?void 0:le.decimalPlaces)||4,formatType:(null==le?void 0:le.formatType)||"percentage",nullHandling:(null==le?void 0:le.nullHandling)||"null",customNullValue:null==le?void 0:le.customNullValue,negativeClipping:(null==le?void 0:le.negativeClipping)||"none",rangeMin:null==le?void 0:le.rangeMin,rangeMax:null==le?void 0:le.rangeMax,errorMarking:(null==le?void 0:le.errorMarking)||!0,enabled:void 0===(null==le?void 0:le.enabled)||le.enabled,versionNote:(null==le?void 0:le.versionNote)||"初始版本"};if(le){const t=R.map(t=>t.id===le.id?e:t);z(t)}else z(t=>[...t,e]);se(!1),ne(null)},okText:"保存",cancelText:"取消",width:1e3,style:{top:20},children:di.jsxs("div",{style:{display:"flex",gap:"24px",height:"600px"},children:[di.jsx("div",{style:{flex:1,overflowY:"auto",paddingRight:"12px"},children:di.jsxs(W,{layout:"vertical",children:[di.jsxs("div",{style:{marginBottom:"24px"},children:[di.jsx(Kn,{strong:!0,style:{fontSize:"16px",color:"#1890ff"},children:"① 基本信息"}),di.jsxs("div",{style:{marginTop:"12px"},children:[di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:12,children:di.jsx(W.Item,{label:"指标ID",required:!0,children:di.jsx(U,{placeholder:"ind_diff_rate",defaultValue:(null==le?void 0:le.indicatorId)||"ind_diff_rate"})})}),di.jsx(P,{span:12,children:di.jsx(W.Item,{label:"名称",required:!0,children:di.jsx(U,{placeholder:"差异率",defaultValue:(null==le?void 0:le.name)||"差异率"})})})]}),di.jsx(W.Item,{label:"描述",children:di.jsx(Yn,{rows:2,placeholder:"协议价相对基准价的差异比例",defaultValue:(null==le?void 0:le.description)||"协议价相对基准价的差异比例"})}),di.jsx(W.Item,{label:"标签",children:di.jsxs(q,{mode:"tags",placeholder:"添加标签",defaultValue:(null==le?void 0:le.tags)||["价格对比"],style:{width:"100%"},children:[di.jsx(Gn,{value:"价格对比",children:"价格对比"}),di.jsx(Gn,{value:"监控",children:"监控"}),di.jsx(Gn,{value:"分析",children:"分析"})]})})]})]}),di.jsxs("div",{style:{marginBottom:"24px"},children:[di.jsx(Kn,{strong:!0,style:{fontSize:"16px",color:"#1890ff"},children:"② 绑定范围"}),di.jsxs("div",{style:{marginTop:"12px"},children:[di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:12,children:di.jsx(W.Item,{label:"绑定基准",required:!0,children:di.jsxs(Ie.Group,{value:ae,style:{width:"100%"},onChange:e=>{de(e.target.value)},children:[di.jsx(Ie,{value:"all",children:"全部基准"}),di.jsx(Ie,{value:"specific",children:"指定基准"})]})})}),di.jsx(P,{span:12,children:di.jsx(W.Item,{label:"数据类型",required:!0,children:di.jsxs(q,{defaultValue:(null==le?void 0:le.dataType)||"number",children:[di.jsx(Gn,{value:"number",children:"数值"}),di.jsx(Gn,{value:"string",children:"文本"}),di.jsx(Gn,{value:"boolean",children:"布尔"})]})})})]}),"specific"===ae&&di.jsx(W.Item,{label:"选择基准",required:!0,children:di.jsxs(q,{mode:"multiple",placeholder:"请选择要绑定的基准",defaultValue:(null==le?void 0:le.specificBaselines)||[],style:{width:"100%"},children:[di.jsx(Gn,{value:"baseline_hist_min",children:"历史最低价"}),di.jsx(Gn,{value:"baseline_market_ref",children:"市场参考价"}),di.jsx(Gn,{value:"baseline_bid_min",children:"中标最低价"}),di.jsx(Gn,{value:"baseline_avg_price",children:"平均价格"})]})}),di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:12,children:di.jsx(W.Item,{label:"参与侧指标",required:!0,children:di.jsxs(q,{placeholder:"从主数据集原子指标选择",defaultValue:(null==le?void 0:le.participantIndicator)||"ind_agreement_price",children:[di.jsx(Gn,{value:"ind_agreement_price",children:"协议价"}),di.jsx(Gn,{value:"ind_tax_price",children:"含税价"}),di.jsx(Gn,{value:"ind_net_price",children:"净价"})]})})}),"specific"===ae&&di.jsx(P,{span:12,children:di.jsx(W.Item,{label:"基准侧指标",required:!0,children:di.jsxs(q,{placeholder:"从基准候选选择",defaultValue:(null==le?void 0:le.baselineIndicator)||"ind_hist_min",children:[di.jsx(Gn,{value:"ind_hist_min",children:"历史最低"}),di.jsx(Gn,{value:"ind_market_ref",children:"市场参考"}),di.jsx(Gn,{value:"ind_bid_min",children:"中标最低"})]})})})]})]})]}),di.jsxs("div",{style:{marginBottom:"24px"},children:[di.jsx(Kn,{strong:!0,style:{fontSize:"16px",color:"#1890ff"},children:"③ 拼装公式（点击积木按钮插入）"}),di.jsxs("div",{style:{marginTop:"12px"},children:[di.jsx(W.Item,{label:"计算方式",children:di.jsxs(Ie.Group,{value:ce,onChange:e=>pe(e.target.value),style:{marginBottom:"12px"},children:[di.jsx(Ie,{value:"visual",children:"可视化编辑"}),di.jsx(Ie,{value:"advanced",children:"高级表达式"})]})}),"visual"===ce&&di.jsxs(di.Fragment,{children:[di.jsx("div",{style:{border:"1px solid #d9d9d9",borderRadius:"6px",padding:"16px",backgroundColor:"#fafafa",marginBottom:"12px"},children:di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"wrap"},children:[di.jsx("span",{children:"( "}),di.jsx(E,{size:"small",style:{backgroundColor:"#e6f7ff",border:"1px solid #91d5ff",color:"#1890ff",borderRadius:"4px"},children:"协议价 ▼"}),di.jsx(E,{size:"small",style:{backgroundColor:"#fff2e8",border:"1px solid #ffbb96",color:"#fa8c16"},children:"-"}),di.jsx(E,{size:"small",style:{backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",color:"#52c41a"},children:"基准价 ▼"}),di.jsx("span",{children:" ) ÷ "}),di.jsx(E,{size:"small",style:{backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",color:"#52c41a"},children:"基准价 ▼"})]})}),di.jsxs("div",{style:{marginBottom:"12px"},children:[di.jsx(Kn,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"插入变量："}),di.jsxs(J,{wrap:!0,children:[di.jsx(E,{size:"small",icon:di.jsx(K,{}),style:{backgroundColor:"#e6f7ff",border:"1px solid #91d5ff",color:"#1890ff"},onClick:()=>{oe(e=>e+" ${COMPARE}")},children:"参与侧指标"}),di.jsx(E,{size:"small",icon:di.jsx(K,{}),style:{backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",color:"#52c41a"},onClick:()=>{oe(e=>e+" ${BASELINE}")},children:"基准侧指标"})]})]}),di.jsxs("div",{style:{marginBottom:"12px"},children:[di.jsx(Kn,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"插入函数："}),di.jsxs(J,{wrap:!0,children:[di.jsx(E,{size:"small",style:{backgroundColor:"#fff1f0",border:"1px solid #ffa39e",color:"#f5222d"},onClick:()=>{oe(e=>e+" (${COMPARE} - ${BASELINE})")},children:"差异额"}),di.jsx(E,{size:"small",style:{backgroundColor:"#fff1f0",border:"1px solid #ffa39e",color:"#f5222d"},onClick:()=>{oe(e=>e+" (${COMPARE} - ${BASELINE}) / NULLIF(${BASELINE}, 0)")},children:"差异率"}),di.jsx(E,{size:"small",style:{backgroundColor:"#f9f0ff",border:"1px solid #d3adf7",color:"#722ed1"},onClick:()=>{oe(e=>e+" ((${COMPARE} - ${BASELINE}) / NULLIF(${BASELINE}, 0)) * 100")},children:"百分比变化"}),di.jsx(E,{size:"small",style:{backgroundColor:"#f9f0ff",border:"1px solid #d3adf7",color:"#722ed1"},onClick:()=>{oe(e=>e+" ROUND(${COMPARE}, 2)")},children:"四舍五入"}),di.jsx(E,{size:"small",style:{backgroundColor:"#fff7e6",border:"1px solid #ffd591",color:"#fa8c16"},onClick:()=>{oe(e=>e+" NULLIF(${BASELINE}, 0)")},children:"NULL处理"})]})]})]}),"advanced"===ce&&di.jsx(W.Item,{label:"高级表达式",children:di.jsx(Yn,{rows:4,placeholder:"( ${COMPARE} - ${BASELINE} ) / NULLIF(${BASELINE},0)",value:re,onChange:e=>oe(e.target.value),style:{fontFamily:'Monaco, Consolas, "Courier New", monospace',fontSize:"13px",backgroundColor:"#1e1e1e",color:"#d4d4d4",border:"1px solid #3c3c3c"}})}),di.jsx($,{message:"可用变量说明",description:di.jsxs("div",{children:[di.jsxs("div",{children:[di.jsxs("code",{children:["$","{COMPARE}"]})," 代表选择的参与侧指标"]}),di.jsxs("div",{children:[di.jsxs("code",{children:["$","{BASELINE}"]}),' 代表选择的基准侧指标（按"绑定基准/别名"替换）']})]}),type:"info",showIcon:!0,style:{fontSize:"12px"}})]})]}),di.jsxs("div",{style:{marginBottom:"24px"},children:[di.jsx(Kn,{strong:!0,style:{fontSize:"16px",color:"#1890ff"},children:"④ 格式与显示"}),di.jsx("div",{style:{marginTop:"12px"},children:di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:8,children:di.jsx(W.Item,{label:"单位",children:di.jsxs(q,{placeholder:"%",defaultValue:(null==le?void 0:le.unit)||"%",children:[di.jsx(Gn,{value:"%",children:"%"}),di.jsx(Gn,{value:"CNY",children:"CNY"}),di.jsx(Gn,{value:"其他",children:"其他"})]})})}),di.jsx(P,{span:8,children:di.jsx(W.Item,{label:"小数位",children:di.jsxs(q,{defaultValue:(null==le?void 0:le.decimalPlaces)||4,style:{width:"100%"},children:[di.jsx(Gn,{value:0,children:"0"}),di.jsx(Gn,{value:1,children:"1"}),di.jsx(Gn,{value:2,children:"2"}),di.jsx(Gn,{value:3,children:"3"}),di.jsx(Gn,{value:4,children:"4"}),di.jsx(Gn,{value:5,children:"5"}),di.jsx(Gn,{value:6,children:"6"})]})})}),di.jsx(P,{span:8,children:di.jsx(W.Item,{label:"格式类型",children:di.jsxs(q,{defaultValue:(null==le?void 0:le.formatType)||"percentage",children:[di.jsx(Gn,{value:"percentage",children:"百分比"}),di.jsx(Gn,{value:"currency",children:"货币"}),di.jsx(Gn,{value:"thousands",children:"千分位"}),di.jsx(Gn,{value:"none",children:"无格式"})]})})})]})})]}),di.jsx(W.Item,{children:di.jsx(me,{defaultChecked:!1!==(null==le?void 0:le.enabled),children:"启用计算指标"})})]})}),di.jsxs("div",{style:{width:"300px",borderLeft:"1px solid #f0f0f0",paddingLeft:"24px",backgroundColor:"#fafafa",borderRadius:"6px",padding:"16px"},children:[di.jsx(Kn,{strong:!0,style:{fontSize:"16px",color:"#1890ff",display:"block",marginBottom:"16px"},children:"⑤ 预览"}),di.jsxs("div",{style:{marginBottom:"16px"},children:[di.jsx(Kn,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"公式（业务）："}),di.jsx("div",{style:{padding:"8px 12px",backgroundColor:"#fff",border:"1px solid #d9d9d9",borderRadius:"4px",fontSize:"13px",fontFamily:"monospace"},children:re.replace(/\$\{COMPARE\}/g,"比价指标").replace(/\$\{BASELINE\}/g,"基准指标")})]}),di.jsxs("div",{style:{marginBottom:"16px"},children:[di.jsx(Kn,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"公式（SQL）："}),di.jsx("div",{style:{padding:"8px 12px",backgroundColor:"#1e1e1e",color:"#d4d4d4",border:"1px solid #3c3c3c",borderRadius:"4px",fontSize:"12px",fontFamily:"Monaco, Consolas, monospace"},children:di.jsx("div",{style:{whiteSpace:"pre-wrap"},children:re.replace(/\$\{COMPARE\}/g,"a.price").replace(/\$\{BASELINE\}/g,"b.price").split(" ").map((e,t)=>{if(e.includes("NULLIF"))return di.jsxs("span",{style:{color:"#dcdcaa"},children:[e," "]},t);if(e.includes("a.price")||e.includes("b.price")){const i=e.split(".");return di.jsxs("span",{children:[di.jsx("span",{style:{color:"#569cd6"},children:i[0]}),".",di.jsx("span",{style:{color:"#9cdcfe"},children:i[1]})," "]},t)}return/^\d+$/.test(e)?di.jsxs("span",{style:{color:"#b5cea8"},children:[e," "]},t):di.jsxs("span",{style:{color:"#d4d4d4"},children:[e," "]},t)})})})]}),di.jsxs("div",{children:[di.jsx(Kn,{strong:!0,style:{display:"block",marginBottom:"8px"},children:"样例预览："}),di.jsx(Y,{size:"small",pagination:!1,dataSource:[{key:1,product:"产品A",compare:100,baseline:90,result:"11.11%"},{key:2,product:"产品B",compare:85,baseline:90,result:"-5.56%"},{key:3,product:"产品C",compare:95,baseline:90,result:"5.56%"}],columns:[{title:"产品",dataIndex:"product",width:60},{title:"协议价",dataIndex:"compare",width:60},{title:"基准价",dataIndex:"baseline",width:60},{title:"差异率",dataIndex:"result",width:60}],style:{fontSize:"12px"}})]})]})]})})]}):di.jsxs("div",{style:{padding:"24px"},children:[di.jsxs("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[di.jsx(Wn,{level:2,children:"比价模型2管理"}),di.jsx(E,{type:"primary",icon:di.jsx(K,{}),onClick:()=>{r(!0),a(null),p(0),l.resetFields(),h([]),f([]),v([]),C([]),S([]),T([]),z([]),A([])},children:"新建模型"})]}),di.jsx(D,{title:"模型列表",children:di.jsx(Y,{dataSource:i,rowKey:"id",pagination:!1,scroll:{x:800},columns:[{title:"模型名称",dataIndex:"modelName",key:"modelName",width:200,ellipsis:!0,render:(e,t)=>di.jsx(E,{type:"link",style:{padding:0,height:"auto",fontWeight:500},onClick:()=>mt(t),children:e})},{title:"模型编码",dataIndex:"modelCode",key:"modelCode",width:180,ellipsis:!0},{title:"标签",dataIndex:"tags",key:"tags",width:200,render:e=>di.jsx(di.Fragment,{children:null==e?void 0:e.map(e=>di.jsx(B,{color:"blue",style:{marginBottom:4},children:e},e))})},{title:"启用状态",dataIndex:"enabled",key:"enabled",width:100,render:e=>di.jsx(B,{color:e?"green":"default",children:e?"启用":"停用"})},{title:"操作",key:"action",width:150,render:(e,t)=>di.jsxs(J,{size:"small",children:[di.jsx(E,{type:"link",size:"small",onClick:()=>mt(t),children:"编辑"}),di.jsx(E,{type:"link",size:"small",children:"复制"}),di.jsx(E,{type:"link",size:"small",danger:!0,children:"删除"})]})}]})})]})},group:"一期"},{title:"比价规则",to:"/price-comparison-rules",icon:di.jsx(ht,{className:"h-4 w-4"}),component:()=>{const[t,i]=j.useState([{id:"1",ruleId:"rule_price_warning",name:"价格预警规则",description:"当差异率或差异额超过设定值时进行预警或打分",tags:["预警","评分"],modelRef:"mdl_vendor_price_compare",ruleType:"control",conditions:[{id:"c1",indicatorId:"ind_diff_rate",operator:">",value:.1,unit:"percent",message:"价格偏高",severity:"high"}],scoringFactors:[],applyScope:{orgs:["org001","org002"],datasetFilter:{field:"purchase_mode",operator:"=",value:"集中采购"}},enabled:!0,createdBy:"user001",createdAt:"2025-01-15 10:30:00",updatedAt:"2025-01-15 10:30:00"}]),[s,l]=j.useState(!1),[n,a]=j.useState(null),[d,r]=j.useState(""),[o]=W.useForm(),[p,x]=j.useState("basic"),[h,u]=j.useState([]),[f,g]=j.useState([]),[v,b]=j.useState(!1),[C,N]=j.useState(!1),[I,w]=j.useState(null),[S,k]=j.useState(null),[T]=W.useForm(),[_]=W.useForm(),[A,R]=j.useState(0),[z,M]=j.useState("control"),[O,F]=j.useState(!0),[H,K]=j.useState(""),X=[{title:"基本信息",description:"规则名称、描述等基础信息"},{title:"模型引用",description:"选择关联的比价模型"},{title:"规则配置",description:"配置控制型或评分型规则"},{title:"应用范围",description:"设置规则应用范围"}],ee=()=>{l(!1),a(null),R(0),M("control"),o.resetFields()},ie=[{id:"mdl_vendor_price_compare",name:"供应商价格对比模型",indicators:[{id:"ind_agreement_price",name:"协议价",type:"atomic",dataType:"number",unit:"CNY"},{id:"ind_hist_min",name:"历史最低价",type:"baseline",dataType:"number",unit:"CNY"},{id:"ind_diff_rate",name:"差异率",type:"calculation",dataType:"number",unit:"%"},{id:"ind_diff_amount",name:"差异额",type:"calculation",dataType:"number",unit:"CNY"}]}],se=[{id:"factor_price_diff_rate",name:"价格差异率",category:"price",unit:"%",defaultWeight:.3,defaultMode:"range",defaultRanges:[{min:0,max:.05,score:100,minInclusive:!0,maxInclusive:!1},{min:.05,max:.1,score:80,minInclusive:!0,maxInclusive:!1},{min:.1,max:.2,score:60,minInclusive:!0,maxInclusive:!1},{min:.2,max:999,score:0,minInclusive:!0,maxInclusive:!1}],description:"当前价格与基准价格的差异率"},{id:"factor_hist_stability",name:"历史价格稳定性",category:"history",unit:"分",defaultWeight:.2,defaultMode:"formula",defaultFormula:"100 - (价格波动率 * 100)",description:"基于历史价格波动计算的稳定性评分"},{id:"factor_supply_reliability",name:"供应可靠性",category:"supply",unit:"分",defaultWeight:.25,defaultMode:"range",defaultRanges:[{min:.9,max:1,score:100,minInclusive:!0,maxInclusive:!0},{min:.8,max:.9,score:80,minInclusive:!0,maxInclusive:!1},{min:.7,max:.8,score:60,minInclusive:!0,maxInclusive:!1},{min:0,max:.7,score:40,minInclusive:!0,maxInclusive:!1}],description:"供应商的交付可靠性评分"},{id:"factor_quality_score",name:"质量评分",category:"quality",unit:"分",defaultWeight:.15,defaultMode:"range",defaultRanges:[{min:90,max:100,score:100,minInclusive:!0,maxInclusive:!0},{min:80,max:90,score:80,minInclusive:!0,maxInclusive:!1},{min:70,max:80,score:60,minInclusive:!0,maxInclusive:!1},{min:0,max:70,score:20,minInclusive:!0,maxInclusive:!1}],description:"产品质量综合评分"},{id:"factor_brand_premium",name:"品牌溢价",category:"brand",unit:"%",defaultWeight:.1,defaultMode:"formula",defaultFormula:"MAX(0, 100 - (品牌溢价率 * 200))",description:"品牌溢价对评分的影响"}],le=[{id:"formula_linear_decrease",name:"线性递减",formula:"MAX(0, {maxScore} - ({value} - {minValue}) * {slope})",description:"随着数值增加，分数线性递减",params:["maxScore","minValue","slope"],example:"MAX(0, 100 - (差异率 - 0) * 500)"},{id:"formula_exponential_decay",name:"指数衰减",formula:"{maxScore} * EXP(-{decayRate} * {value})",description:"随着数值增加，分数指数衰减",params:["maxScore","decayRate"],example:"100 * EXP(-2 * 差异率)"},{id:"formula_sigmoid",name:"S型曲线",formula:"{maxScore} / (1 + EXP({steepness} * ({value} - {midpoint})))",description:"S型曲线评分，适合有明确阈值的场景",params:["maxScore","steepness","midpoint"],example:"100 / (1 + EXP(10 * (差异率 - 0.1)))"},{id:"formula_threshold",name:"阈值函数",formula:"IF({value} <= {threshold}, {highScore}, {lowScore})",description:"基于阈值的二元评分",params:["threshold","highScore","lowScore"],example:"IF(差异率 <= 0.05, 100, 50)"}],ne=[{title:"总公司",value:"org001",children:[{title:"采购部",value:"org001_001"},{title:"财务部",value:"org001_002"}]},{title:"分公司A",value:"org002",children:[{title:"采购部A",value:"org002_001"}]}],ae=()=>{const e=o.getFieldValue("modelRef"),t=ie.find(t=>t.id===e);return(null==t?void 0:t.indicators)||[]},de=()=>{w(null),T.resetFields(),b(!0)},re=e=>{const t=e.reduce((e,t)=>e+t.weight,0);return 0===t?e:e.map(e=>m(c({},e),{weight:e.weight/t}))},oe=()=>{k(null),_.resetFields(),N(!0)},pe=t.filter(e=>e.name.toLowerCase().includes(d.toLowerCase())||e.ruleId.toLowerCase().includes(d.toLowerCase())),xe=[{title:"规则ID",dataIndex:"ruleId",key:"ruleId",width:200},{title:"规则名称",dataIndex:"name",key:"name",width:200},{title:"标签",dataIndex:"tags",key:"tags",width:150,render:e=>di.jsx(di.Fragment,{children:e.map(e=>di.jsx(B,{color:"预警"===e?"red":"blue",children:e},e))})},{title:"类型",dataIndex:"ruleType",key:"ruleType",width:100,render:e=>di.jsx(B,{color:"control"===e?"orange":"green",children:"control"===e?"控制型":"评分型"})},{title:"引用模型",dataIndex:"modelRef",key:"modelRef",width:180,render:e=>{const t=ie.find(t=>t.id===e);return(null==t?void 0:t.name)||e}},{title:"启用状态",dataIndex:"enabled",key:"enabled",width:100,render:e=>di.jsx(B,{color:e?"green":"red",children:e?"启用":"禁用"})},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt",width:180},{title:"操作",key:"action",width:150,render:(e,t)=>di.jsxs(J,{size:"middle",children:[di.jsx(E,{type:"link",icon:di.jsx(Ge,{className:"w-4 h-4"}),onClick:()=>{return a(e=t),u([...e.conditions]),g([...e.scoringFactors]),x("basic"),o.setFieldsValue({ruleId:e.ruleId,name:e.name,description:e.description,tags:e.tags,modelRef:e.modelRef,ruleType:e.ruleType,enabled:e.enabled,applyScope:e.applyScope}),void l(!0);var e},children:"编辑"}),di.jsx(Z,{title:"确定要删除这个规则吗？",onConfirm:()=>{return e=t.id,i(t=>t.filter(t=>t.id!==e)),void te.success("删除成功");var e},okText:"确定",cancelText:"取消",children:di.jsx(E,{type:"link",danger:!0,icon:di.jsx(Qe,{className:"w-4 h-4"}),children:"删除"})})]})}],he=[{title:"指标",dataIndex:"indicatorId",key:"indicatorId",render:e=>{const t=ae().find(t=>t.id===e);return(null==t?void 0:t.name)||e}},{title:"条件",key:"condition",render:(e,t)=>di.jsx(Jn,{code:!0,children:`${t.operator} ${t.value}${t.unit?` ${t.unit}`:""}`})},{title:"提示信息",dataIndex:"message",key:"message"},{title:"严重程度",dataIndex:"severity",key:"severity",render:e=>di.jsx(B,{color:{high:"red",medium:"orange",low:"blue"}[e],children:{high:"高",medium:"中",low:"低"}[e]})},{title:"操作",key:"action",render:(e,t)=>di.jsxs(J,{size:"small",children:[di.jsx(E,{type:"link",size:"small",icon:di.jsx(Ge,{className:"w-3 h-3"}),onClick:()=>{return w(e=t),T.setFieldsValue(e),void b(!0);var e},children:"编辑"}),di.jsx(Z,{title:"确定要删除这个条件吗？",onConfirm:()=>{return e=t.id,u(t=>t.filter(t=>t.id!==e)),void te.success("删除成功");var e},okText:"确定",cancelText:"取消",children:di.jsx(E,{type:"link",size:"small",danger:!0,icon:di.jsx(Qe,{className:"w-3 h-3"}),children:"删除"})})]})}],ue=[{title:"指标",dataIndex:"indicatorId",key:"indicatorId",width:150,render:(e,t)=>{const i=ae().find(t=>t.id===e),s=t.fromLibrary?se.find(e=>e.id===t.fromLibrary):null;return di.jsxs("div",{children:[di.jsx("div",{children:(null==i?void 0:i.name)||e}),s&&di.jsxs(B,{color:"blue",children:["来自因子库: ",s.name]})]})}},{title:"权重",dataIndex:"weight",key:"weight",width:100,render:e=>di.jsxs("div",{children:[di.jsxs("div",{style:{marginBottom:4},children:[(100*e).toFixed(1),"%"]}),di.jsx("div",{style:{width:"100%",height:4,backgroundColor:"#f0f0f0",borderRadius:2,overflow:"hidden"},children:di.jsx("div",{style:{width:100*e+"%",height:"100%",backgroundColor:e>.5?"#ff4d4f":e>.3?"#faad14":"#52c41a",transition:"width 0.3s"}})})]})},{title:"打分模式",dataIndex:"scoreMode",key:"scoreMode",width:120,render:(e,t)=>di.jsxs("div",{children:[di.jsx(B,{color:"range"===e?"green":"blue",children:"range"===e?"区间打分":"公式打分"}),t.onNull&&di.jsxs("div",{style:{fontSize:"11px",color:"#666",marginTop:2},children:["空值处理: ","skip"===t.onNull?"跳过":"zero"===t.onNull?"0分":`${t.customNullScore}分`]})]})},{title:"配置",key:"config",render:(e,t)=>{var i,s,l,n,a;if("range"===t.scoreMode){const e=(null==(i=t.rangeConfig)?void 0:i.ranges.length)||0;return di.jsxs("div",{children:[di.jsxs("div",{style:{marginBottom:4},children:[di.jsxs(Jn,{children:[e," 个区间"]}),(null==(s=t.rangeConfig)?void 0:s.monotonic)&&di.jsx(B,{color:"purple",style:{marginLeft:8},children:"asc"===t.rangeConfig.monotonic?"单调递增":"desc"===t.rangeConfig.monotonic?"单调递减":"非单调"})]}),null==(l=t.rangeConfig)?void 0:l.ranges.slice(0,2).map((e,t)=>di.jsxs("div",{style:{fontSize:"12px",marginBottom:2},children:[di.jsxs("span",{style:{color:"#1890ff"},children:[e.minInclusive?"[":"(",e.min,", ",e.max,e.maxInclusive?"]":")"]}),di.jsxs("span",{style:{marginLeft:8,fontWeight:"bold"},children:["→ ",e.score,"分"]})]},t)),e>2&&di.jsxs("div",{style:{fontSize:"11px",color:"#666"},children:["...还有",e-2,"个区间"]})]})}return di.jsxs("div",{children:[di.jsx("div",{style:{fontSize:"12px",fontFamily:"monospace",background:"#f5f5f5",padding:"4px 8px",borderRadius:4},children:null==(n=t.formulaConfig)?void 0:n.formula}),(null==(a=t.formulaConfig)?void 0:a.params)&&Object.keys(t.formulaConfig.params).length>0&&di.jsxs("div",{style:{fontSize:"11px",color:"#666",marginTop:4},children:["参数: ",Object.entries(t.formulaConfig.params).map(([e,t])=>`${e}=${t}`).join(", ")]})]})}},{title:"操作",key:"action",width:120,render:(e,t)=>di.jsxs(J,{size:"small",children:[di.jsx(E,{type:"link",size:"small",icon:di.jsx(Ge,{className:"w-3 h-3"}),onClick:()=>{return k(e=t),_.setFieldsValue(e),void N(!0);var e},children:"编辑"}),di.jsx(Z,{title:"确定要删除这个评分因子吗？",onConfirm:()=>{return e=t.id,g(t=>t.filter(t=>t.id!==e)),void te.success("删除成功");var e},okText:"确定",cancelText:"取消",children:di.jsx(E,{type:"link",size:"small",danger:!0,icon:di.jsx(Qe,{className:"w-3 h-3"}),children:"删除"})})]})}];return di.jsxs("div",{style:{padding:"24px",backgroundColor:"#f5f5f5",minHeight:"100vh"},children:[di.jsx(D,{style:{marginBottom:16},children:di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[di.jsx(Qn,{level:4,style:{margin:0},children:"比价规则管理"}),di.jsxs(J,{children:[di.jsx(U,{placeholder:"搜索规则名称或ID",prefix:di.jsx(We,{className:"w-4 h-4"}),value:d,onChange:e=>r(e.target.value),style:{width:250}}),di.jsx(E,{type:"primary",icon:di.jsx(Ue,{className:"w-4 h-4"}),onClick:()=>{a(null),u([]),g([]),x("basic"),o.resetFields(),l(!0)},children:"新建规则"})]})]})}),di.jsx(D,{children:di.jsx(Y,{columns:xe,dataSource:pe,rowKey:"id",pagination:{total:pe.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})}),di.jsxs(G,{title:n?"编辑比价规则":"新建比价规则",open:s,onCancel:ee,footer:null,width:1e3,style:{top:20},children:[di.jsx("div",{style:{marginBottom:24},children:di.jsx(Q,{current:A,size:"small",children:X.map((e,t)=>di.jsx(ta,{title:e.title},t))})}),di.jsx(W,{form:o,layout:"vertical",children:(()=>{switch(A){case 0:return di.jsxs("div",{children:[di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:12,children:di.jsx(W.Item,{name:"ruleId",label:"规则ID",rules:[{required:!0,message:"请输入规则ID"}],children:di.jsx(U,{placeholder:"rule_price_warning"})})}),di.jsx(P,{span:12,children:di.jsx(W.Item,{name:"name",label:"规则名称",rules:[{required:!0,message:"请输入规则名称"}],children:di.jsx(U,{placeholder:"价格预警规则"})})})]}),di.jsx(W.Item,{name:"description",label:"规则描述",children:di.jsx(Xn,{rows:3,placeholder:"当差异率或差异额超过设定值时进行预警或打分"})}),di.jsx(W.Item,{name:"tags",label:"标签",children:di.jsxs(q,{mode:"tags",placeholder:"添加标签",children:[di.jsx(ea,{value:"预警",children:"预警"}),di.jsx(ea,{value:"评分",children:"评分"}),di.jsx(ea,{value:"过滤",children:"过滤"})]})})]});case 1:return di.jsxs("div",{children:[di.jsx(W.Item,{name:"modelRef",label:"选择比价模型",rules:[{required:!0,message:"请选择比价模型"}],children:di.jsx(q,{placeholder:"请选择比价模型",children:ie.map(e=>di.jsx(ea,{value:e.id,children:e.name},e.id))})}),di.jsx($,{message:"模型绑定说明",description:"绑定模型后，可获取模型的原子指标、基准指标、计算指标用于规则配置",type:"info",showIcon:!0,style:{marginTop:16}})]});case 2:return di.jsxs("div",{children:[di.jsx(W.Item,{name:"ruleType",label:"规则类型",rules:[{required:!0,message:"请选择规则类型"}],children:di.jsxs(Ie.Group,{value:z,onChange:e=>M(e.target.value),children:[di.jsx(Ie,{value:"control",children:"控制型（预警/过滤）"}),di.jsx(Ie,{value:"score",children:"评分型（打分/加权）"})]})}),"control"===z&&di.jsxs("div",{children:[di.jsx(V,{children:"规则条件配置"}),di.jsx("div",{style:{marginBottom:16},children:di.jsx(E,{type:"dashed",icon:di.jsx(Ue,{className:"w-4 h-4"}),onClick:de,children:"添加条件"})}),di.jsx(Y,{dataSource:h,columns:he,rowKey:"id",size:"small",pagination:!1})]}),"score"===z&&di.jsxs("div",{children:[di.jsx(V,{children:"评分因子配置"}),di.jsx(ce,{style:{marginBottom:16},children:di.jsx(ia,{header:"📚 因子库",children:di.jsx(L,{gutter:[16,16],children:se.map(e=>di.jsx(P,{span:8,children:di.jsx(D,{size:"small",title:e.name,extra:di.jsx(E,{type:"link",size:"small",onClick:()=>{const t={id:`scoring_${Date.now()}`,indicatorId:e.id,weight:e.defaultWeight,scoreMode:e.defaultMode,rangeConfig:e.defaultRanges?{ranges:e.defaultRanges,monotonic:"desc"}:void 0,formulaConfig:e.defaultFormula?{formula:e.defaultFormula}:void 0,onNull:"skip",fromLibrary:e.id};g([...f,t]),te.success(`已添加因子: ${e.name}`)},children:"添加"}),children:di.jsxs("div",{style:{fontSize:"12px"},children:[di.jsxs("div",{children:[di.jsx("strong",{children:"类别:"})," ",e.category]}),di.jsxs("div",{children:[di.jsx("strong",{children:"单位:"})," ",e.unit]}),di.jsxs("div",{children:[di.jsx("strong",{children:"默认权重:"})," ",(100*e.defaultWeight).toFixed(1),"%"]}),di.jsxs("div",{children:[di.jsx("strong",{children:"评分方式:"})," ","range"===e.defaultMode?"区间评分":"公式评分"]}),di.jsx("div",{style:{marginTop:4,color:"#666"},children:e.description})]})})},e.id))})},"factor-library")}),di.jsx("div",{style:{marginBottom:16},children:di.jsxs(J,{children:[di.jsx(E,{type:"dashed",icon:di.jsx(Ue,{className:"w-4 h-4"}),onClick:oe,children:"添加评分因子"}),di.jsx(q,{placeholder:"从因子库选择",style:{width:200},value:H,onChange:K,allowClear:!0,children:se.map(e=>di.jsxs(ea,{value:e.id,children:[e.name," (",e.category,")"]},e.id))}),H&&di.jsx(E,{type:"primary",size:"small",onClick:()=>{const e=se.find(e=>e.id===H);if(e){const t={id:`scoring_${Date.now()}`,indicatorId:e.id,weight:e.defaultWeight,scoreMode:e.defaultMode,rangeConfig:e.defaultRanges?{ranges:e.defaultRanges,monotonic:"desc"}:void 0,formulaConfig:e.defaultFormula?{formula:e.defaultFormula}:void 0,onNull:"skip",fromLibrary:e.id};g([...f,t]),K(""),te.success(`已添加因子: ${e.name}`)}},children:"添加到规则"})]})}),di.jsxs("div",{style:{marginBottom:16},children:[di.jsxs(J,{children:[di.jsx(me,{checked:O,onChange:e=>F(e.target.checked),children:"自动权重归一化"}),di.jsx(E,{size:"small",onClick:()=>{const e=re(f);g(e),te.success("权重已归一化")},disabled:0===f.length,children:"手动归一化"})]}),di.jsxs("div",{style:{marginTop:8},children:[di.jsxs(Jn,{type:"secondary",children:["当前权重总和: ",(100*f.reduce((e,t)=>e+t.weight,0)).toFixed(1),"%"]}),Math.abs(f.reduce((e,t)=>e+t.weight,0)-1)>.01&&di.jsx(Jn,{type:"warning",style:{marginLeft:8},children:"⚠️ 权重总和不为100%"})]})]}),di.jsx(Y,{dataSource:f,columns:ue,rowKey:"id",size:"small",pagination:!1})]})]});case 3:return di.jsxs("div",{children:[di.jsx(W.Item,{name:["applyScope","orgs"],label:"应用组织",children:di.jsx(_e,{treeData:ne,placeholder:"请选择应用组织",multiple:!0,treeCheckable:!0,showCheckedStrategy:_e.SHOW_PARENT,style:{width:"100%"}})}),di.jsx(V,{children:"数据集过滤条件"}),di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:8,children:di.jsx(W.Item,{label:"字段",name:["applyScope","datasetFilter","field"],children:di.jsx(U,{placeholder:"purchase_mode"})})}),di.jsx(P,{span:8,children:di.jsx(W.Item,{label:"操作符",name:["applyScope","datasetFilter","operator"],children:di.jsxs(q,{placeholder:"请选择操作符",children:[di.jsx(ea,{value:"=",children:"="}),di.jsx(ea,{value:"!=",children:"!="}),di.jsx(ea,{value:"IN",children:"IN"}),di.jsx(ea,{value:"LIKE",children:"LIKE"})]})})}),di.jsx(P,{span:8,children:di.jsx(W.Item,{label:"值",name:["applyScope","datasetFilter","value"],children:di.jsx(U,{placeholder:"集中采购"})})})]})]});default:return null}})()}),di.jsx("div",{style:{marginTop:24,textAlign:"right"},children:di.jsxs(J,{children:[A>0&&di.jsx(E,{onClick:()=>{A>0&&R(A-1)},icon:di.jsx(ot,{className:"w-4 h-4"}),children:"上一步"}),A<X.length-1?di.jsx(E,{type:"primary",onClick:()=>{A<X.length-1&&R(A+1)},icon:di.jsx(ct,{className:"w-4 h-4"}),children:"下一步"}):di.jsx(E,{type:"primary",onClick:()=>y(e,null,function*(){try{const e=yield o.validateFields(),t={id:(null==n?void 0:n.id)||Date.now().toString(),ruleId:e.ruleId||`rule_${e.name.replace(/\s+/g,"_").toLowerCase()}_${Date.now()}`,name:e.name,description:e.description,tags:e.tags||[],modelRef:e.modelRef,ruleType:e.ruleType,conditions:h,scoringFactors:f,applyScope:e.applyScope||{orgs:[]},enabled:!1!==e.enabled,createdBy:"current_user",createdAt:(null==n?void 0:n.createdAt)||(new Date).toLocaleString(),updatedAt:(new Date).toLocaleString()};n?(i(e=>e.map(e=>e.id===n.id?t:e)),te.success("更新成功")):(i(e=>[...e,t]),te.success("创建成功")),ee()}catch(e){}}),children:n?"更新规则":"创建规则"}),di.jsx(E,{onClick:ee,children:"取消"})]})})]}),di.jsx(G,{title:I?"编辑规则条件":"新增规则条件",open:v,onCancel:()=>b(!1),onOk:()=>y(e,null,function*(){try{const e=yield T.validateFields(),t=c({id:(null==I?void 0:I.id)||`condition_${Date.now()}`},e);u(I?e=>e.map(e=>e.id===I.id?t:e):e=>[...e,t]),b(!1),te.success("条件保存成功")}catch(e){}}),width:600,children:di.jsxs(W,{form:T,layout:"vertical",children:[di.jsx(W.Item,{label:"指标选择",name:"indicatorId",rules:[{required:!0,message:"请选择指标"}],children:di.jsx(q,{placeholder:"请选择指标",children:ae().map(e=>di.jsxs(ea,{value:e.id,children:[e.name," (",e.id,")"]},e.id))})}),di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:8,children:di.jsx(W.Item,{label:"条件符号",name:"operator",rules:[{required:!0,message:"请选择条件符号"}],children:di.jsxs(q,{placeholder:"请选择",children:[di.jsx(ea,{value:">",children:">"}),di.jsx(ea,{value:"<",children:"<"}),di.jsx(ea,{value:"=",children:"="}),di.jsx(ea,{value:"!=",children:"!="}),di.jsx(ea,{value:"BETWEEN",children:"BETWEEN"}),di.jsx(ea,{value:"IN",children:"IN"})]})})}),di.jsx(P,{span:8,children:di.jsx(W.Item,{label:"阈值",name:"value",rules:[{required:!0,message:"请输入阈值"}],children:di.jsx(ge,{style:{width:"100%"},placeholder:"0.1"})})}),di.jsx(P,{span:8,children:di.jsx(W.Item,{label:"单位",name:"unit",children:di.jsx(U,{placeholder:"%"})})})]}),di.jsx(W.Item,{label:"提示信息",name:"message",rules:[{required:!0,message:"请输入提示信息"}],children:di.jsx(U,{placeholder:"价格偏高"})}),di.jsx(W.Item,{label:"严重程度",name:"severity",rules:[{required:!0,message:"请选择严重程度"}],children:di.jsxs(q,{placeholder:"请选择严重程度",children:[di.jsx(ea,{value:"high",children:"高"}),di.jsx(ea,{value:"medium",children:"中"}),di.jsx(ea,{value:"low",children:"低"})]})})]})}),di.jsx(G,{title:S?"编辑评分因子":"新增评分因子",open:C,onCancel:()=>N(!1),onOk:()=>y(e,null,function*(){try{const e=yield _.validateFields(),t=c({id:(null==S?void 0:S.id)||`factor_${Date.now()}`},e);let i;i=S?f.map(e=>e.id===S.id?t:e):[...f,t],O&&(i=re(i)),g(i),N(!1),te.success("评分因子保存成功")}catch(e){}}),width:900,children:di.jsxs(W,{form:_,layout:"vertical",children:[di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:12,children:di.jsx(W.Item,{label:"指标选择",name:"indicatorId",rules:[{required:!0,message:"请选择指标"}],children:di.jsx(q,{placeholder:"请选择指标",children:ae().filter(e=>"number"===e.dataType).map(e=>di.jsxs(ea,{value:e.id,children:[e.name," (",e.id,")"]},e.id))})})}),di.jsx(P,{span:12,children:di.jsx(W.Item,{label:"权重",name:"weight",rules:[{required:!0,message:"请设置权重"}],children:di.jsx(Te,{min:0,max:1,step:.05,marks:{0:"0%",.25:"25%",.5:"50%",.75:"75%",1:"100%"},tooltip:{formatter:e=>`${(100*(e||0)).toFixed(1)}%`}})})})]}),di.jsx(W.Item,{label:"打分模式",name:"scoreMode",rules:[{required:!0,message:"请选择打分模式"}],children:di.jsxs(Ie.Group,{children:[di.jsx(Ie,{value:"range",children:"区间打分"}),di.jsx(Ie,{value:"formula",children:"公式打分"})]})}),di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:12,children:di.jsx(W.Item,{label:"空值处理",name:"onNull",rules:[{required:!0,message:"请选择空值处理方式"}],children:di.jsxs(q,{placeholder:"请选择空值处理方式",children:[di.jsx(ea,{value:"skip",children:"跳过（不参与计算）"}),di.jsx(ea,{value:"zero",children:"按0分计算"}),di.jsx(ea,{value:"custom",children:"自定义分值"})]})})}),di.jsx(P,{span:12,children:di.jsx(W.Item,{noStyle:!0,shouldUpdate:(e,t)=>e.onNull!==t.onNull,children:({getFieldValue:e})=>"custom"===e("onNull")?di.jsx(W.Item,{label:"自定义空值分数",name:"customNullScore",rules:[{required:!0,message:"请输入自定义分数"}],children:di.jsx(ge,{min:0,max:100,placeholder:"50",style:{width:"100%"}})}):null})})]}),di.jsx(W.Item,{noStyle:!0,shouldUpdate:(e,t)=>e.scoreMode!==t.scoreMode,children:({getFieldValue:e})=>{const t=e("scoreMode");return"range"===t?di.jsxs("div",{children:[di.jsx(W.Item,{label:"单调性",name:["rangeConfig","monotonic"],children:di.jsxs(Ie.Group,{children:[di.jsx(Ie,{value:"asc",children:"单调递增"}),di.jsx(Ie,{value:"desc",children:"单调递减"}),di.jsx(Ie,{value:"none",children:"非单调"})]})}),di.jsxs(W.Item,{label:"区间配置",name:["rangeConfig","ranges"],children:[di.jsx($,{message:"区间打分配置",description:"请配置不同区间对应的分值，支持开闭区间设置",type:"info",showIcon:!0,style:{marginBottom:16}}),di.jsx(Xn,{rows:6,placeholder:'示例配置（JSON格式）：\n[\n  {"min": 0, "max": 0.05, "score": 100, "minInclusive": true, "maxInclusive": false},\n  {"min": 0.05, "max": 0.1, "score": 80, "minInclusive": true, "maxInclusive": false},\n  {"min": 0.1, "max": 0.2, "score": 60, "minInclusive": true, "maxInclusive": false}\n]'})]})]}):"formula"===t?di.jsxs("div",{children:[di.jsx(W.Item,{label:"公式模板",children:di.jsx(q,{placeholder:"选择公式模板（可选）",allowClear:!0,onChange:e=>{if(e){const t=le.find(t=>t.id===e);t&&_.setFieldsValue({formulaConfig:{formula:t.formula}})}},children:le.map(e=>di.jsxs(ea,{value:e.id,children:[e.name," - ",e.description]},e.id))})}),di.jsx(W.Item,{label:"计算公式",name:["formulaConfig","formula"],rules:[{required:!0,message:"请输入计算公式"}],children:di.jsx(Xn,{rows:3,placeholder:"MAX(0, 100 - (差异率 * 500))"})}),di.jsx(W.Item,{label:"公式参数",name:["formulaConfig","params"],children:di.jsx(Xn,{rows:2,placeholder:'参数配置（JSON格式）：\n{"maxScore": 100, "threshold": 0.1}'})})]}):null}})]})})]})},group:"一期"},{title:"比价方案",to:"/price-scheme",icon:di.jsx(ht,{className:"h-4 w-4"}),component:()=>{const[e,t]=j.useState([]),[i,s]=j.useState(!1),[l,n]=j.useState(null),[a]=W.useForm(),[d,r]=j.useState(0),[o,p]=j.useState([]),[x,h]=j.useState([]),[u,f]=j.useState(null),[g,y]=j.useState(!1),[v,b]=j.useState(""),C=[{id:"model_vendor_compare",name:"通用供应商比价模型",primaryDataset:"ds_agreement_price",compareKeys:["item_id","brand"],analysisObject:"供应商",dimensions:["供应商","组织","时间(月)"],analysisIndicators:["ind_agreement_price","ind_discount_rate"],baselineCandidates:[{datasetId:"ds_bid",indicators:["ind_bid_min"]},{datasetId:"ds_po_hist",indicators:["ind_hist_min"]}],displayAttributes:["供应商","组织","产品"],defaultOutput:["供应商","协议价","${BASELINE}","差异率"]}],N=[{id:"ind_agreement_price",name:"协议价格"},{id:"ind_bid_min",name:"招采最低价"},{id:"ind_hist_min",name:"历史最低价"},{id:"ind_discount_rate",name:"折扣率"}],I=[{id:"rule_vendor_compare_default",name:"供应商比价默认规则集"},{id:"rule_price_alert",name:"价格预警规则集"}],w=[{id:"org_group",name:"集团"},{id:"org_subsidiary_a",name:"子公司A"},{id:"org_subsidiary_b",name:"子公司B"}];j.useEffect(()=>{t([{id:"1",schemeName:"同品多商-协议价对比多基准_2024Q1",schemeCode:"cmp_vendor_multi_baseline_2024Q1",tags:["集团采购","价格监控"],description:"2024年第一季度供应商协议价格多基准比价分析",enabled:!0,modelRef:{id:"model_vendor_compare",name:"通用供应商比价模型"},scope:{org:["org_group"],product:{category:"cat_ivd",brand:"brand_roche"},timeRange:["2024-01-01","2024-03-31"],extraFilters:[]},compareIndicator:{id:"ind_agreement_price",name:"协议价",datasetAlias:"ds_agreement_price"},baselines:[{alias:"baseline_1",datasetAlias:"ds_bid",indicatorLibId:"ind_bid_min",name:"招采最低价",conditions:["same_product","same_vendor"]}],computedIndicators:[{id:"diff_rate_A",name:"差异率A",formula:"(协议价 - 招采最低价) / 招采最低价",bindBaselineAlias:"baseline_1",unit:"%"}],output:{columns:["供应商","采购组织","协议价","baseline_price_A","diff_rate_A"],orderBy:[{field:"diff_rate_A",order:"desc"}],styleRules:[],export:["excel"]},status:"DRAFT",createdBy:"admin",createdAt:"2024-01-15",updatedAt:"2024-01-15"}])},[]);const S=[{title:"基本信息",description:"方案名称、编码、标签等"},{title:"绑定比价模型",description:"选择比价模型、比价指标、基准指标"},{title:"查询范围",description:"时间、组织、商品、供应商范围"},{title:"输出与样式",description:"维度列、指标列、排序、样式"},{title:"预览与执行",description:"预览结果、导出设置"},{title:"调度与推送",description:"调度配置、推送设置（可选）"}],k=e=>{var t,i,l;n(e),r(0),p(e.baselines),h(e.output.columns),f(C.find(t=>t.id===e.modelRef.id)||null),a.setFieldsValue({schemeName:e.schemeName,schemeCode:e.schemeCode,tags:e.tags,description:e.description,enabled:e.enabled,modelId:e.modelRef.id,orgScope:e.scope.org,productCategory:e.scope.product.category,productBrand:e.scope.product.brand,vendorScope:e.scope.vendor,timeRange:[be(e.scope.timeRange[0]),be(e.scope.timeRange[1])],ruleSetId:null==(t=e.ruleSetRef)?void 0:t.id,orderBy:null==(i=e.output.orderBy[0])?void 0:i.field,orderDirection:null==(l=e.output.orderBy[0])?void 0:l.order,exportExcel:e.output.export.includes("excel"),exportCsv:e.output.export.includes("csv"),exportApi:e.output.export.includes("api")}),s(!0)},T=e=>{const t=C.find(t=>t.id===e);f(t||null),t?h([...t.defaultOutput]):(h([]),a.setFieldsValue({compareIndicatorId:void 0,baselineAliases:void 0}))},_=()=>{b("-- 比价方案SQL预览\nWITH\n-- P: 参与侧（主数据集）\nP AS (\n  SELECT\n    p.item_id,\n    p.brand,\n    p.vendor_id,\n    p.org_id,\n    DATE_FORMAT(p.tx_date, '%Y-%m-01') AS month_key,\n    p.agreement_price AS ind_agreement_price\n  FROM ds_agreement_price p\n  WHERE p.org_id IN ('org_group')\n    AND p.brand = 'brand_roche'\n    AND p.tx_date BETWEEN '2024-01-01' AND '2024-03-31'\n),\n\n-- B_A: 基准块A（招采最低价）\nB_A AS (\n  SELECT\n    b.item_id,\n    b.brand,\n    DATE_FORMAT(b.bid_date, '%Y-%m-01') AS month_key,\n    MIN(b.bid_price) AS baseline_value\n  FROM ds_bid b\n  WHERE b.bid_date BETWEEN '2024-01-01' AND '2024-03-31'\n  GROUP BY b.item_id, b.brand, DATE_FORMAT(b.bid_date, '%Y-%m-01')\n)\n\nSELECT\n  P.vendor_id AS 供应商,\n  P.org_id AS 采购组织,\n  P.ind_agreement_price AS 协议价,\n  B_A.baseline_value AS baseline_price_A,\n  CASE\n    WHEN B_A.baseline_value IS NULL OR B_A.baseline_value = 0 THEN NULL\n    ELSE (P.ind_agreement_price - B_A.baseline_value) / B_A.baseline_value\n  END AS diff_rate_A\nFROM P\nLEFT JOIN B_A\n  ON P.item_id = B_A.item_id\n AND P.brand = B_A.brand\n AND P.month_key = B_A.month_key\nORDER BY diff_rate_A DESC\nLIMIT 1000;"),y(!0)},A=()=>{a.validateFields().then(i=>{var n,a;const d={id:(null==l?void 0:l.id)||`scheme_${Date.now()}`,schemeName:i.schemeName,schemeCode:i.schemeCode,tags:i.tags||[],description:i.description,enabled:i.enabled,modelRef:{id:i.modelId,name:(null==(n=C.find(e=>e.id===i.modelId))?void 0:n.name)||""},scope:{org:i.orgScope||[],product:{category:i.productCategory,brand:i.productBrand,skuList:[]},vendor:i.vendorScope,timeRange:[i.timeRange[0].format("YYYY-MM-DD"),i.timeRange[1].format("YYYY-MM-DD")],extraFilters:[]},compareIndicator:{id:"ind_agreement_price",name:"协议价",datasetAlias:"ds_agreement_price"},baselines:o,computedIndicators:[],ruleSetRef:i.ruleSetId?{id:i.ruleSetId,name:(null==(a=I.find(e=>e.id===i.ruleSetId))?void 0:a.name)||""}:void 0,output:{columns:x,orderBy:i.orderBy?[{field:i.orderBy,order:i.orderDirection||"desc"}]:[],styleRules:[],export:[...i.exportExcel?["excel"]:[],...i.exportCsv?["csv"]:[],...i.exportApi?["api"]:[]]},status:"DRAFT",createdBy:"admin",createdAt:(null==l?void 0:l.createdAt)||(new Date).toISOString().split("T")[0],updatedAt:(new Date).toISOString().split("T")[0]};l?(t(e.map(e=>e.id===l.id?d:e)),te.success("更新成功")):(t([...e,d]),te.success("创建成功")),s(!1)})},R=[{title:"方案编码",dataIndex:"schemeCode",key:"schemeCode",width:200,ellipsis:!0},{title:"方案名称",dataIndex:"schemeName",key:"schemeName",width:250,ellipsis:{showTitle:!1},render:(e,t)=>di.jsx(se,{placement:"topLeft",title:e,children:di.jsx(E,{type:"link",onClick:()=>k(t),style:{padding:0,height:"auto",textAlign:"left",width:"100%"},children:e})})},{title:"绑定模型",dataIndex:["modelRef","name"],key:"modelName",width:180,ellipsis:!0},{title:"标签",dataIndex:"tags",key:"tags",width:200,render:e=>di.jsx(di.Fragment,{children:e.map(e=>di.jsx(B,{color:"blue",style:{marginBottom:2},children:e},e))})},{title:"状态",dataIndex:"status",key:"status",width:100,render:e=>{const t={DRAFT:{color:"orange",text:"草稿"},PUBLISHED:{color:"green",text:"已发布"},ARCHIVED:{color:"gray",text:"已归档"}}[e];return di.jsx(B,{color:t.color,children:t.text})}},{title:"启用状态",dataIndex:"enabled",key:"enabled",width:100,render:e=>di.jsx(B,{color:e?"green":"red",children:e?"启用":"停用"})},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt",width:120,ellipsis:!0},{title:"操作",key:"action",width:180,fixed:"right",render:(i,s)=>di.jsxs(J,{size:"small",children:[di.jsx(E,{type:"link",size:"small",icon:di.jsx(X,{}),onClick:()=>k(s),children:"编辑"}),di.jsx(E,{type:"link",size:"small",onClick:()=>{const i=e.map(e=>e.id===s.id?m(c({},e),{enabled:!1}):e);t(i),te.success("已停用")},children:"停用"}),di.jsx(Z,{title:"确定删除这个比价方案吗？",onConfirm:()=>{return i=s.id,t(e.filter(e=>e.id!==i)),void te.success("删除成功");var i},okText:"确定",cancelText:"取消",children:di.jsx(E,{type:"link",size:"small",danger:!0,icon:di.jsx(ee,{}),children:"删除"})})]})}];return di.jsxs("div",{className:"p-6",children:[di.jsxs("div",{className:"flex justify-between items-center mb-6",children:[di.jsxs("div",{children:[di.jsx(na,{level:2,children:"比价方案2管理"}),di.jsx(aa,{type:"secondary",children:"管理多基准比价方案，支持复杂的对比分析配置"})]}),di.jsx(E,{type:"primary",icon:di.jsx(K,{}),onClick:()=>{n(null),r(0),p([]),h([]),f(null),a.resetFields(),s(!0)},children:"新建方案"})]}),di.jsx(D,{children:di.jsx(Y,{columns:R,dataSource:e,rowKey:"id",scroll:{x:1200,y:600},pagination:{total:e.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}})}),di.jsxs(G,{title:di.jsxs("div",{className:"flex items-center justify-between",children:[di.jsx("span",{children:l?"编辑比价方案":"新建比价方案"}),di.jsxs("div",{className:"flex items-center space-x-2",children:[di.jsx(B,{color:"orange",children:"状态: 草稿"}),di.jsx(se,{title:"方案信息",children:di.jsx(ll,{className:"text-gray-400"})})]})]}),open:i,onCancel:()=>s(!1),footer:di.jsxs("div",{className:"flex justify-between",children:[di.jsx(E,{onClick:()=>s(!1),children:"返回"}),di.jsxs(J,{children:[d>0&&di.jsx(E,{onClick:()=>r(d-1),children:"上一步"}),d<S.length-1?di.jsx(E,{type:"primary",onClick:()=>r(d+1),children:"下一步"}):di.jsxs(J,{children:[di.jsx(E,{icon:di.jsx(Tl,{}),onClick:A,children:"保存"}),di.jsx(E,{type:"primary",icon:di.jsx(Ml,{}),onClick:A,children:"发布"})]})]})]}),width:1e3,destroyOnClose:!0,children:[di.jsx("div",{className:"mb-6",children:di.jsx(Q,{current:d,size:"small",children:S.map((e,t)=>di.jsx(ra,{title:e.title,description:e.description,onClick:()=>r(t),style:{cursor:"pointer"}},t))})}),di.jsx(W,{form:a,layout:"vertical",children:(()=>{switch(d){case 0:return di.jsxs("div",{className:"space-y-4",children:[di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:12,children:di.jsx(W.Item,{name:"schemeName",label:"方案名称",rules:[{required:!0,message:"请输入方案名称"}],children:di.jsx(U,{placeholder:"请输入方案名称"})})}),di.jsx(P,{span:12,children:di.jsx(W.Item,{name:"schemeCode",label:"方案编码",rules:[{required:!0,message:"请输入方案编码"}],children:di.jsx(U,{placeholder:"请输入方案编码"})})})]}),di.jsx(W.Item,{name:"tags",label:"标签",children:di.jsxs(q,{mode:"tags",placeholder:"请选择或输入标签",children:[di.jsx(sa,{value:"集团采购",children:"集团采购"}),di.jsx(sa,{value:"价格监控",children:"价格监控"}),di.jsx(sa,{value:"供应商管理",children:"供应商管理"})]})}),di.jsx(W.Item,{name:"description",label:"描述",children:di.jsx(la,{rows:3,placeholder:"请输入方案描述"})}),di.jsx(W.Item,{name:"enabled",label:"启用",valuePropName:"checked",children:di.jsx(me,{children:"启用"})})]});case 1:return di.jsxs("div",{className:"space-y-4",children:[di.jsx(W.Item,{name:"modelId",label:"选择比价模型",rules:[{required:!0,message:"请选择比价模型"}],children:di.jsx(q,{placeholder:"请选择一个比价模型以配置指标",onChange:T,allowClear:!0,children:C.map(e=>di.jsx(sa,{value:e.id,children:e.name},e.id))})}),!u&&di.jsx($,{message:"请先选择比价模型",description:"选择比价模型后，将显示该模型的比价指标、基准指标和计算指标配置选项",type:"info",showIcon:!0,style:{marginTop:16}}),u&&di.jsxs("div",{className:"space-y-4 mt-4",children:[di.jsx(V,{children:"比价与基准指标选择"}),di.jsx(W.Item,{name:"compareIndicatorId",label:"比价指标",rules:[{required:!0,message:"请选择比价指标"}],extra:"从模型'主数据集原子指标'挑选",children:di.jsx(q,{placeholder:"请选择比价指标",children:N.filter(e=>e.id.includes("agreement")).map(e=>di.jsx(sa,{value:e.id,children:e.name},e.id))})}),di.jsx(W.Item,{name:"baselineAliases",label:"基准指标",rules:[{required:!0,message:"请至少选择一个基准指标"}],extra:"决定启用哪些基准",children:di.jsx(me.Group,{children:di.jsxs(L,{children:[di.jsx(P,{span:8,children:di.jsx(me,{value:"b1",children:"b1 (历史最低)"})}),di.jsx(P,{span:8,children:di.jsx(me,{value:"b2",children:"b2 (市场参考)"})}),di.jsx(P,{span:8,children:di.jsx(me,{value:"b3",children:"b3 (招采最低)"})})]})})}),di.jsxs("div",{children:[di.jsx(aa,{strong:!0,children:"计算指标"}),di.jsx("div",{className:"text-sm text-gray-500 mb-2",children:"勾选要输出的计算指标（来自模型，含 *_b1/_b2 自动展开）"}),di.jsx(Y,{size:"small",pagination:!1,columns:[{title:"选择",dataIndex:"selected",width:60,render:(e,t)=>di.jsx(me,{})},{title:"ID",dataIndex:"id",width:120},{title:"名称",dataIndex:"name"},{title:"绑定模式",dataIndex:"bindMode",width:100},{title:"可用后缀",dataIndex:"suffixes",width:120},{title:"单位",dataIndex:"unit",width:80},{title:"说明",dataIndex:"description"}],dataSource:[{key:"1",id:"ind_diff_amount",name:"差异额",bindMode:"ALL",suffixes:"_b1, _b2, _b3",unit:"元",description:"对比侧价格与基准价格的差异金额"},{key:"2",id:"ind_diff_rate",name:"差异率",bindMode:"ALL",suffixes:"_b1, _b2, _b3",unit:"%",description:"对比侧价格与基准价格的差异比例"}]})]}),di.jsx($,{message:"说明",description:"计算列由模型定义，方案只做启用与基准勾选。勾选后将输出最终列名（如 ind_diff_rate_b1）",type:"info",showIcon:!0})]})]});case 2:return di.jsxs("div",{className:"space-y-4",children:[di.jsxs(L,{gutter:16,align:"middle",children:[di.jsx(P,{span:4,style:{textAlign:"right"},children:di.jsxs("span",{children:[di.jsx("span",{style:{color:"red"},children:"*"})," 时间范围:"]})}),di.jsx(P,{span:20,children:di.jsx(W.Item,{name:"timeRange",rules:[{required:!0,message:"请选择时间范围"}],style:{marginBottom:0},children:di.jsx(da,{style:{width:"100%"}})})})]}),di.jsx("div",{className:"text-xs text-gray-500 ml-[16.67%]",children:"字段继承模型主表时间口径"}),di.jsxs(L,{gutter:16,align:"middle",children:[di.jsx(P,{span:4,style:{textAlign:"right"},children:di.jsx("span",{children:"组织范围:"})}),di.jsx(P,{span:20,children:di.jsx(W.Item,{name:"orgScope",style:{marginBottom:0},children:di.jsx(_e,{multiple:!0,placeholder:"请选择组织范围",treeData:w.map(e=>({title:e.name,value:e.id,key:e.id}))})})})]}),di.jsxs(L,{gutter:16,align:"middle",children:[di.jsx(P,{span:4,style:{textAlign:"right"},children:di.jsx("span",{children:"产品:"})}),di.jsx(P,{span:20,children:di.jsx(W.Item,{name:"productCategory",style:{marginBottom:0},children:di.jsx(E,{onClick:()=>{G.info({title:"选择产品",width:900,content:di.jsx(Y,{dataSource:[{id:"1",materialCode:"MAT001",materialName:"IVD试剂A",brand:"Roche",specification:"100ml",model:"R001",itemCode:"IT001"},{id:"2",materialCode:"MAT002",materialName:"医疗器械B",brand:"Siemens",specification:"50ml",model:"S002",itemCode:"IT002"},{id:"3",materialCode:"MAT003",materialName:"药品C",brand:"Abbott",specification:"200ml",model:"A003",itemCode:"IT003"},{id:"4",materialCode:"MAT004",materialName:"耗材D",brand:"BD",specification:"10个/盒",model:"B004",itemCode:"IT004"},{id:"5",materialCode:"MAT005",materialName:"设备E",brand:"GE",specification:"台",model:"G005",itemCode:"IT005"}],rowKey:"id",rowSelection:{type:"checkbox",onChange:(e,t)=>{}},pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`共 ${e} 条记录，当前显示 ${t[0]}-${t[1]} 条`},columns:[{title:"物料编码",dataIndex:"materialCode",key:"materialCode",width:120},{title:"物料名称",dataIndex:"materialName",key:"materialName",width:150},{title:"品牌",dataIndex:"brand",key:"brand",width:100},{title:"规格",dataIndex:"specification",key:"specification",width:120},{title:"型号",dataIndex:"model",key:"model",width:100},{title:"货号",dataIndex:"itemCode",key:"itemCode",width:100}]})})},children:"请选择产品"})})})]}),di.jsxs(L,{gutter:16,align:"middle",children:[di.jsx(P,{span:4,style:{textAlign:"right"},children:di.jsx("span",{children:"品牌:"})}),di.jsx(P,{span:20,children:di.jsx(W.Item,{name:"productBrand",style:{marginBottom:0},children:di.jsx(E,{onClick:()=>{G.info({title:"选择品牌",width:900,content:di.jsx(Y,{dataSource:[{id:"1",brandCode:"BR001",brandName:"Roche",brandType:"国际品牌",country:"瑞士",establishYear:"1896",mainProducts:"IVD试剂、诊断设备"},{id:"2",brandCode:"BR002",brandName:"Siemens",brandType:"国际品牌",country:"德国",establishYear:"1847",mainProducts:"医疗设备、影像设备"},{id:"3",brandCode:"BR003",brandName:"Abbott",brandType:"国际品牌",country:"美国",establishYear:"1888",mainProducts:"药品、医疗器械"},{id:"4",brandCode:"BR004",brandName:"BD",brandType:"国际品牌",country:"美国",establishYear:"1897",mainProducts:"医疗耗材、注射器"},{id:"5",brandCode:"BR005",brandName:"GE Healthcare",brandType:"国际品牌",country:"美国",establishYear:"1994",mainProducts:"医疗设备、影像系统"}],rowKey:"id",rowSelection:{type:"checkbox",onChange:(e,t)=>{}},pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`共 ${e} 条记录，当前显示 ${t[0]}-${t[1]} 条`},columns:[{title:"品牌编码",dataIndex:"brandCode",key:"brandCode",width:120},{title:"品牌名称",dataIndex:"brandName",key:"brandName",width:150},{title:"品牌类型",dataIndex:"brandType",key:"brandType",width:100},{title:"国家/地区",dataIndex:"country",key:"country",width:120},{title:"成立年份",dataIndex:"establishYear",key:"establishYear",width:100},{title:"主营产品",dataIndex:"mainProducts",key:"mainProducts",width:200}]})})},children:"请选择品牌"})})})]}),di.jsxs(L,{gutter:16,align:"middle",children:[di.jsx(P,{span:4,style:{textAlign:"right"},children:di.jsx("span",{children:"供应商:"})}),di.jsx(P,{span:20,children:di.jsx(W.Item,{name:"vendorScope",style:{marginBottom:0},children:di.jsx(E,{onClick:()=>{G.info({title:"选择供应商",width:900,content:di.jsx(Y,{dataSource:[{id:"1",vendorCode:"VD001",vendorName:"上海医疗器械有限公司",vendorType:"代理商",region:"华东地区",contactPerson:"张经理",businessScope:"IVD试剂、医疗设备"},{id:"2",vendorCode:"VD002",vendorName:"北京康复医疗科技股份有限公司",vendorType:"制造商",region:"华北地区",contactPerson:"李总监",businessScope:"康复设备、理疗器械"},{id:"3",vendorCode:"VD003",vendorName:"广州生物医药集团",vendorType:"经销商",region:"华南地区",contactPerson:"王主任",businessScope:"生物制品、药品"},{id:"4",vendorCode:"VD004",vendorName:"深圳精密医疗器械制造厂",vendorType:"制造商",region:"华南地区",contactPerson:"陈工程师",businessScope:"精密器械、手术器具"},{id:"5",vendorCode:"VD005",vendorName:"成都医疗耗材供应链公司",vendorType:"供应商",region:"西南地区",contactPerson:"刘采购",businessScope:"一次性耗材、防护用品"}],rowKey:"id",rowSelection:{type:"checkbox",onChange:(e,t)=>{}},pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`共 ${e} 条记录，当前显示 ${t[0]}-${t[1]} 条`},columns:[{title:"供应商编码",dataIndex:"vendorCode",key:"vendorCode",width:120},{title:"供应商名称",dataIndex:"vendorName",key:"vendorName",width:200},{title:"供应商类型",dataIndex:"vendorType",key:"vendorType",width:100},{title:"所属区域",dataIndex:"region",key:"region",width:120},{title:"联系人",dataIndex:"contactPerson",key:"contactPerson",width:100},{title:"经营范围",dataIndex:"businessScope",key:"businessScope",width:200}]})})},children:"请选择供应商"})})})]}),di.jsxs(L,{gutter:16,align:"middle",children:[di.jsx(P,{span:4,style:{textAlign:"right"},children:di.jsx("span",{children:"其他条件:"})}),di.jsxs(P,{span:20,children:[di.jsx(E,{type:"dashed",icon:di.jsx(K,{}),children:"添加条件"}),di.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"来自模型白名单字段；支持继承到基准"})]})]}),di.jsx($,{message:"空基准行处理策略",description:di.jsx(W.Item,{name:"onMissingBaseline",style:{marginBottom:0},children:di.jsxs(Ie.Group,{children:[di.jsx(Ie,{value:"keep",children:"保留"}),di.jsx(Ie,{value:"filter",children:"过滤"}),di.jsx(Ie,{value:"mark",children:"标记"})]})}),type:"info",showIcon:!0})]});case 3:return di.jsxs("div",{className:"space-y-6",children:[di.jsx($,{message:"透视表配置",description:"配置AntV/S2透视表的行列布局、数值字段和展示样式",type:"info",showIcon:!0,style:{marginBottom:24}}),di.jsxs(D,{title:"透视表结构",size:"small",style:{marginBottom:16},children:[di.jsxs(L,{gutter:24,children:[di.jsx(P,{span:8,children:di.jsxs("div",{className:"mb-4",children:[di.jsx(aa,{strong:!0,className:"block mb-2",children:"行字段 (Rows)"}),di.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"拖拽字段到此区域作为行维度"}),di.jsx("div",{className:"border border-dashed border-gray-300 rounded p-3 min-h-[120px] bg-gray-50",children:di.jsxs("div",{className:"space-y-2",children:[di.jsx(B,{color:"blue",children:"供应商"}),di.jsx(B,{color:"blue",children:"采购组织"})]})})]})}),di.jsx(P,{span:8,children:di.jsxs("div",{className:"mb-4",children:[di.jsx(aa,{strong:!0,className:"block mb-2",children:"列字段 (Columns)"}),di.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"拖拽字段到此区域作为列维度"}),di.jsx("div",{className:"border border-dashed border-gray-300 rounded p-3 min-h-[120px] bg-gray-50",children:di.jsx("div",{className:"space-y-2",children:di.jsx(B,{color:"green",children:"商品类别"})})})]})}),di.jsx(P,{span:8,children:di.jsxs("div",{className:"mb-4",children:[di.jsx(aa,{strong:!0,className:"block mb-2",children:"数值字段 (Values)"}),di.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"拖拽指标到此区域"}),di.jsx("div",{className:"border border-dashed border-gray-300 rounded p-3 min-h-[120px] bg-gray-50",children:di.jsxs("div",{className:"space-y-2",children:[di.jsx(B,{color:"orange",children:"协议价"}),di.jsx(B,{color:"orange",children:"差异率_b1"}),di.jsx(B,{color:"orange",children:"差异额_b1"})]})})]})})]}),di.jsx(V,{style:{margin:"16px 0"}}),di.jsxs("div",{className:"mb-4",children:[di.jsx(aa,{strong:!0,className:"block mb-2",children:"可用字段"}),di.jsx("div",{className:"border rounded p-3 bg-white",children:di.jsxs("div",{className:"flex flex-wrap gap-2",children:[di.jsx(B,{className:"cursor-pointer hover:bg-blue-100",children:"供应商"}),di.jsx(B,{className:"cursor-pointer hover:bg-blue-100",children:"采购组织"}),di.jsx(B,{className:"cursor-pointer hover:bg-blue-100",children:"商品"}),di.jsx(B,{className:"cursor-pointer hover:bg-blue-100",children:"商品类别"}),di.jsx(B,{className:"cursor-pointer hover:bg-blue-100",children:"品牌"}),di.jsx(B,{className:"cursor-pointer hover:bg-orange-100",children:"协议价"}),di.jsx(B,{className:"cursor-pointer hover:bg-orange-100",children:"基准价格_b1"}),di.jsx(B,{className:"cursor-pointer hover:bg-orange-100",children:"差异率_b1"}),di.jsx(B,{className:"cursor-pointer hover:bg-orange-100",children:"差异额_b1"})]})})]})]}),di.jsxs(D,{title:"展示配置",size:"small",style:{marginBottom:16},children:[di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:8,children:di.jsx(W.Item,{name:"tableType",label:"表格类型",children:di.jsxs(q,{defaultValue:"pivot",placeholder:"选择表格类型",children:[di.jsx(sa,{value:"pivot",children:"透视表"}),di.jsx(sa,{value:"table",children:"明细表"}),di.jsx(sa,{value:"tree",children:"树形表"})]})})}),di.jsx(P,{span:8,children:di.jsx(W.Item,{name:"showTotals",label:"显示汇总",children:di.jsx(ke,{defaultChecked:!0})})}),di.jsx(P,{span:8,children:di.jsx(W.Item,{name:"showSubTotals",label:"显示小计",children:di.jsx(ke,{defaultChecked:!0})})})]}),di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:12,children:di.jsx(W.Item,{name:"orderBy",label:"排序字段",children:di.jsxs(q,{placeholder:"请选择排序字段",children:[di.jsx(sa,{value:"diff_rate_b1",children:"差异率_b1"}),di.jsx(sa,{value:"diff_amount_b1",children:"差异额_b1"}),di.jsx(sa,{value:"agreement_price",children:"协议价"})]})})}),di.jsx(P,{span:12,children:di.jsx(W.Item,{name:"orderDirection",label:"排序方向",children:di.jsxs(q,{placeholder:"请选择排序方向",children:[di.jsx(sa,{value:"desc",children:"降序"}),di.jsx(sa,{value:"asc",children:"升序"})]})})})]})]}),di.jsxs(D,{title:"样式配置",size:"small",style:{marginBottom:16},children:[di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:12,children:di.jsx(W.Item,{name:"theme",label:"主题风格",children:di.jsxs(q,{defaultValue:"default",placeholder:"选择主题",children:[di.jsx(sa,{value:"default",children:"默认"}),di.jsx(sa,{value:"gray",children:"简约灰"}),di.jsx(sa,{value:"colorful",children:"多彩"}),di.jsx(sa,{value:"dark",children:"深色"})]})})}),di.jsx(P,{span:12,children:di.jsx(W.Item,{name:"cellSize",label:"单元格大小",children:di.jsxs(q,{defaultValue:"default",placeholder:"选择大小",children:[di.jsx(sa,{value:"compact",children:"紧凑"}),di.jsx(sa,{value:"default",children:"默认"}),di.jsx(sa,{value:"loose",children:"宽松"})]})})})]}),di.jsxs("div",{className:"mb-4",children:[di.jsx(aa,{strong:!0,className:"block mb-2",children:"条件格式"}),di.jsxs("div",{className:"space-y-2",children:[di.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[di.jsxs("span",{className:"text-sm",children:["差异率 ",">"," 10% 时高亮显示"]}),di.jsxs("div",{className:"flex items-center gap-2",children:[di.jsx("div",{className:"w-4 h-4 bg-red-100 border border-red-300 rounded"}),di.jsx(E,{size:"small",type:"link",children:"编辑"})]})]}),di.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[di.jsxs("span",{className:"text-sm",children:["差异率 ","<"," -5% 时标记为绿色"]}),di.jsxs("div",{className:"flex items-center gap-2",children:[di.jsx("div",{className:"w-4 h-4 bg-green-100 border border-green-300 rounded"}),di.jsx(E,{size:"small",type:"link",children:"编辑"})]})]}),di.jsx(E,{type:"dashed",size:"small",icon:di.jsx(K,{}),children:"添加条件格式"})]})]})]}),di.jsx(D,{title:"导出配置",size:"small",children:di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:12,children:di.jsxs("div",{children:[di.jsx(aa,{strong:!0,className:"block mb-2",children:"导出格式"}),di.jsxs("div",{className:"space-x-4",children:[di.jsx(W.Item,{name:"exportExcel",valuePropName:"checked",style:{display:"inline-block",marginBottom:0},children:di.jsx(me,{defaultChecked:!0,children:"Excel"})}),di.jsx(W.Item,{name:"exportCsv",valuePropName:"checked",style:{display:"inline-block",marginBottom:0},children:di.jsx(me,{children:"CSV"})}),di.jsx(W.Item,{name:"exportApi",valuePropName:"checked",style:{display:"inline-block",marginBottom:0},children:di.jsx(me,{children:"API"})})]})]})}),di.jsx(P,{span:12,children:di.jsx(W.Item,{name:"exportFileName",label:"文件名模板",children:di.jsx(U,{placeholder:"比价结果_{YYYY-MM-DD}"})})})]})})]});case 4:return di.jsxs("div",{className:"space-y-4",children:[di.jsx($,{message:"预览比价结果并执行方案，确认无误后可保存并启用方案。",type:"info",showIcon:!0,style:{marginBottom:16}}),di.jsx($,{message:"SQL校验",description:"占位符就绪 ✓  对齐维度一致 ✓  时间口径：按月",type:"success",showIcon:!0,style:{marginBottom:16}}),di.jsxs(J,{wrap:!0,children:[di.jsx(E,{icon:di.jsx(de,{}),onClick:_,children:"生成SQL"}),di.jsx(E,{icon:di.jsx(je,{}),children:"预览样例10行"}),di.jsx(E,{type:"primary",icon:di.jsx(jl,{}),children:"执行"}),di.jsx(E,{icon:di.jsx(Ae,{}),children:"导出"}),di.jsx(E,{icon:di.jsx(Ll,{}),children:"配置调度"}),di.jsx(E,{children:"仅保存不执行"})]}),di.jsxs(L,{gutter:16,style:{marginTop:16},children:[di.jsx(P,{span:12,children:di.jsxs(D,{title:"执行统计",size:"small",children:[di.jsxs("div",{children:[di.jsx(aa,{strong:!0,children:"预计记录数:"})," 约 1,250 条"]}),di.jsxs("div",{children:[di.jsx(aa,{strong:!0,children:"执行时间:"})," 预计 2-3 秒"]}),di.jsxs("div",{children:[di.jsx(aa,{strong:!0,children:"数据更新:"})," 实时"]})]})}),di.jsx(P,{span:12,children:di.jsxs(D,{title:"方案状态",size:"small",children:[di.jsxs("div",{children:[di.jsx(aa,{strong:!0,children:"当前状态:"})," ",di.jsx(B,{color:"orange",children:"草稿"})]}),di.jsxs("div",{children:[di.jsx(aa,{strong:!0,children:"创建时间:"})," ",(new Date).toLocaleString()]}),di.jsxs("div",{children:[di.jsx(aa,{strong:!0,children:"修改时间:"})," ",(new Date).toLocaleString()]})]})})]})]});case 5:return di.jsxs("div",{className:"space-y-4",children:[di.jsx($,{message:"配置方案的自动执行调度和结果推送设置（可选）。",type:"info",showIcon:!0,style:{marginBottom:16}}),di.jsxs("div",{children:[di.jsx(aa,{strong:!0,children:"启用调度"}),di.jsxs("div",{className:"mt-2",children:[di.jsx(me,{children:"开启自动调度"}),di.jsx(aa,{className:"ml-2 text-sm text-gray-500",children:"开启后方案将按设定时间自动执行"})]})]}),di.jsxs("div",{children:[di.jsx(aa,{strong:!0,children:"调度频率"}),di.jsxs(Ie.Group,{defaultValue:"daily",className:"mt-2",children:[di.jsx(Ie,{value:"daily",children:"每日"}),di.jsx(Ie,{value:"weekly",children:"每周"}),di.jsx(Ie,{value:"monthly",children:"每月"}),di.jsx(Ie,{value:"custom",children:"自定义"})]})]}),di.jsxs("div",{children:[di.jsx(aa,{strong:!0,children:"执行时间"}),di.jsx(U,{style:{marginTop:8,width:120},placeholder:"09:00",defaultValue:"09:00"})]}),di.jsxs("div",{children:[di.jsx(aa,{strong:!0,children:"推送设置"}),di.jsxs("div",{className:"mt-2 space-y-2",children:[di.jsx(me,{children:"邮件推送"}),di.jsx(me,{children:"钉钉推送"}),di.jsx(me,{children:"企业微信推送"})]})]}),di.jsxs("div",{children:[di.jsx(aa,{strong:!0,children:"推送对象"}),di.jsxs(q,{mode:"multiple",style:{width:"100%",marginTop:8},placeholder:"选择推送对象",children:[di.jsx(sa,{value:"admin",children:"管理员"}),di.jsx(sa,{value:"buyer",children:"采购员"}),di.jsx(sa,{value:"finance",children:"财务"})]})]}),di.jsxs("div",{children:[di.jsx(aa,{strong:!0,children:"推送内容"}),di.jsx(me.Group,{className:"mt-2",children:di.jsxs("div",{className:"space-y-1",children:[di.jsx("div",{children:di.jsx(me,{value:"summary",children:"执行摘要"})}),di.jsx("div",{children:di.jsx(me,{value:"excel",children:"Excel附件"})}),di.jsx("div",{children:di.jsx(me,{value:"alert",children:"异常告警"})})]})})]})]});default:return null}})()})]}),di.jsx(G,{title:"SQL预览",open:g,onCancel:()=>y(!1),footer:[di.jsx(E,{onClick:()=>y(!1),children:"关闭"},"close"),di.jsx(E,{type:"primary",children:"复制SQL"},"copy")],width:800,children:di.jsx("pre",{className:"bg-gray-50 p-4 rounded text-sm overflow-auto max-h-96",children:v})})]})},group:"一期"},{title:"比对模型",to:"/comparison-model",icon:di.jsx(xt,{className:"h-4 w-4"}),component:()=>{var t,i,s;const[l]=W.useForm(),[n,a]=j.useState(!1),[d,r]=j.useState(["1","2","3"]),[o,p]=j.useState([]),[x,h]=j.useState(""),[u,f]=j.useState(""),[g,v]=j.useState(null),[b,C]=j.useState(new Map),[N,I]=j.useState([]),[w,S]=j.useState([]),[k,T]=j.useState(!1),[_,A]=j.useState(!1),[R,z]=j.useState(!1),[M,O]=j.useState(!1),[F,$]=j.useState([]),[V,H]=j.useState([]),[Q,Z]=j.useState(""),[ie,se]=j.useState(!1),[le,ne]=j.useState(null),[ae,de]=j.useState(new Map),[re,ce]=j.useState({comparison:[],baseline:{}}),[me,pe]=j.useState(!1),[xe,he]=j.useState(null),[ue,fe]=j.useState("comparison"),[ge,ye]=j.useState("");j.useEffect(()=>{if(N.length>0){const e=new Set(w.map(e=>e.id)),t=N.filter(t=>e.has(t.id));t.length!==N.length&&I(t)}},[w]);const[ve,be]=j.useState([]),[Ce,Ne]=j.useState(!1),[Ie,we]=j.useState(null),[Se,ke]=j.useState(""),[Te,_e]=j.useState(new Map),[Ae,Re]=j.useState(!1),[Ee,Me]=j.useState({title:"",content:""}),[De,Oe]=j.useState({}),[Le,Pe]=j.useState([]),[Be,Fe]=j.useState([]),[$e,Ve]=j.useState(!1),[He,qe]=j.useState(!1),Ue=[{id:"ds_agreement",name:"采购协议数据集",description:"包含所有采购协议的价格信息",recordCount:15420},{id:"ds_bid",name:"招标数据集",description:"历史招标数据和价格信息",recordCount:8930},{id:"ds_market",name:"市场价格数据集",description:"市场参考价格数据",recordCount:23450},{id:"ds_historical",name:"历史采购数据集",description:"历史采购记录和价格变化",recordCount:45670}],We=[{id:"field_1",fieldCode:"product_code",fieldName:"商品编码",fieldType:"string",displayName:"商品编码",attribute:"文本"},{id:"field_2",fieldCode:"product_name",fieldName:"商品名称",fieldType:"string",displayName:"商品名称",attribute:"文本"},{id:"field_3",fieldCode:"category",fieldName:"商品分类",fieldType:"string",displayName:"商品分类",attribute:"文本"},{id:"field_4",fieldCode:"brand",fieldName:"品牌",fieldType:"string",displayName:"品牌",attribute:"文本"},{id:"field_5",fieldCode:"supplier",fieldName:"供应商",fieldType:"string",displayName:"供应商",attribute:"文本"},{id:"field_6",fieldCode:"price",fieldName:"价格",fieldType:"number",displayName:"价格",attribute:"数值"},{id:"field_7",fieldCode:"quantity",fieldName:"数量",fieldType:"number",displayName:"数量",attribute:"数值"},{id:"field_8",fieldCode:"purchase_date",fieldName:"采购日期",fieldType:"date",displayName:"采购日期",attribute:"时间"}],Ke=()=>{x&&!o.includes(x)&&(p([...o,x]),h(""))},Ye=e=>{const t=Ge(e);Me(t),Re(!0)},Ge=e=>"字段"===e?{title:"字段说明",content:"字段是数据表中的列，定义了数据的类型和属性。字段编码用于程序识别，字段名称用于显示。"}:"所有标记"===e?{title:"标记使用说明",content:'\n          <div style="line-height: 1.8;">\n            <div style="margin-bottom: 12px;">\n              <strong>组织权限</strong>（橙色）：\n              <div style="margin-left: 16px; color: #666;">用于标识需要根据组织架构进行权限控制的字段，如部门、区域等。</div>\n            </div>\n            <div style="margin-bottom: 12px;">\n              <strong>敏感字段</strong>（红色）：\n              <div style="margin-left: 16px; color: #666;">用于标识包含敏感信息的字段，如价格、成本、个人隐私信息等。</div>\n            </div>\n            <div style="margin-bottom: 12px;">\n              <strong>主键</strong>（蓝色）：\n              <div style="margin-left: 16px; color: #666;">用于标识数据表的主键字段，确保数据记录的唯一性。</div>\n            </div>\n            <div>\n              <strong>必填</strong>（绿色）：\n              <div style="margin-left: 16px; color: #666;">用于标识必填字段，在数据录入时必须提供有效值。</div>\n            </div>\n          </div>\n        '}:{title:"",content:""},Qe=(e,t)=>("comparison"===t?b:Te).get(e)||[];return di.jsxs("div",{style:{padding:"24px",backgroundColor:"#f5f5f5",minHeight:"100vh"},children:[di.jsxs(D,{children:[di.jsx("style",{children:"\n          .ant-table-tbody > tr.ant-table-row-selected > td {\n            background-color: #f6ffed !important;\n          }\n          .ant-table-tbody > tr:hover > td {\n            background-color: #e6f7ff !important;\n          }\n          .ant-table-tbody > tr.ant-table-row-selected:hover > td {\n            background-color: #d9f7be !important;\n          }\n        "}),di.jsxs(W,{form:l,layout:"vertical",initialValues:{modelCode:"",modelName:"",modelDescription:""},children:[di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[di.jsx(Na,{level:3,style:{margin:0},children:"比对模型管理"}),di.jsxs(J,{children:[di.jsx(E,{type:"primary",icon:di.jsx(Tl,{}),loading:n,onClick:()=>y(e,null,function*(){try{a(!0),yield l.validateFields(),te.success("比对模型保存成功")}catch(e){}finally{a(!1)}}),children:"保存"}),di.jsx(E,{icon:di.jsx(je,{}),children:"预览"})]})]}),di.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"6px",marginBottom:"16px",backgroundColor:"#fff"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #f0f0f0",cursor:"pointer",backgroundColor:"#fafafa"},onClick:()=>{const e=d.includes("1")?d.filter(e=>"1"!==e):[...d,"1"];r(e)},children:[di.jsx("div",{style:{width:"4px",height:"20px",backgroundColor:"#1890ff",marginRight:"12px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"16px",fontWeight:"bold",color:"#333"},children:"基本信息"}),di.jsx("span",{style:{fontSize:"12px",color:"#999",transform:d.includes("1")?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s",marginLeft:"8px"},children:"▶"})]}),d.includes("1")&&di.jsxs("div",{style:{padding:"20px"},children:[di.jsxs(L,{gutter:24,style:{marginBottom:"16px"},children:[di.jsx(P,{span:8,children:di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx("span",{style:{width:"100px",textAlign:"right",marginRight:"12px",fontSize:"14px"},children:"模型编码："}),di.jsx(W.Item,{name:"modelCode",style:{flex:1,margin:0},rules:[{required:!0,message:"请输入模型编码"}],children:di.jsx(U,{placeholder:"请输入模型编码"})})]})}),di.jsx(P,{span:8,children:di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx("span",{style:{width:"100px",textAlign:"right",marginRight:"12px",fontSize:"14px"},children:"模型名称："}),di.jsx(W.Item,{name:"modelName",style:{flex:1,margin:0},rules:[{required:!0,message:"请输入模型名称"}],children:di.jsx(U,{placeholder:"请输入模型名称"})})]})}),di.jsx(P,{span:8,children:di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx("span",{style:{width:"100px",textAlign:"right",marginRight:"12px",fontSize:"14px"},children:"版本描述："}),di.jsx(W.Item,{name:"version",style:{flex:1,margin:0},initialValue:"V1",children:di.jsx(U,{placeholder:"请输入版本描述"})})]})})]}),di.jsx(L,{style:{marginBottom:"16px"},children:di.jsx(P,{span:24,children:di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx("span",{style:{width:"100px",textAlign:"right",marginRight:"12px",fontSize:"14px"},children:"数据连接："}),di.jsx(W.Item,{name:"dataConnection",style:{flex:1,margin:0,maxWidth:"300px"},children:di.jsxs(q,{placeholder:"请选择数据连接",value:u,onChange:e=>{f(e)},children:[di.jsx(ba,{value:"mysql_prod",children:"MySQL生产库"}),di.jsx(ba,{value:"oracle_dw",children:"Oracle数据仓库"}),di.jsx(ba,{value:"postgres_bi",children:"PostgreSQL BI库"}),di.jsx(ba,{value:"clickhouse_olap",children:"ClickHouse OLAP"})]})})]})})}),di.jsx(L,{style:{marginBottom:"16px"},children:di.jsx(P,{span:24,children:di.jsxs("div",{style:{display:"flex",alignItems:"flex-start"},children:[di.jsx("span",{style:{width:"100px",textAlign:"right",marginRight:"12px",fontSize:"14px",paddingTop:"6px"},children:"模型描述："}),di.jsx(W.Item,{name:"modelDescription",style:{flex:1,margin:0},children:di.jsx(Ca,{placeholder:"请输入模型描述",rows:3})})]})})}),di.jsx(L,{children:di.jsx(P,{span:24,children:di.jsxs("div",{style:{display:"flex",alignItems:"flex-start"},children:[di.jsx("span",{style:{width:"100px",textAlign:"right",marginRight:"12px",fontSize:"14px",paddingTop:"6px"},children:"模型分类："}),di.jsxs("div",{style:{flex:1},children:[di.jsx("div",{style:{marginBottom:"8px"},children:o.map(e=>di.jsx(B,{closable:!0,onClose:()=>{return t=e,void p(o.filter(e=>e!==t));var t},style:{marginBottom:"4px"},children:e},e))}),di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx(U,{value:x,onChange:e=>h(e.target.value),onPressEnter:Ke,placeholder:"输入标签后按回车添加",style:{width:"200px",marginRight:"8px"}}),di.jsx(E,{type:"dashed",icon:di.jsx(K,{}),onClick:Ke,style:{marginRight:"8px"},children:"添加标签"}),di.jsx(E,{type:"primary",ghost:!0,onClick:()=>{return e="同产品比对",void(o.includes(e)||p([...o,e]));var e},size:"small",children:"同产品比对"})]})]})]})})})]})]}),di.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"6px",marginBottom:"16px",backgroundColor:"#fff"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #f0f0f0",cursor:"pointer",backgroundColor:"#fafafa"},onClick:()=>{const e=d.includes("2")?d.filter(e=>"2"!==e):[...d,"2"];r(e)},children:[di.jsx("div",{style:{width:"4px",height:"20px",backgroundColor:"#52c41a",marginRight:"12px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"16px",fontWeight:"bold",color:"#333"},children:"比对数据集设置"}),di.jsx("span",{style:{fontSize:"12px",color:"#999",transform:d.includes("2")?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s",marginLeft:"8px"},children:"▶"})]}),d.includes("2")&&di.jsx("div",{style:{padding:"20px"},children:di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:8,children:di.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"4px",padding:"12px",minHeight:"300px"},children:[di.jsxs("div",{style:{marginBottom:"16px"},children:[di.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#333",marginBottom:"8px"},children:"比对数据集"}),di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx(U,{value:(null==g?void 0:g.name)||"",placeholder:"请选择比对数据集",readOnly:!0,style:{flex:1,cursor:"pointer"},onClick:()=>A(!0)}),di.jsx(E,{type:"primary",size:"small",style:{marginLeft:"8px"},onClick:()=>A(!0),children:"选择"})]})]}),di.jsxs("div",{style:{marginBottom:"16px"},children:[di.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#333",marginBottom:"8px"},children:"比对数据集字段"}),di.jsxs("div",{style:{border:"1px solid #d9d9d9",borderRadius:"6px",padding:"8px",minHeight:"32px",backgroundColor:"#fafafa",cursor:g?"pointer":"not-allowed",position:"relative"},onClick:()=>g&&O(!0),children:[N.length>0?di.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px",marginBottom:"4px"},children:N.map(e=>di.jsx(B,{closable:!0,color:"blue",onClose:t=>{t.preventDefault(),t.stopPropagation();const i=N.filter(t=>t.id!==e.id);I(i),S(w.filter(t=>t.id!==e.id))},style:{margin:0,fontSize:"12px",lineHeight:"20px"},children:e.fieldName},e.id))}):di.jsx("div",{style:{color:"#999",fontSize:"14px",lineHeight:"20px"},children:g?"点击选择比对字段":"请先选择比对数据集"}),di.jsx(E,{type:"primary",size:"small",style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)"},disabled:!g,onClick:e=>{e.stopPropagation(),O(!0)},children:"选择"})]})]})]})}),di.jsx(P,{span:16,children:di.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[di.jsx(D,{title:di.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#333"},children:["可用字段",g&&di.jsxs("span",{style:{fontSize:"12px",color:"#666",fontWeight:"normal"},children:["（",g.name,"）"]})]}),size:"small",style:{minHeight:"280px"},children:g?di.jsxs("div",{style:{border:"1px solid #d9d9d9",borderRadius:"6px",padding:"16px",minHeight:"320px",backgroundColor:"#fafafa"},children:[di.jsx(E,{type:"dashed",icon:di.jsx(K,{}),onClick:()=>{T(!0)},disabled:!g,children:"添加可用字段"}),w.length>0&&di.jsx("div",{style:{marginTop:"16px"},children:di.jsx(Y,{dataSource:w,rowKey:"id",size:"small",pagination:!1,scroll:{y:280},columns:[{title:"排序",key:"sort",width:40,render:(e,t,i)=>di.jsx("div",{style:{cursor:i>0?"grab":"default",color:i>0?"#666":"#ccc"},draggable:i>0,onDragStart:e=>{i>0&&e.dataTransfer.setData("text/plain",i.toString())},onDragOver:e=>{e.preventDefault()},onDrop:e=>{e.preventDefault();const t=parseInt(e.dataTransfer.getData("text/plain")),s=i;if(t!==s&&t>0){const e=[...w],[i]=e.splice(t,1);e.splice(s,0,i),S(e)}},children:di.jsx(Fs,{})})},{title:"显示名称",dataIndex:"displayName",key:"displayName",width:120,render:e=>di.jsx("div",{children:e})},{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:120},{title:di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:["字段名称",di.jsx(ll,{style:{color:"#999",cursor:"pointer"},onClick:()=>Ye("字段")})]}),dataIndex:"fieldName",key:"fieldName",width:120},{title:"字段类型",dataIndex:"fieldType",key:"fieldType",width:100,render:e=>di.jsx(B,{color:{string:"blue",number:"green",date:"orange"}[e]||"default",children:e})},{title:"属性",dataIndex:"attribute",key:"attribute",width:100,render:e=>di.jsx(B,{color:{"文本":"blue","数值":"green","时间":"orange"}[e]||"default",children:e})},{title:di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:["字段标记",di.jsx(ll,{style:{color:"#999",cursor:"pointer"},onClick:()=>Ye("所有标记")})]}),key:"fieldTags",width:150,render:(e,t)=>{const i=Qe(t.id,"comparison"),s=[{key:"organizationPermission",label:"组织权限",color:"orange"},{key:"sensitive",label:"敏感字段",color:"red"},{key:"primaryKey",label:"主键",color:"blue"},{key:"required",label:"必填",color:"green"}],l=s.filter(e=>!i.includes(e.key));return 0===i.length?di.jsx(oe,{menu:{items:l.map(e=>({key:e.key,label:di.jsx("span",{children:di.jsx(B,{color:e.color,style:{marginRight:8},children:e.label})}),onClick:()=>{const s=e,l=[...i,s.key],n=new Map(b);n.set(t.id,l),C(n),te.success(`已为"${t.displayName}"添加"${s.label}"标记`)}}))},trigger:["click"],children:di.jsx(E,{size:"small",icon:di.jsx(K,{}),style:{borderRadius:"50%",width:"28px",height:"28px",padding:0,display:"flex",alignItems:"center",justifyContent:"center"},type:"dashed"})}):di.jsxs(J,{size:4,children:[i.map(e=>{const l=s.find(t=>t.key===e);return di.jsx(oe,{menu:{items:[{key:"remove",label:"移除标记",danger:!0,onClick:()=>{const s=i.filter(t=>t!==e),n=new Map(b);s.length>0?n.set(t.id,s):n.delete(t.id),C(n),te.success(`已移除"${l.label}"标记`)}}]},trigger:["click"],children:di.jsx(B,{color:l.color,style:{cursor:"pointer"},children:l.label})},e)}),l.length>0&&di.jsx(oe,{menu:{items:l.map(e=>({key:e.key,label:di.jsx("span",{children:di.jsx(B,{color:e.color,style:{marginRight:8},children:e.label})}),onClick:()=>{const s=e,l=[...i,s.key],n=new Map(b);n.set(t.id,l),C(n),te.success(`已为"${t.displayName}"添加"${s.label}"标记`)}}))},trigger:["click"],children:di.jsx(E,{size:"small",type:"dashed",icon:di.jsx(ze,{})})})]})}},{title:"操作",key:"action",width:80,render:(e,t)=>di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{S(w.filter(e=>e.id!==t.id)),I(N.filter(e=>e.id!==t.id));const e=new Map(ae);e.delete(t.id),de(e),te.success("已删除字段")},title:"删除字段"})}]})})]}):di.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"320px",color:"#999",fontSize:"16px"},children:"请先选择比对数据集"})}),di.jsx(D,{title:di.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[di.jsx("div",{style:{fontSize:"14px",fontWeight:"bold"},children:"查询条件配置"}),di.jsx(E,{type:"primary",size:"small",icon:di.jsx(K,{}),onClick:()=>{fe("comparison"),he(null),pe(!0)},children:"新增查询条件"})]}),size:"small",style:{minHeight:"200px"},children:di.jsx(Y,{dataSource:re.comparison,columns:[{title:"条件名称",dataIndex:"name",key:"name",width:150},{title:"组件类型",dataIndex:"componentType",key:"componentType",width:120,render:e=>({input:"输入框",select:"下拉选择",multiSelect:"多选下拉",datePicker:"日期选择",dateRangePicker:"日期范围",numberRange:"数值范围"}[e]||e)},{title:"对应字段",dataIndex:"fieldId",key:"fieldId",width:150,render:e=>{const t=w.find(t=>t.id===e);return t?t.displayName:e}},{title:"是否必填",dataIndex:"required",key:"required",width:80,render:e=>di.jsx(B,{color:e?"red":"green",children:e?"是":"否"})},{title:"操作",key:"action",width:120,render:(e,t)=>di.jsxs(J,{size:"small",children:[di.jsx(E,{type:"text",size:"small",icon:di.jsx(X,{}),onClick:()=>{he(t),pe(!0)},title:"编辑"}),di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{const e=re.comparison.filter(e=>e.id!==t.id);ce(t=>m(c({},t),{comparison:e})),te.success("查询条件已删除")},title:"删除"})]})}],size:"small",pagination:!1,locale:{emptyText:'暂无查询条件，点击"新增查询条件"按钮添加'}})})]})})]})})]}),di.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"6px",marginBottom:"16px",backgroundColor:"#fff"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #f0f0f0",cursor:"pointer",backgroundColor:"#fafafa"},onClick:()=>{const e=d.includes("3")?d.filter(e=>"3"!==e):[...d,"3"];r(e)},children:[di.jsx("div",{style:{width:"4px",height:"20px",backgroundColor:"#fa8c16",marginRight:"12px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"16px",fontWeight:"bold",color:"#333"},children:"基准数据集设置"}),di.jsx("span",{style:{fontSize:"12px",color:"#999",transform:d.includes("3")?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s",marginLeft:"8px"},children:"▶"})]}),d.includes("3")&&di.jsx("div",{style:{padding:"20px"},children:di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:8,children:di.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"4px",padding:"12px",height:"450px"},children:[di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[di.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#333"},children:["基准数据集",Se&&di.jsxs("span",{style:{fontSize:"12px",color:"#666",fontWeight:"normal"},children:["（",null==(t=ve.find(e=>e.id===Se))?void 0:t.name,"）"]})]}),di.jsx(E,{type:"primary",size:"small",icon:di.jsx(K,{}),onClick:()=>qe(!0),children:"选择数据集"})]}),di.jsx("div",{style:{maxHeight:"380px",overflow:"auto"},children:0===ve.length?di.jsxs("div",{style:{textAlign:"center",color:"#999",padding:"40px 0",fontSize:"14px"},children:["暂无基准数据集",di.jsx("br",{}),di.jsx("span",{style:{fontSize:"12px"},children:'点击"选择数据集"按钮添加'})]}):di.jsx(Y,{dataSource:ve,rowKey:"id",size:"small",pagination:!1,scroll:{y:350},rowClassName:e=>Se===e.id?"ant-table-row-selected":"",onRow:e=>({onClick:()=>ke(e.id),style:{cursor:"pointer"}}),columns:[{title:"数据集名称",dataIndex:"name",key:"name",render:(e,t)=>di.jsx("div",{style:{fontWeight:Se===t.id?"bold":"normal"},children:e})},{title:"连接类型",dataIndex:"joinType",key:"joinType",width:160,render:(e,t)=>di.jsx(oe,{menu:{items:[{key:"INNER",label:di.jsxs("div",{children:[di.jsx("div",{style:{fontWeight:"bold"},children:"INNER JOIN"}),di.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"内连接"})]}),onClick:()=>{const e=ve.map(e=>e.id===t.id?m(c({},e),{joinType:"INNER JOIN"}):e);be(e),te.success("连接类型已更新为 INNER JOIN")}},{key:"LEFT",label:di.jsxs("div",{children:[di.jsx("div",{style:{fontWeight:"bold"},children:"LEFT JOIN"}),di.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"左连接"})]}),onClick:()=>{const e=ve.map(e=>e.id===t.id?m(c({},e),{joinType:"LEFT JOIN"}):e);be(e),te.success("连接类型已更新为 LEFT JOIN")}},{key:"RIGHT",label:di.jsxs("div",{children:[di.jsx("div",{style:{fontWeight:"bold"},children:"RIGHT JOIN"}),di.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"右连接"})]}),onClick:()=>{const e=ve.map(e=>e.id===t.id?m(c({},e),{joinType:"RIGHT JOIN"}):e);be(e),te.success("连接类型已更新为 RIGHT JOIN")}}]},trigger:["click"],children:di.jsxs(B,{color:"LEFT JOIN"===e?"blue":"RIGHT JOIN"===e?"orange":"green",style:{cursor:"pointer"},children:[e||"INNER JOIN"," ",di.jsx(ze,{style:{fontSize:"10px"}})]})})},{title:"操作",key:"action",width:80,render:(e,t)=>di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:e=>{e.stopPropagation();const i=ve.filter(e=>e.id!==t.id);be(i),Se===t.id&&ke("")},title:"删除"})}]})})]})}),di.jsx(P,{span:16,children:di.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"4px",padding:"16px",height:"450px"},children:[di.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:di.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#333"},children:["可用字段",Se&&di.jsxs("span",{style:{fontSize:"12px",color:"#666",fontWeight:"normal"},children:["（",null==(i=ve.find(e=>e.id===Se))?void 0:i.name,"）"]})]})}),Se?di.jsxs("div",{style:{border:"1px solid #d9d9d9",borderRadius:"6px",padding:"16px",minHeight:"320px",backgroundColor:"#fafafa"},children:[di.jsx(E,{type:"dashed",icon:di.jsx(K,{}),onClick:()=>Ve(!0),children:"添加可用字段"}),Le.length>0&&di.jsx("div",{style:{marginTop:"16px"},children:di.jsx(Y,{dataSource:Le,rowKey:"id",size:"small",pagination:!1,scroll:{y:200},columns:[{title:"排序",key:"sort",width:40,render:(e,t,i)=>di.jsx("div",{style:{cursor:i>0?"grab":"default",color:i>0?"#666":"#ccc"},draggable:i>0,onDragStart:e=>{i>0&&e.dataTransfer.setData("text/plain",i.toString())},onDragOver:e=>{e.preventDefault()},onDrop:e=>{e.preventDefault();const t=parseInt(e.dataTransfer.getData("text/plain")),s=i;if(t!==s&&t>0){const e=[...Le],[i]=e.splice(t,1);e.splice(s,0,i),Pe(e)}},children:di.jsx(Fs,{})})},{title:"显示名称",dataIndex:"displayName",key:"displayName",width:120,render:e=>di.jsx("div",{children:e})},{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:120},{title:di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:["字段名称",di.jsx(ll,{style:{color:"#999",cursor:"pointer"},onClick:()=>Ye("字段")})]}),dataIndex:"fieldName",key:"fieldName",width:120},{title:"字段类型",dataIndex:"fieldType",key:"fieldType",width:100,render:e=>di.jsx(B,{color:{string:"blue",number:"green",date:"orange"}[e]||"default",children:e})},{title:"属性",dataIndex:"attribute",key:"attribute",width:100,render:e=>di.jsx(B,{color:{"文本":"blue","数值":"green","时间":"orange"}[e]||"default",children:e})},{title:di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:["字段标记",di.jsx(ll,{style:{color:"#999",cursor:"pointer"},onClick:()=>Ye("所有标记")})]}),key:"fieldTags",width:150,render:(e,t)=>{const i=Qe(t.id,"baseline"),s=[{key:"organizationPermission",label:"组织权限",color:"orange"},{key:"sensitive",label:"敏感字段",color:"red"},{key:"primaryKey",label:"主键",color:"blue"},{key:"required",label:"必填",color:"green"}],l=s.filter(e=>!i.includes(e.key));return 0===i.length?di.jsx(oe,{menu:{items:l.map(e=>({key:e.key,label:di.jsx("span",{children:di.jsx(B,{color:e.color,style:{marginRight:8},children:e.label})}),onClick:()=>{const s=e,l=[...i,s.key],n=new Map(Te);n.set(t.id,l),_e(n),te.success(`已为"${t.fieldName}"添加"${s.label}"标记`)}}))},trigger:["click"],children:di.jsx(E,{size:"small",icon:di.jsx(K,{}),style:{borderRadius:"50%",width:"28px",height:"28px",padding:0,display:"flex",alignItems:"center",justifyContent:"center"},type:"dashed"})}):di.jsxs(J,{size:4,children:[i.map(e=>{const l=s.find(t=>t.key===e);return di.jsx(oe,{menu:{items:[{key:"remove",label:"移除标记",danger:!0,onClick:()=>{const s=i.filter(t=>t!==e),n=new Map(Te);s.length>0?n.set(t.id,s):n.delete(t.id),_e(n),te.success(`已移除"${l.label}"标记`)}}]},trigger:["click"],children:di.jsx(B,{color:l.color,style:{cursor:"pointer"},children:l.label})},e)}),l.length>0&&di.jsx(oe,{menu:{items:l.map(e=>({key:e.key,label:di.jsx("span",{children:di.jsx(B,{color:e.color,style:{marginRight:8},children:e.label})}),onClick:()=>{const s=e,l=[...i,s.key],n=new Map(Te);n.set(t.id,l),_e(n),te.success(`已为"${t.fieldName}"添加"${s.label}"标记`)}}))},trigger:["click"],children:di.jsx(E,{size:"small",type:"dashed",icon:di.jsx(ze,{})})})]})}},{title:"操作",key:"action",width:80,render:(e,t)=>di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{Pe(Le.filter(e=>e.id!==t.id)),te.success("已删除字段")}})}]})}),Se&&di.jsx(D,{title:di.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[di.jsx("div",{style:{fontSize:"14px",fontWeight:"bold"},children:"查询条件配置"}),di.jsx(E,{type:"primary",size:"small",icon:di.jsx(K,{}),onClick:()=>{fe("baseline"),ye(Se),he(null),pe(!0)},children:"新增查询条件"})]}),size:"small",style:{marginTop:"16px",minHeight:"200px"},children:di.jsx(Y,{dataSource:re.baseline[Se]||[],columns:[{title:"条件名称",dataIndex:"name",key:"name",width:150},{title:"组件类型",dataIndex:"componentType",key:"componentType",width:120,render:e=>({input:"输入框",select:"下拉选择",multiSelect:"多选下拉",datePicker:"日期选择",dateRangePicker:"日期范围",numberRange:"数值范围"}[e]||e)},{title:"对应字段",dataIndex:"fieldId",key:"fieldId",width:150,render:e=>{const t=Le.find(t=>t.id===e);return t?t.displayName:e}},{title:"是否必填",dataIndex:"required",key:"required",width:80,render:e=>di.jsx(B,{color:e?"red":"green",children:e?"是":"否"})},{title:"操作",key:"action",width:120,render:(e,t)=>di.jsxs(J,{size:"small",children:[di.jsx(E,{type:"text",size:"small",icon:di.jsx(X,{}),onClick:()=>{he(t),ye(Se),pe(!0)},title:"编辑"}),di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{const e=(re.baseline[Se]||[]).filter(e=>e.id!==t.id);ce(t=>m(c({},t),{baseline:m(c({},t.baseline),{[Se]:e})})),te.success("查询条件已删除")},title:"删除"})]})}],size:"small",pagination:!1,locale:{emptyText:'暂无查询条件，点击"新增查询条件"按钮添加'}})})]}):di.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"320px",color:"#999",fontSize:"16px"},children:"请先选择基准数据集"})]})})]})})]})]})]}),di.jsx(G,{title:"选择比对数据集字段",open:k,onCancel:()=>T(!1),onOk:()=>{T(!1),te.success("已添加字段")},width:800,children:di.jsx(Y,{rowSelection:{type:"checkbox",selectedRowKeys:w.map(e=>e.id),onChange:(e,t)=>{S(t)}},columns:[{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:120},{title:"字段名称",dataIndex:"fieldName",key:"fieldName",width:120},{title:"字段类型",dataIndex:"fieldType",key:"fieldType",width:100,render:e=>di.jsx(B,{color:{string:"blue",number:"green",date:"orange"}[e]||"default",children:e})},{title:"显示名称",dataIndex:"displayName",key:"displayName",width:120},{title:"属性",dataIndex:"attribute",key:"attribute",width:80,render:e=>di.jsx(B,{color:{"文本":"blue","数值":"green","时间":"orange"}[e]||"default",children:e})}],dataSource:w,rowKey:"id",size:"small",scroll:{y:300}})}),di.jsx(G,{title:"配置连接类型",open:Ce,onCancel:()=>{Ne(!1),we(null)},onOk:()=>{Ne(!1),we(null),te.success("连接类型配置成功")},width:500,children:di.jsxs("div",{style:{padding:"20px 0"},children:[di.jsx(Ia,{style:{fontSize:"14px",color:"#666",marginBottom:"16px",display:"block"},children:"请选择比对数据集与基准数据集的连接类型："}),di.jsxs(q,{defaultValue:Ie&&(null==(s=ve.find(e=>e.id===Ie))?void 0:s.joinType)||"INNER JOIN",style:{width:"100%"},size:"large",onChange:e=>{if(Ie){const t=ve.map(t=>t.id===Ie?m(c({},t),{joinType:e}):t);be(t)}},children:[di.jsx(ba,{value:"INNER JOIN",children:di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx(Ia,{strong:!0,children:"INNER JOIN"}),di.jsx(Ia,{type:"secondary",style:{fontSize:"12px"},children:"内连接 - 只返回匹配的记录"})]})}),di.jsx(ba,{value:"LEFT JOIN",children:di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx(Ia,{strong:!0,children:"LEFT JOIN"}),di.jsx(Ia,{type:"secondary",style:{fontSize:"12px"},children:"左连接 - 返回左表所有记录"})]})}),di.jsx(ba,{value:"RIGHT JOIN",children:di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx(Ia,{strong:!0,children:"RIGHT JOIN"}),di.jsx(Ia,{type:"secondary",style:{fontSize:"12px"},children:"右连接 - 返回右表所有记录"})]})})]}),di.jsx("div",{style:{marginTop:"16px",padding:"12px",backgroundColor:"#f6ffed",borderRadius:"4px"},children:di.jsx(Ia,{style:{fontSize:"12px",color:"#52c41a"},children:"提示：连接类型决定了比对数据集和基准数据集在关联时的数据匹配规则"})})]})}),di.jsx(G,{title:"选择基准数据集",open:He,onCancel:()=>qe(!1),onOk:()=>{qe(!1),te.success(`已选择 ${ve.length} 个数据集`)},width:800,children:di.jsx(Y,{rowSelection:{type:"checkbox",selectedRowKeys:ve.map(e=>e.id),onChange:(e,t)=>{const i=t.map(e=>m(c({},e),{joinType:"INNER JOIN"}));be(i)}},columns:[{title:"数据集名称",dataIndex:"name",key:"name",width:200},{title:"描述",dataIndex:"description",key:"description",width:300}],dataSource:Ue,rowKey:"id",size:"small",scroll:{y:300}})}),di.jsx(G,{title:"选择比对数据集",open:_,onCancel:()=>{A(!1),Z("")},onOk:()=>{const e=Ue.find(e=>e.id===Q);e?(v({id:e.id,name:e.name}),S([]),te.success(`已选择数据集：${e.name}`),A(!1),Z("")):te.warning("请选择一个数据集")},width:800,children:di.jsx(Y,{rowSelection:{type:"radio",selectedRowKeys:Q?[Q]:[],onChange:e=>{Z(e[0]||"")}},columns:[{title:"数据集名称",dataIndex:"name",key:"name",width:200},{title:"描述",dataIndex:"description",key:"description",width:300}],dataSource:Ue,rowKey:"id",size:"small",scroll:{y:300}})}),di.jsx(G,{title:"添加比对数据集字段",open:R,onCancel:()=>z(!1),onOk:()=>{const e=w.filter(e=>V.includes(e.id)),t=e.filter(e=>!N.some(t=>t.id===e.id));if(t.length>0&&I([...N,...t]),e.length>0){const t=new Set(e.map(e=>e.id)),i=w.filter(e=>!t.has(e.id)),s=w.filter(e=>t.has(e.id));S([...s,...i]),te.success(`已同步 ${s.length} 个字段到最前并加入比对数据集字段`)}z(!1),H([])},width:800,children:di.jsx(Y,{rowSelection:{type:"checkbox",selectedRowKeys:V,onChange:e=>{H(e)}},columns:[{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:120},{title:"字段名称",dataIndex:"fieldName",key:"fieldName",width:120},{title:"字段类型",dataIndex:"fieldType",key:"fieldType",width:100,render:e=>di.jsx(B,{color:{string:"blue",number:"green",date:"orange"}[e]||"default",children:e})},{title:"显示名称",dataIndex:"displayName",key:"displayName",width:120},{title:"属性",dataIndex:"attribute",key:"attribute",width:80,render:e=>di.jsx(B,{color:{"文本":"blue","数值":"green","时间":"orange"}[e]||"default",children:e})}],dataSource:w,rowKey:"id",size:"small",scroll:{y:300}})}),di.jsx(G,{title:"选择可用字段",open:M,onCancel:()=>{O(!1),H([])},onOk:()=>{const e=We.filter(e=>V.includes(e.id)),t=e.filter(e=>!N.some(t=>t.id===e.id));if(t.length>0&&I([...N,...t]),e.length>0){const t=new Set(e.map(e=>e.id)),i=w.filter(e=>!t.has(e.id)),s=e.filter(e=>!w.some(t=>t.id===e.id));S([...s,...i]),te.success(`已添加 ${e.length} 个字段到比对数据集字段和可用字段`)}O(!1),H([])},width:800,children:di.jsx(Y,{rowSelection:{type:"checkbox",selectedRowKeys:V,onChange:e=>{H(e)}},columns:[{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:120},{title:"字段名称",dataIndex:"fieldName",key:"fieldName",width:120},{title:"字段类型",dataIndex:"fieldType",key:"fieldType",width:100,render:e=>di.jsx(B,{color:{string:"blue",number:"green",date:"orange"}[e]||"default",children:e})},{title:"显示名称",dataIndex:"displayName",key:"displayName",width:120},{title:"属性",dataIndex:"attribute",key:"attribute",width:80,render:e=>di.jsx(B,{color:{"文本":"blue","数值":"green","时间":"orange"}[e]||"default",children:e})}],dataSource:We,rowKey:"id",size:"small",scroll:{y:300}})}),di.jsx(G,{title:"选择可用字段",open:k,onCancel:()=>T(!1),onOk:()=>{const e=We.filter(e=>F.includes(e.id)&&!w.some(t=>t.id===e.id));e.length>0&&(S([...w,...e]),te.success(`已添加 ${e.length} 个字段`)),T(!1),$([])},width:800,children:di.jsx(Y,{rowSelection:{type:"checkbox",selectedRowKeys:F,onChange:e=>{$(e)}},columns:[{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:120},{title:"字段名称",dataIndex:"fieldName",key:"fieldName",width:120},{title:"字段类型",dataIndex:"fieldType",key:"fieldType",width:100,render:e=>di.jsx(B,{color:{string:"blue",number:"green",date:"orange"}[e]||"default",children:e})},{title:"显示名称",dataIndex:"displayName",key:"displayName",width:120},{title:"属性",dataIndex:"attribute",key:"attribute",width:80,render:e=>di.jsx(B,{color:{"文本":"blue","数值":"green","时间":"orange"}[e]||"default",children:e})}],dataSource:We,rowKey:"id",size:"small",scroll:{y:300}})}),di.jsx(G,{title:"选择可用字段",open:$e,onCancel:()=>Ve(!1),onOk:()=>{const e=We.filter(e=>Be.includes(e.id)&&!Le.some(t=>t.id===e.id));e.length>0&&(Pe([...Le,...e]),te.success(`已添加 ${e.length} 个字段`)),Ve(!1),Fe([])},width:800,children:di.jsx(Y,{rowSelection:{type:"checkbox",selectedRowKeys:Be,onChange:e=>{Fe(e)}},columns:[{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:120},{title:"字段名称",dataIndex:"fieldName",key:"fieldName",width:120},{title:"字段类型",dataIndex:"fieldType",key:"fieldType",width:100,render:e=>di.jsx(B,{color:{string:"blue",number:"green",date:"orange"}[e]||"default",children:e})},{title:"显示名称",dataIndex:"displayName",key:"displayName",width:120},{title:"属性",dataIndex:"attribute",key:"attribute",width:80,render:e=>di.jsx(B,{color:{"文本":"blue","数值":"green","时间":"orange"}[e]||"default",children:e})}],dataSource:We,rowKey:"id",size:"small",scroll:{y:300}})}),di.jsx(va,{visible:ie,field:le,initialConfig:le?ae.get(le.id):void 0,onOk:e=>{if(le){const t=new Map(ae);t.set(le.id,e),de(t),te.success("字段配置已保存")}se(!1),ne(null)},onCancel:()=>{se(!1),ne(null)}}),di.jsx(G,{title:xe?"编辑查询条件":"新增查询条件",open:me,onCancel:()=>{pe(!1),he(null)},onOk:()=>y(e,null,function*(){try{const e=document.querySelector("#queryConditionForm");if(!e)return;const t=new FormData(e),i={id:(null==xe?void 0:xe.id)||`query_${Date.now()}`,name:t.get("name"),componentType:t.get("componentType"),fieldId:t.get("fieldId"),remark:t.get("remark"),required:"on"===t.get("required")};if(!i.name||!i.componentType||!i.fieldId)return void te.error("请填写所有必填字段");if("comparison"===ue){const e=xe?re.comparison.map(e=>e.id===xe.id?i:e):[...re.comparison,i];ce(t=>m(c({},t),{comparison:e}))}else{const e=re.baseline[ge]||[],t=xe?e.map(e=>e.id===xe.id?i:e):[...e,i];ce(e=>m(c({},e),{baseline:m(c({},e.baseline),{[ge]:t})}))}te.success(xe?"查询条件更新成功":"查询条件添加成功"),pe(!1),he(null)}catch(e){te.error("保存失败，请重试")}}),width:600,children:di.jsxs("form",{id:"queryConditionForm",style:{display:"flex",flexDirection:"column",gap:"16px"},children:[di.jsxs("div",{children:[di.jsxs("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px"},children:["条件名称 ",di.jsx("span",{style:{color:"red"},children:"*"})]}),di.jsx("input",{name:"name",type:"text",placeholder:"请输入条件名称",defaultValue:null==xe?void 0:xe.name,style:{width:"100%",padding:"8px",border:"1px solid #d9d9d9",borderRadius:"6px"}})]}),di.jsxs("div",{children:[di.jsxs("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px"},children:["组件类型 ",di.jsx("span",{style:{color:"red"},children:"*"})]}),di.jsxs("select",{name:"componentType",defaultValue:(null==xe?void 0:xe.componentType)||"",style:{width:"100%",padding:"8px",border:"1px solid #d9d9d9",borderRadius:"6px"},children:[di.jsx("option",{value:"",children:"请选择组件类型"}),di.jsx("option",{value:"input",children:"输入框"}),di.jsx("option",{value:"select",children:"下拉选择"}),di.jsx("option",{value:"multiSelect",children:"多选下拉"}),di.jsx("option",{value:"datePicker",children:"日期选择"}),di.jsx("option",{value:"dateRangePicker",children:"日期范围"}),di.jsx("option",{value:"numberRange",children:"数值范围"})]})]}),di.jsxs("div",{children:[di.jsxs("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px"},children:["对应字段 ",di.jsx("span",{style:{color:"red"},children:"*"})]}),di.jsxs("select",{name:"fieldId",defaultValue:(null==xe?void 0:xe.fieldId)||"",style:{width:"100%",padding:"8px",border:"1px solid #d9d9d9",borderRadius:"6px"},children:[di.jsx("option",{value:"",children:"请选择对应字段"}),("comparison"===ue?w:Le).map(e=>di.jsxs("option",{value:e.id,children:[e.displayName," (",e.fieldName,")"]},e.id))]})]}),di.jsxs("div",{children:[di.jsx("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px"},children:"备注"}),di.jsx("textarea",{name:"remark",placeholder:"可选的备注说明",defaultValue:(null==xe?void 0:xe.remark)||"",rows:2,style:{width:"100%",padding:"8px",border:"1px solid #d9d9d9",borderRadius:"6px",resize:"vertical"}})]}),di.jsx("div",{children:di.jsxs("label",{style:{display:"flex",alignItems:"center",fontSize:"14px"},children:[di.jsx("input",{type:"checkbox",name:"required",defaultChecked:(null==xe?void 0:xe.required)||!1,style:{marginRight:"8px"}}),"是否必填"]})})]})}),di.jsx(G,{title:Ee.title,open:Ae,onCancel:()=>Re(!1),footer:[di.jsx(E,{onClick:()=>Re(!1),children:"我知道了"},"close")],width:600,children:di.jsx("div",{dangerouslySetInnerHTML:{__html:Ee.content}})})]})},group:"二期"},{title:"比价方案新版",to:"/price-scheme-v2",icon:di.jsx(ht,{className:"h-4 w-4"}),component:()=>{const[t]=W.useForm(),i=(e,t)=>{for(const s of e){if(s.value===t)return s;if(s.children){const e=i(s.children,t);if(e)return e}}return null},s=({organization:e,level:t,selectedValue:i,onChange:l})=>{const n=24*t;return di.jsxs("div",{style:{paddingLeft:n},children:[di.jsx(Ie,{value:e.value,checked:i===e.value,onChange:e=>l(e.target.value),style:{marginBottom:"4px"},children:di.jsx("span",{style:{fontWeight:0===t?500:"normal"},children:e.title})}),e.children&&e.children.map(e=>di.jsx(s,{organization:e,level:t+1,selectedValue:i,onChange:l},e.value))]})},[l,n]=j.useState(!1),[a,d]=j.useState(!1),[r,o]=j.useState(["1","2","3"]),[p,x]=j.useState(!0),[h,u]=j.useState(!1),[f,g]=j.useState(!1),[v,b]=j.useState([]),[C,N]=j.useState([]),[I,w]=j.useState(0),[S,k]=j.useState([]),[T,_]=j.useState(null),[A,R]=j.useState([]),[z,M]=j.useState(!1),[O,F]=j.useState(!1),[V,H]=j.useState({objectName:"",datasetId:""}),[Q,Z]=j.useState([]),[ie,le]=j.useState({object:"",indicator:"",queryScope:{}}),[ne,ae]=j.useState(""),[de,re]=j.useState(!1),[me,pe]=j.useState(null),[xe,he]=j.useState({dataset:"",indicator:"",queryScope:{}}),[ue,fe]=j.useState([]),ye=[{id:"org",name:"管理组织",inputType:"select",gridSpan:1,options:["集团组织","事业部A","子公司B"]},{id:"vendor",name:"供应商",inputType:"select",gridSpan:1,options:["供应商A","供应商B","供应商C"]},{id:"category",name:"品类",inputType:"select",gridSpan:1,options:["品类X","品类Y","品类Z"]},{id:"productName",name:"产品名称",inputType:"text",gridSpan:1},{id:"priceRange",name:"价格范围",inputType:"numberRange",gridSpan:2},{id:"timeRange",name:"时间范围",inputType:"dateRange",gridSpan:2}],je=e=>ye.find(t=>t.id===e),ve=e=>{const t=je(e);if(!t)return 1;if("number"==typeof t.gridSpan)return t.gridSpan;switch(t.inputType){case"numberRange":case"dateRange":return 2;default:return 1}},Ce=e=>{const t=je(e.id);if(!t)return di.jsx(U,{size:"small",style:{width:"100%"},value:e.values[0]||"",onChange:t=>{const i=t.target.value;N(t=>t.map(t=>t.id===e.id?m(c({},t),{values:[String(i)]}):t))},placeholder:"请输入默认值"});switch(t.inputType){case"text":return di.jsx(U,{size:"small",style:{width:"100%"},value:e.values[0]||"",onChange:t=>{const i=t.target.value;N(t=>t.map(t=>t.id===e.id?m(c({},t),{values:[String(i)]}):t))},placeholder:`设置${t.name}默认值`});case"select":return di.jsx(q,{size:"small",style:{width:"100%"},placeholder:`选择${t.name}默认值`,value:e.values[0]||void 0,onChange:t=>{N(i=>i.map(i=>i.id===e.id?m(c({},i),{values:[String(t)]}):i))},children:(t.options||[]).map(e=>di.jsx(xa,{value:e,children:e},e))});case"numberRange":return di.jsxs(J,{size:4,children:[di.jsx(ge,{size:"small",style:{width:100},value:void 0!==e.values[0]&&""!==e.values[0]?Number(e.values[0]):void 0,onChange:t=>{const i=null===t?"":String(t);N(t=>t.map(t=>t.id===e.id?m(c({},t),{values:[i,t.values[1]||""]}):t))},placeholder:"最小值"}),di.jsx("span",{style:{color:"#999"},children:"至"}),di.jsx(ge,{size:"small",style:{width:100},value:void 0!==e.values[1]&&""!==e.values[1]?Number(e.values[1]):void 0,onChange:t=>{const i=null===t?"":String(t);N(t=>t.map(t=>t.id===e.id?m(c({},t),{values:[t.values[0]||"",i]}):t))},placeholder:"最大值"})]});case"dateRange":return di.jsx(ga,{size:"small",style:{width:"100%"},value:e.values[0]&&e.values[1]?[be(e.values[0]),be(e.values[1])]:void 0,onChange:t=>{var i,s;const l=null!=(i=null==t?void 0:t[0])?i:null,n=null!=(s=null==t?void 0:t[1])?s:null;N(l&&n?t=>t.map(t=>t.id===e.id?m(c({},t),{values:[l.format("YYYY-MM-DD"),n.format("YYYY-MM-DD")]}):t):t=>t.map(t=>t.id===e.id?m(c({},t),{values:[]}):t))}});default:return di.jsx(U,{size:"small",value:e.values[0]||"",onChange:t=>{const i=t.target.value;N(t=>t.map(t=>t.id===e.id?m(c({},t),{values:[String(i)]}):t))},placeholder:`设置${t.name}默认值`})}},Ne=e=>{const t=je(e.id);if(!t)return di.jsx(U,{size:"small",style:{width:"100%"},value:e.values||"",onChange:t=>{const i=t.target.value;Le(t=>t.map(t=>t.id===e.id?m(c({},t),{values:String(i)}):t))},placeholder:"请输入默认值"});switch(t.inputType){case"text":return di.jsx(U,{size:"small",style:{width:"100%"},value:e.values||"",onChange:t=>{const i=t.target.value;Le(t=>t.map(t=>t.id===e.id?m(c({},t),{values:String(i)}):t))},placeholder:`设置${t.name}默认值`});case"select":return di.jsx(q,{size:"small",style:{width:"100%"},placeholder:`选择${t.name}默认值`,value:e.values||void 0,onChange:t=>{Le(i=>i.map(i=>i.id===e.id?m(c({},i),{values:String(t)}):i))},children:(t.options||[]).map(e=>di.jsx(xa,{value:e,children:e},e))});case"numberRange":const i=e.values?e.values.split(","):["",""];return di.jsxs(J,{size:4,children:[di.jsx(ge,{size:"small",style:{width:100},value:""!==i[0]?Number(i[0]):void 0,onChange:t=>{const s=null===t?"":String(t);Le(t=>t.map(t=>t.id===e.id?m(c({},t),{values:`${s},${i[1]||""}`}):t))},placeholder:"最小值"}),di.jsx("span",{style:{color:"#999"},children:"至"}),di.jsx(ge,{size:"small",style:{width:100},value:""!==i[1]?Number(i[1]):void 0,onChange:t=>{const s=null===t?"":String(t);Le(t=>t.map(t=>t.id===e.id?m(c({},t),{values:`${i[0]||""},${s}`}):t))},placeholder:"最大值"})]});case"dateRange":const s=e.values?e.values.split(","):["",""];return di.jsx(ga,{size:"small",style:{width:"100%"},value:s[0]&&s[1]?[be(s[0]),be(s[1])]:void 0,onChange:t=>{var i,s;const l=null!=(i=null==t?void 0:t[0])?i:null,n=null!=(s=null==t?void 0:t[1])?s:null;Le(l&&n?t=>t.map(t=>t.id===e.id?m(c({},t),{values:`${l.format("YYYY-MM-DD")},${n.format("YYYY-MM-DD")}`}):t):t=>t.map(t=>t.id===e.id?m(c({},t),{values:""}):t))}});default:return di.jsx(U,{size:"small",value:e.values||"",onChange:t=>{const i=t.target.value;Le(t=>t.map(t=>t.id===e.id?m(c({},t),{values:String(i)}):t))},placeholder:`设置${t.name}默认值`})}},[we,Se]=j.useState([]),[ke,Te]=j.useState(!1),[_e,Ae]=j.useState([]),[ze,Ee]=j.useState(null),[Me,De]=j.useState(!1),[Oe,Le]=j.useState([]),[Pe,Be]=j.useState(!1),[Fe,$e]=j.useState(!1),[Ve,He]=j.useState([]),[qe,Ue]=j.useState([]),[We,Ke]=j.useState(!1),[Ye,Ge]=j.useState([]),Qe=[{id:"supplier_v3",modelId:"supplier",name:"供应商比对模型",description:"按供应商维度进行比价分析",version:"V3",isLatest:!0},{id:"product_v2",modelId:"product",name:"产品比对模型",description:"按产品维度进行比价分析",version:"V2",isLatest:!0},{id:"category_v2",modelId:"category",name:"品类比对模型",description:"按品类维度进行比价分析",version:"V2",isLatest:!0},{id:"brand_v1",modelId:"brand",name:"品牌比对模型",description:"按品牌维度进行比价分析",version:"V1",isLatest:!0}],Je=[{id:"agreement_price",name:"协议价格",unit:"元",description:"采购协议中的价格",expression:"SUM(协议价格)"},{id:"bid_price",name:"招标价格",unit:"元",description:"招标过程中的报价",expression:"AVG(招标价格)"},{id:"market_price",name:"市场价格",unit:"元",description:"市场参考价格",expression:"MAX(市场价格)"},{id:"discount_rate",name:"折扣率",unit:"%",description:"相对于标准价格的折扣",expression:"(标准价格-实际价格)/标准价格*100"}],Xe=[{id:"ds_agreement",name:"采购协议数据集",description:"包含所有采购协议的价格信息",recordCount:15420},{id:"ds_bid",name:"招标数据集",description:"历史招标数据和价格信息",recordCount:8930},{id:"ds_market",name:"市场价格数据集",description:"市场参考价格数据",recordCount:23450},{id:"ds_historical",name:"历史采购数据集",description:"历史采购记录和价格变化",recordCount:45670}],Ze=[{field:"product_code",name:"商品编码",type:"string",attribute:"文本"},{field:"product_name",name:"商品名称",type:"string",attribute:"文本"},{field:"category",name:"商品分类",type:"string",attribute:"文本"},{field:"brand",name:"品牌",type:"string",attribute:"文本"},{field:"supplier",name:"供应商",type:"string",attribute:"文本"},{field:"region",name:"地区",type:"string",attribute:"文本"},{field:"price",name:"价格",type:"number",attribute:"数值"},{field:"quantity",name:"数量",type:"number",attribute:"数值"},{field:"purchase_date",name:"采购日期",type:"date",attribute:"时间"}],et=[{title:"集团总部",value:"org_group",key:"org_group",children:[{title:"子公司A",value:"org_subsidiary_a",key:"org_subsidiary_a"},{title:"子公司B",value:"org_subsidiary_b",key:"org_subsidiary_b"}]},{title:"分公司",value:"org_branch",key:"org_branch",children:[{title:"华东分公司",value:"org_branch_east",key:"org_branch_east"},{title:"华南分公司",value:"org_branch_south",key:"org_branch_south"}]}],tt=(e,t,i)=>{const s=[...ue];s[e]=m(c({},s[e]),{[t]:i}),fe(s)};return di.jsxs("div",{style:{padding:"24px",backgroundColor:"#f5f5f5",minHeight:"100vh"},children:[di.jsxs(D,{children:[di.jsxs("div",{style:{marginBottom:"24px"},children:[di.jsx(ua,{level:3,children:"新建比价方案"}),di.jsx(fa,{type:"secondary",children:"配置比对对象、基准对象和分析指标，创建个性化的比价分析方案"})]}),di.jsxs("div",{style:{marginBottom:"32px"},children:[di.jsx("div",{style:{fontSize:"18px",fontWeight:"600",color:"#262626",textAlign:"center"},children:"比价配置"}),di.jsx("div",{style:{fontSize:"14px",color:"#8c8c8c",textAlign:"center",marginTop:"8px"},children:"配置比对对象、基准对象和分析指标"})]}),di.jsxs(W,{form:t,layout:"vertical",onFinish:i=>y(e,null,function*(){try{n(!0),m(c({},i),{comparisonConfig:ie,baselineConfig:xe,analysisMetrics:ue,createdAt:be().format("YYYY-MM-DD HH:mm:ss")}),yield new Promise(e=>setTimeout(e,1e3)),te.success("比价方案创建成功！"),t.resetFields(),le({object:"",indicator:"",queryScope:{}}),he({dataset:"",indicator:"",queryScope:{}}),fe([])}catch(e){te.error("创建失败，请重试")}finally{n(!1)}}),initialValues:{enabled:!0,timeRange:[be().subtract(3,"month"),be()]},children:[di.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"6px",marginBottom:"16px",backgroundColor:"#fff"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px 16px",borderBottom:p?"1px solid #f0f0f0":"none",cursor:"pointer",backgroundColor:"#fafafa"},onClick:()=>x(!p),children:[di.jsx("div",{style:{width:"4px",height:"20px",backgroundColor:"#1890ff",marginRight:"12px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"16px",fontWeight:"bold",color:"#1890ff"},children:"基本信息"}),di.jsx("span",{style:{fontSize:"12px",color:"#999",transform:p?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s",marginLeft:"8px"},children:"▶"}),di.jsx("div",{style:{flex:1}})]}),p&&di.jsxs("div",{style:{padding:"16px"},children:[di.jsxs(L,{gutter:[16,16],children:[di.jsx(P,{span:8,children:di.jsxs("div",{style:{display:"flex",alignItems:"center",height:"32px"},children:[di.jsx("span",{style:{width:"80px",textAlign:"right",marginRight:"8px"},children:"方案编码:"}),di.jsx(W.Item,{name:"schemeCode",style:{flex:1,margin:0},rules:[{required:!0,message:"请输入方案编码"}],children:di.jsx(U,{placeholder:"请输入方案编码"})})]})}),di.jsx(P,{span:8,children:di.jsxs("div",{style:{display:"flex",alignItems:"center",height:"32px"},children:[di.jsx("span",{style:{width:"80px",textAlign:"right",marginRight:"8px"},children:"方案名称:"}),di.jsx(W.Item,{name:"schemeName",style:{flex:1,margin:0},rules:[{required:!0,message:"请输入方案名称"}],children:di.jsx(U,{placeholder:"请输入方案名称"})})]})}),di.jsx(P,{span:8,children:di.jsxs("div",{style:{display:"flex",alignItems:"center",height:"32px"},children:[di.jsx("span",{style:{width:"80px",textAlign:"right",marginRight:"8px"},children:"比对模型:"}),di.jsx("div",{style:{position:"relative",flex:1},children:di.jsx(W.Item,{name:"comparisonModel",style:{margin:0},rules:[{required:!0,message:"请选择比对模型"}],children:di.jsx(q,{placeholder:"请选择比对模型",onChange:e=>{const i=Qe.find(t=>t.id===e);i&&(t.setFieldsValue({comparisonModel:e}),pe(m(c({},i),{isLatest:!0})))},value:t.getFieldValue("comparisonModel"),optionRender:e=>{const t=Qe.find(t=>t.id===e.value);return t?di.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"4px 0"},children:[di.jsx("span",{children:t.name}),di.jsx(B,{color:"blue",style:{fontSize:"11px",margin:0},children:t.version})]}):e.label},children:Qe.map(e=>di.jsx(xa,{value:e.id,label:e.name,children:e.name},e.id))})})})]})})]}),di.jsx(L,{gutter:[16,16],style:{marginTop:"16px"},children:di.jsx(P,{span:24,children:di.jsxs("div",{style:{display:"flex",alignItems:"center",height:"32px"},children:[di.jsx("span",{style:{width:"80px",textAlign:"right",marginRight:"8px",fontSize:"14px"},children:"管理组织:"}),di.jsxs("div",{style:{flex:1,maxWidth:"400px",padding:"4px 8px",border:"1px solid #d9d9d9",borderRadius:"4px",backgroundColor:"#fff",cursor:"pointer",minHeight:"32px",display:"flex",alignItems:"center",justifyContent:"space-between"},onClick:()=>re(!0),children:[ne?di.jsx("span",{style:{fontSize:"14px"},children:(e=>{const t=i(et,e);return t?t.title:e})(ne)}):di.jsx("span",{style:{fontSize:"14px",color:"#bfbfbf"},children:"点击选择管理组织"}),di.jsx(Rl,{style:{color:"#bfbfbf",fontSize:"12px"}})]})]})})}),di.jsx(L,{gutter:[16,16],style:{marginTop:"16px"},children:di.jsx(P,{span:24,children:di.jsxs("div",{style:{display:"flex",alignItems:"flex-start"},children:[di.jsx("span",{style:{width:"80px",textAlign:"right",marginRight:"8px",marginTop:"8px"},children:"方案描述:"}),di.jsx(W.Item,{name:"description",style:{flex:1,margin:0},children:di.jsx(ha,{placeholder:"请输入方案描述",rows:3,style:{resize:"vertical"}})})]})})}),di.jsx(L,{gutter:[16,16],style:{marginTop:"16px"},children:di.jsx(P,{span:24,children:di.jsxs("div",{style:{display:"flex",alignItems:"flex-start"},children:[di.jsx("span",{style:{width:"80px",textAlign:"right",marginRight:"8px",fontSize:"14px",paddingTop:"6px"},children:"比对类型："}),di.jsx("div",{style:{flex:1},children:di.jsxs("div",{style:{padding:"8px 12px",backgroundColor:"#f5f5f5",borderRadius:"6px",border:"1px solid #d9d9d9",display:"flex",alignItems:"center",gap:"16px"},children:[di.jsx(B,{color:"blue",style:{fontSize:"12px",padding:"4px 8px",borderRadius:"4px"},children:"同产品比对"}),di.jsx("div",{style:{width:"1px",height:"20px",backgroundColor:"#d9d9d9"}}),di.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:[di.jsx(B,{style:{fontSize:"12px",padding:"2px 6px",backgroundColor:"#e6f7ff",color:"#1890ff",border:"1px solid #91d5ff"},children:"产品编码"}),di.jsx(B,{style:{fontSize:"12px",padding:"2px 6px",backgroundColor:"#e6f7ff",color:"#1890ff",border:"1px solid #91d5ff"},children:"产品名称"})]})]})})]})})})]})]}),di.jsxs("div",{style:{marginBottom:"24px"},children:[di.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"6px",marginBottom:"16px",backgroundColor:"#fff"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #f0f0f0",cursor:"pointer",backgroundColor:"#fafafa"},onClick:()=>{const e=r.includes("1")?r.filter(e=>"1"!==e):[...r,"1"];o(e)},children:[di.jsx("div",{style:{width:"4px",height:"20px",backgroundColor:"#1890ff",marginRight:"12px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"12px",color:"#999",transform:r.includes("1")?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s",marginRight:"8px"},children:"▶"}),di.jsx("span",{style:{fontSize:"16px",fontWeight:"bold",color:"#1890ff",flex:1},children:"比对对象"})]}),r.includes("1")&&di.jsxs("div",{style:{padding:"16px"},children:[di.jsx("div",{style:{marginBottom:"24px"},children:di.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"4px",padding:"16px"},children:[di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[di.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#333",display:"flex",alignItems:"center",gap:"6px"},children:["比对范围",di.jsx(se,{title:"查询范围不可在比价报表中修改",children:di.jsx(ll,{style:{fontSize:"12px",color:"#999",cursor:"pointer"}})})]}),di.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[di.jsx(oe,{trigger:["click"],menu:{items:ye.filter(e=>!C.some(t=>t.id===e.id)).map(e=>({key:e.id,label:e.name})),onClick:({key:e})=>(e=>{if(C.some(t=>t.id===e))return void te.info("该条件已存在");const t=je(e),i={id:e,field:(null==t?void 0:t.name)||e,condition:"",values:[]};N(e=>[...e,i]),te.success(`已添加查询条件：${i.field}`)})(String(e))},children:di.jsx(E,{type:"primary",size:"small",icon:di.jsx(K,{}),children:"添加条件"})}),di.jsx(E,{size:"small",onClick:()=>N([]),children:"清空"})]})]}),di.jsx("div",{style:{minHeight:"120px"},children:0===C.length?di.jsxs("div",{style:{textAlign:"center",color:"#999",padding:"40px 0",fontSize:"14px"},children:["暂无比对范围条件",di.jsx("br",{}),di.jsx("span",{style:{fontSize:"12px"},children:'点击"添加条件"按钮添加'})]}):di.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gridAutoFlow:"dense",gap:"8px"},children:C.map(e=>{const t=ve(e.id);return di.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"4px",padding:"8px 10px",backgroundColor:"#fafafa",display:"flex",alignItems:"center",gap:8,gridColumn:`span ${t}`},children:[di.jsx("span",{style:{fontSize:"12px",color:"#555",fontWeight:500,flexShrink:0,width:100},children:e.field}),di.jsx("div",{style:{flex:1},children:Ce(e)}),di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{N(t=>t.filter(t=>t.id!==e.id))}})]},e.id)})})})]})}),di.jsxs(L,{gutter:24,children:[di.jsx(P,{span:7,children:di.jsxs("div",{style:{border:"1px solid #e8e8e8",borderRadius:"4px",padding:"16px",height:"100%"},children:[di.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"12px",color:"#333",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[di.jsx("span",{children:"比对维度"}),di.jsx(E,{type:"primary",size:"small",icon:di.jsx(K,{}),onClick:()=>M(!0),children:"添加维度"})]}),di.jsx(W.Item,{name:"comparisonDimensions",rules:[{required:!0,message:"请选择比对维度"}],children:di.jsx("div",{style:{minHeight:"100px",border:"1px dashed #d9d9d9",borderRadius:"6px",padding:"12px",backgroundColor:0===Q.length?"#fafafa":"#fff"},children:0===Q.length?di.jsxs("div",{style:{textAlign:"center",color:"#999",fontSize:"13px",paddingTop:"20px"},children:[di.jsx("div",{style:{fontSize:"20px",marginBottom:"8px"},children:"📊"}),di.jsx("div",{children:'点击"添加维度"按钮选择比对维度'})]}):di.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:Q.map((e,t)=>di.jsxs(B,{closable:!0,color:"blue",onClose:()=>{Z(e=>e.filter((e,i)=>i!==t))},style:{fontSize:"12px",padding:"4px 8px"},children:[e.name,di.jsxs("span",{style:{marginLeft:"4px",fontSize:"10px",opacity:.7},children:["(",e.attribute,")"]})]},t))})})})]})}),di.jsx(P,{span:17,children:di.jsxs("div",{style:{border:"1px solid #e8e8e8",borderRadius:"4px",padding:"16px",height:"100%"},children:[di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[di.jsx("span",{style:{fontSize:"14px",fontWeight:"bold",color:"#333"},children:"比对指标"}),di.jsxs(J,{children:[di.jsx(E,{type:"primary",size:"small",onClick:()=>u(!0),children:"选择指标"}),di.jsx(E,{type:"default",size:"small",onClick:()=>{g(!0)},children:"自定义指标"})]})]}),v.length>0?di.jsx(Y,{dataSource:v.map(e=>{const t=qe.find(t=>t.id===e);if(t)return{key:e,code:t.code,name:t.name,expression:t.expression,unit:"个",description:t.description};const i=Ye.find(t=>t.id===e);if(i)return{key:e,code:i.code,name:i.name,expression:i.formula,unit:i.unit,description:i.description};const s=Je.find(t=>t.id===e);return s?{key:e,code:`IND_${e.toUpperCase()}`,name:s.name,expression:`SUM(${s.name})`,unit:s.unit,description:s.description}:null}).filter(e=>null!==e),columns:[{title:"指标编码",dataIndex:"code",key:"code",width:120},{title:"指标名称",dataIndex:"name",key:"name",width:150,render:(e,t,i)=>di.jsx(U,{value:e,onChange:e=>{e.target.value,te.info("指标名称编辑功能已启用")},bordered:!1,style:{padding:"4px 0"},placeholder:"请输入指标名称"})},{title:"指标公式",dataIndex:"expression",key:"expression",ellipsis:!0,render:(e,t,i)=>di.jsx(U,{value:e,onChange:e=>{e.target.value,te.info("表达式编辑功能已启用")},bordered:!1,style:{padding:"4px 0"},placeholder:"请输入表达式"})},{title:"单位",dataIndex:"unit",key:"unit",width:80,render:(e,t,i)=>di.jsx(U,{value:e,onChange:e=>{e.target.value,te.info("单位编辑功能已启用")},bordered:!1,style:{padding:"4px 0"},placeholder:"单位"})},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0,render:(e,t,i)=>di.jsx(U,{value:e,onChange:e=>{e.target.value,te.info("描述编辑功能已启用")},bordered:!1,style:{padding:"4px 0"},placeholder:"请输入描述"})},{title:"操作",key:"action",width:100,render:(e,t)=>di.jsxs(J,{size:"small",children:[di.jsx(E,{type:"text",size:"small",icon:di.jsx(X,{}),onClick:()=>{te.info("编辑指标功能待实现")}}),di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{b(e=>e.filter(e=>e!==t.key))}})]})}],pagination:!1,size:"small",style:{marginTop:"8px"}}):di.jsxs("div",{style:{textAlign:"center",color:"#999",padding:"40px 0",fontSize:"14px",border:"1px dashed #d9d9d9",borderRadius:"4px",backgroundColor:"#fafafa"},children:["暂无比对指标",di.jsx("br",{}),di.jsx("span",{style:{fontSize:"12px"},children:'点击"选择指标"按钮添加'})]})]})})]})]})]}),di.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"6px",marginBottom:"16px",backgroundColor:"#fff"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #f0f0f0",cursor:"pointer",backgroundColor:"#fafafa"},onClick:()=>{const e=r.includes("2")?r.filter(e=>"2"!==e):[...r,"2"];o(e)},children:[di.jsx("div",{style:{width:"4px",height:"20px",backgroundColor:"#52c41a",marginRight:"12px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"12px",color:"#999",transform:r.includes("2")?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s",marginRight:"8px"},children:"▶"}),di.jsx("span",{style:{fontSize:"16px",fontWeight:"bold",color:"#52c41a",flex:1},children:"基准对象"})]}),r.includes("2")&&di.jsx("div",{style:{padding:"16px"},children:di.jsxs(L,{gutter:16,children:[di.jsx(P,{span:7,children:di.jsxs("div",{style:{border:"1px solid #e8e8e8",borderRadius:"8px",padding:"16px",height:"500px",display:"flex",flexDirection:"column",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)",backgroundColor:"#fff"},children:[di.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"16px"},children:[di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[di.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#333"},children:"基准对象列表"}),di.jsx(E,{type:"primary",size:"small",icon:di.jsx(K,{}),onClick:()=>F(!0),children:"添加基准对象"})]}),di.jsx($,{message:"基准对象是比价分析的参照标准，点击添加按钮创建新的基准对象",type:"info",showIcon:!0,style:{marginBottom:"8px"}})]}),di.jsx("div",{style:{flex:1,overflowY:"auto"},children:0===_e.length?di.jsxs("div",{style:{textAlign:"center",color:"#8c8c8c",padding:"60px 20px",fontSize:"14px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",minHeight:"300px"},children:[di.jsx(tl,{style:{fontSize:"64px",color:"#d9d9d9",marginBottom:"16px"}}),di.jsx("div",{style:{fontSize:"16px",fontWeight:"500",color:"#595959",marginBottom:"8px"},children:"暂无基准对象"}),di.jsxs("div",{style:{fontSize:"13px",color:"#8c8c8c",lineHeight:"1.5"},children:["基准对象是比价分析的参照标准",di.jsx("br",{}),'点击上方"添加基准对象"按钮开始创建']})]}):_e.map((e,t)=>di.jsxs("div",{style:{padding:"16px",border:(null==ze?void 0:ze.id)===e.id?"2px solid #52c41a":"1px solid #e8e8e8",borderRadius:"6px",marginBottom:"12px",cursor:"pointer",backgroundColor:(null==ze?void 0:ze.id)===e.id?"#f6ffed":"#fff",transition:"all 0.2s",boxShadow:(null==ze?void 0:ze.id)===e.id?"0 2px 8px rgba(82, 196, 26, 0.15)":"0 1px 3px rgba(0, 0, 0, 0.04)",position:"relative",overflow:"hidden"},onClick:()=>Ee(e),onMouseEnter:t=>{(null==ze?void 0:ze.id)!==e.id&&(t.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.08)",t.currentTarget.style.transform="translateY(-1px)")},onMouseLeave:t=>{(null==ze?void 0:ze.id)!==e.id&&(t.currentTarget.style.boxShadow="0 1px 3px rgba(0, 0, 0, 0.04)",t.currentTarget.style.transform="translateY(0)")},children:[(null==ze?void 0:ze.id)===e.id&&di.jsx("div",{style:{position:"absolute",top:"0",left:"0",right:"0",height:"3px",backgroundColor:"#52c41a"}}),di.jsxs("div",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"6px",color:"#262626",display:"flex",alignItems:"center",gap:"8px"},children:[e.objectName||`基准对象-${e.name}`,(null==ze?void 0:ze.id)===e.id&&di.jsx(Re,{style:{color:"#52c41a",fontSize:"14px"}})]}),di.jsxs("div",{style:{fontSize:"13px",color:"#8c8c8c",marginBottom:"10px",lineHeight:"1.4"},children:["数据集: ",e.name]}),e.description&&di.jsx("div",{style:{fontSize:"12px",color:"#bfbfbf",marginBottom:"12px",lineHeight:"1.3",fontStyle:"italic"},children:e.description}),di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"auto"},children:[di.jsx("div",{style:{fontSize:"11px",color:"#d9d9d9"},children:"点击选择此基准对象"}),di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:i=>{i.stopPropagation();const s=_e.filter((e,i)=>i!==t);Ae(s),(null==ze?void 0:ze.id)===e.id&&Ee(s[0]||null)},style:{opacity:.7,transition:"opacity 0.2s"},onMouseEnter:e=>{e.currentTarget.style.opacity="1"},onMouseLeave:e=>{e.currentTarget.style.opacity="0.7"},children:"移除"})]})]},e.id))})]})}),di.jsx(P,{span:17,children:di.jsx("div",{style:{border:"1px solid #e8e8e8",borderRadius:"4px",padding:"16px",height:"500px",display:"flex",flexDirection:"column"},children:ze?di.jsxs(di.Fragment,{children:[di.jsxs("div",{style:{flex:1,marginBottom:"16px",border:"1px solid #f0f0f0",borderRadius:"4px",padding:"16px"},children:[di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[di.jsxs("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#333",display:"flex",alignItems:"center",gap:"6px"},children:["基准范围",di.jsx(se,{title:"查询范围不可在比价报表中修改",children:di.jsx(ll,{style:{fontSize:"12px",color:"#999",cursor:"pointer"}})})]}),di.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[di.jsx(oe,{trigger:["click"],menu:{items:ye.filter(e=>!Oe.some(t=>t.id===e.id)).map(e=>({key:e.id,label:e.name})),onClick:({key:e})=>(e=>{if(Oe.some(t=>t.id===e))return void te.info("该条件已存在");const t=je(e),i={id:e,field:(null==t?void 0:t.name)||e,condition:"",values:""};Le(e=>[...e,i]),te.success(`已添加基准查询条件：${i.field}`)})(String(e))},children:di.jsx(E,{type:"primary",size:"small",icon:di.jsx(K,{}),children:"添加条件"})}),di.jsx(E,{size:"small",onClick:()=>Le([]),children:"清空"})]})]}),di.jsx("div",{style:{minHeight:"120px"},children:0===Oe.length?di.jsxs("div",{style:{textAlign:"center",color:"#999",padding:"40px 0",fontSize:"14px"},children:["暂无基准范围条件",di.jsx("br",{}),di.jsx("span",{style:{fontSize:"12px"},children:'点击"添加条件"按钮添加'})]}):di.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gridAutoFlow:"dense",gap:"8px"},children:Oe.map(e=>{const t=ve(e.id);return di.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"4px",padding:"8px 10px",backgroundColor:"#fafafa",display:"flex",alignItems:"center",gap:8,gridColumn:`span ${t}`},children:[di.jsx("span",{style:{fontSize:"12px",color:"#555",fontWeight:500,flexShrink:0,width:100},children:e.field}),di.jsx("div",{style:{flex:1},children:Ne(e)}),di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{Le(t=>t.filter(t=>t.id!==e.id))}})]},e.id)})})})]}),di.jsxs("div",{style:{flex:1,border:"1px solid #f0f0f0",borderRadius:"4px",padding:"16px"},children:[di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[di.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",color:"#333"},children:"基准指标"}),di.jsxs(J,{children:[di.jsx(E,{type:"primary",size:"small",onClick:()=>Be(!0),children:"选择指标"}),di.jsx(E,{type:"default",size:"small",onClick:()=>{$e(!0)},children:"自定义指标"})]})]}),di.jsx("div",{style:{minHeight:"120px"},children:0===Ve.length?di.jsxs("div",{style:{textAlign:"center",color:"#999",padding:"40px 0",fontSize:"14px",border:"1px dashed #d9d9d9",borderRadius:"4px",backgroundColor:"#fafafa"},children:["暂无基准指标",di.jsx("br",{}),di.jsx("span",{style:{fontSize:"12px"},children:'点击"选择指标"按钮添加'})]}):di.jsx(Y,{dataSource:Ve.map(e=>({key:e.id,code:`IND_${e.id.toUpperCase()}`,name:e.name,expression:`SUM(${e.name})`,unit:e.unit,description:"基准指标"})),columns:[{title:"指标编码",dataIndex:"code",key:"code",width:120},{title:"指标名称",dataIndex:"name",key:"name",width:150,render:(e,t,i)=>di.jsx(U,{value:e,onChange:e=>{e.target.value,te.info("基准指标名称编辑功能已启用")},bordered:!1,style:{padding:"4px 0"},placeholder:"请输入指标名称"})},{title:"指标公式",dataIndex:"expression",key:"expression",ellipsis:!0,render:(e,t,i)=>di.jsx(U,{value:e,onChange:e=>{e.target.value,te.info("基准指标表达式编辑功能已启用")},bordered:!1,style:{padding:"4px 0"},placeholder:"请输入表达式"})},{title:"单位",dataIndex:"unit",key:"unit",width:80,render:(e,t,i)=>di.jsx(U,{value:e,onChange:e=>{e.target.value,te.info("基准指标单位编辑功能已启用")},bordered:!1,style:{padding:"4px 0"},placeholder:"单位"})},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0,render:(e,t,i)=>di.jsx(U,{value:e,onChange:e=>{e.target.value,te.info("基准指标描述编辑功能已启用")},bordered:!1,style:{padding:"4px 0"},placeholder:"请输入描述"})},{title:"操作",key:"action",width:100,render:(e,t)=>di.jsxs(J,{size:"small",children:[di.jsx(E,{type:"text",size:"small",icon:di.jsx(X,{}),onClick:()=>{te.info("编辑基准指标功能待实现")}}),di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{const e=Ve.filter(e=>e.id!==t.key);He(e)}})]})}],pagination:!1,size:"small",style:{marginTop:"8px"}})})]})]}):di.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#999",fontSize:"16px"},children:"请先选择基准数据集"})})})]})})]}),di.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"6px",marginBottom:"16px",backgroundColor:"#fff"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px 16px",borderBottom:"1px solid #f0f0f0",cursor:"pointer",backgroundColor:"#fafafa"},onClick:()=>{const e=r.includes("3")?r.filter(e=>"3"!==e):[...r,"3"];o(e)},children:[di.jsx("div",{style:{width:"4px",height:"20px",backgroundColor:"#fa8c16",marginRight:"12px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"12px",color:"#999",transform:r.includes("3")?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s",marginRight:"8px"},children:"▶"}),di.jsx("span",{style:{fontSize:"16px",fontWeight:"bold",color:"#fa8c16",flex:1},children:"计算指标"}),di.jsx(E,{type:"primary",size:"small",onClick:e=>{e.stopPropagation(),Ke(!0)},icon:di.jsx(K,{}),style:{marginLeft:"auto"},children:"自定义计算指标"})]}),r.includes("3")&&di.jsx("div",{style:{padding:"0"},children:di.jsx(Y,{dataSource:ue.map((e,t)=>m(c({},e),{key:e.id,index:t+1})),columns:[{title:"指标名称",dataIndex:"name",key:"name",width:150,render:(e,t,i)=>di.jsx(U,{placeholder:"请输入指标名称",value:e,onChange:e=>tt(i,"name",e.target.value),bordered:!1,style:{padding:"4px 0"}})},{title:"指标编码",dataIndex:"id",key:"id",width:120,render:(e,t,i)=>di.jsx("span",{style:{color:"#666",fontSize:"12px"},children:`CALC_${String(i+1).padStart(3,"0")}`})},{title:"指标公式",dataIndex:"formula",key:"formula",width:200,render:(e,t,i)=>di.jsx("code",{style:{backgroundColor:"#f5f5f5",padding:"2px 6px",borderRadius:"3px",fontSize:"11px",color:"#666"},children:t.expression?t.expression.replace(/比对数据集_/g,"").replace(/#1参照数据集_/g,"REF_"):"(比对指标-基准指标)/基准指标*100"})},{title:"指标描述",dataIndex:"description",key:"description",render:(e,t,i)=>di.jsx(U,{placeholder:"请输入指标描述",value:e,onChange:e=>tt(i,"description",e.target.value),bordered:!1,style:{padding:"4px 0"}})},{title:"操作",key:"action",width:80,render:(e,t,i)=>di.jsx(E,{type:"text",danger:!0,size:"small",icon:di.jsx(ee,{}),onClick:()=>(e=>{const t=ue.filter((t,i)=>i!==e);fe(t)})(i)})}],pagination:!1,size:"small",locale:{emptyText:di.jsx("div",{style:{textAlign:"center",padding:"40px",color:"#999"},children:di.jsx(fa,{type:"secondary",children:'暂无计算指标，点击上方"添加计算指标"按钮开始配置'})})}})})]})]}),di.jsx("div",{style:{marginTop:"24px",textAlign:"center",padding:"16px",borderTop:"1px solid #f0f0f0"},children:di.jsx(E,{type:"primary",icon:di.jsx(Tl,{}),htmlType:"submit",loading:l,size:"large",children:"保存方案"})})]})]}),di.jsx(G,{title:"选择指标",open:h,onCancel:()=>u(!1),onOk:()=>{u(!1),te.success(`已选择 ${v.length} 个指标`)},width:800,children:di.jsx(Y,{rowSelection:{type:"checkbox",selectedRowKeys:v,onChange:e=>{b(e)}},columns:[{title:"指标名称",dataIndex:"name",key:"name",width:200},{title:"指标公式",dataIndex:"expression",key:"expression",render:e=>di.jsx("code",{style:{backgroundColor:"#f5f5f5",padding:"2px 6px",borderRadius:"3px",fontSize:"12px"},children:e})},{title:"指标描述",dataIndex:"description",key:"description",ellipsis:!0}],dataSource:Je.map(e=>m(c({},e),{key:e.id})),pagination:!1,size:"small",scroll:{y:300}})}),di.jsx(G,{title:"配置预览",open:a,onCancel:()=>d(!1),footer:[di.jsx(E,{onClick:()=>d(!1),children:"关闭"},"close")],width:800,children:di.jsxs("div",{children:[di.jsx(ua,{level:5,children:"比对对象配置"}),di.jsx("pre",{style:{backgroundColor:"#f5f5f5",padding:"12px",borderRadius:"4px"},children:JSON.stringify(ie,null,2)}),di.jsx(ua,{level:5,children:"基准对象配置"}),di.jsx("pre",{style:{backgroundColor:"#f5f5f5",padding:"12px",borderRadius:"4px"},children:JSON.stringify(xe,null,2)}),di.jsx(ua,{level:5,children:"分析指标配置"}),di.jsx("pre",{style:{backgroundColor:"#f5f5f5",padding:"12px",borderRadius:"4px"},children:JSON.stringify(ue,null,2)})]})}),di.jsx(G,{title:"选择比对维度",open:z,onCancel:()=>M(!1),width:800,footer:[di.jsx(E,{onClick:()=>M(!1),children:"取消"},"cancel"),di.jsx(E,{type:"primary",onClick:()=>{M(!1)},children:"确定"},"confirm")],children:di.jsxs("div",{style:{padding:"16px 0"},children:[di.jsx("div",{style:{marginBottom:"16px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:di.jsx("span",{style:{fontSize:"14px",fontWeight:"bold"},children:"数据集字段"})}),di.jsx(Y,{dataSource:Ze,pagination:!1,size:"small",rowKey:"field",rowSelection:{type:"checkbox",selectedRowKeys:Q.map(e=>e.field),onChange:(e,t)=>{Z(t)}},columns:[{title:"名称",dataIndex:"name",key:"name",width:200},{title:"属性",dataIndex:"attribute",key:"attribute",width:150,render:e=>di.jsx(B,{color:"cyan",children:e})}],style:{border:"1px solid #f0f0f0",borderRadius:"6px"}})]})}),di.jsxs(G,{title:"添加基准对象",open:ke,onCancel:()=>Te(!1),onOk:()=>{Te(!1),te.success(`已添加 ${_e.length} 个基准对象`)},width:800,children:[di.jsx("div",{style:{marginBottom:"16px"},children:di.jsx($,{message:"请先选择数据集，然后为每个数据集指定基准对象名称",type:"info",showIcon:!0,style:{marginBottom:"16px"}})}),di.jsx(Y,{rowSelection:{type:"checkbox",selectedRowKeys:_e.map(e=>e.id),onChange:(e,t)=>{const i=t.map(e=>{const t=_e.find(t=>t.id===e.id);return m(c({},e),{objectName:(null==t?void 0:t.objectName)||`基准对象-${e.name}`})});Ae(i)}},columns:[{title:"数据集名称",dataIndex:"name",key:"name",width:150},{title:"基准对象名称",dataIndex:"objectName",key:"objectName",width:200,render:(e,t)=>di.jsx(U,{value:t.name,onChange:e=>{const i=_e.map(i=>i.id===t.id?m(c({},i),{objectName:e.target.value}):i);Ae(i)},placeholder:"请输入基准对象名称"})},{title:"描述",dataIndex:"description",key:"description",width:350}],dataSource:Xe,rowKey:"id",size:"small",scroll:{y:300}})]}),di.jsx(G,{title:"设置基准范围",open:Me,onCancel:()=>De(!1),onOk:()=>{De(!1),te.success("基准范围设置已保存")},width:1200,bodyStyle:{padding:"20px"},style:{top:20},children:di.jsxs(L,{gutter:16,style:{height:"600px"},children:[di.jsx(P,{span:8,children:di.jsx(ce,{defaultActiveKey:["1"],style:{border:"1px solid #d9d9d9",borderRadius:"6px",height:"100%"},children:di.jsx(ya,{header:"数据集字段",style:{height:"100%"},children:di.jsx("div",{style:{maxHeight:"500px",overflowY:"auto",padding:"8px"},children:Ze.map(e=>di.jsxs("div",{draggable:!0,style:{padding:"8px 12px",margin:"4px 0",backgroundColor:"#f8f9fa",border:"1px solid #e9ecef",borderRadius:"4px",cursor:"move",fontSize:"13px"},children:[di.jsx("div",{style:{fontWeight:"bold",color:"#333"},children:e.name}),di.jsxs("div",{style:{fontSize:"12px",color:"#666",marginTop:"2px"},children:[e.type," | ",e.attribute]})]},e.field))})},"1")})}),di.jsx(P,{span:16,children:di.jsxs("div",{style:{border:"1px solid #d9d9d9",borderRadius:"6px",height:"100%",padding:"16px"},children:[di.jsx("div",{style:{fontSize:"16px",fontWeight:"bold",marginBottom:"16px",color:"#333"},children:"基准范围配置"}),di.jsx("div",{style:{minHeight:"400px",border:"2px dashed #d9d9d9",borderRadius:"6px",padding:"20px",backgroundColor:"#fafafa"},children:0===Oe.length?di.jsx("div",{style:{textAlign:"center",color:"#999",fontSize:"14px",paddingTop:"100px"},children:"拖拽左侧字段到此处设置基准范围"}):Oe.map(e=>di.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"12px",border:"1px solid #e9ecef",borderRadius:"4px",marginBottom:"8px",backgroundColor:"#fff"},children:[di.jsxs("span",{style:{flex:1,fontSize:"14px"},children:[e.field," ",e.condition," ",e.values]}),di.jsxs(J,{children:[di.jsx(E,{type:"text",size:"small",icon:di.jsx(X,{})}),di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{const t=Oe.filter(t=>t.id!==e.id);Le(t)}})]})]},e.id))})]})})]})}),di.jsx(G,{title:"选择基准指标",open:Pe,onCancel:()=>Be(!1),onOk:()=>{Be(!1),te.success(`已选择 ${Ve.length} 个基准指标`)},width:800,children:di.jsx(Y,{rowSelection:{type:"checkbox",selectedRowKeys:Ve.map(e=>e.id),onChange:(e,t)=>{He(t)}},columns:[{title:"指标名称",dataIndex:"name",key:"name",width:200},{title:"指标公式",dataIndex:"expression",key:"expression",render:e=>di.jsx("code",{style:{backgroundColor:"#f5f5f5",padding:"2px 6px",borderRadius:"3px",fontSize:"12px"},children:e})},{title:"指标描述",dataIndex:"description",key:"description",ellipsis:!0}],dataSource:Je,rowKey:"id",size:"small",scroll:{y:300}})}),di.jsx(pa,{visible:f,onCancel:()=>g(!1),onOk:e=>{const t=`custom_${Date.now()}`;b(e=>[...e,t]);const i={id:t,name:e.metricName,code:e.metricCode,description:e.bizSpec||"",expression:e.expression||""};Ue(e=>[...e,i]),g(!1)},title:"新增比对自定义指标"}),di.jsx(pa,{visible:Fe,onCancel:()=>$e(!1),onOk:e=>{const t={id:`custom_${Date.now()}`,name:e.metricName,unit:e.unit||"个"};He(e=>[...e,t]),$e(!1)},title:"新增基准自定义指标"}),di.jsx(pa,{visible:We,onCancel:()=>Ke(!1),onOk:e=>{const t=`calc_${Date.now()}`;b(e=>[...e,t]);const i={id:t,name:e.metricName,code:e.metricCode,description:e.bizSpec||"",formula:e.expression||e.formula||"",unit:e.unit||"个"};Ge(e=>[...e,i]),Ke(!1)},title:"自定义计算指标"}),di.jsx(G,{title:"添加基准对象",open:O,width:800,onCancel:()=>{F(!1),H({objectName:"",datasetId:""})},onOk:()=>{if(!V.objectName.trim())return void te.error("请输入基准对象名称");if(!V.datasetId)return void te.error("请选择数据集");if(_e.some(e=>(e.objectName||`基准对象-${e.name}`)===V.objectName.trim()))return void te.error("基准对象名称已存在，请使用其他名称");const e=Xe.find(e=>e.id===V.datasetId);if(e){const t=m(c({},e),{objectName:V.objectName.trim()});Ae([..._e,t]),0===_e.length&&Ee(t),H({objectName:"",datasetId:""}),F(!1),te.success("基准对象添加成功")}},children:di.jsx(W,{layout:"vertical",children:di.jsxs(L,{gutter:24,children:[di.jsx(P,{span:12,children:di.jsx(W.Item,{label:"基准对象名称",required:!0,help:"为基准对象设置一个易于识别的名称",rules:[{required:!0,message:"请输入基准对象名称"}],children:di.jsx(U,{placeholder:"例如：华东地区采购基准",value:V.objectName,onChange:e=>H(m(c({},V),{objectName:e.target.value})),prefix:di.jsx(Ls,{style:{color:"#bfbfbf"}})})})}),di.jsx(P,{span:12,children:di.jsx(W.Item,{label:"选择数据集",required:!0,help:"选择作为基准对象的数据集",rules:[{required:!0,message:"请选择数据集"}],children:di.jsx(q,{placeholder:"请选择数据集",value:V.datasetId||void 0,onChange:e=>{const t=Xe.find(t=>t.id===e);H(m(c({},V),{datasetId:e,objectName:V.objectName||(t?`基准对象-${t.name}`:"")}))},style:{width:"100%"},optionLabelProp:"label",children:Xe.map(e=>di.jsx(xa,{value:e.id,label:e.name,children:di.jsxs("div",{style:{padding:"4px 0"},children:[di.jsx("div",{style:{fontWeight:500,marginBottom:"2px"},children:e.name}),e.description&&di.jsx("div",{style:{fontSize:"12px",color:"#8c8c8c",lineHeight:"1.3"},children:e.description})]})},e.id))})})})]})})}),di.jsx(G,{title:"选择管理组织",open:de,onCancel:()=>re(!1),onOk:()=>re(!1),width:600,children:di.jsxs("div",{style:{padding:"16px 0"},children:[di.jsx($,{message:"管理组织说明",description:"管理组织拥有此方案的完全编辑权限，包括添加、修改、删除等所有操作。一个方案只能有一个管理组织。",type:"info",showIcon:!0,style:{marginBottom:"16px"}}),di.jsx(Ie.Group,{value:ne,onChange:e=>ae(e.target.value),style:{width:"100%"},children:di.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:et.map(e=>di.jsx(s,{organization:e,level:0,selectedValue:ne,onChange:ae},e.value))})})]})})]})},group:"二期"},{title:"比对模型(卡片布局)",to:"/comparison-model-v2",icon:di.jsx(xt,{className:"h-4 w-4"}),component:()=>{const[t]=W.useForm(),[i,s]=j.useState(!1),[l,n]=j.useState([]),[a,d]=j.useState(""),[r,o]=j.useState(""),[p,x]=j.useState(null),[h,u]=j.useState(null),[f,g]=j.useState([]),[v,b]=j.useState([]),[C,N]=j.useState(!1),[I,w]=j.useState(!1),[S,k]=j.useState(!1),[T,_]=j.useState(!1),[A,R]=j.useState([]),[z,M]=j.useState([]),[O,F]=j.useState(""),[$,V]=j.useState(!1),[H,Q]=j.useState(null),[Z,ie]=j.useState(new Map),[se,le]=j.useState({comparison:[],baseline:{}}),[ne,ae]=j.useState(!1),[de,re]=j.useState(null),[ce,me]=j.useState("comparison"),[pe,xe]=j.useState("");j.useEffect(()=>{if(f.length>0){const e=new Set(v.map(e=>e.id)),t=f.filter(t=>e.has(t.id));t.length!==f.length&&g(t)}},[v]);const[he,ue]=j.useState([]),[fe,ge]=j.useState(!1),[ye,ve]=j.useState(null),[be,Ce]=j.useState(""),[Ne,we]=j.useState(null),[Se,ke]=j.useState({}),[Te,_e]=j.useState([]),[Ae,Re]=j.useState([]),[Ee,Me]=j.useState(!1),[De,Oe]=j.useState(!1),Le=[{id:"ds_agreement",name:"采购协议数据集",description:"包含所有采购协议的价格信息",recordCount:15420},{id:"ds_bid",name:"招标数据集",description:"历史招标数据和价格信息",recordCount:8930},{id:"ds_market",name:"市场价格数据集",description:"市场参考价格数据",recordCount:23450},{id:"ds_historical",name:"历史采购数据集",description:"历史采购记录和价格变化",recordCount:45670}],Pe=[{id:"field_1",fieldCode:"product_code",fieldName:"商品编码",fieldType:"string",displayName:"商品编码",attribute:"文本"},{id:"field_2",fieldCode:"product_name",fieldName:"商品名称",fieldType:"string",displayName:"商品名称",attribute:"文本"},{id:"field_3",fieldCode:"category",fieldName:"商品分类",fieldType:"string",displayName:"商品分类",attribute:"文本"},{id:"field_4",fieldCode:"brand",fieldName:"品牌",fieldType:"string",displayName:"品牌",attribute:"文本"},{id:"field_5",fieldCode:"supplier",fieldName:"供应商",fieldType:"string",displayName:"供应商",attribute:"文本"},{id:"field_6",fieldCode:"price",fieldName:"价格",fieldType:"number",displayName:"价格",attribute:"数值"},{id:"field_7",fieldCode:"quantity",fieldName:"数量",fieldType:"number",displayName:"数量",attribute:"数值"},{id:"field_8",fieldCode:"purchase_date",fieldName:"采购日期",fieldType:"date",displayName:"采购日期",attribute:"时间"}],Be=()=>{a&&!l.includes(a)&&(n([...l,a]),d(""))};return di.jsxs("div",{style:{padding:"24px",backgroundColor:"#f5f5f5",minHeight:"100vh"},children:[di.jsxs(D,{children:[di.jsx("style",{children:"\n          .ant-table-tbody > tr.ant-table-row-selected > td {\n            background-color: #f6ffed !important;\n          }\n          .ant-table-tbody > tr:hover > td {\n            background-color: #e6f7ff !important;\n          }\n          .ant-table-tbody > tr.ant-table-row-selected:hover > td {\n            background-color: #d9f7be !important;\n          }\n        "}),di.jsxs(W,{form:t,layout:"vertical",initialValues:{modelCode:"",modelName:"",modelDescription:""},children:[di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[di.jsx(ka,{level:3,style:{margin:0},children:"比对模型管理（卡片布局）"}),di.jsxs(J,{children:[di.jsx(E,{type:"primary",icon:di.jsx(Tl,{}),loading:i,onClick:()=>y(e,null,function*(){try{s(!0),yield t.validateFields(),te.success("比对模型保存成功")}catch(e){}finally{s(!1)}}),children:"保存"}),di.jsx(E,{icon:di.jsx(je,{}),children:"预览"})]})]}),di.jsxs(D,{title:di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx("div",{style:{width:"4px",height:"20px",backgroundColor:"#1890ff",marginRight:"12px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"16px",fontWeight:"bold",color:"#333"},children:"基本信息"})]}),style:{marginBottom:"16px"},children:[di.jsxs(L,{gutter:24,style:{marginBottom:"16px"},children:[di.jsx(P,{span:8,children:di.jsx(W.Item,{name:"modelCode",label:"模型编码",rules:[{required:!0,message:"请输入模型编码"}],children:di.jsx(U,{placeholder:"请输入模型编码"})})}),di.jsx(P,{span:8,children:di.jsx(W.Item,{name:"modelName",label:"模型名称",rules:[{required:!0,message:"请输入模型名称"}],children:di.jsx(U,{placeholder:"请输入模型名称"})})})]}),di.jsx(L,{style:{marginBottom:"16px"},children:di.jsx(P,{span:8,children:di.jsx(W.Item,{name:"dataConnection",label:"数据连接",children:di.jsxs(q,{placeholder:"请选择数据连接",value:r,onChange:e=>{o(e)},children:[di.jsx(wa,{value:"mysql_prod",children:"MySQL生产库"}),di.jsx(wa,{value:"oracle_dw",children:"Oracle数据仓库"}),di.jsx(wa,{value:"postgres_bi",children:"PostgreSQL BI库"}),di.jsx(wa,{value:"clickhouse_olap",children:"ClickHouse OLAP"})]})})})}),di.jsx(L,{style:{marginBottom:"16px"},children:di.jsx(P,{span:16,children:di.jsx(W.Item,{name:"modelDescription",label:"模型描述",children:di.jsx(Sa,{placeholder:"请输入模型描述",rows:3})})})}),di.jsx(L,{children:di.jsx(P,{span:16,children:di.jsxs(W.Item,{label:"分类标签",children:[di.jsx("div",{style:{marginBottom:"8px"},children:l.map(e=>di.jsx(B,{closable:!0,onClose:()=>{return t=e,void n(l.filter(e=>e!==t));var t},style:{marginBottom:"4px"},children:e},e))}),di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx(U,{value:a,onChange:e=>d(e.target.value),onPressEnter:Be,placeholder:"输入标签后按回车添加",style:{width:"200px",marginRight:"8px"}}),di.jsx(E,{type:"dashed",icon:di.jsx(K,{}),onClick:Be,children:"添加标签"})]})]})})})]}),di.jsxs("div",{style:{backgroundColor:"#fafafa",borderRadius:"8px",padding:"20px",marginBottom:"24px"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"20px"},children:[di.jsx("div",{style:{width:"4px",height:"20px",backgroundColor:"#52c41a",marginRight:"12px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"16px",fontWeight:"bold",color:"#333"},children:"比对数据集设置"})]}),di.jsx(D,{title:di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx("div",{style:{width:"3px",height:"16px",backgroundColor:"#52c41a",marginRight:"8px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"14px",fontWeight:"bold"},children:"比对配置"})]}),size:"small",style:{marginBottom:"16px"},children:di.jsxs(L,{gutter:16,children:[di.jsxs(P,{span:12,children:[di.jsx("div",{style:{marginBottom:"8px",fontSize:"14px",fontWeight:"bold"},children:"比对数据集"}),di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx(U,{value:(null==p?void 0:p.name)||"",placeholder:"请选择比对数据集",readOnly:!0,style:{flex:1,cursor:"pointer",marginRight:"8px"},onClick:()=>w(!0)}),di.jsx(E,{type:"primary",size:"small",onClick:()=>w(!0),children:"选择"})]})]}),di.jsxs(P,{span:12,children:[di.jsx("div",{style:{marginBottom:"8px",fontSize:"14px",fontWeight:"bold"},children:"比对数据集"}),di.jsxs("div",{style:{border:"1px solid #d9d9d9",borderRadius:"6px",padding:"8px",minHeight:"32px",backgroundColor:"#fafafa",cursor:p?"pointer":"not-allowed",position:"relative"},onClick:()=>p&&_(!0),children:[f.length>0?di.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px",marginBottom:"4px"},children:f.map(e=>di.jsx(B,{closable:!0,color:"blue",onClose:t=>{t.preventDefault(),t.stopPropagation();const i=f.filter(t=>t.id!==e.id);g(i),b(v.filter(t=>t.id!==e.id))},style:{margin:0,fontSize:"12px",lineHeight:"20px"},children:e.fieldName},e.id))}):di.jsx("div",{style:{color:"#999",fontSize:"14px",lineHeight:"20px"},children:p?"点击选择比对字段":"请先选择比对数据集"}),di.jsx(E,{type:"primary",size:"small",style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)"},disabled:!p,onClick:e=>{e.stopPropagation(),_(!0)},children:"选择"})]})]})]})}),di.jsx(D,{title:di.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx("div",{style:{width:"3px",height:"16px",backgroundColor:"#52c41a",marginRight:"8px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"14px",fontWeight:"bold"},children:"可用字段"}),p&&di.jsxs("span",{style:{fontSize:"12px",color:"#666",fontWeight:"normal",marginLeft:"8px"},children:["（",p.name,"）"]})]}),di.jsx(E,{type:"dashed",icon:di.jsx(K,{}),size:"small",onClick:()=>{N(!0)},disabled:!p,children:"添加字段"})]}),size:"small",style:{marginBottom:"16px"},children:p?0===v.length?di.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"120px",color:"#999",fontSize:"16px",border:"1px dashed #d9d9d9",borderRadius:"6px"},children:'暂无字段，请点击"添加字段"按钮'}):di.jsx(Y,{dataSource:v,rowKey:"id",size:"small",pagination:!1,scroll:{y:200},columns:[{title:"排序",key:"sort",width:40,render:(e,t,i)=>di.jsx("div",{style:{cursor:i>0?"grab":"default",color:i>0?"#666":"#ccc"},draggable:i>0,onDragStart:e=>{i>0&&e.dataTransfer.setData("text/plain",i.toString())},onDragOver:e=>{e.preventDefault()},onDrop:e=>{e.preventDefault();const t=parseInt(e.dataTransfer.getData("text/plain")),s=i;if(t!==s&&t>0){const e=[...v],[i]=e.splice(t,1);e.splice(s,0,i),b(e)}},children:di.jsx(Fs,{})})},{title:"显示名称",dataIndex:"displayName",key:"displayName",width:120},{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:120},{title:"字段名称",dataIndex:"fieldName",key:"fieldName",width:120},{title:"字段类型",dataIndex:"fieldType",key:"fieldType",width:100,render:e=>di.jsx(B,{color:{string:"blue",number:"green",date:"orange"}[e]||"default",children:e})},{title:"属性",dataIndex:"attribute",key:"attribute",width:100,render:e=>di.jsx(B,{color:{"文本":"blue","数值":"green","时间":"orange"}[e]||"default",children:e})},{title:"组织权限字段",key:"organizationPermission",width:100,render:(e,t)=>di.jsx(Ie,{checked:h===t.id,onChange:()=>{u(t.id),te.success(`已将"${t.displayName}"设为组织权限字段`)}})},{title:"操作",key:"action",width:80,render:(e,t)=>di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{b(v.filter(e=>e.id!==t.id)),g(f.filter(e=>e.id!==t.id));const e=new Map(Z);e.delete(t.id),ie(e),te.success("已删除字段")},title:"删除字段"})}]}):di.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"120px",color:"#999",fontSize:"16px",border:"1px dashed #d9d9d9",borderRadius:"6px"},children:"请先选择比对数据集"})}),di.jsx(D,{title:di.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx("div",{style:{width:"3px",height:"16px",backgroundColor:"#52c41a",marginRight:"8px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"14px",fontWeight:"bold"},children:"查询条件配置"})]}),di.jsx(E,{type:"primary",size:"small",icon:di.jsx(K,{}),onClick:()=>{me("comparison"),re(null),ae(!0)},children:"新增查询条件"})]}),size:"small",children:di.jsx(Y,{dataSource:se.comparison,columns:[{title:"条件名称",dataIndex:"name",key:"name",width:150},{title:"组件类型",dataIndex:"componentType",key:"componentType",width:120,render:e=>({input:"输入框",select:"下拉选择",multiSelect:"多选下拉",datePicker:"日期选择",dateRangePicker:"日期范围",numberRange:"数值范围"}[e]||e)},{title:"对应字段",dataIndex:"fieldId",key:"fieldId",width:150,render:e=>{const t=v.find(t=>t.id===e);return t?t.displayName:e}},{title:"是否必填",dataIndex:"required",key:"required",width:80,render:e=>di.jsx(B,{color:e?"red":"green",children:e?"是":"否"})},{title:"操作",key:"action",width:120,render:(e,t)=>di.jsxs(J,{size:"small",children:[di.jsx(E,{type:"text",size:"small",icon:di.jsx(X,{}),onClick:()=>{re(t),ae(!0)},title:"编辑"}),di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{const e=se.comparison.filter(e=>e.id!==t.id);le(t=>m(c({},t),{comparison:e})),te.success("查询条件已删除")},title:"删除"})]})}],size:"small",pagination:!1,locale:{emptyText:'暂无查询条件，点击"新增查询条件"按钮添加'}})})]}),di.jsxs("div",{style:{backgroundColor:"#fafafa",borderRadius:"8px",padding:"20px",marginBottom:"24px"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"20px"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx("div",{style:{width:"4px",height:"20px",backgroundColor:"#fa8c16",marginRight:"12px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"16px",fontWeight:"bold",color:"#333"},children:"基准数据集设置"})]}),di.jsx(E,{type:"primary",icon:di.jsx(K,{}),onClick:()=>Oe(!0),children:"添加基准数据集"})]}),0===he.length?di.jsx(D,{style:{textAlign:"center",padding:"40px",color:"#999"},children:'暂无基准数据集，点击"添加基准数据集"按钮添加'}):he.map((e,t)=>di.jsxs("div",{style:{backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.03), 0 1px 6px -1px rgba(0, 0, 0, 0.02), 0 2px 4px 0 rgba(0, 0, 0, 0.02)",marginBottom:"16px",overflow:"hidden"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 16px",backgroundColor:"#fff7e6",borderBottom:"1px solid #ffd591"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx("div",{style:{width:"3px",height:"16px",backgroundColor:"#fa8c16",marginRight:"8px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"14px",fontWeight:"bold",color:"#d46b08"},children:e.name})]}),di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{const t=he.filter(t=>t.id!==e.id);ue(t),be===e.id&&Ce(""),te.success("基准数据集已删除")},title:"删除数据集"})]}),di.jsx("div",{style:{padding:"16px",borderBottom:"1px solid #f0f0f0"},children:di.jsxs(L,{gutter:16,children:[di.jsxs(P,{span:12,children:[di.jsx("div",{style:{fontSize:"14px",color:"#666",marginBottom:"4px"},children:"连接类型"}),di.jsx(oe,{menu:{items:[{key:"INNER",label:di.jsxs("div",{children:[di.jsx("div",{style:{fontWeight:"bold"},children:"INNER JOIN"}),di.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"内连接"})]}),onClick:()=>{const t=he.map(t=>t.id===e.id?m(c({},t),{joinType:"INNER JOIN"}):t);ue(t),te.success("连接类型已更新为 INNER JOIN")}},{key:"LEFT",label:di.jsxs("div",{children:[di.jsx("div",{style:{fontWeight:"bold"},children:"LEFT JOIN"}),di.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"左连接"})]}),onClick:()=>{const t=he.map(t=>t.id===e.id?m(c({},t),{joinType:"LEFT JOIN"}):t);ue(t),te.success("连接类型已更新为 LEFT JOIN")}},{key:"RIGHT",label:di.jsxs("div",{children:[di.jsx("div",{style:{fontWeight:"bold"},children:"RIGHT JOIN"}),di.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"右连接"})]}),onClick:()=>{const t=he.map(t=>t.id===e.id?m(c({},t),{joinType:"RIGHT JOIN"}):t);ue(t),te.success("连接类型已更新为 RIGHT JOIN")}}]},trigger:["click"],children:di.jsxs(B,{color:"LEFT JOIN"===e.joinType?"blue":"RIGHT JOIN"===e.joinType?"orange":"green",style:{cursor:"pointer"},children:[e.joinType||"INNER JOIN"," ",di.jsx(ze,{style:{fontSize:"10px"}})]})})]}),di.jsx(P,{span:12})]})}),di.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid #f0f0f0"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx("div",{style:{width:"3px",height:"16px",backgroundColor:"#fa8c16",marginRight:"8px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"14px",fontWeight:"bold"},children:"可用字段"})]}),di.jsx(E,{type:"dashed",icon:di.jsx(K,{}),size:"small",onClick:()=>{Ce(e.id),Me(!0)},children:"添加字段"})]}),0===Te.length?di.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"120px",color:"#999",fontSize:"16px",border:"1px dashed #d9d9d9",borderRadius:"6px"},children:'暂无字段，请点击"添加字段"按钮'}):di.jsx(Y,{dataSource:Te,rowKey:"id",size:"small",pagination:!1,scroll:{y:150},columns:[{title:"排序",key:"sort",width:40,render:(e,t,i)=>di.jsx("div",{style:{cursor:i>0?"grab":"default",color:i>0?"#666":"#ccc"},draggable:i>0,onDragStart:e=>{i>0&&e.dataTransfer.setData("text/plain",i.toString())},onDragOver:e=>{e.preventDefault()},onDrop:e=>{e.preventDefault();const t=parseInt(e.dataTransfer.getData("text/plain")),s=i;if(t!==s&&t>0){const e=[...Te],[i]=e.splice(t,1);e.splice(s,0,i),_e(e)}},children:di.jsx(Fs,{})})},{title:"显示名称",dataIndex:"displayName",key:"displayName",width:120},{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:120},{title:"字段名称",dataIndex:"fieldName",key:"fieldName",width:120},{title:"字段类型",dataIndex:"fieldType",key:"fieldType",width:100,render:e=>di.jsx(B,{color:{string:"blue",number:"green",date:"orange"}[e]||"default",children:e})},{title:"属性",dataIndex:"attribute",key:"attribute",width:100,render:e=>di.jsx(B,{color:{"文本":"blue","数值":"green","时间":"orange"}[e]||"default",children:e})},{title:"组织权限字段",key:"organizationPermission",width:100,render:(e,t)=>di.jsx(Ie,{checked:Ne===t.id,onChange:()=>{we(t.id),te.success(`已将"${t.fieldName}"设为组织权限字段`)}})},{title:"操作",key:"action",width:80,render:(e,t)=>di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{_e(Te.filter(e=>e.id!==t.id)),te.success("已删除字段")}})}]})]}),di.jsxs("div",{style:{padding:"16px"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[di.jsx("div",{style:{width:"3px",height:"16px",backgroundColor:"#fa8c16",marginRight:"8px",borderRadius:"2px"}}),di.jsx("span",{style:{fontSize:"14px",fontWeight:"bold"},children:"查询条件配置"})]}),di.jsx(E,{type:"primary",size:"small",icon:di.jsx(K,{}),onClick:()=>{me("baseline"),xe(e.id),re(null),ae(!0)},children:"新增查询条件"})]}),di.jsx(Y,{dataSource:se.baseline[e.id]||[],columns:[{title:"条件名称",dataIndex:"name",key:"name",width:150},{title:"组件类型",dataIndex:"componentType",key:"componentType",width:120,render:e=>({input:"输入框",select:"下拉选择",multiSelect:"多选下拉",datePicker:"日期选择",dateRangePicker:"日期范围",numberRange:"数值范围"}[e]||e)},{title:"对应字段",dataIndex:"fieldId",key:"fieldId",width:150,render:e=>{const t=Te.find(t=>t.id===e);return t?t.displayName:e}},{title:"是否必填",dataIndex:"required",key:"required",width:80,render:e=>di.jsx(B,{color:e?"red":"green",children:e?"是":"否"})},{title:"操作",key:"action",width:120,render:(t,i)=>di.jsxs(J,{size:"small",children:[di.jsx(E,{type:"text",size:"small",icon:di.jsx(X,{}),onClick:()=>{re(i),xe(e.id),ae(!0)},title:"编辑"}),di.jsx(E,{type:"text",size:"small",danger:!0,icon:di.jsx(ee,{}),onClick:()=>{const t=(se.baseline[e.id]||[]).filter(e=>e.id!==i.id);le(i=>m(c({},i),{baseline:m(c({},i.baseline),{[e.id]:t})})),te.success("查询条件已删除")},title:"删除"})]})}],size:"small",pagination:!1,locale:{emptyText:'暂无查询条件，点击"新增查询条件"按钮添加'}})]})]},e.id))]})]})]}),di.jsx(G,{title:"选择比对数据集",open:I,onCancel:()=>{w(!1),F("")},onOk:()=>{const e=Le.find(e=>e.id===O);e?(x({id:e.id,name:e.name}),b([]),te.success(`已选择数据集：${e.name}`),w(!1),F("")):te.warning("请选择一个数据集")},width:800,children:di.jsx(Y,{rowSelection:{type:"radio",selectedRowKeys:O?[O]:[],onChange:e=>{F(e[0]||"")}},columns:[{title:"数据集名称",dataIndex:"name",key:"name",width:200},{title:"描述",dataIndex:"description",key:"description",width:300}],dataSource:Le,rowKey:"id",size:"small",scroll:{y:300}})}),di.jsx(G,{title:"选择基准数据集",open:De,onCancel:()=>Oe(!1),onOk:()=>{Oe(!1),te.success(`已选择 ${he.length} 个数据集`)},width:800,children:di.jsx(Y,{rowSelection:{type:"checkbox",selectedRowKeys:he.map(e=>e.id),onChange:(e,t)=>{const i=t.map(e=>m(c({},e),{joinType:"INNER JOIN"}));ue(i)}},columns:[{title:"数据集名称",dataIndex:"name",key:"name",width:200},{title:"描述",dataIndex:"description",key:"description",width:300}],dataSource:Le,rowKey:"id",size:"small",scroll:{y:300}})}),di.jsx(G,{title:"选择可用字段",open:T,onCancel:()=>{_(!1),M([])},onOk:()=>{const e=Pe.filter(e=>z.includes(e.id)),t=e.filter(e=>!f.some(t=>t.id===e.id));if(t.length>0&&g([...f,...t]),e.length>0){const t=new Set(e.map(e=>e.id)),i=v.filter(e=>!t.has(e.id)),s=e.filter(e=>!v.some(t=>t.id===e.id));b([...s,...i]),te.success(`已添加 ${e.length} 个字段到比对数据集和可用字段`)}_(!1),M([])},width:800,children:di.jsx(Y,{rowSelection:{type:"checkbox",selectedRowKeys:z,onChange:e=>{M(e)}},columns:[{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:120},{title:"字段名称",dataIndex:"fieldName",key:"fieldName",width:120},{title:"字段类型",dataIndex:"fieldType",key:"fieldType",width:100,render:e=>di.jsx(B,{color:{string:"blue",number:"green",date:"orange"}[e]||"default",children:e})},{title:"显示名称",dataIndex:"displayName",key:"displayName",width:120},{title:"属性",dataIndex:"attribute",key:"attribute",width:80,render:e=>di.jsx(B,{color:{"文本":"blue","数值":"green","时间":"orange"}[e]||"default",children:e})}],dataSource:Pe,rowKey:"id",size:"small",scroll:{y:300}})}),di.jsx(G,{title:"添加可用字段",open:C,onCancel:()=>N(!1),onOk:()=>{const e=Pe.filter(e=>A.includes(e.id)&&!v.some(t=>t.id===e.id));e.length>0&&(b([...v,...e]),te.success(`已添加 ${e.length} 个字段`)),N(!1),R([])},width:800,children:di.jsx(Y,{rowSelection:{type:"checkbox",selectedRowKeys:A,onChange:e=>{R(e)}},columns:[{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:120},{title:"字段名称",dataIndex:"fieldName",key:"fieldName",width:120},{title:"字段类型",dataIndex:"fieldType",key:"fieldType",width:100,render:e=>di.jsx(B,{color:{string:"blue",number:"green",date:"orange"}[e]||"default",children:e})},{title:"显示名称",dataIndex:"displayName",key:"displayName",width:120},{title:"属性",dataIndex:"attribute",key:"attribute",width:80,render:e=>di.jsx(B,{color:{"文本":"blue","数值":"green","时间":"orange"}[e]||"default",children:e})}],dataSource:Pe,rowKey:"id",size:"small",scroll:{y:300}})}),di.jsx(G,{title:"添加可用字段",open:Ee,onCancel:()=>Me(!1),onOk:()=>{const e=Pe.filter(e=>Ae.includes(e.id)&&!Te.some(t=>t.id===e.id));e.length>0&&(_e([...Te,...e]),te.success(`已添加 ${e.length} 个字段`)),Me(!1),Re([])},width:800,children:di.jsx(Y,{rowSelection:{type:"checkbox",selectedRowKeys:Ae,onChange:e=>{Re(e)}},columns:[{title:"字段编码",dataIndex:"fieldCode",key:"fieldCode",width:120},{title:"字段名称",dataIndex:"fieldName",key:"fieldName",width:120},{title:"字段类型",dataIndex:"fieldType",key:"fieldType",width:100,render:e=>di.jsx(B,{color:{string:"blue",number:"green",date:"orange"}[e]||"default",children:e})},{title:"显示名称",dataIndex:"displayName",key:"displayName",width:120},{title:"属性",dataIndex:"attribute",key:"attribute",width:80,render:e=>di.jsx(B,{color:{"文本":"blue","数值":"green","时间":"orange"}[e]||"default",children:e})}],dataSource:Pe,rowKey:"id",size:"small",scroll:{y:300}})}),di.jsx(G,{title:de?"编辑查询条件":"新增查询条件",open:ne,onCancel:()=>{ae(!1),re(null)},onOk:()=>y(e,null,function*(){try{const e=document.querySelector("#queryConditionForm");if(!e)return;const t=new FormData(e),i={id:(null==de?void 0:de.id)||`query_${Date.now()}`,name:t.get("name"),componentType:t.get("componentType"),fieldId:t.get("fieldId"),remark:t.get("remark"),required:"on"===t.get("required")};if(!i.name||!i.componentType||!i.fieldId)return void te.error("请填写所有必填字段");if("comparison"===ce){const e=de?se.comparison.map(e=>e.id===de.id?i:e):[...se.comparison,i];le(t=>m(c({},t),{comparison:e}))}else{const e=se.baseline[pe]||[],t=de?e.map(e=>e.id===de.id?i:e):[...e,i];le(e=>m(c({},e),{baseline:m(c({},e.baseline),{[pe]:t})}))}te.success(de?"查询条件更新成功":"查询条件添加成功"),ae(!1),re(null)}catch(e){te.error("保存失败，请重试")}}),width:600,children:di.jsxs("form",{id:"queryConditionForm",style:{display:"flex",flexDirection:"column",gap:"16px"},children:[di.jsxs("div",{children:[di.jsxs("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px"},children:["条件名称 ",di.jsx("span",{style:{color:"red"},children:"*"})]}),di.jsx("input",{name:"name",type:"text",placeholder:"请输入条件名称",defaultValue:null==de?void 0:de.name,style:{width:"100%",padding:"8px",border:"1px solid #d9d9d9",borderRadius:"6px"}})]}),di.jsxs("div",{children:[di.jsxs("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px"},children:["组件类型 ",di.jsx("span",{style:{color:"red"},children:"*"})]}),di.jsxs("select",{name:"componentType",defaultValue:(null==de?void 0:de.componentType)||"",style:{width:"100%",padding:"8px",border:"1px solid #d9d9d9",borderRadius:"6px"},children:[di.jsx("option",{value:"",children:"请选择组件类型"}),di.jsx("option",{value:"input",children:"输入框"}),di.jsx("option",{value:"select",children:"下拉选择"}),di.jsx("option",{value:"multiSelect",children:"多选下拉"}),di.jsx("option",{value:"datePicker",children:"日期选择"}),di.jsx("option",{value:"dateRangePicker",children:"日期范围"}),di.jsx("option",{value:"numberRange",children:"数值范围"})]})]}),di.jsxs("div",{children:[di.jsxs("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px"},children:["对应字段 ",di.jsx("span",{style:{color:"red"},children:"*"})]}),di.jsxs("select",{name:"fieldId",defaultValue:(null==de?void 0:de.fieldId)||"",style:{width:"100%",padding:"8px",border:"1px solid #d9d9d9",borderRadius:"6px"},children:[di.jsx("option",{value:"",children:"请选择对应字段"}),("comparison"===ce?v:Te).map(e=>di.jsxs("option",{value:e.id,children:[e.displayName," (",e.fieldName,")"]},e.id))]})]}),di.jsxs("div",{children:[di.jsx("label",{style:{display:"block",marginBottom:"4px",fontSize:"14px"},children:"备注"}),di.jsx("textarea",{name:"remark",placeholder:"可选的备注说明",defaultValue:(null==de?void 0:de.remark)||"",rows:2,style:{width:"100%",padding:"8px",border:"1px solid #d9d9d9",borderRadius:"6px",resize:"vertical"}})]}),di.jsx("div",{children:di.jsxs("label",{style:{display:"flex",alignItems:"center",fontSize:"14px"},children:[di.jsx("input",{type:"checkbox",name:"required",defaultChecked:(null==de?void 0:de.required)||!1,style:{marginRight:"8px"}}),"是否必填"]})})]})})]})},group:"一期"},{title:"比价分析中心",to:"/report-center",icon:di.jsx(Ve,{className:"h-4 w-4"}),component:()=>{const[e,t]=j.useState(["cost","history"]),[i,s]=j.useState("supplier"),[l,n]=j.useState(["supplier"]),[a,d]=j.useState("lowest"),[r,o]=j.useState(["supplier"]),[p,x]=j.useState("supplier"),[h,u]=j.useState("history"),[f,g]=j.useState(!1),[y,v]=j.useState(""),[b,C]=j.useState(""),[N,I]=j.useState([]),[w,S]=j.useState(!0),[k,T]=j.useState(!0),[_,A]=j.useState({managementOrg:[],supplier:[],product:[],brand:[],inventoryCategory:[]}),[R,z]=j.useState({managementOrg:[],supplier:[],product:[],brand:[],inventoryCategory:[]}),M=(e,t,i=!1)=>{v(e),C(t);const s=i?R[e]:_[e];I(s||[]),g(!0)},O=()=>{g(!1),v(""),C(""),I([])},L=(e,t,i)=>{if(0===e.length)return i;const s=P(t).filter(t=>e.includes(t.value));return 1===s.length?s[0].name:s.length>1?`${s[0].name} +${s.length-1}`:i},P=e=>{switch(e){case"managementOrg":return[{code:"DIAN001",name:"迪安诊断技术集团",value:"dian"},{code:"HUADA001",name:"华大基因",value:"huada"},{code:"JINYU001",name:"金域医学",value:"jinyu"}];case"supplier":return[{code:"SUP001",name:"罗氏Roche Diagnostics",value:"roche"},{code:"SUP002",name:"迪安诊断技术集团股份有限公司",value:"dian_supplier"},{code:"SUP003",name:"西门子医疗",value:"siemens"},{code:"SUP004",name:"雅培诊断",value:"abbott"}];case"product":return[{code:"1001",name:"糖类抗原15-3(检测试剂) CA15-3",brand:"罗氏Roche",registrationNo:"国械注准20173400123",specification:"100测试/盒",model:"CA15-3 Kit",itemNo:"RO-CA153-100",value:"ca15_3"},{code:"1002",name:"三碘甲状腺原氨酸测定试剂 T3",brand:"罗氏Roche",registrationNo:"国械注准20173400124",specification:"100测试/盒",model:"T3 Kit",itemNo:"RO-T3-100",value:"t3"},{code:"1003",name:"癌胚抗原测定试剂 CEA CalSet",brand:"罗氏Roche",registrationNo:"国械注准20173400125",specification:"100测试/盒",model:"CEA Kit",itemNo:"RO-CEA-100",value:"cea"},{code:"1004",name:"糖类抗原19-9(检测试剂) CA19-9",brand:"罗氏Roche",registrationNo:"国械注准20173400126",specification:"100测试/盒",model:"CA19-9 Kit",itemNo:"RO-CA199-100",value:"ca19_9"}];case"brand":return[{code:"BR001",name:"罗氏Roche",value:"roche"},{code:"BR002",name:"西门子Siemens",value:"siemens"},{code:"BR003",name:"雅培Abbott",value:"abbott"},{code:"BR004",name:"贝克曼Beckman",value:"beckman"}];case"inventoryCategory":return[{code:"CAT001",name:"体外诊断试剂",value:"ivd"},{code:"CAT002",name:"医疗器械",value:"medical_device"},{code:"CAT003",name:"实验室耗材",value:"lab_consumables"},{code:"CAT004",name:"检测设备",value:"testing_equipment"}];default:return[]}},B={fields:{rows:["productCode","productName","brand"],columns:["supplier"],values:["managementOrg","procurementMode","agreementPrice","diffRate"],valueInCols:!0},meta:[{field:"productCode",name:"产品编号"},{field:"productName",name:"产品名称"},{field:"brand",name:"品牌"},{field:"supplier",name:"供应商"},{field:"managementOrg",name:"管理组织"},{field:"procurementMode",name:"采购模式"},{field:"agreementPrice",name:"协议单价",formatter:e=>`¥${(null==e?void 0:e.toFixed(2))||"-"}`},{field:"diffRate",name:"差异率",formatter:e=>null==e||0===e?"-":e>0?`+${e.toFixed(2)}%`:`${e.toFixed(2)}%`},{field:"taxRate",name:"税率",formatter:e=>`${e}%`}],data:[{productCode:"1101",productName:"糖类抗原15-3(检测试剂) CA15-3",brand:"罗氏Roche",supplier:"罗氏Roche Diagnostics",managementOrg:"迪安诊断技术集团",procurementMode:"集中采购",agreementPrice:191.23,taxRate:13,diffRate:0},{productCode:"1102",productName:"糖类抗原15-3(检测试剂) CA15-3",brand:"罗氏Roche",supplier:"迪安诊断技术集团股份有限公司",managementOrg:"迪安诊断技术集团",procurementMode:"集中采购",agreementPrice:198.23,taxRate:13,diffRate:13},{productCode:"1003",productName:"三碘甲状腺原氨酸测定试剂 T3",brand:"罗氏Roche",supplier:"罗氏Roche Diagnostics",managementOrg:"迪安诊断技术集团",procurementMode:"自行采购",agreementPrice:226,taxRate:13,diffRate:0},{productCode:"1004",productName:"癌胚抗原测定试剂 CEA CalSet",brand:"罗氏Roche",supplier:"罗氏Roche Diagnostics",managementOrg:"迪安诊断技术集团",procurementMode:"集中采购",agreementPrice:98,taxRate:13,diffRate:0},{productCode:"1005",productName:"癌胚抗原测定试剂 CEA CalSet",brand:"罗氏Roche",supplier:"迪安诊断技术集团股份有限公司",managementOrg:"迪安诊断技术集团",procurementMode:"集中采购",agreementPrice:133,taxRate:13,diffRate:13},{productCode:"1006",productName:"糖类抗原19-9(检测试剂) CA19-9",brand:"罗氏Roche",supplier:"罗氏Roche Diagnostics",managementOrg:"迪安诊断技术集团",procurementMode:"自行采购",agreementPrice:155.26,taxRate:13,diffRate:0},{productCode:"1007",productName:"非小细胞肺癌相关抗原21-1",brand:"罗氏Roche",supplier:"罗氏Roche Diagnostics",managementOrg:"迪安诊断技术集团",procurementMode:"集中采购",agreementPrice:199.18,taxRate:13,diffRate:0},{productCode:"1008",productName:"非小细胞肺癌相关抗原21-1",brand:"罗氏Roche",supplier:"迪安诊断技术集团股份有限公司",managementOrg:"迪安诊断技术集团",procurementMode:"集中采购",agreementPrice:567,taxRate:13,diffRate:150.1}]};return di.jsxs("div",{className:"p-6 space-y-6",children:[di.jsx(D,{title:di.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[di.jsx(Tn,{level:3,style:{margin:0},children:"同产品采购协议价比较分析 (方案: PLAN_20250806_MED001)"}),di.jsxs("div",{style:{display:"flex",gap:"8px"},children:[di.jsx(E,{icon:di.jsx(at,{size:16}),size:"small",children:"收藏"}),di.jsx(E,{icon:di.jsx(dt,{size:16}),size:"small",children:"导出"}),di.jsx(E,{icon:di.jsx(rt,{size:16}),size:"small",children:"重置"})]})]}),children:di.jsxs("div",{style:{marginBottom:"24px"},children:[di.jsxs("div",{style:{marginBottom:"24px"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",cursor:"pointer",marginBottom:"16px"},onClick:()=>S(!w),children:[di.jsx("div",{style:{width:"4px",height:"20px",backgroundColor:"#1890ff",marginRight:"8px"}}),di.jsx(Tn,{level:4,style:{margin:0,marginRight:"8px"},children:"分析对象设置:"}),w?di.jsx(lt,{size:16}):di.jsx(nt,{size:16})]}),w&&di.jsxs("div",{children:[di.jsxs("div",{style:{marginBottom:"12px",display:"flex",alignItems:"center"},children:[di.jsx("span",{style:{fontWeight:"bold",marginRight:"12px",minWidth:"80px"},children:"分析指标："}),di.jsx(me.Group,{value:e,onChange:t,style:{display:"flex",gap:"16px"},children:[{label:"协议价（含税）",value:"agreementPriceTax"},{label:"协议价（不含税）",value:"agreementPriceNoTax"},{label:"税率",value:"taxRate"}].map(e=>di.jsx(me,{value:e.value,children:e.label},e.value))})]}),di.jsxs("div",{style:{marginBottom:"12px"},children:[di.jsx("span",{style:{fontWeight:"bold",marginRight:"12px"},children:"分析对象："}),di.jsx(q,{value:i,onChange:s,style:{width:160},children:[{label:"供应商",value:"supplier"},{label:"采购组织",value:"procurementOrg"},{label:"采购模式",value:"procurementMode"}].map(e=>di.jsx(_n,{value:e.value,children:e.label},e.value))})]}),di.jsxs("div",{style:{marginBottom:"12px",display:"flex",alignItems:"center"},children:[di.jsx("span",{style:{fontWeight:"bold",marginRight:"12px",minWidth:"80px"},children:"分析维度："}),di.jsx(me.Group,{value:l,onChange:n,style:{display:"flex",gap:"16px"},children:[{label:"管理组织",value:"managementOrg"},{label:"采购组织",value:"procurementOrg"},{label:"采购模式",value:"procurementMode"},{label:"供应商",value:"supplier"}].map(e=>di.jsx(me,{value:e.value,children:e.label},e.value))})]}),di.jsxs("div",{style:{marginBottom:"12px"},children:[di.jsx("span",{style:{fontWeight:"bold",marginRight:"12px"},children:"筛选范围："}),di.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginTop:"8px"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{minWidth:"80px",textAlign:"right"},children:"管理组织："}),di.jsx(E,{onClick:()=>M("managementOrg","选择管理组织"),style:{width:220,textAlign:"left"},children:L(_.managementOrg,"managementOrg","请选择管理组织")})]}),di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{minWidth:"80px",textAlign:"right"},children:"采购模式："}),di.jsxs(q,{mode:"multiple",placeholder:"请选择采购模式",style:{width:220},children:[di.jsx(_n,{value:"centralized",children:"集中采购"}),di.jsx(_n,{value:"independent",children:"自行采购"}),di.jsx(_n,{value:"delegated",children:"委托采购"})]})]}),di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{minWidth:"80px",textAlign:"right"},children:"供应商："}),di.jsx(E,{onClick:()=>M("supplier","选择供应商"),style:{width:220,textAlign:"left"},children:L(_.supplier,"supplier","请选择供应商")})]}),di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{minWidth:"80px",textAlign:"right"},children:"产品："}),di.jsx(E,{onClick:()=>M("product","选择产品"),style:{width:220,textAlign:"left"},children:L(_.product,"product","请选择产品")})]}),di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{minWidth:"80px",textAlign:"right"},children:"品牌："}),di.jsx(E,{onClick:()=>M("brand","选择品牌"),style:{width:220,textAlign:"left"},children:L(_.brand,"brand","请选择品牌")})]}),di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{minWidth:"80px",textAlign:"right"},children:"存货分类："}),di.jsx(E,{onClick:()=>M("inventoryCategory","选择存货分类"),style:{width:220,textAlign:"left"},children:L(_.inventoryCategory,"inventoryCategory","请选择存货分类")})]})]})]})]})]}),di.jsxs("div",{style:{borderTop:"1px solid #f0f0f0",paddingTop:"16px"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",cursor:"pointer",marginBottom:"16px"},onClick:()=>T(!k),children:[di.jsx("div",{style:{width:"4px",height:"20px",backgroundColor:"#1890ff",marginRight:"8px"}}),di.jsx(Tn,{level:4,style:{margin:0,marginRight:"8px"},children:"基准选择:"}),k?di.jsx(lt,{size:16}):di.jsx(nt,{size:16})]}),k&&di.jsxs("div",{children:[di.jsxs("div",{style:{marginBottom:"12px",display:"flex",alignItems:"center"},children:[di.jsx("span",{style:{fontWeight:"bold",marginRight:"12px",minWidth:"80px"},children:"基准指标："}),di.jsx(me.Group,{value:[a],onChange:e=>d(e[e.length-1]||"lowest"),style:{display:"flex",gap:"16px"},children:[{label:"最高价",value:"highest"},{label:"最低价",value:"lowest"},{label:"平均价",value:"average"}].map(e=>di.jsx(me,{value:e.value,children:e.label},e.value))})]}),di.jsxs("div",{style:{marginBottom:"12px",display:"flex",alignItems:"center"},children:[di.jsx("span",{style:{fontWeight:"bold",marginRight:"12px",minWidth:"80px"},children:"基准维度："}),di.jsx(me.Group,{value:r,onChange:o,style:{display:"flex",gap:"16px"},children:[{label:"供应商",value:"supplier"},{label:"采购模式",value:"procurementMode"},{label:"采购组织",value:"procurementOrg"}].map(e=>di.jsx(me,{value:e.value,children:e.label},e.value))})]}),di.jsxs("div",{style:{marginBottom:"12px"},children:[di.jsx("span",{style:{fontWeight:"bold",marginRight:"12px"},children:"基准范围："}),di.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginTop:"8px"},children:[di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{minWidth:"80px",textAlign:"right"},children:"管理组织："}),di.jsx(E,{onClick:()=>M("baselineManagementOrg","选择管理组织"),style:{width:220,textAlign:"left"},children:L(R.managementOrg,"managementOrg","请选择管理组织")})]}),di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{minWidth:"80px",textAlign:"right"},children:"采购模式："}),di.jsxs(q,{mode:"multiple",placeholder:"请选择采购模式",style:{width:220},children:[di.jsx(_n,{value:"centralized",children:"集中采购"}),di.jsx(_n,{value:"independent",children:"自行采购"}),di.jsx(_n,{value:"delegated",children:"委托采购"})]})]}),di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{minWidth:"80px",textAlign:"right"},children:"供应商："}),di.jsx(E,{onClick:()=>M("baselineSupplier","选择供应商"),style:{width:220,textAlign:"left"},children:L(R.supplier,"supplier","请选择供应商")})]}),di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{minWidth:"80px",textAlign:"right"},children:"产品："}),di.jsx(E,{onClick:()=>M("baselineProduct","选择产品"),style:{width:220,textAlign:"left"},children:L(R.product,"product","请选择产品")})]}),di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{minWidth:"80px",textAlign:"right"},children:"品牌："}),di.jsx(E,{onClick:()=>M("baselineBrand","选择品牌"),style:{width:220,textAlign:"left"},children:L(R.brand,"brand","请选择品牌")})]}),di.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[di.jsx("span",{style:{minWidth:"80px",textAlign:"right"},children:"存货分类："}),di.jsx(E,{onClick:()=>M("baselineInventoryCategory","选择存货分类"),style:{width:220,textAlign:"left"},children:L(R.inventoryCategory,"inventoryCategory","请选择存货分类")})]})]})]})]})]})]})}),di.jsx(D,{title:"同产品采购协议价比较分析",children:di.jsx("div",{style:{width:"100%",overflowX:"auto"},children:di.jsx(pe,{dataCfg:B,options:{width:1200,height:600,interaction:{selectedCellsSpotlight:!0,hoverHighlight:!0},style:{layoutWidthType:"adaptive",cellCfg:{height:40}},conditions:{text:[{field:"diffRate",mapping:e=>e>50?{fill:"#ff4d4f"}:e>0?{fill:"#faad14"}:{fill:"#52c41a"}}]}},sheetType:"pivot"})})}),di.jsx(D,{children:di.jsx("div",{style:{padding:"16px"},children:di.jsxs("div",{style:{fontSize:"14px",color:"#666",display:"flex",flexDirection:"column",gap:"8px"},children:[di.jsxs("div",{style:{display:"flex",gap:"16px"},children:[di.jsx("span",{style:{fontWeight:"bold"},children:"基准对象:"}),di.jsx("span",{children:"罗氏Roche Diagnostics (所有差异率以此为准)"})]}),di.jsxs("div",{style:{display:"flex",gap:"16px"},children:[di.jsx("span",{style:{fontWeight:"bold"},children:"分析对象:"}),di.jsx("span",{children:"迪安诊断技术集团股份有限公司"})]}),di.jsxs("div",{style:{display:"flex",gap:"16px"},children:[di.jsx("span",{style:{fontWeight:"bold"},children:"颜色说明:"}),di.jsx("span",{style:{color:"#52c41a"},children:"绿色: 基准价格"}),di.jsx("span",{style:{color:"#faad14"},children:"黄色: 轻微差异 (0-50%)"}),di.jsx("span",{style:{color:"#ff4d4f"},children:"红色: 显著差异 (>50%)"})]})]})})}),di.jsx(G,{title:b,open:f,onOk:()=>{b.includes("基准")?z(e=>m(c({},e),{[y]:N})):A(e=>m(c({},e),{[y]:N})),O()},onCancel:O,width:y.includes("product")?1e3:600,children:di.jsx(Y,{rowSelection:{type:"checkbox",selectedRowKeys:N,onChange:e=>I(e)},dataSource:P(y.replace("baseline","")),rowKey:"value",pagination:!1,size:"small",columns:[{title:"编码",dataIndex:"code",key:"code",width:120},{title:"名称",dataIndex:"name",key:"name",ellipsis:!0},...y.includes("product")?[{title:"品牌",dataIndex:"brand",key:"brand",width:100},{title:"注册证号",dataIndex:"registrationNo",key:"registrationNo",width:140},{title:"规格",dataIndex:"specification",key:"specification",width:100},{title:"型号",dataIndex:"model",key:"model",width:100},{title:"货号",dataIndex:"itemNo",key:"itemNo",width:120}]:[]]})})]})},group:"一期"},{title:"发布报表",to:"/report-publish",icon:di.jsx(ut,{className:"h-4 w-4"}),component:()=>{const t=C(),[i]=W.useForm(),[s,l]=j.useState(""),[n,a]=j.useState(""),[d,r]=j.useState([]),[o,p]=j.useState(null),[x,h]=j.useState(["dimension","metric","calculated","baseline"]),[u,f]=j.useState(!1),[g,v]=j.useState(["财务分析报表","采购比价报表","库存分析报表","销售业绩报表"]),[b,N]=j.useState(!1),[I,w]=j.useState(""),[S,k]=j.useState(!1),[T]=j.useState([{id:"scheme_001",name:"体外诊断试剂比价方案",description:"针对体外诊断试剂的专业比价方案"},{id:"scheme_002",name:"医疗设备比价方案",description:"大型医疗设备采购比价分析方案"},{id:"scheme_003",name:"药品比价方案",description:"各类药品价格对比分析方案"},{id:"scheme_004",name:"耗材比价方案",description:"医用耗材价格对比方案"}]),[_,A]=j.useState([]),R=()=>{if(!I.trim())return void te.warning("请输入分组名称");if(g.includes(I.trim()))return void te.warning("该分组已存在");const e=[...g,I.trim()];v(e),a(I.trim()),w(""),N(!1),te.success("添加分组成功")},z=[{id:"comp-sku",name:"SKU编码",type:"dimension",description:"产品SKU编码"},{id:"comp-name",name:"产品名称",type:"dimension",description:"产品具体名称"},{id:"comp-category",name:"产品类别",type:"dimension",description:"产品分类"}],M=[{key:"dimension",title:"比对维度",children:[{id:"dim1",name:"产品名称",type:"dimension",description:"检测产品的具体名称"},{id:"dim2",name:"规格型号",type:"dimension",description:"产品的规格参数"},{id:"dim3",name:"生产厂家",type:"dimension",description:"产品生产厂商"},{id:"dim4",name:"省份",type:"dimension",description:"销售区域省份"},{id:"dim5",name:"医院等级",type:"dimension",description:"医疗机构等级分类"}].map(e=>({key:e.id,title:e.name,isLeaf:!0,itemData:e}))},{key:"metric",title:"比对指标",children:[{id:"met1",name:"中标价格",type:"metric",description:"产品中标价格"},{id:"met2",name:"挂网价格",type:"metric",description:"平台挂网价格"},{id:"met3",name:"采购量",type:"metric",description:"采购数量统计"},{id:"met4",name:"采购金额",type:"metric",description:"采购总金额"}].map(e=>({key:e.id,title:e.name,isLeaf:!0,itemData:e}))},{key:"calculated",title:"计算指标",children:[{id:"calc1",name:"价差率",type:"calculated",description:"(中标价格-挂网价格)/挂网价格"},{id:"calc2",name:"市场份额",type:"calculated",description:"企业采购量占比"},{id:"calc3",name:"价格排名",type:"calculated",description:"按价格从低到高排名"}].map(e=>({key:e.id,title:e.name,isLeaf:!0,itemData:e}))},{key:"baseline",title:"基准指标",children:[{id:"base1",name:"平均价格",type:"baseline",description:"所有企业平均中标价格"},{id:"base2",name:"最低价格",type:"baseline",description:"所有企业最低中标价格"},{id:"base3",name:"市场基准价",type:"baseline",description:"行业市场基准价格"},{id:"base4",name:"历史均价",type:"baseline",description:"历史采购平均价格"}].map(e=>({key:e.id,title:e.name,isLeaf:!0,itemData:e}))}],D=()=>d.map(e=>e.id),O=e=>{const t=D(),i=e.itemData&&t.includes(e.itemData.id),s=e.isLeaf;return di.jsxs("div",{className:`flex items-center h-6 px-2 rounded cursor-pointer transition-all\n          ${i?"opacity-50 cursor-not-allowed":"hover:bg-blue-50"}\n        `,draggable:s&&!i,onDragStart:t=>{s&&e.itemData?((e,t)=>{D().includes(t.id)?e.preventDefault():(p(t),e.dataTransfer.effectAllowed="copy")})(t,e.itemData):t.preventDefault()},onDragEnd:L,children:[di.jsx("span",{className:"text-sm "+(i?"text-gray-400":"text-gray-700"),children:e.title}),i&&di.jsx("span",{className:"ml-auto text-xs text-gray-400",children:"已使用"})]})},L=()=>{p(null)},P=e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},{data:B,fields:F}=(()=>{const e=d.filter(e=>"row"===e.position),t=d.filter(e=>"column"===e.position),i=d.filter(e=>"value"===e.position);if(0===t.length&&0===i.length)return{data:[],fields:{}};const s=[];[{"SKU编码":"SKU001","产品名称":"生化分析仪A1","产品类别":"生化试剂"},{"SKU编码":"SKU002","产品名称":"化学发光仪B2","产品类别":"免疫试剂"},{"SKU编码":"SKU003","产品名称":"基因测序仪C3","产品类别":"分子诊断"},{"SKU编码":"SKU004","产品名称":"细菌鉴定仪D4","产品类别":"微生物检测"}].forEach(l=>{for(let n=0;n<2;n++){const a={"SKU编码":l["SKU编码"],"产品名称":l["产品名称"],"产品类别":l["产品类别"]};e.forEach(e=>{a[e.name]=`${e.name}_${n+1}`}),t.forEach(e=>{a[e.name]=`${e.name}_类别${n%3+1}`}),i.forEach(e=>{"metric"===e.type?a[e.name]=Math.floor(1e4*Math.random())/100:"calculated"===e.type?a[e.name]=Math.floor(100*Math.random()):a[e.name]=`值${n+1}`}),s.push(a)}});const l={rows:["SKU编码","产品名称","产品类别",...e.map(e=>e.name)],columns:t.map(e=>e.name),values:i.map(e=>e.name)};return{data:s,fields:l}})(),$=(e,t,i)=>{const s=d.filter(e=>e.position===t);if("row"===t){const i=d.filter(e=>"row"===e.position),s=[...z,...i];return di.jsxs("div",{className:"flex items-center px-1 py-2 border-b border-gray-200 hover:bg-gray-50 transition-colors min-h-[36px]",style:{gap:"0"},onDragOver:P,onDrop:e=>{if(e.preventDefault(),!o)return;if("dimension"!==o.type)return void te.warning("只能将维度字段拖拽到行维度");const i=m(c({},o),{position:t});r(e=>[...e.filter(e=>e.id!==o.id),i]),p(null)},children:[di.jsx("div",{className:"w-1/5 flex items-center",style:{paddingRight:"4px"},children:di.jsx(Hn,{className:"text-sm text-gray-700",children:e})}),di.jsx("div",{className:"w-4/5",children:0===s.length?di.jsx("div",{className:"h-6 flex items-center",children:di.jsx(q,{placeholder:`选择${e}`,className:"w-full",style:{fontSize:"14px",margin:0},dropdownStyle:{fontSize:"14px"},onDropdownVisibleChange:t=>{t&&te.info(`请从左侧拖拽字段到${e}`)},open:!1})}):di.jsx("div",{className:"flex gap-1 items-center h-6",children:s.map((e,t)=>di.jsxs("div",{className:`px-2 py-1 text-xs rounded cursor-pointer transition-all border h-6 flex items-center\n                      ${0===t?"bg-blue-100 text-blue-700 border-blue-300":e.id.startsWith("comp-")?"bg-blue-50 text-blue-600 border-blue-200":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-gray-200"}\n                    `,onClick:()=>{},children:[di.jsxs("div",{className:"flex items-center gap-1",children:["metric"===e.type&&di.jsx("span",{className:"opacity-75",children:"求和"}),e.name]}),!e.id.startsWith("comp-")&&di.jsx(E,{type:"text",size:"small",icon:di.jsx("span",{className:"text-gray-400 hover:text-red-500",children:"×"}),className:"ml-1 p-0 h-auto min-w-0 text-xs",onClick:t=>{t.stopPropagation(),r(t=>t.filter(t=>t.id!==e.id))}})]},e.id))})})]})}return di.jsxs("div",{className:"flex items-center px-1 py-2 border-b border-gray-200 hover:bg-gray-50 transition-colors min-h-[36px]",style:{gap:"0"},onDragOver:P,onDrop:e=>{if(e.preventDefault(),!o)return;const i=m(c({},o),{position:t});r(e=>[...e.filter(e=>e.id!==o.id),i]),p(null)},children:[di.jsx("div",{className:"w-1/5 flex items-center",style:{paddingRight:"4px"},children:di.jsx(Hn,{className:"text-sm text-gray-700",children:e})}),di.jsx("div",{className:"w-4/5",children:0===s.length?di.jsx("div",{className:"h-6 flex items-center",children:di.jsx(q,{placeholder:`选择${e}`,className:"w-full",style:{fontSize:"14px",margin:0},dropdownStyle:{fontSize:"14px"},onDropdownVisibleChange:t=>{t&&te.info(`请从左侧拖拽字段到${e}`)},open:!1})}):di.jsx("div",{className:"flex gap-1 items-center h-6",children:s.map((e,i)=>di.jsxs("div",{className:`px-2 py-1 text-xs rounded cursor-pointer transition-all border h-6 flex items-center\n                    ${0===i?"row"===t?"bg-blue-100 text-blue-700 border-blue-300":"column"===t?"bg-cyan-100 text-cyan-700 border-cyan-300":"bg-indigo-100 text-indigo-700 border-indigo-300":"bg-gray-100 text-gray-600 border-gray-300 hover:bg-gray-200"}\n                  `,onClick:()=>{},children:[di.jsxs("div",{className:"flex items-center gap-1",children:["metric"===e.type&&di.jsx("span",{className:"opacity-75",children:"求和"}),e.name]}),di.jsx(E,{type:"text",size:"small",icon:di.jsx("span",{className:"text-gray-400 hover:text-red-500",children:"×"}),className:"ml-1 p-0 h-auto min-w-0 text-xs",onClick:t=>{var i;t.stopPropagation(),i=e.id,r(e=>e.filter(e=>e.id!==i))}})]},e.id))})})]})};return D(),di.jsx(ye,{className:"min-h-screen bg-gray-50",children:di.jsxs(qn,{className:"p-0",children:[di.jsx("div",{className:"bg-white border-b px-6 py-4",children:di.jsxs("div",{className:"flex items-center justify-between",children:[di.jsxs("div",{children:[di.jsx(Vn,{level:3,className:"mb-2",children:"发布报表"}),di.jsx(Hn,{type:"secondary",children:"从比价方案配置中拖拽字段来创建自定义报表布局"})]}),di.jsxs(J,{children:[di.jsx(E,{icon:di.jsx(wl,{}),onClick:()=>{k(!0)},children:"权限管理"}),di.jsx(E,{icon:di.jsx(je,{}),onClick:()=>{0!==d.length?te.success("报表预览功能开发中..."):te.warning("请先配置报表内容")},children:"预览报表"}),di.jsx(E,{type:"primary",icon:di.jsx(Tl,{}),onClick:()=>y(e,null,function*(){try{const e=yield i.validateFields();if(0===d.length)return void te.warning("请先配置报表内容");if(!s)return void te.warning("请选择比价方案");f(!0),setTimeout(()=>{var i;Date.now(),e.reportName,null==(i=T.find(e=>e.id===s))||i.name,e.description,be().format("YYYY-MM-DD HH:mm:ss"),te.success("报表发布成功！"),setTimeout(()=>{t("/price-comparison-reports")},1500),f(!1)},1500)}catch(e){f(!1)}}),loading:u,children:"保存报表"})]})]})}),di.jsxs("div",{className:"flex",children:[di.jsx("div",{className:"w-80 bg-white border-r h-screen overflow-y-auto",children:di.jsxs("div",{className:"p-4 space-y-4",children:[di.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[di.jsx("div",{className:"bg-gray-50 px-3 py-2 border-b border-gray-200",children:di.jsxs("div",{className:"flex items-center",children:[di.jsx(Ls,{className:"text-blue-600 mr-2"}),di.jsx("span",{className:"font-medium text-sm text-gray-700",children:"报表基本信息"})]})}),di.jsxs("div",{className:"p-3 space-y-3",children:[di.jsxs("div",{children:[di.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"报表名称"}),di.jsx(W.Item,{name:"reportName",rules:[{required:!0,message:"请输入报表名称"}],className:"mb-0",children:di.jsx(U,{placeholder:"请输入报表名称",style:{fontSize:"14px"}})})]}),di.jsxs("div",{children:[di.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"比价方案"}),di.jsx(W.Item,{name:"schemeId",rules:[{required:!0,message:"请选择方案"}],className:"mb-0",children:di.jsx(q,{onChange:e=>{l(e);const t=T.find(t=>t.id===e);if(t){const e=`${be().format("YYYY年MM月DD日")}${t.name}`;i.setFieldsValue({reportName:e})}},value:s,placeholder:"请选择比价方案",style:{fontSize:"14px"},children:T.map(e=>di.jsx(q.Option,{value:e.id,children:e.name},e.id))})})]}),di.jsxs("div",{children:[di.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"报表分组"}),b?di.jsxs("div",{className:"flex items-center space-x-1",children:[di.jsx(U,{value:I,onChange:e=>w(e.target.value),placeholder:"输入新分组名称",style:{fontSize:"14px"},onPressEnter:R}),di.jsx(E,{size:"small",type:"primary",onClick:R,children:"确定"}),di.jsx(E,{size:"small",onClick:()=>{w(""),N(!1),a("")},children:"取消"})]}):di.jsxs(q,{value:n,onChange:e=>{"add_new"===e?(N(!0),a("")):(a(e),N(!1))},placeholder:"选择分组",allowClear:!0,style:{fontSize:"14px"},children:[g.map(e=>di.jsx(q.Option,{value:e,children:e},e)),di.jsxs(q.Option,{value:"add_new",className:"text-blue-600",children:[di.jsx(K,{className:"mr-1"}),"添加新分组"]})]})]}),di.jsxs("div",{children:[di.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"描述"}),di.jsx(W.Item,{name:"description",className:"mb-0",children:di.jsx(Un,{placeholder:"请输入报表描述",rows:2,style:{fontSize:"14px"}})})]})]})]}),di.jsxs("div",{children:[di.jsxs("div",{className:"flex items-center justify-between mb-3",children:[di.jsx(Vn,{level:4,className:"mb-0 text-sm",children:"可用字段"}),di.jsx(Hn,{type:"secondary",className:"text-xs",children:"拖拽到右侧进行配置"})]}),di.jsx("div",{className:"border border-gray-200 rounded-lg",children:di.jsx(ne,{showLine:!1,showIcon:!1,defaultExpandAll:!0,expandedKeys:x,onExpand:e=>h(e),treeData:M,titleRender:e=>O(e),className:"field-tree",switcherIcon:({expanded:e})=>e?di.jsx(ve,{className:"text-gray-500 text-xs"}):di.jsx(Ms,{className:"text-gray-500 text-xs"})})})]})]})}),di.jsxs("div",{className:"flex-1 bg-gray-50",children:[di.jsx("div",{className:"bg-white",children:di.jsx($n,{conditions:_,onConditionsChange:A,availableFields:[{id:"dim1",name:"产品名称",type:"dimension",componentType:"input",description:"检测产品的具体名称"},{id:"dim2",name:"规格型号",type:"dimension",componentType:"select",options:["A型","B型","C型"],description:"产品的规格参数"},{id:"dim3",name:"生产厂家",type:"dimension",componentType:"multiSelect",options:["厂家A","厂家B","厂家C"],description:"产品生产厂商"},{id:"dim4",name:"省份",type:"dimension",componentType:"select",options:["北京","上海","广东","江苏"],description:"销售区域省份"},{id:"dim5",name:"医院等级",type:"dimension",componentType:"select",options:["三甲","三乙","二甲"],description:"医疗机构等级分类"},{id:"dim6",name:"采购日期",type:"dimension",componentType:"dateRangePicker",description:"采购日期范围"},{id:"dim7",name:"组织机构",type:"dimension",componentType:"modalSelector",description:"选择组织机构"},{id:"met1",name:"中标价格",type:"metric",componentType:"numberRange",description:"产品中标价格"},{id:"met2",name:"挂网价格",type:"metric",componentType:"numberRange",description:"平台挂网价格"},{id:"met3",name:"采购量",type:"metric",componentType:"numberRange",description:"采购数量统计"},{id:"met4",name:"采购金额",type:"metric",componentType:"numberRange",description:"采购总金额"}],predefinedConditions:[{id:"predefined-1",fieldId:"dim5",fieldName:"医院等级",fieldType:"dimension",groupType:"comparison",value:["三甲"],isPredefined:!0,componentType:"multiSelect"},{id:"predefined-2",fieldId:"met1",fieldName:"中标价格",fieldType:"metric",groupType:"metric",value:{min:100,max:1e4},isPredefined:!0,componentType:"numberRange"},{id:"predefined-3",fieldId:"dim2",fieldName:"规格型号",fieldType:"dimension",groupType:"baseline",value:"A型",isPredefined:!0,componentType:"select",baselineName:"集团价"},{id:"predefined-4",fieldId:"dim3",fieldName:"生产厂家",fieldType:"dimension",groupType:"baseline",value:["厂家A","厂家B"],isPredefined:!0,componentType:"multiSelect",baselineName:"集团价"},{id:"predefined-5",fieldId:"dim6",fieldName:"采购日期",fieldType:"dimension",groupType:"baseline",value:null,isPredefined:!0,componentType:"dateRangePicker",baselineName:"历史价"},{id:"predefined-6",fieldId:"dim4",fieldName:"省份",fieldType:"dimension",groupType:"baseline",value:["北京","上海"],isPredefined:!0,componentType:"multiSelect",baselineName:"历史价"}]})}),di.jsxs("div",{className:"bg-white border-b",children:[di.jsx("div",{className:"px-3 py-2 border-b border-gray-100",children:di.jsx(Vn,{level:4,className:"mb-0 text-sm",children:"报表布局配置"})}),di.jsxs("div",{className:"bg-gray-50",children:[$("行维度","row"),$("列维度","column"),$("指标","value")]})]}),di.jsxs("div",{className:"px-3 py-2",children:[di.jsxs("div",{className:"flex items-center justify-between mb-2",children:[di.jsx(Vn,{level:4,className:"mb-0 text-sm",children:"报表预览"}),di.jsx(Hn,{type:"secondary",className:"text-xs",children:d.length>0?`已配置 ${d.length} 个字段`:"请先配置报表布局"})]}),di.jsx("div",{className:"bg-white rounded p-3 shadow-sm",children:B.length>0?di.jsx("div",{className:"overflow-auto",children:di.jsx(pe,{dataCfg:{data:B,fields:F,meta:[{field:"*",formatter:e=>"number"==typeof e?e.toLocaleString():e}]},options:{width:800,height:400,showSeriesNumber:!0,interaction:{enableCopy:!0,autoResetSheetStyle:!1},tooltip:{showTooltip:!0,operation:{hiddenColumns:!0}},style:{layoutContentType:"table",cellCfg:{width:120,height:32},rowCfg:{width:120},colCfg:{width:120,height:32}}}})}):di.jsxs("div",{className:"text-center py-8",children:[di.jsx("div",{className:"mb-3",children:di.jsx("div",{className:"w-12 h-12 mx-auto rounded-full bg-gray-100 flex items-center justify-center",children:di.jsx(Fs,{className:"text-xl text-gray-400"})})}),di.jsx(xe,{image:xe.PRESENTED_IMAGE_SIMPLE,description:"请拖拽字段到上方配置区域以生成报表预览"})]})})]})]})]}),di.jsx(Rn,{open:S,reportId:"report_temp_id",reportName:i.getFieldValue("reportName")||"新报表",onClose:()=>{k(!1)},onSave:e=>{}})]})})},group:"二期"},{title:"报表中心",to:"/report-center-v2",icon:di.jsx(st,{className:"h-4 w-4"}),component:()=>{const[t,i]=j.useState([{id:"group_001",name:"体外诊断试剂报表",description:"体外诊断试剂相关比价报表",createTime:"2024-01-01 10:00:00"},{id:"group_002",name:"医疗设备报表",description:"医疗设备采购比价报表",createTime:"2024-01-02 10:00:00"},{id:"group_003",name:"药品报表",description:"药品价格对比报表",createTime:"2024-01-03 10:00:00"}]),[s,l]=j.useState([{id:"report_001",name:"2024年Q1体外诊断试剂比价报表",groupId:"group_001",schemeId:"scheme_001",schemeName:"体外诊断试剂比价方案",organization:"上海总部",createTime:"2024-01-15 10:30:00",updateTime:"2024-01-15 14:20:00",status:"PUBLISHED",creator:"张三",description:"第一季度体外诊断试剂价格对比分析",content:"这里是体外诊断试剂报表的具体内容，包含图表、数据表格等..."},{id:"report_002",name:"2023年生化试剂采购分析报告",groupId:"group_001",schemeId:"scheme_001",schemeName:"体外诊断试剂比价方案",organization:"上海总部",createTime:"2023-12-10 14:20:00",updateTime:"2023-12-12 16:30:00",status:"PUBLISHED",creator:"李四",description:"生化试剂年度采购价格分析与趋势预测",content:"这里是生化试剂比价报表的具体内容..."},{id:"report_003",name:"免疫试剂供应商比价分析",groupId:"group_001",schemeId:"scheme_001",schemeName:"体外诊断试剂比价方案",organization:"上海总部",createTime:"2023-11-05 09:15:00",updateTime:"2023-11-06 11:45:00",status:"DRAFT",creator:"王五",description:"免疫试剂类产品供应商价格对比分析",content:"这里是免疫试剂比价报表的具体内容..."},{id:"report_004",name:"分子诊断试剂成本分析",groupId:"group_001",schemeId:"scheme_001",schemeName:"体外诊断试剂比价方案",organization:"上海总部",createTime:"2023-10-18 16:00:00",updateTime:"2023-10-20 10:30:00",status:"PUBLISHED",creator:"赵六",description:"分子诊断试剂产品线成本结构分析",content:"这里是分子诊断试剂报表的具体内容..."},{id:"report_005",name:"2023年医疗设备采购比价分析",groupId:"group_002",schemeId:"scheme_002",schemeName:"医疗设备比价方案",organization:"北京分公司",createTime:"2023-12-20 09:15:00",updateTime:"2023-12-22 16:45:00",status:"PUBLISHED",creator:"李四",description:"2023年度医疗设备采购价格对比分析报告",content:"这里是医疗设备比价报表的具体内容..."},{id:"report_006",name:"影像设备维护成本分析",groupId:"group_002",schemeId:"scheme_002",schemeName:"医疗设备比价方案",organization:"北京分公司",createTime:"2023-11-15 13:30:00",updateTime:"2023-11-16 15:20:00",status:"PUBLISHED",creator:"张三",description:"大型影像设备全生命周期成本分析",content:"这里是影像设备成本分析报表的具体内容..."},{id:"report_007",name:"手术器械供应商评估",groupId:"group_002",schemeId:"scheme_002",schemeName:"医疗设备比价方案",organization:"北京分公司",createTime:"2023-09-28 10:45:00",updateTime:"2023-09-29 14:15:00",status:"DRAFT",creator:"王五",description:"手术器械类供应商综合评估报告",content:"这里是手术器械评估报表的具体内容..."},{id:"report_008",name:"华南区药品比价报表",groupId:"group_003",schemeId:"scheme_003",schemeName:"药品比价方案",organization:"广州分公司",createTime:"2023-11-08 11:20:00",updateTime:"2023-11-08 11:20:00",status:"DRAFT",creator:"王五",description:"华南地区药品价格对比分析",content:"这里是药品比价报表的具体内容..."},{id:"report_009",name:"抗生素类药物价格趋势分析",groupId:"group_003",schemeId:"scheme_003",schemeName:"药品比价方案",organization:"广州分公司",createTime:"2023-10-12 16:30:00",updateTime:"2023-10-13 09:45:00",status:"PUBLISHED",creator:"赵六",description:"抗生素类药品市场价格走势与预测分析",content:"这里是抗生素价格分析报表的具体内容..."}]),[n,a]=j.useState(null),[d,r]=j.useState(null),[o,p]=j.useState(""),[x,h]=j.useState([]),[u,f]=j.useState(!1),[g,v]=j.useState(null),[b,C]=j.useState(!1),[N,I]=j.useState(""),[w,S]=j.useState(!1),[k,T]=j.useState(null),[_,A]=j.useState(!1),[R,z]=j.useState(null),[M]=W.useForm(),O=j.useCallback((e,t)=>{const{node:i}=t;if(i.isLeaf){const e=s.find(e=>e.id===i.key);e&&(r(e),a(null))}else a(i.key),r(null),h(e=>[...e.filter(e=>e!==i.key),i.key])},[s]),L=e=>{v(e),G.info({title:"编辑报表",content:di.jsxs("div",{children:[di.jsxs("p",{children:["报表名称：",e.name]}),di.jsxs("p",{children:["创建时间：",e.createTime]}),di.jsxs("p",{children:["状态：","PUBLISHED"===e.status?"已发布":"草稿"]}),di.jsx("p",{children:"这里可以添加编辑表单..."})]}),width:600,onOk:()=>{v(null),te.info("编辑功能待实现")}})},P=e=>{const t=`${window.location.origin}/share/report/${e.id}`;I(t),C(!0)};return di.jsxs("div",{className:"h-screen flex flex-col bg-gray-100",children:[di.jsx("div",{className:"bg-white shadow-sm p-4 border-b",children:di.jsxs("div",{children:[di.jsx(_a,{level:3,className:"mb-0",children:"报表中心"}),di.jsx(Aa,{type:"secondary",children:"管理和查看各类比价分析报表"})]})}),di.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[di.jsxs("div",{className:"w-80 bg-white border-r overflow-hidden flex flex-col",children:[di.jsx("div",{className:"p-4 border-b",children:di.jsx(Ra,{placeholder:"搜索报表...",value:o,onChange:e=>p(e.target.value),prefix:di.jsx(le,{}),allowClear:!0})}),di.jsx("div",{className:"border-b",children:di.jsxs("div",{className:"px-4 py-3 flex justify-between items-center",children:[di.jsx("span",{className:"font-medium text-gray-700",children:"报表分组"}),di.jsx(E,{type:"primary",size:"small",icon:di.jsx(K,{}),onClick:()=>{M.resetFields(),T(null),f(!0)},children:"新建分组"})]})}),di.jsxs("div",{className:"flex-1 overflow-auto p-4",children:[di.jsx("style",{jsx:!0,children:"\n              .custom-tree .ant-tree-node-content-wrapper {\n                display: flex;\n                align-items: center;\n                min-height: 32px;\n              }\n              .custom-tree .ant-tree-title {\n                flex: 1;\n                display: flex;\n                align-items: center;\n              }\n              .custom-tree .ant-tree-switcher {\n                display: flex;\n                align-items: center;\n              }\n              .custom-tree .ant-tree-node-content-wrapper:hover {\n                background-color: transparent;\n              }\n              .custom-tree .ant-tree-node-content-wrapper.ant-tree-node-selected {\n                background-color: transparent;\n              }\n            "}),di.jsx(ne,{showIcon:!0,treeData:t.map(e=>{const l=s.filter(t=>t.groupId===e.id),d=n===e.id;return{title:di.jsxs("div",{className:"flex justify-between items-center pr-2 group rounded px-2 py-1 "+(d?"bg-blue-50":"hover:bg-gray-50"),children:[di.jsx("span",{className:"flex-1 truncate",children:e.name}),di.jsx(oe,{menu:{items:[{key:"edit",label:"编辑分组",icon:di.jsx(X,{}),onClick:()=>(e=>{T(e),M.setFieldsValue({name:e.name,description:e.description}),f(!0)})(e)},{key:"delete",label:"删除分组",icon:di.jsx(ee,{}),danger:!0,onClick:()=>{return l=e.id,void G.confirm({title:"确认删除分组",content:"删除分组后，该分组下的所有报表也将被删除，此操作不可恢复。",okText:"确定删除",okType:"danger",cancelText:"取消",onOk:()=>{s.filter(e=>e.groupId===l).length>0?te.warning("该分组下还有报表，请先移动或删除报表"):(i(t.filter(e=>e.id!==l)),n===l&&a(null),te.success("分组删除成功"))}});var l}}]},trigger:["click"],placement:"bottomRight",children:di.jsx(E,{type:"text",size:"small",icon:di.jsx(xl,{}),className:"opacity-60 group-hover:opacity-100 ml-2 transition-opacity "+(d?"text-blue-600":""),onClick:e=>e.stopPropagation()})})]}),key:e.id,icon:di.jsx(re,{className:d?"text-blue-600":""}),children:l.map(e=>({title:e.name,key:e.id,icon:di.jsx(de,{}),isLeaf:!0,reportData:e}))}}),onSelect:O,expandedKeys:x,onExpand:h,blockNode:!0,className:"custom-tree"})]})]}),di.jsx("div",{className:"flex-1 overflow-auto",children:di.jsx("div",{className:"p-6 h-full",children:w?di.jsx("div",{className:"flex justify-center items-center h-full",children:di.jsx(Ee,{size:"large"})}):(()=>{if(d)return di.jsxs("div",{className:"h-full flex flex-col",children:[di.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b",children:[di.jsxs("div",{children:[di.jsx(_a,{level:4,className:"mb-2",children:d.name}),di.jsxs(J,{children:[di.jsxs(Aa,{type:"secondary",children:["创建者：",d.creator]}),di.jsxs(Aa,{type:"secondary",children:["创建时间：",d.createTime]}),di.jsxs(Aa,{type:"secondary",children:["状态：","PUBLISHED"===d.status?"已发布":"草稿"]})]})]}),di.jsxs(J,{children:[di.jsx(E,{icon:di.jsx(X,{}),onClick:()=>L(d),children:"编辑"}),di.jsx(E,{icon:di.jsx(Fl,{}),onClick:()=>P(d),children:"分享"})]})]}),di.jsx("div",{className:"flex-1 bg-gray-50 p-6 rounded-lg",children:di.jsxs("div",{className:"bg-white p-6 rounded shadow-sm",children:[di.jsx(_a,{level:5,children:"报表内容"}),di.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded",children:d.content||"报表内容加载中..."})]})})]});if(n){const i=(e=n,s.filter(t=>t.groupId===e)),l=t.find(e=>e.id===n);return di.jsxs("div",{className:"h-full",children:[di.jsxs("div",{className:"mb-6",children:[di.jsx(_a,{level:4,children:null==l?void 0:l.name}),di.jsx(Aa,{type:"secondary",children:null==l?void 0:l.description})]}),i.length>0?di.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:i.map(e=>di.jsx(D,{hoverable:!0,className:"cursor-pointer transition-all hover:shadow-lg hover:border-blue-200 border-2",onClick:()=>r(e),bodyStyle:{padding:"20px"},children:di.jsxs("div",{className:"flex flex-col h-full",children:[di.jsxs("div",{className:"flex items-center mb-4",children:[di.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-lg flex items-center justify-center mr-3",children:di.jsx(de,{className:"text-blue-500 text-lg"})}),di.jsx("div",{className:"flex-1 min-w-0",children:di.jsx("div",{className:"font-semibold text-gray-900 text-sm truncate",children:e.name})})]}),di.jsx("div",{className:"flex-1 mb-4",children:di.jsx(Aa,{type:"secondary",className:"text-xs leading-relaxed line-clamp-3",children:e.description})}),di.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[di.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[di.jsx("span",{children:e.creator}),di.jsx("span",{className:"mx-2",children:"·"}),di.jsx("span",{children:be(e.createTime).format("YYYY-MM-DD")})]}),di.jsxs("div",{className:"flex space-x-1",children:[di.jsx(E,{type:"text",size:"small",icon:di.jsx(X,{}),className:"text-gray-400 hover:text-blue-500 p-1",onClick:t=>{t.stopPropagation(),L(e)}}),di.jsx(E,{type:"text",size:"small",icon:di.jsx(Xs,{}),className:"text-gray-400 hover:text-blue-500 p-1",onClick:t=>{t.stopPropagation(),(e=>{z(e),A(!0)})(e)}}),di.jsx(E,{type:"text",size:"small",icon:di.jsx(Fl,{}),className:"text-gray-400 hover:text-blue-500 p-1",onClick:t=>{t.stopPropagation(),P(e)}})]})]})]})},e.id))}):di.jsx(xe,{description:"该分组下暂无报表",image:xe.PRESENTED_IMAGE_SIMPLE})]})}var e;return di.jsx("div",{className:"h-full flex items-center justify-center",children:di.jsx(xe,{description:"请选择左侧分组或报表查看内容",image:xe.PRESENTED_IMAGE_SIMPLE})})})()})})]}),di.jsx(G,{title:k?"编辑分组":"新增分组",open:u,onCancel:()=>{f(!1),T(null)},onOk:()=>M.submit(),destroyOnClose:!0,children:di.jsxs(W,{form:M,layout:"vertical",onFinish:s=>y(e,null,function*(){try{if(k)i(t.map(e=>e.id===k.id?m(c({},e),{name:s.name,description:s.description}):e)),te.success("分组更新成功");else{const e={id:`group_${Date.now()}`,name:s.name,description:s.description,createTime:be().format("YYYY-MM-DD HH:mm:ss")};i([...t,e]),te.success("分组创建成功")}f(!1),T(null)}catch(e){te.error("操作失败")}}),children:[di.jsx(W.Item,{name:"name",label:"分组名称",rules:[{required:!0,message:"请输入分组名称"}],children:di.jsx(U,{placeholder:"请输入分组名称"})}),di.jsx(W.Item,{name:"description",label:"分组描述",children:di.jsx(U.TextArea,{placeholder:"请输入分组描述",rows:3})})]})}),di.jsxs(G,{title:"分享报表",open:b,onCancel:()=>C(!1),footer:[di.jsx(E,{type:"primary",onClick:()=>{navigator.clipboard.writeText(N),te.success("分享链接已复制到剪贴板")},children:"复制链接"},"copy"),di.jsx(E,{onClick:()=>C(!1),children:"关闭"},"close")],children:[di.jsx("div",{className:"p-4 bg-gray-50 rounded",children:di.jsx(Aa,{code:!0,className:"break-all",children:N})}),di.jsx(Aa,{type:"secondary",className:"text-sm mt-2 block",children:"通过此链接，其他人可以查看此报表内容"})]}),di.jsx(G,{title:`操作日志 - ${null==R?void 0:R.name}`,open:_,onCancel:()=>{A(!1),z(null)},footer:[di.jsx(E,{onClick:()=>{A(!1),z(null)},children:"关闭"},"close")],width:700,children:R&&di.jsx("div",{className:"max-h-96 overflow-auto",children:di.jsx(Me,{dataSource:(F=R.id,[{id:"log_001",reportId:F,operation:"CREATE",operator:"张三",operationTime:"2024-01-15 10:30:00",description:"创建了报表",details:'使用"体外诊断试剂比价方案"创建了新报表'},{id:"log_002",reportId:F,operation:"UPDATE",operator:"张三",operationTime:"2024-01-15 14:20:00",description:"更新了报表内容",details:"修改了报表标题和描述信息"},{id:"log_003",reportId:F,operation:"VIEW",operator:"李四",operationTime:"2024-01-16 09:15:00",description:"查看了报表",details:"查看了报表详情页面"},{id:"log_004",reportId:F,operation:"SHARE",operator:"张三",operationTime:"2024-01-16 11:30:00",description:"分享了报表",details:"生成了分享链接，发送给了相关人员"},{id:"log_005",reportId:F,operation:"UPDATE",operator:"王五",operationTime:"2024-01-17 16:45:00",description:"编辑了报表",details:"更新了报表的数据源配置"}].map((e,t)=>m(c({},e),{operationTime:be(e.operationTime).subtract(Math.floor(30*Math.random()),"day").format("YYYY-MM-DD HH:mm:ss")}))),renderItem:e=>{const t={CREATE:{name:"创建",color:"green"},UPDATE:{name:"更新",color:"blue"},DELETE:{name:"删除",color:"red"},SHARE:{name:"分享",color:"orange"},VIEW:{name:"查看",color:"gray"}}[i=e.operation]||{name:i,color:"default"};var i;return di.jsx(Me.Item,{className:"border-b border-gray-100",children:di.jsxs("div",{className:"w-full",children:[di.jsxs("div",{className:"flex justify-between items-start mb-2",children:[di.jsxs("div",{className:"flex items-center space-x-2",children:[di.jsx(B,{color:t.color,children:t.name}),di.jsx("span",{className:"font-medium",children:e.operator})]}),di.jsx("span",{className:"text-xs text-gray-500",children:be(e.operationTime).format("YYYY-MM-DD HH:mm:ss")})]}),di.jsx("div",{className:"text-sm text-gray-700 mb-1",children:e.description}),e.details&&di.jsx("div",{className:"text-xs text-gray-500 bg-gray-50 p-2 rounded",children:e.details})]})})}})})})]});var F},group:"二期"}],{Sider:Ea,Content:Ma}=ye,Da=({children:e})=>{const t=N(),[i,s]=j.useState(!1),l=za.reduce((e,t)=>{const i=t.group||"一期";return e[i]||(e[i]=[]),e[i].push({key:t.to,icon:t.icon,label:di.jsx(I,{to:t.to,className:"text-inherit",children:t.title})}),e},{}),n=[],a=["二期","一期"];return a.forEach((e,t)=>{l[e]&&l[e].length>0&&(n.push({key:`group-${e}`,label:i?di.jsx(se,{title:e,placement:"right",children:di.jsx("span",{className:"font-semibold text-gray-600",children:e.charAt(0)})}):di.jsx("span",{className:"font-semibold text-gray-600 text-sm",children:e}),disabled:!0,type:"group"}),n.push(...l[e]),t<a.length-1&&!i&&n.push({key:`divider-${e}`,type:"divider"}))}),di.jsxs(ye,{style:{minHeight:"100vh"},children:[di.jsxs(Ea,{width:256,collapsedWidth:80,collapsed:i,theme:"light",className:"shadow-lg",trigger:null,children:[di.jsx("div",{className:"p-6 "+(i?"px-4":""),children:i?di.jsx(se,{title:"智能比价分析平台",placement:"right",children:di.jsx("div",{className:"text-center",children:di.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded text-white flex items-center justify-center text-sm font-bold",children:"智"})})}):di.jsx("h1",{className:"text-xl font-bold text-gray-800 mb-8",children:"智能比价分析平台"})}),di.jsx("div",{className:"px-4 mb-4 "+(i?"text-center":""),children:di.jsx(E,{type:"text",icon:i?di.jsx(cl,{}):di.jsx(dl,{}),onClick:()=>s(!i),className:"w-full"})}),di.jsx(De,{mode:"inline",selectedKeys:[t.pathname],items:n,className:"border-r-0",inlineCollapsed:i})]}),di.jsx(Ma,{className:"bg-gray-50",children:di.jsx("div",{className:"p-6",children:e})})]})},Oa=new Qi,La=()=>di.jsx(Xi,{client:Oa,children:di.jsx(Oe,{locale:ws,children:di.jsx(w,{basename:"/",children:di.jsx(Da,{children:di.jsx(S,{children:za.map(({to:e,component:t})=>di.jsx(k,{path:e,element:di.jsx(t,{})},e))})})})})});ri.createRoot(document.getElementById("root")).render(di.jsx(La,{}))}},function(){return gt||(0,ft[s(ft)[0]])((gt={exports:{}}).exports,gt),gt.exports});export default yt();
